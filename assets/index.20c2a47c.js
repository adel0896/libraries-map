function JS(i,s){for(var h=0;h<s.length;h++){const m=s[h];if(typeof m!="string"&&!Array.isArray(m)){for(const v in m)if(v!=="default"&&!(v in i)){const T=Object.getOwnPropertyDescriptor(m,v);T&&Object.defineProperty(i,v,T.get?T:{enumerable:!0,get:()=>m[v]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const v of document.querySelectorAll('link[rel="modulepreload"]'))m(v);new MutationObserver(v=>{for(const T of v)if(T.type==="childList")for(const I of T.addedNodes)I.tagName==="LINK"&&I.rel==="modulepreload"&&m(I)}).observe(document,{childList:!0,subtree:!0});function h(v){const T={};return v.integrity&&(T.integrity=v.integrity),v.referrerpolicy&&(T.referrerPolicy=v.referrerpolicy),v.crossorigin==="use-credentials"?T.credentials="include":v.crossorigin==="anonymous"?T.credentials="omit":T.credentials="same-origin",T}function m(v){if(v.ep)return;v.ep=!0;const T=h(v);fetch(v.href,T)}})();var QS=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function eC(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var At={exports:{}},Kt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Md=Symbol.for("react.element"),tC=Symbol.for("react.portal"),nC=Symbol.for("react.fragment"),rC=Symbol.for("react.strict_mode"),iC=Symbol.for("react.profiler"),oC=Symbol.for("react.provider"),sC=Symbol.for("react.context"),aC=Symbol.for("react.forward_ref"),lC=Symbol.for("react.suspense"),cC=Symbol.for("react.memo"),uC=Symbol.for("react.lazy"),x1=Symbol.iterator;function hC(i){return i===null||typeof i!="object"?null:(i=x1&&i[x1]||i["@@iterator"],typeof i=="function"?i:null)}var qw={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Ww=Object.assign,Xw={};function su(i,s,h){this.props=i,this.context=s,this.refs=Xw,this.updater=h||qw}su.prototype.isReactComponent={};su.prototype.setState=function(i,s){if(typeof i!="object"&&typeof i!="function"&&i!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,i,s,"setState")};su.prototype.forceUpdate=function(i){this.updater.enqueueForceUpdate(this,i,"forceUpdate")};function Hw(){}Hw.prototype=su.prototype;function Dy(i,s,h){this.props=i,this.context=s,this.refs=Xw,this.updater=h||qw}var Ly=Dy.prototype=new Hw;Ly.constructor=Dy;Ww(Ly,su.prototype);Ly.isPureReactComponent=!0;var v1=Array.isArray,Yw=Object.prototype.hasOwnProperty,Ry={current:null},Kw={key:!0,ref:!0,__self:!0,__source:!0};function Jw(i,s,h){var m,v={},T=null,I=null;if(s!=null)for(m in s.ref!==void 0&&(I=s.ref),s.key!==void 0&&(T=""+s.key),s)Yw.call(s,m)&&!Kw.hasOwnProperty(m)&&(v[m]=s[m]);var a=arguments.length-2;if(a===1)v.children=h;else if(1<a){for(var B=Array(a),G=0;G<a;G++)B[G]=arguments[G+2];v.children=B}if(i&&i.defaultProps)for(m in a=i.defaultProps,a)v[m]===void 0&&(v[m]=a[m]);return{$$typeof:Md,type:i,key:T,ref:I,props:v,_owner:Ry.current}}function dC(i,s){return{$$typeof:Md,type:i.type,key:s,ref:i.ref,props:i.props,_owner:i._owner}}function By(i){return typeof i=="object"&&i!==null&&i.$$typeof===Md}function pC(i){var s={"=":"=0",":":"=2"};return"$"+i.replace(/[=:]/g,function(h){return s[h]})}var w1=/\/+/g;function lg(i,s){return typeof i=="object"&&i!==null&&i.key!=null?pC(""+i.key):s.toString(36)}function Bf(i,s,h,m,v){var T=typeof i;(T==="undefined"||T==="boolean")&&(i=null);var I=!1;if(i===null)I=!0;else switch(T){case"string":case"number":I=!0;break;case"object":switch(i.$$typeof){case Md:case tC:I=!0}}if(I)return I=i,v=v(I),i=m===""?"."+lg(I,0):m,v1(v)?(h="",i!=null&&(h=i.replace(w1,"$&/")+"/"),Bf(v,s,h,"",function(G){return G})):v!=null&&(By(v)&&(v=dC(v,h+(!v.key||I&&I.key===v.key?"":(""+v.key).replace(w1,"$&/")+"/")+i)),s.push(v)),1;if(I=0,m=m===""?".":m+":",v1(i))for(var a=0;a<i.length;a++){T=i[a];var B=m+lg(T,a);I+=Bf(T,s,h,B,v)}else if(B=hC(i),typeof B=="function")for(i=B.call(i),a=0;!(T=i.next()).done;)T=T.value,B=m+lg(T,a++),I+=Bf(T,s,h,B,v);else if(T==="object")throw s=String(i),Error("Objects are not valid as a React child (found: "+(s==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":s)+"). If you meant to render a collection of children, use an array instead.");return I}function yf(i,s,h){if(i==null)return i;var m=[],v=0;return Bf(i,m,"","",function(T){return s.call(h,T,v++)}),m}function fC(i){if(i._status===-1){var s=i._result;s=s(),s.then(function(h){(i._status===0||i._status===-1)&&(i._status=1,i._result=h)},function(h){(i._status===0||i._status===-1)&&(i._status=2,i._result=h)}),i._status===-1&&(i._status=0,i._result=s)}if(i._status===1)return i._result.default;throw i._result}var Vr={current:null},Of={transition:null},mC={ReactCurrentDispatcher:Vr,ReactCurrentBatchConfig:Of,ReactCurrentOwner:Ry};Kt.Children={map:yf,forEach:function(i,s,h){yf(i,function(){s.apply(this,arguments)},h)},count:function(i){var s=0;return yf(i,function(){s++}),s},toArray:function(i){return yf(i,function(s){return s})||[]},only:function(i){if(!By(i))throw Error("React.Children.only expected to receive a single React element child.");return i}};Kt.Component=su;Kt.Fragment=nC;Kt.Profiler=iC;Kt.PureComponent=Dy;Kt.StrictMode=rC;Kt.Suspense=lC;Kt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=mC;Kt.cloneElement=function(i,s,h){if(i==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+i+".");var m=Ww({},i.props),v=i.key,T=i.ref,I=i._owner;if(s!=null){if(s.ref!==void 0&&(T=s.ref,I=Ry.current),s.key!==void 0&&(v=""+s.key),i.type&&i.type.defaultProps)var a=i.type.defaultProps;for(B in s)Yw.call(s,B)&&!Kw.hasOwnProperty(B)&&(m[B]=s[B]===void 0&&a!==void 0?a[B]:s[B])}var B=arguments.length-2;if(B===1)m.children=h;else if(1<B){a=Array(B);for(var G=0;G<B;G++)a[G]=arguments[G+2];m.children=a}return{$$typeof:Md,type:i.type,key:v,ref:T,props:m,_owner:I}};Kt.createContext=function(i){return i={$$typeof:sC,_currentValue:i,_currentValue2:i,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},i.Provider={$$typeof:oC,_context:i},i.Consumer=i};Kt.createElement=Jw;Kt.createFactory=function(i){var s=Jw.bind(null,i);return s.type=i,s};Kt.createRef=function(){return{current:null}};Kt.forwardRef=function(i){return{$$typeof:aC,render:i}};Kt.isValidElement=By;Kt.lazy=function(i){return{$$typeof:uC,_payload:{_status:-1,_result:i},_init:fC}};Kt.memo=function(i,s){return{$$typeof:cC,type:i,compare:s===void 0?null:s}};Kt.startTransition=function(i){var s=Of.transition;Of.transition={};try{i()}finally{Of.transition=s}};Kt.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};Kt.useCallback=function(i,s){return Vr.current.useCallback(i,s)};Kt.useContext=function(i){return Vr.current.useContext(i)};Kt.useDebugValue=function(){};Kt.useDeferredValue=function(i){return Vr.current.useDeferredValue(i)};Kt.useEffect=function(i,s){return Vr.current.useEffect(i,s)};Kt.useId=function(){return Vr.current.useId()};Kt.useImperativeHandle=function(i,s,h){return Vr.current.useImperativeHandle(i,s,h)};Kt.useInsertionEffect=function(i,s){return Vr.current.useInsertionEffect(i,s)};Kt.useLayoutEffect=function(i,s){return Vr.current.useLayoutEffect(i,s)};Kt.useMemo=function(i,s){return Vr.current.useMemo(i,s)};Kt.useReducer=function(i,s,h){return Vr.current.useReducer(i,s,h)};Kt.useRef=function(i){return Vr.current.useRef(i)};Kt.useState=function(i){return Vr.current.useState(i)};Kt.useSyncExternalStore=function(i,s,h){return Vr.current.useSyncExternalStore(i,s,h)};Kt.useTransition=function(){return Vr.current.useTransition()};Kt.version="18.2.0";(function(i){i.exports=Kt})(At);const _C=eC(At.exports);var Og={},Tm={exports:{}},_i={},Qw={exports:{}},eb={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function s(st,zt){var _t=st.length;st.push(zt);e:for(;0<_t;){var dn=_t-1>>>1,bn=st[dn];if(0<v(bn,zt))st[dn]=zt,st[_t]=bn,_t=dn;else break e}}function h(st){return st.length===0?null:st[0]}function m(st){if(st.length===0)return null;var zt=st[0],_t=st.pop();if(_t!==zt){st[0]=_t;e:for(var dn=0,bn=st.length,br=bn>>>1;dn<br;){var qn=2*(dn+1)-1,ti=st[qn],dr=qn+1,Xn=st[dr];if(0>v(ti,_t))dr<bn&&0>v(Xn,ti)?(st[dn]=Xn,st[dr]=_t,dn=dr):(st[dn]=ti,st[qn]=_t,dn=qn);else if(dr<bn&&0>v(Xn,_t))st[dn]=Xn,st[dr]=_t,dn=dr;else break e}}return zt}function v(st,zt){var _t=st.sortIndex-zt.sortIndex;return _t!==0?_t:st.id-zt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var T=performance;i.unstable_now=function(){return T.now()}}else{var I=Date,a=I.now();i.unstable_now=function(){return I.now()-a}}var B=[],G=[],he=1,le=null,ye=3,Fe=!1,Ie=!1,Ue=!1,Ft=typeof setTimeout=="function"?setTimeout:null,me=typeof clearTimeout=="function"?clearTimeout:null,de=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function be(st){for(var zt=h(G);zt!==null;){if(zt.callback===null)m(G);else if(zt.startTime<=st)m(G),zt.sortIndex=zt.expirationTime,s(B,zt);else break;zt=h(G)}}function He(st){if(Ue=!1,be(st),!Ie)if(h(B)!==null)Ie=!0,Fi(Me);else{var zt=h(G);zt!==null&&ei(He,zt.startTime-st)}}function Me(st,zt){Ie=!1,Ue&&(Ue=!1,me(vt),vt=-1),Fe=!0;var _t=ye;try{for(be(zt),le=h(B);le!==null&&(!(le.expirationTime>zt)||st&&!hr());){var dn=le.callback;if(typeof dn=="function"){le.callback=null,ye=le.priorityLevel;var bn=dn(le.expirationTime<=zt);zt=i.unstable_now(),typeof bn=="function"?le.callback=bn:le===h(B)&&m(B),be(zt)}else m(B);le=h(B)}if(le!==null)var br=!0;else{var qn=h(G);qn!==null&&ei(He,qn.startTime-zt),br=!1}return br}finally{le=null,ye=_t,Fe=!1}}var ct=!1,dt=null,vt=-1,mt=5,Ct=-1;function hr(){return!(i.unstable_now()-Ct<mt)}function yi(){if(dt!==null){var st=i.unstable_now();Ct=st;var zt=!0;try{zt=dt(!0,st)}finally{zt?Qr():(ct=!1,dt=null)}}else ct=!1}var Qr;if(typeof de=="function")Qr=function(){de(yi)};else if(typeof MessageChannel<"u"){var ao=new MessageChannel,Ot=ao.port2;ao.port1.onmessage=yi,Qr=function(){Ot.postMessage(null)}}else Qr=function(){Ft(yi,0)};function Fi(st){dt=st,ct||(ct=!0,Qr())}function ei(st,zt){vt=Ft(function(){st(i.unstable_now())},zt)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(st){st.callback=null},i.unstable_continueExecution=function(){Ie||Fe||(Ie=!0,Fi(Me))},i.unstable_forceFrameRate=function(st){0>st||125<st?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):mt=0<st?Math.floor(1e3/st):5},i.unstable_getCurrentPriorityLevel=function(){return ye},i.unstable_getFirstCallbackNode=function(){return h(B)},i.unstable_next=function(st){switch(ye){case 1:case 2:case 3:var zt=3;break;default:zt=ye}var _t=ye;ye=zt;try{return st()}finally{ye=_t}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(st,zt){switch(st){case 1:case 2:case 3:case 4:case 5:break;default:st=3}var _t=ye;ye=st;try{return zt()}finally{ye=_t}},i.unstable_scheduleCallback=function(st,zt,_t){var dn=i.unstable_now();switch(typeof _t=="object"&&_t!==null?(_t=_t.delay,_t=typeof _t=="number"&&0<_t?dn+_t:dn):_t=dn,st){case 1:var bn=-1;break;case 2:bn=250;break;case 5:bn=1073741823;break;case 4:bn=1e4;break;default:bn=5e3}return bn=_t+bn,st={id:he++,callback:zt,priorityLevel:st,startTime:_t,expirationTime:bn,sortIndex:-1},_t>dn?(st.sortIndex=_t,s(G,st),h(B)===null&&st===h(G)&&(Ue?(me(vt),vt=-1):Ue=!0,ei(He,_t-dn))):(st.sortIndex=bn,s(B,st),Ie||Fe||(Ie=!0,Fi(Me))),st},i.unstable_shouldYield=hr,i.unstable_wrapCallback=function(st){var zt=ye;return function(){var _t=ye;ye=zt;try{return st.apply(this,arguments)}finally{ye=_t}}}})(eb);(function(i){i.exports=eb})(Qw);/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tb=At.exports,mi=Qw.exports;function Je(i){for(var s="https://reactjs.org/docs/error-decoder.html?invariant="+i,h=1;h<arguments.length;h++)s+="&args[]="+encodeURIComponent(arguments[h]);return"Minified React error #"+i+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var nb=new Set,ld={};function vl(i,s){Jc(i,s),Jc(i+"Capture",s)}function Jc(i,s){for(ld[i]=s,i=0;i<s.length;i++)nb.add(s[i])}var hs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Fg=Object.prototype.hasOwnProperty,gC=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,b1={},T1={};function yC(i){return Fg.call(T1,i)?!0:Fg.call(b1,i)?!1:gC.test(i)?T1[i]=!0:(b1[i]=!0,!1)}function xC(i,s,h,m){if(h!==null&&h.type===0)return!1;switch(typeof s){case"function":case"symbol":return!0;case"boolean":return m?!1:h!==null?!h.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function vC(i,s,h,m){if(s===null||typeof s>"u"||xC(i,s,h,m))return!0;if(m)return!1;if(h!==null)switch(h.type){case 3:return!s;case 4:return s===!1;case 5:return isNaN(s);case 6:return isNaN(s)||1>s}return!1}function Gr(i,s,h,m,v,T,I){this.acceptsBooleans=s===2||s===3||s===4,this.attributeName=m,this.attributeNamespace=v,this.mustUseProperty=h,this.propertyName=i,this.type=s,this.sanitizeURL=T,this.removeEmptyString=I}var vr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){vr[i]=new Gr(i,0,!1,i,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var s=i[0];vr[s]=new Gr(s,1,!1,i[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(i){vr[i]=new Gr(i,2,!1,i.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){vr[i]=new Gr(i,2,!1,i,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){vr[i]=new Gr(i,3,!1,i.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(i){vr[i]=new Gr(i,3,!0,i,null,!1,!1)});["capture","download"].forEach(function(i){vr[i]=new Gr(i,4,!1,i,null,!1,!1)});["cols","rows","size","span"].forEach(function(i){vr[i]=new Gr(i,6,!1,i,null,!1,!1)});["rowSpan","start"].forEach(function(i){vr[i]=new Gr(i,5,!1,i.toLowerCase(),null,!1,!1)});var Oy=/[\-:]([a-z])/g;function Fy(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var s=i.replace(Oy,Fy);vr[s]=new Gr(s,1,!1,i,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var s=i.replace(Oy,Fy);vr[s]=new Gr(s,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(i){var s=i.replace(Oy,Fy);vr[s]=new Gr(s,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(i){vr[i]=new Gr(i,1,!1,i.toLowerCase(),null,!1,!1)});vr.xlinkHref=new Gr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(i){vr[i]=new Gr(i,1,!1,i.toLowerCase(),null,!0,!0)});function Uy(i,s,h,m){var v=vr.hasOwnProperty(s)?vr[s]:null;(v!==null?v.type!==0:m||!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(vC(s,h,v,m)&&(h=null),m||v===null?yC(s)&&(h===null?i.removeAttribute(s):i.setAttribute(s,""+h)):v.mustUseProperty?i[v.propertyName]=h===null?v.type===3?!1:"":h:(s=v.attributeName,m=v.attributeNamespace,h===null?i.removeAttribute(s):(v=v.type,h=v===3||v===4&&h===!0?"":""+h,m?i.setAttributeNS(m,s,h):i.setAttribute(s,h))))}var ms=tb.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,xf=Symbol.for("react.element"),Lc=Symbol.for("react.portal"),Rc=Symbol.for("react.fragment"),Ny=Symbol.for("react.strict_mode"),Ug=Symbol.for("react.profiler"),rb=Symbol.for("react.provider"),ib=Symbol.for("react.context"),jy=Symbol.for("react.forward_ref"),Ng=Symbol.for("react.suspense"),jg=Symbol.for("react.suspense_list"),Vy=Symbol.for("react.memo"),ea=Symbol.for("react.lazy"),ob=Symbol.for("react.offscreen"),E1=Symbol.iterator;function Uh(i){return i===null||typeof i!="object"?null:(i=E1&&i[E1]||i["@@iterator"],typeof i=="function"?i:null)}var On=Object.assign,cg;function Xh(i){if(cg===void 0)try{throw Error()}catch(h){var s=h.stack.trim().match(/\n( *(at )?)/);cg=s&&s[1]||""}return`
`+cg+i}var ug=!1;function hg(i,s){if(!i||ug)return"";ug=!0;var h=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(s)if(s=function(){throw Error()},Object.defineProperty(s.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(s,[])}catch(G){var m=G}Reflect.construct(i,[],s)}else{try{s.call()}catch(G){m=G}i.call(s.prototype)}else{try{throw Error()}catch(G){m=G}i()}}catch(G){if(G&&m&&typeof G.stack=="string"){for(var v=G.stack.split(`
`),T=m.stack.split(`
`),I=v.length-1,a=T.length-1;1<=I&&0<=a&&v[I]!==T[a];)a--;for(;1<=I&&0<=a;I--,a--)if(v[I]!==T[a]){if(I!==1||a!==1)do if(I--,a--,0>a||v[I]!==T[a]){var B=`
`+v[I].replace(" at new "," at ");return i.displayName&&B.includes("<anonymous>")&&(B=B.replace("<anonymous>",i.displayName)),B}while(1<=I&&0<=a);break}}}finally{ug=!1,Error.prepareStackTrace=h}return(i=i?i.displayName||i.name:"")?Xh(i):""}function wC(i){switch(i.tag){case 5:return Xh(i.type);case 16:return Xh("Lazy");case 13:return Xh("Suspense");case 19:return Xh("SuspenseList");case 0:case 2:case 15:return i=hg(i.type,!1),i;case 11:return i=hg(i.type.render,!1),i;case 1:return i=hg(i.type,!0),i;default:return""}}function Vg(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case Rc:return"Fragment";case Lc:return"Portal";case Ug:return"Profiler";case Ny:return"StrictMode";case Ng:return"Suspense";case jg:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case ib:return(i.displayName||"Context")+".Consumer";case rb:return(i._context.displayName||"Context")+".Provider";case jy:var s=i.render;return i=i.displayName,i||(i=s.displayName||s.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case Vy:return s=i.displayName||null,s!==null?s:Vg(i.type)||"Memo";case ea:s=i._payload,i=i._init;try{return Vg(i(s))}catch{}}return null}function bC(i){var s=i.type;switch(i.tag){case 24:return"Cache";case 9:return(s.displayName||"Context")+".Consumer";case 10:return(s._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=s.render,i=i.displayName||i.name||"",s.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return s;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Vg(s);case 8:return s===Ny?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s}return null}function ma(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function sb(i){var s=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function TC(i){var s=sb(i)?"checked":"value",h=Object.getOwnPropertyDescriptor(i.constructor.prototype,s),m=""+i[s];if(!i.hasOwnProperty(s)&&typeof h<"u"&&typeof h.get=="function"&&typeof h.set=="function"){var v=h.get,T=h.set;return Object.defineProperty(i,s,{configurable:!0,get:function(){return v.call(this)},set:function(I){m=""+I,T.call(this,I)}}),Object.defineProperty(i,s,{enumerable:h.enumerable}),{getValue:function(){return m},setValue:function(I){m=""+I},stopTracking:function(){i._valueTracker=null,delete i[s]}}}}function vf(i){i._valueTracker||(i._valueTracker=TC(i))}function ab(i){if(!i)return!1;var s=i._valueTracker;if(!s)return!0;var h=s.getValue(),m="";return i&&(m=sb(i)?i.checked?"true":"false":i.value),i=m,i!==h?(s.setValue(i),!0):!1}function Jf(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function Gg(i,s){var h=s.checked;return On({},s,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:h!=null?h:i._wrapperState.initialChecked})}function S1(i,s){var h=s.defaultValue==null?"":s.defaultValue,m=s.checked!=null?s.checked:s.defaultChecked;h=ma(s.value!=null?s.value:h),i._wrapperState={initialChecked:m,initialValue:h,controlled:s.type==="checkbox"||s.type==="radio"?s.checked!=null:s.value!=null}}function lb(i,s){s=s.checked,s!=null&&Uy(i,"checked",s,!1)}function $g(i,s){lb(i,s);var h=ma(s.value),m=s.type;if(h!=null)m==="number"?(h===0&&i.value===""||i.value!=h)&&(i.value=""+h):i.value!==""+h&&(i.value=""+h);else if(m==="submit"||m==="reset"){i.removeAttribute("value");return}s.hasOwnProperty("value")?Zg(i,s.type,h):s.hasOwnProperty("defaultValue")&&Zg(i,s.type,ma(s.defaultValue)),s.checked==null&&s.defaultChecked!=null&&(i.defaultChecked=!!s.defaultChecked)}function C1(i,s,h){if(s.hasOwnProperty("value")||s.hasOwnProperty("defaultValue")){var m=s.type;if(!(m!=="submit"&&m!=="reset"||s.value!==void 0&&s.value!==null))return;s=""+i._wrapperState.initialValue,h||s===i.value||(i.value=s),i.defaultValue=s}h=i.name,h!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,h!==""&&(i.name=h)}function Zg(i,s,h){(s!=="number"||Jf(i.ownerDocument)!==i)&&(h==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+h&&(i.defaultValue=""+h))}var Hh=Array.isArray;function qc(i,s,h,m){if(i=i.options,s){s={};for(var v=0;v<h.length;v++)s["$"+h[v]]=!0;for(h=0;h<i.length;h++)v=s.hasOwnProperty("$"+i[h].value),i[h].selected!==v&&(i[h].selected=v),v&&m&&(i[h].defaultSelected=!0)}else{for(h=""+ma(h),s=null,v=0;v<i.length;v++){if(i[v].value===h){i[v].selected=!0,m&&(i[v].defaultSelected=!0);return}s!==null||i[v].disabled||(s=i[v])}s!==null&&(s.selected=!0)}}function qg(i,s){if(s.dangerouslySetInnerHTML!=null)throw Error(Je(91));return On({},s,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function M1(i,s){var h=s.value;if(h==null){if(h=s.children,s=s.defaultValue,h!=null){if(s!=null)throw Error(Je(92));if(Hh(h)){if(1<h.length)throw Error(Je(93));h=h[0]}s=h}s==null&&(s=""),h=s}i._wrapperState={initialValue:ma(h)}}function cb(i,s){var h=ma(s.value),m=ma(s.defaultValue);h!=null&&(h=""+h,h!==i.value&&(i.value=h),s.defaultValue==null&&i.defaultValue!==h&&(i.defaultValue=h)),m!=null&&(i.defaultValue=""+m)}function A1(i){var s=i.textContent;s===i._wrapperState.initialValue&&s!==""&&s!==null&&(i.value=s)}function ub(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Wg(i,s){return i==null||i==="http://www.w3.org/1999/xhtml"?ub(s):i==="http://www.w3.org/2000/svg"&&s==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var wf,hb=function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(s,h,m,v){MSApp.execUnsafeLocalFunction(function(){return i(s,h,m,v)})}:i}(function(i,s){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=s;else{for(wf=wf||document.createElement("div"),wf.innerHTML="<svg>"+s.valueOf().toString()+"</svg>",s=wf.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;s.firstChild;)i.appendChild(s.firstChild)}});function cd(i,s){if(s){var h=i.firstChild;if(h&&h===i.lastChild&&h.nodeType===3){h.nodeValue=s;return}}i.textContent=s}var Qh={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},EC=["Webkit","ms","Moz","O"];Object.keys(Qh).forEach(function(i){EC.forEach(function(s){s=s+i.charAt(0).toUpperCase()+i.substring(1),Qh[s]=Qh[i]})});function db(i,s,h){return s==null||typeof s=="boolean"||s===""?"":h||typeof s!="number"||s===0||Qh.hasOwnProperty(i)&&Qh[i]?(""+s).trim():s+"px"}function pb(i,s){i=i.style;for(var h in s)if(s.hasOwnProperty(h)){var m=h.indexOf("--")===0,v=db(h,s[h],m);h==="float"&&(h="cssFloat"),m?i.setProperty(h,v):i[h]=v}}var SC=On({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Xg(i,s){if(s){if(SC[i]&&(s.children!=null||s.dangerouslySetInnerHTML!=null))throw Error(Je(137,i));if(s.dangerouslySetInnerHTML!=null){if(s.children!=null)throw Error(Je(60));if(typeof s.dangerouslySetInnerHTML!="object"||!("__html"in s.dangerouslySetInnerHTML))throw Error(Je(61))}if(s.style!=null&&typeof s.style!="object")throw Error(Je(62))}}function Hg(i,s){if(i.indexOf("-")===-1)return typeof s.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Yg=null;function Gy(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var Kg=null,Wc=null,Xc=null;function I1(i){if(i=zd(i)){if(typeof Kg!="function")throw Error(Je(280));var s=i.stateNode;s&&(s=Am(s),Kg(i.stateNode,i.type,s))}}function fb(i){Wc?Xc?Xc.push(i):Xc=[i]:Wc=i}function mb(){if(Wc){var i=Wc,s=Xc;if(Xc=Wc=null,I1(i),s)for(i=0;i<s.length;i++)I1(s[i])}}function _b(i,s){return i(s)}function gb(){}var dg=!1;function yb(i,s,h){if(dg)return i(s,h);dg=!0;try{return _b(i,s,h)}finally{dg=!1,(Wc!==null||Xc!==null)&&(gb(),mb())}}function ud(i,s){var h=i.stateNode;if(h===null)return null;var m=Am(h);if(m===null)return null;h=m[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(i=i.type,m=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!m;break e;default:i=!1}if(i)return null;if(h&&typeof h!="function")throw Error(Je(231,s,typeof h));return h}var Jg=!1;if(hs)try{var Nh={};Object.defineProperty(Nh,"passive",{get:function(){Jg=!0}}),window.addEventListener("test",Nh,Nh),window.removeEventListener("test",Nh,Nh)}catch{Jg=!1}function CC(i,s,h,m,v,T,I,a,B){var G=Array.prototype.slice.call(arguments,3);try{s.apply(h,G)}catch(he){this.onError(he)}}var ed=!1,Qf=null,em=!1,Qg=null,MC={onError:function(i){ed=!0,Qf=i}};function AC(i,s,h,m,v,T,I,a,B){ed=!1,Qf=null,CC.apply(MC,arguments)}function IC(i,s,h,m,v,T,I,a,B){if(AC.apply(this,arguments),ed){if(ed){var G=Qf;ed=!1,Qf=null}else throw Error(Je(198));em||(em=!0,Qg=G)}}function wl(i){var s=i,h=i;if(i.alternate)for(;s.return;)s=s.return;else{i=s;do s=i,(s.flags&4098)!==0&&(h=s.return),i=s.return;while(i)}return s.tag===3?h:null}function xb(i){if(i.tag===13){var s=i.memoizedState;if(s===null&&(i=i.alternate,i!==null&&(s=i.memoizedState)),s!==null)return s.dehydrated}return null}function z1(i){if(wl(i)!==i)throw Error(Je(188))}function zC(i){var s=i.alternate;if(!s){if(s=wl(i),s===null)throw Error(Je(188));return s!==i?null:i}for(var h=i,m=s;;){var v=h.return;if(v===null)break;var T=v.alternate;if(T===null){if(m=v.return,m!==null){h=m;continue}break}if(v.child===T.child){for(T=v.child;T;){if(T===h)return z1(v),i;if(T===m)return z1(v),s;T=T.sibling}throw Error(Je(188))}if(h.return!==m.return)h=v,m=T;else{for(var I=!1,a=v.child;a;){if(a===h){I=!0,h=v,m=T;break}if(a===m){I=!0,m=v,h=T;break}a=a.sibling}if(!I){for(a=T.child;a;){if(a===h){I=!0,h=T,m=v;break}if(a===m){I=!0,m=T,h=v;break}a=a.sibling}if(!I)throw Error(Je(189))}}if(h.alternate!==m)throw Error(Je(190))}if(h.tag!==3)throw Error(Je(188));return h.stateNode.current===h?i:s}function vb(i){return i=zC(i),i!==null?wb(i):null}function wb(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var s=wb(i);if(s!==null)return s;i=i.sibling}return null}var bb=mi.unstable_scheduleCallback,k1=mi.unstable_cancelCallback,kC=mi.unstable_shouldYield,PC=mi.unstable_requestPaint,Zn=mi.unstable_now,DC=mi.unstable_getCurrentPriorityLevel,$y=mi.unstable_ImmediatePriority,Tb=mi.unstable_UserBlockingPriority,tm=mi.unstable_NormalPriority,LC=mi.unstable_LowPriority,Eb=mi.unstable_IdlePriority,Em=null,Oo=null;function RC(i){if(Oo&&typeof Oo.onCommitFiberRoot=="function")try{Oo.onCommitFiberRoot(Em,i,void 0,(i.current.flags&128)===128)}catch{}}var io=Math.clz32?Math.clz32:FC,BC=Math.log,OC=Math.LN2;function FC(i){return i>>>=0,i===0?32:31-(BC(i)/OC|0)|0}var bf=64,Tf=4194304;function Yh(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function nm(i,s){var h=i.pendingLanes;if(h===0)return 0;var m=0,v=i.suspendedLanes,T=i.pingedLanes,I=h&268435455;if(I!==0){var a=I&~v;a!==0?m=Yh(a):(T&=I,T!==0&&(m=Yh(T)))}else I=h&~v,I!==0?m=Yh(I):T!==0&&(m=Yh(T));if(m===0)return 0;if(s!==0&&s!==m&&(s&v)===0&&(v=m&-m,T=s&-s,v>=T||v===16&&(T&4194240)!==0))return s;if((m&4)!==0&&(m|=h&16),s=i.entangledLanes,s!==0)for(i=i.entanglements,s&=m;0<s;)h=31-io(s),v=1<<h,m|=i[h],s&=~v;return m}function UC(i,s){switch(i){case 1:case 2:case 4:return s+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function NC(i,s){for(var h=i.suspendedLanes,m=i.pingedLanes,v=i.expirationTimes,T=i.pendingLanes;0<T;){var I=31-io(T),a=1<<I,B=v[I];B===-1?((a&h)===0||(a&m)!==0)&&(v[I]=UC(a,s)):B<=s&&(i.expiredLanes|=a),T&=~a}}function ey(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function Sb(){var i=bf;return bf<<=1,(bf&4194240)===0&&(bf=64),i}function pg(i){for(var s=[],h=0;31>h;h++)s.push(i);return s}function Ad(i,s,h){i.pendingLanes|=s,s!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,s=31-io(s),i[s]=h}function jC(i,s){var h=i.pendingLanes&~s;i.pendingLanes=s,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=s,i.mutableReadLanes&=s,i.entangledLanes&=s,s=i.entanglements;var m=i.eventTimes;for(i=i.expirationTimes;0<h;){var v=31-io(h),T=1<<v;s[v]=0,m[v]=-1,i[v]=-1,h&=~T}}function Zy(i,s){var h=i.entangledLanes|=s;for(i=i.entanglements;h;){var m=31-io(h),v=1<<m;v&s|i[m]&s&&(i[m]|=s),h&=~v}}var xn=0;function Cb(i){return i&=-i,1<i?4<i?(i&268435455)!==0?16:536870912:4:1}var Mb,qy,Ab,Ib,zb,ty=!1,Ef=[],aa=null,la=null,ca=null,hd=new Map,dd=new Map,na=[],VC="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function P1(i,s){switch(i){case"focusin":case"focusout":aa=null;break;case"dragenter":case"dragleave":la=null;break;case"mouseover":case"mouseout":ca=null;break;case"pointerover":case"pointerout":hd.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":dd.delete(s.pointerId)}}function jh(i,s,h,m,v,T){return i===null||i.nativeEvent!==T?(i={blockedOn:s,domEventName:h,eventSystemFlags:m,nativeEvent:T,targetContainers:[v]},s!==null&&(s=zd(s),s!==null&&qy(s)),i):(i.eventSystemFlags|=m,s=i.targetContainers,v!==null&&s.indexOf(v)===-1&&s.push(v),i)}function GC(i,s,h,m,v){switch(s){case"focusin":return aa=jh(aa,i,s,h,m,v),!0;case"dragenter":return la=jh(la,i,s,h,m,v),!0;case"mouseover":return ca=jh(ca,i,s,h,m,v),!0;case"pointerover":var T=v.pointerId;return hd.set(T,jh(hd.get(T)||null,i,s,h,m,v)),!0;case"gotpointercapture":return T=v.pointerId,dd.set(T,jh(dd.get(T)||null,i,s,h,m,v)),!0}return!1}function kb(i){var s=cl(i.target);if(s!==null){var h=wl(s);if(h!==null){if(s=h.tag,s===13){if(s=xb(h),s!==null){i.blockedOn=s,zb(i.priority,function(){Ab(h)});return}}else if(s===3&&h.stateNode.current.memoizedState.isDehydrated){i.blockedOn=h.tag===3?h.stateNode.containerInfo:null;return}}}i.blockedOn=null}function Ff(i){if(i.blockedOn!==null)return!1;for(var s=i.targetContainers;0<s.length;){var h=ny(i.domEventName,i.eventSystemFlags,s[0],i.nativeEvent);if(h===null){h=i.nativeEvent;var m=new h.constructor(h.type,h);Yg=m,h.target.dispatchEvent(m),Yg=null}else return s=zd(h),s!==null&&qy(s),i.blockedOn=h,!1;s.shift()}return!0}function D1(i,s,h){Ff(i)&&h.delete(s)}function $C(){ty=!1,aa!==null&&Ff(aa)&&(aa=null),la!==null&&Ff(la)&&(la=null),ca!==null&&Ff(ca)&&(ca=null),hd.forEach(D1),dd.forEach(D1)}function Vh(i,s){i.blockedOn===s&&(i.blockedOn=null,ty||(ty=!0,mi.unstable_scheduleCallback(mi.unstable_NormalPriority,$C)))}function pd(i){function s(v){return Vh(v,i)}if(0<Ef.length){Vh(Ef[0],i);for(var h=1;h<Ef.length;h++){var m=Ef[h];m.blockedOn===i&&(m.blockedOn=null)}}for(aa!==null&&Vh(aa,i),la!==null&&Vh(la,i),ca!==null&&Vh(ca,i),hd.forEach(s),dd.forEach(s),h=0;h<na.length;h++)m=na[h],m.blockedOn===i&&(m.blockedOn=null);for(;0<na.length&&(h=na[0],h.blockedOn===null);)kb(h),h.blockedOn===null&&na.shift()}var Hc=ms.ReactCurrentBatchConfig,rm=!0;function ZC(i,s,h,m){var v=xn,T=Hc.transition;Hc.transition=null;try{xn=1,Wy(i,s,h,m)}finally{xn=v,Hc.transition=T}}function qC(i,s,h,m){var v=xn,T=Hc.transition;Hc.transition=null;try{xn=4,Wy(i,s,h,m)}finally{xn=v,Hc.transition=T}}function Wy(i,s,h,m){if(rm){var v=ny(i,s,h,m);if(v===null)Tg(i,s,m,im,h),P1(i,m);else if(GC(v,i,s,h,m))m.stopPropagation();else if(P1(i,m),s&4&&-1<VC.indexOf(i)){for(;v!==null;){var T=zd(v);if(T!==null&&Mb(T),T=ny(i,s,h,m),T===null&&Tg(i,s,m,im,h),T===v)break;v=T}v!==null&&m.stopPropagation()}else Tg(i,s,m,null,h)}}var im=null;function ny(i,s,h,m){if(im=null,i=Gy(m),i=cl(i),i!==null)if(s=wl(i),s===null)i=null;else if(h=s.tag,h===13){if(i=xb(s),i!==null)return i;i=null}else if(h===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;i=null}else s!==i&&(i=null);return im=i,null}function Pb(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(DC()){case $y:return 1;case Tb:return 4;case tm:case LC:return 16;case Eb:return 536870912;default:return 16}default:return 16}}var oa=null,Xy=null,Uf=null;function Db(){if(Uf)return Uf;var i,s=Xy,h=s.length,m,v="value"in oa?oa.value:oa.textContent,T=v.length;for(i=0;i<h&&s[i]===v[i];i++);var I=h-i;for(m=1;m<=I&&s[h-m]===v[T-m];m++);return Uf=v.slice(i,1<m?1-m:void 0)}function Nf(i){var s=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&s===13&&(i=13)):i=s,i===10&&(i=13),32<=i||i===13?i:0}function Sf(){return!0}function L1(){return!1}function gi(i){function s(h,m,v,T,I){this._reactName=h,this._targetInst=v,this.type=m,this.nativeEvent=T,this.target=I,this.currentTarget=null;for(var a in i)i.hasOwnProperty(a)&&(h=i[a],this[a]=h?h(T):T[a]);return this.isDefaultPrevented=(T.defaultPrevented!=null?T.defaultPrevented:T.returnValue===!1)?Sf:L1,this.isPropagationStopped=L1,this}return On(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var h=this.nativeEvent;h&&(h.preventDefault?h.preventDefault():typeof h.returnValue!="unknown"&&(h.returnValue=!1),this.isDefaultPrevented=Sf)},stopPropagation:function(){var h=this.nativeEvent;h&&(h.stopPropagation?h.stopPropagation():typeof h.cancelBubble!="unknown"&&(h.cancelBubble=!0),this.isPropagationStopped=Sf)},persist:function(){},isPersistent:Sf}),s}var au={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Hy=gi(au),Id=On({},au,{view:0,detail:0}),WC=gi(Id),fg,mg,Gh,Sm=On({},Id,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Yy,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==Gh&&(Gh&&i.type==="mousemove"?(fg=i.screenX-Gh.screenX,mg=i.screenY-Gh.screenY):mg=fg=0,Gh=i),fg)},movementY:function(i){return"movementY"in i?i.movementY:mg}}),R1=gi(Sm),XC=On({},Sm,{dataTransfer:0}),HC=gi(XC),YC=On({},Id,{relatedTarget:0}),_g=gi(YC),KC=On({},au,{animationName:0,elapsedTime:0,pseudoElement:0}),JC=gi(KC),QC=On({},au,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),eM=gi(QC),tM=On({},au,{data:0}),B1=gi(tM),nM={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},rM={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},iM={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function oM(i){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(i):(i=iM[i])?!!s[i]:!1}function Yy(){return oM}var sM=On({},Id,{key:function(i){if(i.key){var s=nM[i.key]||i.key;if(s!=="Unidentified")return s}return i.type==="keypress"?(i=Nf(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?rM[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Yy,charCode:function(i){return i.type==="keypress"?Nf(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?Nf(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),aM=gi(sM),lM=On({},Sm,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),O1=gi(lM),cM=On({},Id,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Yy}),uM=gi(cM),hM=On({},au,{propertyName:0,elapsedTime:0,pseudoElement:0}),dM=gi(hM),pM=On({},Sm,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),fM=gi(pM),mM=[9,13,27,32],Ky=hs&&"CompositionEvent"in window,td=null;hs&&"documentMode"in document&&(td=document.documentMode);var _M=hs&&"TextEvent"in window&&!td,Lb=hs&&(!Ky||td&&8<td&&11>=td),F1=String.fromCharCode(32),U1=!1;function Rb(i,s){switch(i){case"keyup":return mM.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Bb(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var Bc=!1;function gM(i,s){switch(i){case"compositionend":return Bb(s);case"keypress":return s.which!==32?null:(U1=!0,F1);case"textInput":return i=s.data,i===F1&&U1?null:i;default:return null}}function yM(i,s){if(Bc)return i==="compositionend"||!Ky&&Rb(i,s)?(i=Db(),Uf=Xy=oa=null,Bc=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return Lb&&s.locale!=="ko"?null:s.data;default:return null}}var xM={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function N1(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s==="input"?!!xM[i.type]:s==="textarea"}function Ob(i,s,h,m){fb(m),s=om(s,"onChange"),0<s.length&&(h=new Hy("onChange","change",null,h,m),i.push({event:h,listeners:s}))}var nd=null,fd=null;function vM(i){Xb(i,0)}function Cm(i){var s=Uc(i);if(ab(s))return i}function wM(i,s){if(i==="change")return s}var Fb=!1;if(hs){var gg;if(hs){var yg="oninput"in document;if(!yg){var j1=document.createElement("div");j1.setAttribute("oninput","return;"),yg=typeof j1.oninput=="function"}gg=yg}else gg=!1;Fb=gg&&(!document.documentMode||9<document.documentMode)}function V1(){nd&&(nd.detachEvent("onpropertychange",Ub),fd=nd=null)}function Ub(i){if(i.propertyName==="value"&&Cm(fd)){var s=[];Ob(s,fd,i,Gy(i)),yb(vM,s)}}function bM(i,s,h){i==="focusin"?(V1(),nd=s,fd=h,nd.attachEvent("onpropertychange",Ub)):i==="focusout"&&V1()}function TM(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return Cm(fd)}function EM(i,s){if(i==="click")return Cm(s)}function SM(i,s){if(i==="input"||i==="change")return Cm(s)}function CM(i,s){return i===s&&(i!==0||1/i===1/s)||i!==i&&s!==s}var so=typeof Object.is=="function"?Object.is:CM;function md(i,s){if(so(i,s))return!0;if(typeof i!="object"||i===null||typeof s!="object"||s===null)return!1;var h=Object.keys(i),m=Object.keys(s);if(h.length!==m.length)return!1;for(m=0;m<h.length;m++){var v=h[m];if(!Fg.call(s,v)||!so(i[v],s[v]))return!1}return!0}function G1(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function $1(i,s){var h=G1(i);i=0;for(var m;h;){if(h.nodeType===3){if(m=i+h.textContent.length,i<=s&&m>=s)return{node:h,offset:s-i};i=m}e:{for(;h;){if(h.nextSibling){h=h.nextSibling;break e}h=h.parentNode}h=void 0}h=G1(h)}}function Nb(i,s){return i&&s?i===s?!0:i&&i.nodeType===3?!1:s&&s.nodeType===3?Nb(i,s.parentNode):"contains"in i?i.contains(s):i.compareDocumentPosition?!!(i.compareDocumentPosition(s)&16):!1:!1}function jb(){for(var i=window,s=Jf();s instanceof i.HTMLIFrameElement;){try{var h=typeof s.contentWindow.location.href=="string"}catch{h=!1}if(h)i=s.contentWindow;else break;s=Jf(i.document)}return s}function Jy(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s&&(s==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||s==="textarea"||i.contentEditable==="true")}function MM(i){var s=jb(),h=i.focusedElem,m=i.selectionRange;if(s!==h&&h&&h.ownerDocument&&Nb(h.ownerDocument.documentElement,h)){if(m!==null&&Jy(h)){if(s=m.start,i=m.end,i===void 0&&(i=s),"selectionStart"in h)h.selectionStart=s,h.selectionEnd=Math.min(i,h.value.length);else if(i=(s=h.ownerDocument||document)&&s.defaultView||window,i.getSelection){i=i.getSelection();var v=h.textContent.length,T=Math.min(m.start,v);m=m.end===void 0?T:Math.min(m.end,v),!i.extend&&T>m&&(v=m,m=T,T=v),v=$1(h,T);var I=$1(h,m);v&&I&&(i.rangeCount!==1||i.anchorNode!==v.node||i.anchorOffset!==v.offset||i.focusNode!==I.node||i.focusOffset!==I.offset)&&(s=s.createRange(),s.setStart(v.node,v.offset),i.removeAllRanges(),T>m?(i.addRange(s),i.extend(I.node,I.offset)):(s.setEnd(I.node,I.offset),i.addRange(s)))}}for(s=[],i=h;i=i.parentNode;)i.nodeType===1&&s.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof h.focus=="function"&&h.focus(),h=0;h<s.length;h++)i=s[h],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var AM=hs&&"documentMode"in document&&11>=document.documentMode,Oc=null,ry=null,rd=null,iy=!1;function Z1(i,s,h){var m=h.window===h?h.document:h.nodeType===9?h:h.ownerDocument;iy||Oc==null||Oc!==Jf(m)||(m=Oc,"selectionStart"in m&&Jy(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),rd&&md(rd,m)||(rd=m,m=om(ry,"onSelect"),0<m.length&&(s=new Hy("onSelect","select",null,s,h),i.push({event:s,listeners:m}),s.target=Oc)))}function Cf(i,s){var h={};return h[i.toLowerCase()]=s.toLowerCase(),h["Webkit"+i]="webkit"+s,h["Moz"+i]="moz"+s,h}var Fc={animationend:Cf("Animation","AnimationEnd"),animationiteration:Cf("Animation","AnimationIteration"),animationstart:Cf("Animation","AnimationStart"),transitionend:Cf("Transition","TransitionEnd")},xg={},Vb={};hs&&(Vb=document.createElement("div").style,"AnimationEvent"in window||(delete Fc.animationend.animation,delete Fc.animationiteration.animation,delete Fc.animationstart.animation),"TransitionEvent"in window||delete Fc.transitionend.transition);function Mm(i){if(xg[i])return xg[i];if(!Fc[i])return i;var s=Fc[i],h;for(h in s)if(s.hasOwnProperty(h)&&h in Vb)return xg[i]=s[h];return i}var Gb=Mm("animationend"),$b=Mm("animationiteration"),Zb=Mm("animationstart"),qb=Mm("transitionend"),Wb=new Map,q1="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ga(i,s){Wb.set(i,s),vl(s,[i])}for(var vg=0;vg<q1.length;vg++){var wg=q1[vg],IM=wg.toLowerCase(),zM=wg[0].toUpperCase()+wg.slice(1);ga(IM,"on"+zM)}ga(Gb,"onAnimationEnd");ga($b,"onAnimationIteration");ga(Zb,"onAnimationStart");ga("dblclick","onDoubleClick");ga("focusin","onFocus");ga("focusout","onBlur");ga(qb,"onTransitionEnd");Jc("onMouseEnter",["mouseout","mouseover"]);Jc("onMouseLeave",["mouseout","mouseover"]);Jc("onPointerEnter",["pointerout","pointerover"]);Jc("onPointerLeave",["pointerout","pointerover"]);vl("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));vl("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));vl("onBeforeInput",["compositionend","keypress","textInput","paste"]);vl("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));vl("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));vl("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Kh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),kM=new Set("cancel close invalid load scroll toggle".split(" ").concat(Kh));function W1(i,s,h){var m=i.type||"unknown-event";i.currentTarget=h,IC(m,s,void 0,i),i.currentTarget=null}function Xb(i,s){s=(s&4)!==0;for(var h=0;h<i.length;h++){var m=i[h],v=m.event;m=m.listeners;e:{var T=void 0;if(s)for(var I=m.length-1;0<=I;I--){var a=m[I],B=a.instance,G=a.currentTarget;if(a=a.listener,B!==T&&v.isPropagationStopped())break e;W1(v,a,G),T=B}else for(I=0;I<m.length;I++){if(a=m[I],B=a.instance,G=a.currentTarget,a=a.listener,B!==T&&v.isPropagationStopped())break e;W1(v,a,G),T=B}}}if(em)throw i=Qg,em=!1,Qg=null,i}function Cn(i,s){var h=s[cy];h===void 0&&(h=s[cy]=new Set);var m=i+"__bubble";h.has(m)||(Hb(s,i,2,!1),h.add(m))}function bg(i,s,h){var m=0;s&&(m|=4),Hb(h,i,m,s)}var Mf="_reactListening"+Math.random().toString(36).slice(2);function _d(i){if(!i[Mf]){i[Mf]=!0,nb.forEach(function(h){h!=="selectionchange"&&(kM.has(h)||bg(h,!1,i),bg(h,!0,i))});var s=i.nodeType===9?i:i.ownerDocument;s===null||s[Mf]||(s[Mf]=!0,bg("selectionchange",!1,s))}}function Hb(i,s,h,m){switch(Pb(s)){case 1:var v=ZC;break;case 4:v=qC;break;default:v=Wy}h=v.bind(null,s,h,i),v=void 0,!Jg||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(v=!0),m?v!==void 0?i.addEventListener(s,h,{capture:!0,passive:v}):i.addEventListener(s,h,!0):v!==void 0?i.addEventListener(s,h,{passive:v}):i.addEventListener(s,h,!1)}function Tg(i,s,h,m,v){var T=m;if((s&1)===0&&(s&2)===0&&m!==null)e:for(;;){if(m===null)return;var I=m.tag;if(I===3||I===4){var a=m.stateNode.containerInfo;if(a===v||a.nodeType===8&&a.parentNode===v)break;if(I===4)for(I=m.return;I!==null;){var B=I.tag;if((B===3||B===4)&&(B=I.stateNode.containerInfo,B===v||B.nodeType===8&&B.parentNode===v))return;I=I.return}for(;a!==null;){if(I=cl(a),I===null)return;if(B=I.tag,B===5||B===6){m=T=I;continue e}a=a.parentNode}}m=m.return}yb(function(){var G=T,he=Gy(h),le=[];e:{var ye=Wb.get(i);if(ye!==void 0){var Fe=Hy,Ie=i;switch(i){case"keypress":if(Nf(h)===0)break e;case"keydown":case"keyup":Fe=aM;break;case"focusin":Ie="focus",Fe=_g;break;case"focusout":Ie="blur",Fe=_g;break;case"beforeblur":case"afterblur":Fe=_g;break;case"click":if(h.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Fe=R1;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Fe=HC;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Fe=uM;break;case Gb:case $b:case Zb:Fe=JC;break;case qb:Fe=dM;break;case"scroll":Fe=WC;break;case"wheel":Fe=fM;break;case"copy":case"cut":case"paste":Fe=eM;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Fe=O1}var Ue=(s&4)!==0,Ft=!Ue&&i==="scroll",me=Ue?ye!==null?ye+"Capture":null:ye;Ue=[];for(var de=G,be;de!==null;){be=de;var He=be.stateNode;if(be.tag===5&&He!==null&&(be=He,me!==null&&(He=ud(de,me),He!=null&&Ue.push(gd(de,He,be)))),Ft)break;de=de.return}0<Ue.length&&(ye=new Fe(ye,Ie,null,h,he),le.push({event:ye,listeners:Ue}))}}if((s&7)===0){e:{if(ye=i==="mouseover"||i==="pointerover",Fe=i==="mouseout"||i==="pointerout",ye&&h!==Yg&&(Ie=h.relatedTarget||h.fromElement)&&(cl(Ie)||Ie[ds]))break e;if((Fe||ye)&&(ye=he.window===he?he:(ye=he.ownerDocument)?ye.defaultView||ye.parentWindow:window,Fe?(Ie=h.relatedTarget||h.toElement,Fe=G,Ie=Ie?cl(Ie):null,Ie!==null&&(Ft=wl(Ie),Ie!==Ft||Ie.tag!==5&&Ie.tag!==6)&&(Ie=null)):(Fe=null,Ie=G),Fe!==Ie)){if(Ue=R1,He="onMouseLeave",me="onMouseEnter",de="mouse",(i==="pointerout"||i==="pointerover")&&(Ue=O1,He="onPointerLeave",me="onPointerEnter",de="pointer"),Ft=Fe==null?ye:Uc(Fe),be=Ie==null?ye:Uc(Ie),ye=new Ue(He,de+"leave",Fe,h,he),ye.target=Ft,ye.relatedTarget=be,He=null,cl(he)===G&&(Ue=new Ue(me,de+"enter",Ie,h,he),Ue.target=be,Ue.relatedTarget=Ft,He=Ue),Ft=He,Fe&&Ie)t:{for(Ue=Fe,me=Ie,de=0,be=Ue;be;be=Dc(be))de++;for(be=0,He=me;He;He=Dc(He))be++;for(;0<de-be;)Ue=Dc(Ue),de--;for(;0<be-de;)me=Dc(me),be--;for(;de--;){if(Ue===me||me!==null&&Ue===me.alternate)break t;Ue=Dc(Ue),me=Dc(me)}Ue=null}else Ue=null;Fe!==null&&X1(le,ye,Fe,Ue,!1),Ie!==null&&Ft!==null&&X1(le,Ft,Ie,Ue,!0)}}e:{if(ye=G?Uc(G):window,Fe=ye.nodeName&&ye.nodeName.toLowerCase(),Fe==="select"||Fe==="input"&&ye.type==="file")var Me=wM;else if(N1(ye))if(Fb)Me=SM;else{Me=TM;var ct=bM}else(Fe=ye.nodeName)&&Fe.toLowerCase()==="input"&&(ye.type==="checkbox"||ye.type==="radio")&&(Me=EM);if(Me&&(Me=Me(i,G))){Ob(le,Me,h,he);break e}ct&&ct(i,ye,G),i==="focusout"&&(ct=ye._wrapperState)&&ct.controlled&&ye.type==="number"&&Zg(ye,"number",ye.value)}switch(ct=G?Uc(G):window,i){case"focusin":(N1(ct)||ct.contentEditable==="true")&&(Oc=ct,ry=G,rd=null);break;case"focusout":rd=ry=Oc=null;break;case"mousedown":iy=!0;break;case"contextmenu":case"mouseup":case"dragend":iy=!1,Z1(le,h,he);break;case"selectionchange":if(AM)break;case"keydown":case"keyup":Z1(le,h,he)}var dt;if(Ky)e:{switch(i){case"compositionstart":var vt="onCompositionStart";break e;case"compositionend":vt="onCompositionEnd";break e;case"compositionupdate":vt="onCompositionUpdate";break e}vt=void 0}else Bc?Rb(i,h)&&(vt="onCompositionEnd"):i==="keydown"&&h.keyCode===229&&(vt="onCompositionStart");vt&&(Lb&&h.locale!=="ko"&&(Bc||vt!=="onCompositionStart"?vt==="onCompositionEnd"&&Bc&&(dt=Db()):(oa=he,Xy="value"in oa?oa.value:oa.textContent,Bc=!0)),ct=om(G,vt),0<ct.length&&(vt=new B1(vt,i,null,h,he),le.push({event:vt,listeners:ct}),dt?vt.data=dt:(dt=Bb(h),dt!==null&&(vt.data=dt)))),(dt=_M?gM(i,h):yM(i,h))&&(G=om(G,"onBeforeInput"),0<G.length&&(he=new B1("onBeforeInput","beforeinput",null,h,he),le.push({event:he,listeners:G}),he.data=dt))}Xb(le,s)})}function gd(i,s,h){return{instance:i,listener:s,currentTarget:h}}function om(i,s){for(var h=s+"Capture",m=[];i!==null;){var v=i,T=v.stateNode;v.tag===5&&T!==null&&(v=T,T=ud(i,h),T!=null&&m.unshift(gd(i,T,v)),T=ud(i,s),T!=null&&m.push(gd(i,T,v))),i=i.return}return m}function Dc(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function X1(i,s,h,m,v){for(var T=s._reactName,I=[];h!==null&&h!==m;){var a=h,B=a.alternate,G=a.stateNode;if(B!==null&&B===m)break;a.tag===5&&G!==null&&(a=G,v?(B=ud(h,T),B!=null&&I.unshift(gd(h,B,a))):v||(B=ud(h,T),B!=null&&I.push(gd(h,B,a)))),h=h.return}I.length!==0&&i.push({event:s,listeners:I})}var PM=/\r\n?/g,DM=/\u0000|\uFFFD/g;function H1(i){return(typeof i=="string"?i:""+i).replace(PM,`
`).replace(DM,"")}function Af(i,s,h){if(s=H1(s),H1(i)!==s&&h)throw Error(Je(425))}function sm(){}var oy=null,sy=null;function ay(i,s){return i==="textarea"||i==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var ly=typeof setTimeout=="function"?setTimeout:void 0,LM=typeof clearTimeout=="function"?clearTimeout:void 0,Y1=typeof Promise=="function"?Promise:void 0,RM=typeof queueMicrotask=="function"?queueMicrotask:typeof Y1<"u"?function(i){return Y1.resolve(null).then(i).catch(BM)}:ly;function BM(i){setTimeout(function(){throw i})}function Eg(i,s){var h=s,m=0;do{var v=h.nextSibling;if(i.removeChild(h),v&&v.nodeType===8)if(h=v.data,h==="/$"){if(m===0){i.removeChild(v),pd(s);return}m--}else h!=="$"&&h!=="$?"&&h!=="$!"||m++;h=v}while(h);pd(s)}function ua(i){for(;i!=null;i=i.nextSibling){var s=i.nodeType;if(s===1||s===3)break;if(s===8){if(s=i.data,s==="$"||s==="$!"||s==="$?")break;if(s==="/$")return null}}return i}function K1(i){i=i.previousSibling;for(var s=0;i;){if(i.nodeType===8){var h=i.data;if(h==="$"||h==="$!"||h==="$?"){if(s===0)return i;s--}else h==="/$"&&s++}i=i.previousSibling}return null}var lu=Math.random().toString(36).slice(2),Bo="__reactFiber$"+lu,yd="__reactProps$"+lu,ds="__reactContainer$"+lu,cy="__reactEvents$"+lu,OM="__reactListeners$"+lu,FM="__reactHandles$"+lu;function cl(i){var s=i[Bo];if(s)return s;for(var h=i.parentNode;h;){if(s=h[ds]||h[Bo]){if(h=s.alternate,s.child!==null||h!==null&&h.child!==null)for(i=K1(i);i!==null;){if(h=i[Bo])return h;i=K1(i)}return s}i=h,h=i.parentNode}return null}function zd(i){return i=i[Bo]||i[ds],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function Uc(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(Je(33))}function Am(i){return i[yd]||null}var uy=[],Nc=-1;function ya(i){return{current:i}}function Mn(i){0>Nc||(i.current=uy[Nc],uy[Nc]=null,Nc--)}function En(i,s){Nc++,uy[Nc]=i.current,i.current=s}var _a={},Lr=ya(_a),Yr=ya(!1),fl=_a;function Qc(i,s){var h=i.type.contextTypes;if(!h)return _a;var m=i.stateNode;if(m&&m.__reactInternalMemoizedUnmaskedChildContext===s)return m.__reactInternalMemoizedMaskedChildContext;var v={},T;for(T in h)v[T]=s[T];return m&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=s,i.__reactInternalMemoizedMaskedChildContext=v),v}function Kr(i){return i=i.childContextTypes,i!=null}function am(){Mn(Yr),Mn(Lr)}function J1(i,s,h){if(Lr.current!==_a)throw Error(Je(168));En(Lr,s),En(Yr,h)}function Yb(i,s,h){var m=i.stateNode;if(s=s.childContextTypes,typeof m.getChildContext!="function")return h;m=m.getChildContext();for(var v in m)if(!(v in s))throw Error(Je(108,bC(i)||"Unknown",v));return On({},h,m)}function lm(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||_a,fl=Lr.current,En(Lr,i),En(Yr,Yr.current),!0}function Q1(i,s,h){var m=i.stateNode;if(!m)throw Error(Je(169));h?(i=Yb(i,s,fl),m.__reactInternalMemoizedMergedChildContext=i,Mn(Yr),Mn(Lr),En(Lr,i)):Mn(Yr),En(Yr,h)}var os=null,Im=!1,Sg=!1;function Kb(i){os===null?os=[i]:os.push(i)}function UM(i){Im=!0,Kb(i)}function xa(){if(!Sg&&os!==null){Sg=!0;var i=0,s=xn;try{var h=os;for(xn=1;i<h.length;i++){var m=h[i];do m=m(!0);while(m!==null)}os=null,Im=!1}catch(v){throw os!==null&&(os=os.slice(i+1)),bb($y,xa),v}finally{xn=s,Sg=!1}}return null}var jc=[],Vc=0,cm=null,um=0,Pi=[],Di=0,ml=null,ss=1,as="";function al(i,s){jc[Vc++]=um,jc[Vc++]=cm,cm=i,um=s}function Jb(i,s,h){Pi[Di++]=ss,Pi[Di++]=as,Pi[Di++]=ml,ml=i;var m=ss;i=as;var v=32-io(m)-1;m&=~(1<<v),h+=1;var T=32-io(s)+v;if(30<T){var I=v-v%5;T=(m&(1<<I)-1).toString(32),m>>=I,v-=I,ss=1<<32-io(s)+v|h<<v|m,as=T+i}else ss=1<<T|h<<v|m,as=i}function Qy(i){i.return!==null&&(al(i,1),Jb(i,1,0))}function e0(i){for(;i===cm;)cm=jc[--Vc],jc[Vc]=null,um=jc[--Vc],jc[Vc]=null;for(;i===ml;)ml=Pi[--Di],Pi[Di]=null,as=Pi[--Di],Pi[Di]=null,ss=Pi[--Di],Pi[Di]=null}var fi=null,pi=null,zn=!1,ro=null;function Qb(i,s){var h=Li(5,null,null,0);h.elementType="DELETED",h.stateNode=s,h.return=i,s=i.deletions,s===null?(i.deletions=[h],i.flags|=16):s.push(h)}function ew(i,s){switch(i.tag){case 5:var h=i.type;return s=s.nodeType!==1||h.toLowerCase()!==s.nodeName.toLowerCase()?null:s,s!==null?(i.stateNode=s,fi=i,pi=ua(s.firstChild),!0):!1;case 6:return s=i.pendingProps===""||s.nodeType!==3?null:s,s!==null?(i.stateNode=s,fi=i,pi=null,!0):!1;case 13:return s=s.nodeType!==8?null:s,s!==null?(h=ml!==null?{id:ss,overflow:as}:null,i.memoizedState={dehydrated:s,treeContext:h,retryLane:1073741824},h=Li(18,null,null,0),h.stateNode=s,h.return=i,i.child=h,fi=i,pi=null,!0):!1;default:return!1}}function hy(i){return(i.mode&1)!==0&&(i.flags&128)===0}function dy(i){if(zn){var s=pi;if(s){var h=s;if(!ew(i,s)){if(hy(i))throw Error(Je(418));s=ua(h.nextSibling);var m=fi;s&&ew(i,s)?Qb(m,h):(i.flags=i.flags&-4097|2,zn=!1,fi=i)}}else{if(hy(i))throw Error(Je(418));i.flags=i.flags&-4097|2,zn=!1,fi=i}}}function tw(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;fi=i}function If(i){if(i!==fi)return!1;if(!zn)return tw(i),zn=!0,!1;var s;if((s=i.tag!==3)&&!(s=i.tag!==5)&&(s=i.type,s=s!=="head"&&s!=="body"&&!ay(i.type,i.memoizedProps)),s&&(s=pi)){if(hy(i))throw e2(),Error(Je(418));for(;s;)Qb(i,s),s=ua(s.nextSibling)}if(tw(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Je(317));e:{for(i=i.nextSibling,s=0;i;){if(i.nodeType===8){var h=i.data;if(h==="/$"){if(s===0){pi=ua(i.nextSibling);break e}s--}else h!=="$"&&h!=="$!"&&h!=="$?"||s++}i=i.nextSibling}pi=null}}else pi=fi?ua(i.stateNode.nextSibling):null;return!0}function e2(){for(var i=pi;i;)i=ua(i.nextSibling)}function eu(){pi=fi=null,zn=!1}function t0(i){ro===null?ro=[i]:ro.push(i)}var NM=ms.ReactCurrentBatchConfig;function to(i,s){if(i&&i.defaultProps){s=On({},s),i=i.defaultProps;for(var h in i)s[h]===void 0&&(s[h]=i[h]);return s}return s}var hm=ya(null),dm=null,Gc=null,n0=null;function r0(){n0=Gc=dm=null}function i0(i){var s=hm.current;Mn(hm),i._currentValue=s}function py(i,s,h){for(;i!==null;){var m=i.alternate;if((i.childLanes&s)!==s?(i.childLanes|=s,m!==null&&(m.childLanes|=s)):m!==null&&(m.childLanes&s)!==s&&(m.childLanes|=s),i===h)break;i=i.return}}function Yc(i,s){dm=i,n0=Gc=null,i=i.dependencies,i!==null&&i.firstContext!==null&&((i.lanes&s)!==0&&(Hr=!0),i.firstContext=null)}function Bi(i){var s=i._currentValue;if(n0!==i)if(i={context:i,memoizedValue:s,next:null},Gc===null){if(dm===null)throw Error(Je(308));Gc=i,dm.dependencies={lanes:0,firstContext:i}}else Gc=Gc.next=i;return s}var ul=null;function o0(i){ul===null?ul=[i]:ul.push(i)}function t2(i,s,h,m){var v=s.interleaved;return v===null?(h.next=h,o0(s)):(h.next=v.next,v.next=h),s.interleaved=h,ps(i,m)}function ps(i,s){i.lanes|=s;var h=i.alternate;for(h!==null&&(h.lanes|=s),h=i,i=i.return;i!==null;)i.childLanes|=s,h=i.alternate,h!==null&&(h.childLanes|=s),h=i,i=i.return;return h.tag===3?h.stateNode:null}var ta=!1;function s0(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function n2(i,s){i=i.updateQueue,s.updateQueue===i&&(s.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function ls(i,s){return{eventTime:i,lane:s,tag:0,payload:null,callback:null,next:null}}function ha(i,s,h){var m=i.updateQueue;if(m===null)return null;if(m=m.shared,(ln&2)!==0){var v=m.pending;return v===null?s.next=s:(s.next=v.next,v.next=s),m.pending=s,ps(i,h)}return v=m.interleaved,v===null?(s.next=s,o0(m)):(s.next=v.next,v.next=s),m.interleaved=s,ps(i,h)}function jf(i,s,h){if(s=s.updateQueue,s!==null&&(s=s.shared,(h&4194240)!==0)){var m=s.lanes;m&=i.pendingLanes,h|=m,s.lanes=h,Zy(i,h)}}function nw(i,s){var h=i.updateQueue,m=i.alternate;if(m!==null&&(m=m.updateQueue,h===m)){var v=null,T=null;if(h=h.firstBaseUpdate,h!==null){do{var I={eventTime:h.eventTime,lane:h.lane,tag:h.tag,payload:h.payload,callback:h.callback,next:null};T===null?v=T=I:T=T.next=I,h=h.next}while(h!==null);T===null?v=T=s:T=T.next=s}else v=T=s;h={baseState:m.baseState,firstBaseUpdate:v,lastBaseUpdate:T,shared:m.shared,effects:m.effects},i.updateQueue=h;return}i=h.lastBaseUpdate,i===null?h.firstBaseUpdate=s:i.next=s,h.lastBaseUpdate=s}function pm(i,s,h,m){var v=i.updateQueue;ta=!1;var T=v.firstBaseUpdate,I=v.lastBaseUpdate,a=v.shared.pending;if(a!==null){v.shared.pending=null;var B=a,G=B.next;B.next=null,I===null?T=G:I.next=G,I=B;var he=i.alternate;he!==null&&(he=he.updateQueue,a=he.lastBaseUpdate,a!==I&&(a===null?he.firstBaseUpdate=G:a.next=G,he.lastBaseUpdate=B))}if(T!==null){var le=v.baseState;I=0,he=G=B=null,a=T;do{var ye=a.lane,Fe=a.eventTime;if((m&ye)===ye){he!==null&&(he=he.next={eventTime:Fe,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var Ie=i,Ue=a;switch(ye=s,Fe=h,Ue.tag){case 1:if(Ie=Ue.payload,typeof Ie=="function"){le=Ie.call(Fe,le,ye);break e}le=Ie;break e;case 3:Ie.flags=Ie.flags&-65537|128;case 0:if(Ie=Ue.payload,ye=typeof Ie=="function"?Ie.call(Fe,le,ye):Ie,ye==null)break e;le=On({},le,ye);break e;case 2:ta=!0}}a.callback!==null&&a.lane!==0&&(i.flags|=64,ye=v.effects,ye===null?v.effects=[a]:ye.push(a))}else Fe={eventTime:Fe,lane:ye,tag:a.tag,payload:a.payload,callback:a.callback,next:null},he===null?(G=he=Fe,B=le):he=he.next=Fe,I|=ye;if(a=a.next,a===null){if(a=v.shared.pending,a===null)break;ye=a,a=ye.next,ye.next=null,v.lastBaseUpdate=ye,v.shared.pending=null}}while(1);if(he===null&&(B=le),v.baseState=B,v.firstBaseUpdate=G,v.lastBaseUpdate=he,s=v.shared.interleaved,s!==null){v=s;do I|=v.lane,v=v.next;while(v!==s)}else T===null&&(v.shared.lanes=0);gl|=I,i.lanes=I,i.memoizedState=le}}function rw(i,s,h){if(i=s.effects,s.effects=null,i!==null)for(s=0;s<i.length;s++){var m=i[s],v=m.callback;if(v!==null){if(m.callback=null,m=h,typeof v!="function")throw Error(Je(191,v));v.call(m)}}}var r2=new tb.Component().refs;function fy(i,s,h,m){s=i.memoizedState,h=h(m,s),h=h==null?s:On({},s,h),i.memoizedState=h,i.lanes===0&&(i.updateQueue.baseState=h)}var zm={isMounted:function(i){return(i=i._reactInternals)?wl(i)===i:!1},enqueueSetState:function(i,s,h){i=i._reactInternals;var m=jr(),v=pa(i),T=ls(m,v);T.payload=s,h!=null&&(T.callback=h),s=ha(i,T,v),s!==null&&(oo(s,i,v,m),jf(s,i,v))},enqueueReplaceState:function(i,s,h){i=i._reactInternals;var m=jr(),v=pa(i),T=ls(m,v);T.tag=1,T.payload=s,h!=null&&(T.callback=h),s=ha(i,T,v),s!==null&&(oo(s,i,v,m),jf(s,i,v))},enqueueForceUpdate:function(i,s){i=i._reactInternals;var h=jr(),m=pa(i),v=ls(h,m);v.tag=2,s!=null&&(v.callback=s),s=ha(i,v,m),s!==null&&(oo(s,i,m,h),jf(s,i,m))}};function iw(i,s,h,m,v,T,I){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(m,T,I):s.prototype&&s.prototype.isPureReactComponent?!md(h,m)||!md(v,T):!0}function i2(i,s,h){var m=!1,v=_a,T=s.contextType;return typeof T=="object"&&T!==null?T=Bi(T):(v=Kr(s)?fl:Lr.current,m=s.contextTypes,T=(m=m!=null)?Qc(i,v):_a),s=new s(h,T),i.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,s.updater=zm,i.stateNode=s,s._reactInternals=i,m&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=v,i.__reactInternalMemoizedMaskedChildContext=T),s}function ow(i,s,h,m){i=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(h,m),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(h,m),s.state!==i&&zm.enqueueReplaceState(s,s.state,null)}function my(i,s,h,m){var v=i.stateNode;v.props=h,v.state=i.memoizedState,v.refs=r2,s0(i);var T=s.contextType;typeof T=="object"&&T!==null?v.context=Bi(T):(T=Kr(s)?fl:Lr.current,v.context=Qc(i,T)),v.state=i.memoizedState,T=s.getDerivedStateFromProps,typeof T=="function"&&(fy(i,s,T,h),v.state=i.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof v.getSnapshotBeforeUpdate=="function"||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(s=v.state,typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount(),s!==v.state&&zm.enqueueReplaceState(v,v.state,null),pm(i,h,v,m),v.state=i.memoizedState),typeof v.componentDidMount=="function"&&(i.flags|=4194308)}function $h(i,s,h){if(i=h.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(h._owner){if(h=h._owner,h){if(h.tag!==1)throw Error(Je(309));var m=h.stateNode}if(!m)throw Error(Je(147,i));var v=m,T=""+i;return s!==null&&s.ref!==null&&typeof s.ref=="function"&&s.ref._stringRef===T?s.ref:(s=function(I){var a=v.refs;a===r2&&(a=v.refs={}),I===null?delete a[T]:a[T]=I},s._stringRef=T,s)}if(typeof i!="string")throw Error(Je(284));if(!h._owner)throw Error(Je(290,i))}return i}function zf(i,s){throw i=Object.prototype.toString.call(s),Error(Je(31,i==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":i))}function sw(i){var s=i._init;return s(i._payload)}function o2(i){function s(me,de){if(i){var be=me.deletions;be===null?(me.deletions=[de],me.flags|=16):be.push(de)}}function h(me,de){if(!i)return null;for(;de!==null;)s(me,de),de=de.sibling;return null}function m(me,de){for(me=new Map;de!==null;)de.key!==null?me.set(de.key,de):me.set(de.index,de),de=de.sibling;return me}function v(me,de){return me=fa(me,de),me.index=0,me.sibling=null,me}function T(me,de,be){return me.index=be,i?(be=me.alternate,be!==null?(be=be.index,be<de?(me.flags|=2,de):be):(me.flags|=2,de)):(me.flags|=1048576,de)}function I(me){return i&&me.alternate===null&&(me.flags|=2),me}function a(me,de,be,He){return de===null||de.tag!==6?(de=Pg(be,me.mode,He),de.return=me,de):(de=v(de,be),de.return=me,de)}function B(me,de,be,He){var Me=be.type;return Me===Rc?he(me,de,be.props.children,He,be.key):de!==null&&(de.elementType===Me||typeof Me=="object"&&Me!==null&&Me.$$typeof===ea&&sw(Me)===de.type)?(He=v(de,be.props),He.ref=$h(me,de,be),He.return=me,He):(He=Wf(be.type,be.key,be.props,null,me.mode,He),He.ref=$h(me,de,be),He.return=me,He)}function G(me,de,be,He){return de===null||de.tag!==4||de.stateNode.containerInfo!==be.containerInfo||de.stateNode.implementation!==be.implementation?(de=Dg(be,me.mode,He),de.return=me,de):(de=v(de,be.children||[]),de.return=me,de)}function he(me,de,be,He,Me){return de===null||de.tag!==7?(de=pl(be,me.mode,He,Me),de.return=me,de):(de=v(de,be),de.return=me,de)}function le(me,de,be){if(typeof de=="string"&&de!==""||typeof de=="number")return de=Pg(""+de,me.mode,be),de.return=me,de;if(typeof de=="object"&&de!==null){switch(de.$$typeof){case xf:return be=Wf(de.type,de.key,de.props,null,me.mode,be),be.ref=$h(me,null,de),be.return=me,be;case Lc:return de=Dg(de,me.mode,be),de.return=me,de;case ea:var He=de._init;return le(me,He(de._payload),be)}if(Hh(de)||Uh(de))return de=pl(de,me.mode,be,null),de.return=me,de;zf(me,de)}return null}function ye(me,de,be,He){var Me=de!==null?de.key:null;if(typeof be=="string"&&be!==""||typeof be=="number")return Me!==null?null:a(me,de,""+be,He);if(typeof be=="object"&&be!==null){switch(be.$$typeof){case xf:return be.key===Me?B(me,de,be,He):null;case Lc:return be.key===Me?G(me,de,be,He):null;case ea:return Me=be._init,ye(me,de,Me(be._payload),He)}if(Hh(be)||Uh(be))return Me!==null?null:he(me,de,be,He,null);zf(me,be)}return null}function Fe(me,de,be,He,Me){if(typeof He=="string"&&He!==""||typeof He=="number")return me=me.get(be)||null,a(de,me,""+He,Me);if(typeof He=="object"&&He!==null){switch(He.$$typeof){case xf:return me=me.get(He.key===null?be:He.key)||null,B(de,me,He,Me);case Lc:return me=me.get(He.key===null?be:He.key)||null,G(de,me,He,Me);case ea:var ct=He._init;return Fe(me,de,be,ct(He._payload),Me)}if(Hh(He)||Uh(He))return me=me.get(be)||null,he(de,me,He,Me,null);zf(de,He)}return null}function Ie(me,de,be,He){for(var Me=null,ct=null,dt=de,vt=de=0,mt=null;dt!==null&&vt<be.length;vt++){dt.index>vt?(mt=dt,dt=null):mt=dt.sibling;var Ct=ye(me,dt,be[vt],He);if(Ct===null){dt===null&&(dt=mt);break}i&&dt&&Ct.alternate===null&&s(me,dt),de=T(Ct,de,vt),ct===null?Me=Ct:ct.sibling=Ct,ct=Ct,dt=mt}if(vt===be.length)return h(me,dt),zn&&al(me,vt),Me;if(dt===null){for(;vt<be.length;vt++)dt=le(me,be[vt],He),dt!==null&&(de=T(dt,de,vt),ct===null?Me=dt:ct.sibling=dt,ct=dt);return zn&&al(me,vt),Me}for(dt=m(me,dt);vt<be.length;vt++)mt=Fe(dt,me,vt,be[vt],He),mt!==null&&(i&&mt.alternate!==null&&dt.delete(mt.key===null?vt:mt.key),de=T(mt,de,vt),ct===null?Me=mt:ct.sibling=mt,ct=mt);return i&&dt.forEach(function(hr){return s(me,hr)}),zn&&al(me,vt),Me}function Ue(me,de,be,He){var Me=Uh(be);if(typeof Me!="function")throw Error(Je(150));if(be=Me.call(be),be==null)throw Error(Je(151));for(var ct=Me=null,dt=de,vt=de=0,mt=null,Ct=be.next();dt!==null&&!Ct.done;vt++,Ct=be.next()){dt.index>vt?(mt=dt,dt=null):mt=dt.sibling;var hr=ye(me,dt,Ct.value,He);if(hr===null){dt===null&&(dt=mt);break}i&&dt&&hr.alternate===null&&s(me,dt),de=T(hr,de,vt),ct===null?Me=hr:ct.sibling=hr,ct=hr,dt=mt}if(Ct.done)return h(me,dt),zn&&al(me,vt),Me;if(dt===null){for(;!Ct.done;vt++,Ct=be.next())Ct=le(me,Ct.value,He),Ct!==null&&(de=T(Ct,de,vt),ct===null?Me=Ct:ct.sibling=Ct,ct=Ct);return zn&&al(me,vt),Me}for(dt=m(me,dt);!Ct.done;vt++,Ct=be.next())Ct=Fe(dt,me,vt,Ct.value,He),Ct!==null&&(i&&Ct.alternate!==null&&dt.delete(Ct.key===null?vt:Ct.key),de=T(Ct,de,vt),ct===null?Me=Ct:ct.sibling=Ct,ct=Ct);return i&&dt.forEach(function(yi){return s(me,yi)}),zn&&al(me,vt),Me}function Ft(me,de,be,He){if(typeof be=="object"&&be!==null&&be.type===Rc&&be.key===null&&(be=be.props.children),typeof be=="object"&&be!==null){switch(be.$$typeof){case xf:e:{for(var Me=be.key,ct=de;ct!==null;){if(ct.key===Me){if(Me=be.type,Me===Rc){if(ct.tag===7){h(me,ct.sibling),de=v(ct,be.props.children),de.return=me,me=de;break e}}else if(ct.elementType===Me||typeof Me=="object"&&Me!==null&&Me.$$typeof===ea&&sw(Me)===ct.type){h(me,ct.sibling),de=v(ct,be.props),de.ref=$h(me,ct,be),de.return=me,me=de;break e}h(me,ct);break}else s(me,ct);ct=ct.sibling}be.type===Rc?(de=pl(be.props.children,me.mode,He,be.key),de.return=me,me=de):(He=Wf(be.type,be.key,be.props,null,me.mode,He),He.ref=$h(me,de,be),He.return=me,me=He)}return I(me);case Lc:e:{for(ct=be.key;de!==null;){if(de.key===ct)if(de.tag===4&&de.stateNode.containerInfo===be.containerInfo&&de.stateNode.implementation===be.implementation){h(me,de.sibling),de=v(de,be.children||[]),de.return=me,me=de;break e}else{h(me,de);break}else s(me,de);de=de.sibling}de=Dg(be,me.mode,He),de.return=me,me=de}return I(me);case ea:return ct=be._init,Ft(me,de,ct(be._payload),He)}if(Hh(be))return Ie(me,de,be,He);if(Uh(be))return Ue(me,de,be,He);zf(me,be)}return typeof be=="string"&&be!==""||typeof be=="number"?(be=""+be,de!==null&&de.tag===6?(h(me,de.sibling),de=v(de,be),de.return=me,me=de):(h(me,de),de=Pg(be,me.mode,He),de.return=me,me=de),I(me)):h(me,de)}return Ft}var tu=o2(!0),s2=o2(!1),kd={},Fo=ya(kd),xd=ya(kd),vd=ya(kd);function hl(i){if(i===kd)throw Error(Je(174));return i}function a0(i,s){switch(En(vd,s),En(xd,i),En(Fo,kd),i=s.nodeType,i){case 9:case 11:s=(s=s.documentElement)?s.namespaceURI:Wg(null,"");break;default:i=i===8?s.parentNode:s,s=i.namespaceURI||null,i=i.tagName,s=Wg(s,i)}Mn(Fo),En(Fo,s)}function nu(){Mn(Fo),Mn(xd),Mn(vd)}function a2(i){hl(vd.current);var s=hl(Fo.current),h=Wg(s,i.type);s!==h&&(En(xd,i),En(Fo,h))}function l0(i){xd.current===i&&(Mn(Fo),Mn(xd))}var Rn=ya(0);function fm(i){for(var s=i;s!==null;){if(s.tag===13){var h=s.memoizedState;if(h!==null&&(h=h.dehydrated,h===null||h.data==="$?"||h.data==="$!"))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var Cg=[];function c0(){for(var i=0;i<Cg.length;i++)Cg[i]._workInProgressVersionPrimary=null;Cg.length=0}var Vf=ms.ReactCurrentDispatcher,Mg=ms.ReactCurrentBatchConfig,_l=0,Bn=null,nr=null,cr=null,mm=!1,id=!1,wd=0,jM=0;function kr(){throw Error(Je(321))}function u0(i,s){if(s===null)return!1;for(var h=0;h<s.length&&h<i.length;h++)if(!so(i[h],s[h]))return!1;return!0}function h0(i,s,h,m,v,T){if(_l=T,Bn=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,Vf.current=i===null||i.memoizedState===null?ZM:qM,i=h(m,v),id){T=0;do{if(id=!1,wd=0,25<=T)throw Error(Je(301));T+=1,cr=nr=null,s.updateQueue=null,Vf.current=WM,i=h(m,v)}while(id)}if(Vf.current=_m,s=nr!==null&&nr.next!==null,_l=0,cr=nr=Bn=null,mm=!1,s)throw Error(Je(300));return i}function d0(){var i=wd!==0;return wd=0,i}function Ro(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return cr===null?Bn.memoizedState=cr=i:cr=cr.next=i,cr}function Oi(){if(nr===null){var i=Bn.alternate;i=i!==null?i.memoizedState:null}else i=nr.next;var s=cr===null?Bn.memoizedState:cr.next;if(s!==null)cr=s,nr=i;else{if(i===null)throw Error(Je(310));nr=i,i={memoizedState:nr.memoizedState,baseState:nr.baseState,baseQueue:nr.baseQueue,queue:nr.queue,next:null},cr===null?Bn.memoizedState=cr=i:cr=cr.next=i}return cr}function bd(i,s){return typeof s=="function"?s(i):s}function Ag(i){var s=Oi(),h=s.queue;if(h===null)throw Error(Je(311));h.lastRenderedReducer=i;var m=nr,v=m.baseQueue,T=h.pending;if(T!==null){if(v!==null){var I=v.next;v.next=T.next,T.next=I}m.baseQueue=v=T,h.pending=null}if(v!==null){T=v.next,m=m.baseState;var a=I=null,B=null,G=T;do{var he=G.lane;if((_l&he)===he)B!==null&&(B=B.next={lane:0,action:G.action,hasEagerState:G.hasEagerState,eagerState:G.eagerState,next:null}),m=G.hasEagerState?G.eagerState:i(m,G.action);else{var le={lane:he,action:G.action,hasEagerState:G.hasEagerState,eagerState:G.eagerState,next:null};B===null?(a=B=le,I=m):B=B.next=le,Bn.lanes|=he,gl|=he}G=G.next}while(G!==null&&G!==T);B===null?I=m:B.next=a,so(m,s.memoizedState)||(Hr=!0),s.memoizedState=m,s.baseState=I,s.baseQueue=B,h.lastRenderedState=m}if(i=h.interleaved,i!==null){v=i;do T=v.lane,Bn.lanes|=T,gl|=T,v=v.next;while(v!==i)}else v===null&&(h.lanes=0);return[s.memoizedState,h.dispatch]}function Ig(i){var s=Oi(),h=s.queue;if(h===null)throw Error(Je(311));h.lastRenderedReducer=i;var m=h.dispatch,v=h.pending,T=s.memoizedState;if(v!==null){h.pending=null;var I=v=v.next;do T=i(T,I.action),I=I.next;while(I!==v);so(T,s.memoizedState)||(Hr=!0),s.memoizedState=T,s.baseQueue===null&&(s.baseState=T),h.lastRenderedState=T}return[T,m]}function l2(){}function c2(i,s){var h=Bn,m=Oi(),v=s(),T=!so(m.memoizedState,v);if(T&&(m.memoizedState=v,Hr=!0),m=m.queue,p0(d2.bind(null,h,m,i),[i]),m.getSnapshot!==s||T||cr!==null&&cr.memoizedState.tag&1){if(h.flags|=2048,Td(9,h2.bind(null,h,m,v,s),void 0,null),ur===null)throw Error(Je(349));(_l&30)!==0||u2(h,s,v)}return v}function u2(i,s,h){i.flags|=16384,i={getSnapshot:s,value:h},s=Bn.updateQueue,s===null?(s={lastEffect:null,stores:null},Bn.updateQueue=s,s.stores=[i]):(h=s.stores,h===null?s.stores=[i]:h.push(i))}function h2(i,s,h,m){s.value=h,s.getSnapshot=m,p2(s)&&f2(i)}function d2(i,s,h){return h(function(){p2(s)&&f2(i)})}function p2(i){var s=i.getSnapshot;i=i.value;try{var h=s();return!so(i,h)}catch{return!0}}function f2(i){var s=ps(i,1);s!==null&&oo(s,i,1,-1)}function aw(i){var s=Ro();return typeof i=="function"&&(i=i()),s.memoizedState=s.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:bd,lastRenderedState:i},s.queue=i,i=i.dispatch=$M.bind(null,Bn,i),[s.memoizedState,i]}function Td(i,s,h,m){return i={tag:i,create:s,destroy:h,deps:m,next:null},s=Bn.updateQueue,s===null?(s={lastEffect:null,stores:null},Bn.updateQueue=s,s.lastEffect=i.next=i):(h=s.lastEffect,h===null?s.lastEffect=i.next=i:(m=h.next,h.next=i,i.next=m,s.lastEffect=i)),i}function m2(){return Oi().memoizedState}function Gf(i,s,h,m){var v=Ro();Bn.flags|=i,v.memoizedState=Td(1|s,h,void 0,m===void 0?null:m)}function km(i,s,h,m){var v=Oi();m=m===void 0?null:m;var T=void 0;if(nr!==null){var I=nr.memoizedState;if(T=I.destroy,m!==null&&u0(m,I.deps)){v.memoizedState=Td(s,h,T,m);return}}Bn.flags|=i,v.memoizedState=Td(1|s,h,T,m)}function lw(i,s){return Gf(8390656,8,i,s)}function p0(i,s){return km(2048,8,i,s)}function _2(i,s){return km(4,2,i,s)}function g2(i,s){return km(4,4,i,s)}function y2(i,s){if(typeof s=="function")return i=i(),s(i),function(){s(null)};if(s!=null)return i=i(),s.current=i,function(){s.current=null}}function x2(i,s,h){return h=h!=null?h.concat([i]):null,km(4,4,y2.bind(null,s,i),h)}function f0(){}function v2(i,s){var h=Oi();s=s===void 0?null:s;var m=h.memoizedState;return m!==null&&s!==null&&u0(s,m[1])?m[0]:(h.memoizedState=[i,s],i)}function w2(i,s){var h=Oi();s=s===void 0?null:s;var m=h.memoizedState;return m!==null&&s!==null&&u0(s,m[1])?m[0]:(i=i(),h.memoizedState=[i,s],i)}function b2(i,s,h){return(_l&21)===0?(i.baseState&&(i.baseState=!1,Hr=!0),i.memoizedState=h):(so(h,s)||(h=Sb(),Bn.lanes|=h,gl|=h,i.baseState=!0),s)}function VM(i,s){var h=xn;xn=h!==0&&4>h?h:4,i(!0);var m=Mg.transition;Mg.transition={};try{i(!1),s()}finally{xn=h,Mg.transition=m}}function T2(){return Oi().memoizedState}function GM(i,s,h){var m=pa(i);if(h={lane:m,action:h,hasEagerState:!1,eagerState:null,next:null},E2(i))S2(s,h);else if(h=t2(i,s,h,m),h!==null){var v=jr();oo(h,i,m,v),C2(h,s,m)}}function $M(i,s,h){var m=pa(i),v={lane:m,action:h,hasEagerState:!1,eagerState:null,next:null};if(E2(i))S2(s,v);else{var T=i.alternate;if(i.lanes===0&&(T===null||T.lanes===0)&&(T=s.lastRenderedReducer,T!==null))try{var I=s.lastRenderedState,a=T(I,h);if(v.hasEagerState=!0,v.eagerState=a,so(a,I)){var B=s.interleaved;B===null?(v.next=v,o0(s)):(v.next=B.next,B.next=v),s.interleaved=v;return}}catch{}finally{}h=t2(i,s,v,m),h!==null&&(v=jr(),oo(h,i,m,v),C2(h,s,m))}}function E2(i){var s=i.alternate;return i===Bn||s!==null&&s===Bn}function S2(i,s){id=mm=!0;var h=i.pending;h===null?s.next=s:(s.next=h.next,h.next=s),i.pending=s}function C2(i,s,h){if((h&4194240)!==0){var m=s.lanes;m&=i.pendingLanes,h|=m,s.lanes=h,Zy(i,h)}}var _m={readContext:Bi,useCallback:kr,useContext:kr,useEffect:kr,useImperativeHandle:kr,useInsertionEffect:kr,useLayoutEffect:kr,useMemo:kr,useReducer:kr,useRef:kr,useState:kr,useDebugValue:kr,useDeferredValue:kr,useTransition:kr,useMutableSource:kr,useSyncExternalStore:kr,useId:kr,unstable_isNewReconciler:!1},ZM={readContext:Bi,useCallback:function(i,s){return Ro().memoizedState=[i,s===void 0?null:s],i},useContext:Bi,useEffect:lw,useImperativeHandle:function(i,s,h){return h=h!=null?h.concat([i]):null,Gf(4194308,4,y2.bind(null,s,i),h)},useLayoutEffect:function(i,s){return Gf(4194308,4,i,s)},useInsertionEffect:function(i,s){return Gf(4,2,i,s)},useMemo:function(i,s){var h=Ro();return s=s===void 0?null:s,i=i(),h.memoizedState=[i,s],i},useReducer:function(i,s,h){var m=Ro();return s=h!==void 0?h(s):s,m.memoizedState=m.baseState=s,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:s},m.queue=i,i=i.dispatch=GM.bind(null,Bn,i),[m.memoizedState,i]},useRef:function(i){var s=Ro();return i={current:i},s.memoizedState=i},useState:aw,useDebugValue:f0,useDeferredValue:function(i){return Ro().memoizedState=i},useTransition:function(){var i=aw(!1),s=i[0];return i=VM.bind(null,i[1]),Ro().memoizedState=i,[s,i]},useMutableSource:function(){},useSyncExternalStore:function(i,s,h){var m=Bn,v=Ro();if(zn){if(h===void 0)throw Error(Je(407));h=h()}else{if(h=s(),ur===null)throw Error(Je(349));(_l&30)!==0||u2(m,s,h)}v.memoizedState=h;var T={value:h,getSnapshot:s};return v.queue=T,lw(d2.bind(null,m,T,i),[i]),m.flags|=2048,Td(9,h2.bind(null,m,T,h,s),void 0,null),h},useId:function(){var i=Ro(),s=ur.identifierPrefix;if(zn){var h=as,m=ss;h=(m&~(1<<32-io(m)-1)).toString(32)+h,s=":"+s+"R"+h,h=wd++,0<h&&(s+="H"+h.toString(32)),s+=":"}else h=jM++,s=":"+s+"r"+h.toString(32)+":";return i.memoizedState=s},unstable_isNewReconciler:!1},qM={readContext:Bi,useCallback:v2,useContext:Bi,useEffect:p0,useImperativeHandle:x2,useInsertionEffect:_2,useLayoutEffect:g2,useMemo:w2,useReducer:Ag,useRef:m2,useState:function(){return Ag(bd)},useDebugValue:f0,useDeferredValue:function(i){var s=Oi();return b2(s,nr.memoizedState,i)},useTransition:function(){var i=Ag(bd)[0],s=Oi().memoizedState;return[i,s]},useMutableSource:l2,useSyncExternalStore:c2,useId:T2,unstable_isNewReconciler:!1},WM={readContext:Bi,useCallback:v2,useContext:Bi,useEffect:p0,useImperativeHandle:x2,useInsertionEffect:_2,useLayoutEffect:g2,useMemo:w2,useReducer:Ig,useRef:m2,useState:function(){return Ig(bd)},useDebugValue:f0,useDeferredValue:function(i){var s=Oi();return nr===null?s.memoizedState=i:b2(s,nr.memoizedState,i)},useTransition:function(){var i=Ig(bd)[0],s=Oi().memoizedState;return[i,s]},useMutableSource:l2,useSyncExternalStore:c2,useId:T2,unstable_isNewReconciler:!1};function ru(i,s){try{var h="",m=s;do h+=wC(m),m=m.return;while(m);var v=h}catch(T){v=`
Error generating stack: `+T.message+`
`+T.stack}return{value:i,source:s,stack:v,digest:null}}function zg(i,s,h){return{value:i,source:null,stack:h!=null?h:null,digest:s!=null?s:null}}function _y(i,s){try{console.error(s.value)}catch(h){setTimeout(function(){throw h})}}var XM=typeof WeakMap=="function"?WeakMap:Map;function M2(i,s,h){h=ls(-1,h),h.tag=3,h.payload={element:null};var m=s.value;return h.callback=function(){ym||(ym=!0,Cy=m),_y(i,s)},h}function A2(i,s,h){h=ls(-1,h),h.tag=3;var m=i.type.getDerivedStateFromError;if(typeof m=="function"){var v=s.value;h.payload=function(){return m(v)},h.callback=function(){_y(i,s)}}var T=i.stateNode;return T!==null&&typeof T.componentDidCatch=="function"&&(h.callback=function(){_y(i,s),typeof m!="function"&&(da===null?da=new Set([this]):da.add(this));var I=s.stack;this.componentDidCatch(s.value,{componentStack:I!==null?I:""})}),h}function cw(i,s,h){var m=i.pingCache;if(m===null){m=i.pingCache=new XM;var v=new Set;m.set(s,v)}else v=m.get(s),v===void 0&&(v=new Set,m.set(s,v));v.has(h)||(v.add(h),i=lA.bind(null,i,s,h),s.then(i,i))}function uw(i){do{var s;if((s=i.tag===13)&&(s=i.memoizedState,s=s!==null?s.dehydrated!==null:!0),s)return i;i=i.return}while(i!==null);return null}function hw(i,s,h,m,v){return(i.mode&1)===0?(i===s?i.flags|=65536:(i.flags|=128,h.flags|=131072,h.flags&=-52805,h.tag===1&&(h.alternate===null?h.tag=17:(s=ls(-1,1),s.tag=2,ha(h,s,1))),h.lanes|=1),i):(i.flags|=65536,i.lanes=v,i)}var HM=ms.ReactCurrentOwner,Hr=!1;function Nr(i,s,h,m){s.child=i===null?s2(s,null,h,m):tu(s,i.child,h,m)}function dw(i,s,h,m,v){h=h.render;var T=s.ref;return Yc(s,v),m=h0(i,s,h,m,T,v),h=d0(),i!==null&&!Hr?(s.updateQueue=i.updateQueue,s.flags&=-2053,i.lanes&=~v,fs(i,s,v)):(zn&&h&&Qy(s),s.flags|=1,Nr(i,s,m,v),s.child)}function pw(i,s,h,m,v){if(i===null){var T=h.type;return typeof T=="function"&&!b0(T)&&T.defaultProps===void 0&&h.compare===null&&h.defaultProps===void 0?(s.tag=15,s.type=T,I2(i,s,T,m,v)):(i=Wf(h.type,null,m,s,s.mode,v),i.ref=s.ref,i.return=s,s.child=i)}if(T=i.child,(i.lanes&v)===0){var I=T.memoizedProps;if(h=h.compare,h=h!==null?h:md,h(I,m)&&i.ref===s.ref)return fs(i,s,v)}return s.flags|=1,i=fa(T,m),i.ref=s.ref,i.return=s,s.child=i}function I2(i,s,h,m,v){if(i!==null){var T=i.memoizedProps;if(md(T,m)&&i.ref===s.ref)if(Hr=!1,s.pendingProps=m=T,(i.lanes&v)!==0)(i.flags&131072)!==0&&(Hr=!0);else return s.lanes=i.lanes,fs(i,s,v)}return gy(i,s,h,m,v)}function z2(i,s,h){var m=s.pendingProps,v=m.children,T=i!==null?i.memoizedState:null;if(m.mode==="hidden")if((s.mode&1)===0)s.memoizedState={baseLanes:0,cachePool:null,transitions:null},En(Zc,di),di|=h;else{if((h&1073741824)===0)return i=T!==null?T.baseLanes|h:h,s.lanes=s.childLanes=1073741824,s.memoizedState={baseLanes:i,cachePool:null,transitions:null},s.updateQueue=null,En(Zc,di),di|=i,null;s.memoizedState={baseLanes:0,cachePool:null,transitions:null},m=T!==null?T.baseLanes:h,En(Zc,di),di|=m}else T!==null?(m=T.baseLanes|h,s.memoizedState=null):m=h,En(Zc,di),di|=m;return Nr(i,s,v,h),s.child}function k2(i,s){var h=s.ref;(i===null&&h!==null||i!==null&&i.ref!==h)&&(s.flags|=512,s.flags|=2097152)}function gy(i,s,h,m,v){var T=Kr(h)?fl:Lr.current;return T=Qc(s,T),Yc(s,v),h=h0(i,s,h,m,T,v),m=d0(),i!==null&&!Hr?(s.updateQueue=i.updateQueue,s.flags&=-2053,i.lanes&=~v,fs(i,s,v)):(zn&&m&&Qy(s),s.flags|=1,Nr(i,s,h,v),s.child)}function fw(i,s,h,m,v){if(Kr(h)){var T=!0;lm(s)}else T=!1;if(Yc(s,v),s.stateNode===null)$f(i,s),i2(s,h,m),my(s,h,m,v),m=!0;else if(i===null){var I=s.stateNode,a=s.memoizedProps;I.props=a;var B=I.context,G=h.contextType;typeof G=="object"&&G!==null?G=Bi(G):(G=Kr(h)?fl:Lr.current,G=Qc(s,G));var he=h.getDerivedStateFromProps,le=typeof he=="function"||typeof I.getSnapshotBeforeUpdate=="function";le||typeof I.UNSAFE_componentWillReceiveProps!="function"&&typeof I.componentWillReceiveProps!="function"||(a!==m||B!==G)&&ow(s,I,m,G),ta=!1;var ye=s.memoizedState;I.state=ye,pm(s,m,I,v),B=s.memoizedState,a!==m||ye!==B||Yr.current||ta?(typeof he=="function"&&(fy(s,h,he,m),B=s.memoizedState),(a=ta||iw(s,h,a,m,ye,B,G))?(le||typeof I.UNSAFE_componentWillMount!="function"&&typeof I.componentWillMount!="function"||(typeof I.componentWillMount=="function"&&I.componentWillMount(),typeof I.UNSAFE_componentWillMount=="function"&&I.UNSAFE_componentWillMount()),typeof I.componentDidMount=="function"&&(s.flags|=4194308)):(typeof I.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=m,s.memoizedState=B),I.props=m,I.state=B,I.context=G,m=a):(typeof I.componentDidMount=="function"&&(s.flags|=4194308),m=!1)}else{I=s.stateNode,n2(i,s),a=s.memoizedProps,G=s.type===s.elementType?a:to(s.type,a),I.props=G,le=s.pendingProps,ye=I.context,B=h.contextType,typeof B=="object"&&B!==null?B=Bi(B):(B=Kr(h)?fl:Lr.current,B=Qc(s,B));var Fe=h.getDerivedStateFromProps;(he=typeof Fe=="function"||typeof I.getSnapshotBeforeUpdate=="function")||typeof I.UNSAFE_componentWillReceiveProps!="function"&&typeof I.componentWillReceiveProps!="function"||(a!==le||ye!==B)&&ow(s,I,m,B),ta=!1,ye=s.memoizedState,I.state=ye,pm(s,m,I,v);var Ie=s.memoizedState;a!==le||ye!==Ie||Yr.current||ta?(typeof Fe=="function"&&(fy(s,h,Fe,m),Ie=s.memoizedState),(G=ta||iw(s,h,G,m,ye,Ie,B)||!1)?(he||typeof I.UNSAFE_componentWillUpdate!="function"&&typeof I.componentWillUpdate!="function"||(typeof I.componentWillUpdate=="function"&&I.componentWillUpdate(m,Ie,B),typeof I.UNSAFE_componentWillUpdate=="function"&&I.UNSAFE_componentWillUpdate(m,Ie,B)),typeof I.componentDidUpdate=="function"&&(s.flags|=4),typeof I.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof I.componentDidUpdate!="function"||a===i.memoizedProps&&ye===i.memoizedState||(s.flags|=4),typeof I.getSnapshotBeforeUpdate!="function"||a===i.memoizedProps&&ye===i.memoizedState||(s.flags|=1024),s.memoizedProps=m,s.memoizedState=Ie),I.props=m,I.state=Ie,I.context=B,m=G):(typeof I.componentDidUpdate!="function"||a===i.memoizedProps&&ye===i.memoizedState||(s.flags|=4),typeof I.getSnapshotBeforeUpdate!="function"||a===i.memoizedProps&&ye===i.memoizedState||(s.flags|=1024),m=!1)}return yy(i,s,h,m,T,v)}function yy(i,s,h,m,v,T){k2(i,s);var I=(s.flags&128)!==0;if(!m&&!I)return v&&Q1(s,h,!1),fs(i,s,T);m=s.stateNode,HM.current=s;var a=I&&typeof h.getDerivedStateFromError!="function"?null:m.render();return s.flags|=1,i!==null&&I?(s.child=tu(s,i.child,null,T),s.child=tu(s,null,a,T)):Nr(i,s,a,T),s.memoizedState=m.state,v&&Q1(s,h,!0),s.child}function P2(i){var s=i.stateNode;s.pendingContext?J1(i,s.pendingContext,s.pendingContext!==s.context):s.context&&J1(i,s.context,!1),a0(i,s.containerInfo)}function mw(i,s,h,m,v){return eu(),t0(v),s.flags|=256,Nr(i,s,h,m),s.child}var xy={dehydrated:null,treeContext:null,retryLane:0};function vy(i){return{baseLanes:i,cachePool:null,transitions:null}}function D2(i,s,h){var m=s.pendingProps,v=Rn.current,T=!1,I=(s.flags&128)!==0,a;if((a=I)||(a=i!==null&&i.memoizedState===null?!1:(v&2)!==0),a?(T=!0,s.flags&=-129):(i===null||i.memoizedState!==null)&&(v|=1),En(Rn,v&1),i===null)return dy(s),i=s.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?((s.mode&1)===0?s.lanes=1:i.data==="$!"?s.lanes=8:s.lanes=1073741824,null):(I=m.children,i=m.fallback,T?(m=s.mode,T=s.child,I={mode:"hidden",children:I},(m&1)===0&&T!==null?(T.childLanes=0,T.pendingProps=I):T=Lm(I,m,0,null),i=pl(i,m,h,null),T.return=s,i.return=s,T.sibling=i,s.child=T,s.child.memoizedState=vy(h),s.memoizedState=xy,i):m0(s,I));if(v=i.memoizedState,v!==null&&(a=v.dehydrated,a!==null))return YM(i,s,I,m,a,v,h);if(T){T=m.fallback,I=s.mode,v=i.child,a=v.sibling;var B={mode:"hidden",children:m.children};return(I&1)===0&&s.child!==v?(m=s.child,m.childLanes=0,m.pendingProps=B,s.deletions=null):(m=fa(v,B),m.subtreeFlags=v.subtreeFlags&14680064),a!==null?T=fa(a,T):(T=pl(T,I,h,null),T.flags|=2),T.return=s,m.return=s,m.sibling=T,s.child=m,m=T,T=s.child,I=i.child.memoizedState,I=I===null?vy(h):{baseLanes:I.baseLanes|h,cachePool:null,transitions:I.transitions},T.memoizedState=I,T.childLanes=i.childLanes&~h,s.memoizedState=xy,m}return T=i.child,i=T.sibling,m=fa(T,{mode:"visible",children:m.children}),(s.mode&1)===0&&(m.lanes=h),m.return=s,m.sibling=null,i!==null&&(h=s.deletions,h===null?(s.deletions=[i],s.flags|=16):h.push(i)),s.child=m,s.memoizedState=null,m}function m0(i,s){return s=Lm({mode:"visible",children:s},i.mode,0,null),s.return=i,i.child=s}function kf(i,s,h,m){return m!==null&&t0(m),tu(s,i.child,null,h),i=m0(s,s.pendingProps.children),i.flags|=2,s.memoizedState=null,i}function YM(i,s,h,m,v,T,I){if(h)return s.flags&256?(s.flags&=-257,m=zg(Error(Je(422))),kf(i,s,I,m)):s.memoizedState!==null?(s.child=i.child,s.flags|=128,null):(T=m.fallback,v=s.mode,m=Lm({mode:"visible",children:m.children},v,0,null),T=pl(T,v,I,null),T.flags|=2,m.return=s,T.return=s,m.sibling=T,s.child=m,(s.mode&1)!==0&&tu(s,i.child,null,I),s.child.memoizedState=vy(I),s.memoizedState=xy,T);if((s.mode&1)===0)return kf(i,s,I,null);if(v.data==="$!"){if(m=v.nextSibling&&v.nextSibling.dataset,m)var a=m.dgst;return m=a,T=Error(Je(419)),m=zg(T,m,void 0),kf(i,s,I,m)}if(a=(I&i.childLanes)!==0,Hr||a){if(m=ur,m!==null){switch(I&-I){case 4:v=2;break;case 16:v=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:v=32;break;case 536870912:v=268435456;break;default:v=0}v=(v&(m.suspendedLanes|I))!==0?0:v,v!==0&&v!==T.retryLane&&(T.retryLane=v,ps(i,v),oo(m,i,v,-1))}return w0(),m=zg(Error(Je(421))),kf(i,s,I,m)}return v.data==="$?"?(s.flags|=128,s.child=i.child,s=cA.bind(null,i),v._reactRetry=s,null):(i=T.treeContext,pi=ua(v.nextSibling),fi=s,zn=!0,ro=null,i!==null&&(Pi[Di++]=ss,Pi[Di++]=as,Pi[Di++]=ml,ss=i.id,as=i.overflow,ml=s),s=m0(s,m.children),s.flags|=4096,s)}function _w(i,s,h){i.lanes|=s;var m=i.alternate;m!==null&&(m.lanes|=s),py(i.return,s,h)}function kg(i,s,h,m,v){var T=i.memoizedState;T===null?i.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:m,tail:h,tailMode:v}:(T.isBackwards=s,T.rendering=null,T.renderingStartTime=0,T.last=m,T.tail=h,T.tailMode=v)}function L2(i,s,h){var m=s.pendingProps,v=m.revealOrder,T=m.tail;if(Nr(i,s,m.children,h),m=Rn.current,(m&2)!==0)m=m&1|2,s.flags|=128;else{if(i!==null&&(i.flags&128)!==0)e:for(i=s.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&_w(i,h,s);else if(i.tag===19)_w(i,h,s);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break e;for(;i.sibling===null;){if(i.return===null||i.return===s)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}m&=1}if(En(Rn,m),(s.mode&1)===0)s.memoizedState=null;else switch(v){case"forwards":for(h=s.child,v=null;h!==null;)i=h.alternate,i!==null&&fm(i)===null&&(v=h),h=h.sibling;h=v,h===null?(v=s.child,s.child=null):(v=h.sibling,h.sibling=null),kg(s,!1,v,h,T);break;case"backwards":for(h=null,v=s.child,s.child=null;v!==null;){if(i=v.alternate,i!==null&&fm(i)===null){s.child=v;break}i=v.sibling,v.sibling=h,h=v,v=i}kg(s,!0,h,null,T);break;case"together":kg(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function $f(i,s){(s.mode&1)===0&&i!==null&&(i.alternate=null,s.alternate=null,s.flags|=2)}function fs(i,s,h){if(i!==null&&(s.dependencies=i.dependencies),gl|=s.lanes,(h&s.childLanes)===0)return null;if(i!==null&&s.child!==i.child)throw Error(Je(153));if(s.child!==null){for(i=s.child,h=fa(i,i.pendingProps),s.child=h,h.return=s;i.sibling!==null;)i=i.sibling,h=h.sibling=fa(i,i.pendingProps),h.return=s;h.sibling=null}return s.child}function KM(i,s,h){switch(s.tag){case 3:P2(s),eu();break;case 5:a2(s);break;case 1:Kr(s.type)&&lm(s);break;case 4:a0(s,s.stateNode.containerInfo);break;case 10:var m=s.type._context,v=s.memoizedProps.value;En(hm,m._currentValue),m._currentValue=v;break;case 13:if(m=s.memoizedState,m!==null)return m.dehydrated!==null?(En(Rn,Rn.current&1),s.flags|=128,null):(h&s.child.childLanes)!==0?D2(i,s,h):(En(Rn,Rn.current&1),i=fs(i,s,h),i!==null?i.sibling:null);En(Rn,Rn.current&1);break;case 19:if(m=(h&s.childLanes)!==0,(i.flags&128)!==0){if(m)return L2(i,s,h);s.flags|=128}if(v=s.memoizedState,v!==null&&(v.rendering=null,v.tail=null,v.lastEffect=null),En(Rn,Rn.current),m)break;return null;case 22:case 23:return s.lanes=0,z2(i,s,h)}return fs(i,s,h)}var R2,wy,B2,O2;R2=function(i,s){for(var h=s.child;h!==null;){if(h.tag===5||h.tag===6)i.appendChild(h.stateNode);else if(h.tag!==4&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===s)break;for(;h.sibling===null;){if(h.return===null||h.return===s)return;h=h.return}h.sibling.return=h.return,h=h.sibling}};wy=function(){};B2=function(i,s,h,m){var v=i.memoizedProps;if(v!==m){i=s.stateNode,hl(Fo.current);var T=null;switch(h){case"input":v=Gg(i,v),m=Gg(i,m),T=[];break;case"select":v=On({},v,{value:void 0}),m=On({},m,{value:void 0}),T=[];break;case"textarea":v=qg(i,v),m=qg(i,m),T=[];break;default:typeof v.onClick!="function"&&typeof m.onClick=="function"&&(i.onclick=sm)}Xg(h,m);var I;h=null;for(G in v)if(!m.hasOwnProperty(G)&&v.hasOwnProperty(G)&&v[G]!=null)if(G==="style"){var a=v[G];for(I in a)a.hasOwnProperty(I)&&(h||(h={}),h[I]="")}else G!=="dangerouslySetInnerHTML"&&G!=="children"&&G!=="suppressContentEditableWarning"&&G!=="suppressHydrationWarning"&&G!=="autoFocus"&&(ld.hasOwnProperty(G)?T||(T=[]):(T=T||[]).push(G,null));for(G in m){var B=m[G];if(a=v!=null?v[G]:void 0,m.hasOwnProperty(G)&&B!==a&&(B!=null||a!=null))if(G==="style")if(a){for(I in a)!a.hasOwnProperty(I)||B&&B.hasOwnProperty(I)||(h||(h={}),h[I]="");for(I in B)B.hasOwnProperty(I)&&a[I]!==B[I]&&(h||(h={}),h[I]=B[I])}else h||(T||(T=[]),T.push(G,h)),h=B;else G==="dangerouslySetInnerHTML"?(B=B?B.__html:void 0,a=a?a.__html:void 0,B!=null&&a!==B&&(T=T||[]).push(G,B)):G==="children"?typeof B!="string"&&typeof B!="number"||(T=T||[]).push(G,""+B):G!=="suppressContentEditableWarning"&&G!=="suppressHydrationWarning"&&(ld.hasOwnProperty(G)?(B!=null&&G==="onScroll"&&Cn("scroll",i),T||a===B||(T=[])):(T=T||[]).push(G,B))}h&&(T=T||[]).push("style",h);var G=T;(s.updateQueue=G)&&(s.flags|=4)}};O2=function(i,s,h,m){h!==m&&(s.flags|=4)};function Zh(i,s){if(!zn)switch(i.tailMode){case"hidden":s=i.tail;for(var h=null;s!==null;)s.alternate!==null&&(h=s),s=s.sibling;h===null?i.tail=null:h.sibling=null;break;case"collapsed":h=i.tail;for(var m=null;h!==null;)h.alternate!==null&&(m=h),h=h.sibling;m===null?s||i.tail===null?i.tail=null:i.tail.sibling=null:m.sibling=null}}function Pr(i){var s=i.alternate!==null&&i.alternate.child===i.child,h=0,m=0;if(s)for(var v=i.child;v!==null;)h|=v.lanes|v.childLanes,m|=v.subtreeFlags&14680064,m|=v.flags&14680064,v.return=i,v=v.sibling;else for(v=i.child;v!==null;)h|=v.lanes|v.childLanes,m|=v.subtreeFlags,m|=v.flags,v.return=i,v=v.sibling;return i.subtreeFlags|=m,i.childLanes=h,s}function JM(i,s,h){var m=s.pendingProps;switch(e0(s),s.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Pr(s),null;case 1:return Kr(s.type)&&am(),Pr(s),null;case 3:return m=s.stateNode,nu(),Mn(Yr),Mn(Lr),c0(),m.pendingContext&&(m.context=m.pendingContext,m.pendingContext=null),(i===null||i.child===null)&&(If(s)?s.flags|=4:i===null||i.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,ro!==null&&(Iy(ro),ro=null))),wy(i,s),Pr(s),null;case 5:l0(s);var v=hl(vd.current);if(h=s.type,i!==null&&s.stateNode!=null)B2(i,s,h,m,v),i.ref!==s.ref&&(s.flags|=512,s.flags|=2097152);else{if(!m){if(s.stateNode===null)throw Error(Je(166));return Pr(s),null}if(i=hl(Fo.current),If(s)){m=s.stateNode,h=s.type;var T=s.memoizedProps;switch(m[Bo]=s,m[yd]=T,i=(s.mode&1)!==0,h){case"dialog":Cn("cancel",m),Cn("close",m);break;case"iframe":case"object":case"embed":Cn("load",m);break;case"video":case"audio":for(v=0;v<Kh.length;v++)Cn(Kh[v],m);break;case"source":Cn("error",m);break;case"img":case"image":case"link":Cn("error",m),Cn("load",m);break;case"details":Cn("toggle",m);break;case"input":S1(m,T),Cn("invalid",m);break;case"select":m._wrapperState={wasMultiple:!!T.multiple},Cn("invalid",m);break;case"textarea":M1(m,T),Cn("invalid",m)}Xg(h,T),v=null;for(var I in T)if(T.hasOwnProperty(I)){var a=T[I];I==="children"?typeof a=="string"?m.textContent!==a&&(T.suppressHydrationWarning!==!0&&Af(m.textContent,a,i),v=["children",a]):typeof a=="number"&&m.textContent!==""+a&&(T.suppressHydrationWarning!==!0&&Af(m.textContent,a,i),v=["children",""+a]):ld.hasOwnProperty(I)&&a!=null&&I==="onScroll"&&Cn("scroll",m)}switch(h){case"input":vf(m),C1(m,T,!0);break;case"textarea":vf(m),A1(m);break;case"select":case"option":break;default:typeof T.onClick=="function"&&(m.onclick=sm)}m=v,s.updateQueue=m,m!==null&&(s.flags|=4)}else{I=v.nodeType===9?v:v.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=ub(h)),i==="http://www.w3.org/1999/xhtml"?h==="script"?(i=I.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof m.is=="string"?i=I.createElement(h,{is:m.is}):(i=I.createElement(h),h==="select"&&(I=i,m.multiple?I.multiple=!0:m.size&&(I.size=m.size))):i=I.createElementNS(i,h),i[Bo]=s,i[yd]=m,R2(i,s,!1,!1),s.stateNode=i;e:{switch(I=Hg(h,m),h){case"dialog":Cn("cancel",i),Cn("close",i),v=m;break;case"iframe":case"object":case"embed":Cn("load",i),v=m;break;case"video":case"audio":for(v=0;v<Kh.length;v++)Cn(Kh[v],i);v=m;break;case"source":Cn("error",i),v=m;break;case"img":case"image":case"link":Cn("error",i),Cn("load",i),v=m;break;case"details":Cn("toggle",i),v=m;break;case"input":S1(i,m),v=Gg(i,m),Cn("invalid",i);break;case"option":v=m;break;case"select":i._wrapperState={wasMultiple:!!m.multiple},v=On({},m,{value:void 0}),Cn("invalid",i);break;case"textarea":M1(i,m),v=qg(i,m),Cn("invalid",i);break;default:v=m}Xg(h,v),a=v;for(T in a)if(a.hasOwnProperty(T)){var B=a[T];T==="style"?pb(i,B):T==="dangerouslySetInnerHTML"?(B=B?B.__html:void 0,B!=null&&hb(i,B)):T==="children"?typeof B=="string"?(h!=="textarea"||B!=="")&&cd(i,B):typeof B=="number"&&cd(i,""+B):T!=="suppressContentEditableWarning"&&T!=="suppressHydrationWarning"&&T!=="autoFocus"&&(ld.hasOwnProperty(T)?B!=null&&T==="onScroll"&&Cn("scroll",i):B!=null&&Uy(i,T,B,I))}switch(h){case"input":vf(i),C1(i,m,!1);break;case"textarea":vf(i),A1(i);break;case"option":m.value!=null&&i.setAttribute("value",""+ma(m.value));break;case"select":i.multiple=!!m.multiple,T=m.value,T!=null?qc(i,!!m.multiple,T,!1):m.defaultValue!=null&&qc(i,!!m.multiple,m.defaultValue,!0);break;default:typeof v.onClick=="function"&&(i.onclick=sm)}switch(h){case"button":case"input":case"select":case"textarea":m=!!m.autoFocus;break e;case"img":m=!0;break e;default:m=!1}}m&&(s.flags|=4)}s.ref!==null&&(s.flags|=512,s.flags|=2097152)}return Pr(s),null;case 6:if(i&&s.stateNode!=null)O2(i,s,i.memoizedProps,m);else{if(typeof m!="string"&&s.stateNode===null)throw Error(Je(166));if(h=hl(vd.current),hl(Fo.current),If(s)){if(m=s.stateNode,h=s.memoizedProps,m[Bo]=s,(T=m.nodeValue!==h)&&(i=fi,i!==null))switch(i.tag){case 3:Af(m.nodeValue,h,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&Af(m.nodeValue,h,(i.mode&1)!==0)}T&&(s.flags|=4)}else m=(h.nodeType===9?h:h.ownerDocument).createTextNode(m),m[Bo]=s,s.stateNode=m}return Pr(s),null;case 13:if(Mn(Rn),m=s.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(zn&&pi!==null&&(s.mode&1)!==0&&(s.flags&128)===0)e2(),eu(),s.flags|=98560,T=!1;else if(T=If(s),m!==null&&m.dehydrated!==null){if(i===null){if(!T)throw Error(Je(318));if(T=s.memoizedState,T=T!==null?T.dehydrated:null,!T)throw Error(Je(317));T[Bo]=s}else eu(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;Pr(s),T=!1}else ro!==null&&(Iy(ro),ro=null),T=!0;if(!T)return s.flags&65536?s:null}return(s.flags&128)!==0?(s.lanes=h,s):(m=m!==null,m!==(i!==null&&i.memoizedState!==null)&&m&&(s.child.flags|=8192,(s.mode&1)!==0&&(i===null||(Rn.current&1)!==0?rr===0&&(rr=3):w0())),s.updateQueue!==null&&(s.flags|=4),Pr(s),null);case 4:return nu(),wy(i,s),i===null&&_d(s.stateNode.containerInfo),Pr(s),null;case 10:return i0(s.type._context),Pr(s),null;case 17:return Kr(s.type)&&am(),Pr(s),null;case 19:if(Mn(Rn),T=s.memoizedState,T===null)return Pr(s),null;if(m=(s.flags&128)!==0,I=T.rendering,I===null)if(m)Zh(T,!1);else{if(rr!==0||i!==null&&(i.flags&128)!==0)for(i=s.child;i!==null;){if(I=fm(i),I!==null){for(s.flags|=128,Zh(T,!1),m=I.updateQueue,m!==null&&(s.updateQueue=m,s.flags|=4),s.subtreeFlags=0,m=h,h=s.child;h!==null;)T=h,i=m,T.flags&=14680066,I=T.alternate,I===null?(T.childLanes=0,T.lanes=i,T.child=null,T.subtreeFlags=0,T.memoizedProps=null,T.memoizedState=null,T.updateQueue=null,T.dependencies=null,T.stateNode=null):(T.childLanes=I.childLanes,T.lanes=I.lanes,T.child=I.child,T.subtreeFlags=0,T.deletions=null,T.memoizedProps=I.memoizedProps,T.memoizedState=I.memoizedState,T.updateQueue=I.updateQueue,T.type=I.type,i=I.dependencies,T.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),h=h.sibling;return En(Rn,Rn.current&1|2),s.child}i=i.sibling}T.tail!==null&&Zn()>iu&&(s.flags|=128,m=!0,Zh(T,!1),s.lanes=4194304)}else{if(!m)if(i=fm(I),i!==null){if(s.flags|=128,m=!0,h=i.updateQueue,h!==null&&(s.updateQueue=h,s.flags|=4),Zh(T,!0),T.tail===null&&T.tailMode==="hidden"&&!I.alternate&&!zn)return Pr(s),null}else 2*Zn()-T.renderingStartTime>iu&&h!==1073741824&&(s.flags|=128,m=!0,Zh(T,!1),s.lanes=4194304);T.isBackwards?(I.sibling=s.child,s.child=I):(h=T.last,h!==null?h.sibling=I:s.child=I,T.last=I)}return T.tail!==null?(s=T.tail,T.rendering=s,T.tail=s.sibling,T.renderingStartTime=Zn(),s.sibling=null,h=Rn.current,En(Rn,m?h&1|2:h&1),s):(Pr(s),null);case 22:case 23:return v0(),m=s.memoizedState!==null,i!==null&&i.memoizedState!==null!==m&&(s.flags|=8192),m&&(s.mode&1)!==0?(di&1073741824)!==0&&(Pr(s),s.subtreeFlags&6&&(s.flags|=8192)):Pr(s),null;case 24:return null;case 25:return null}throw Error(Je(156,s.tag))}function QM(i,s){switch(e0(s),s.tag){case 1:return Kr(s.type)&&am(),i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 3:return nu(),Mn(Yr),Mn(Lr),c0(),i=s.flags,(i&65536)!==0&&(i&128)===0?(s.flags=i&-65537|128,s):null;case 5:return l0(s),null;case 13:if(Mn(Rn),i=s.memoizedState,i!==null&&i.dehydrated!==null){if(s.alternate===null)throw Error(Je(340));eu()}return i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 19:return Mn(Rn),null;case 4:return nu(),null;case 10:return i0(s.type._context),null;case 22:case 23:return v0(),null;case 24:return null;default:return null}}var Pf=!1,Dr=!1,eA=typeof WeakSet=="function"?WeakSet:Set,ft=null;function $c(i,s){var h=i.ref;if(h!==null)if(typeof h=="function")try{h(null)}catch(m){Vn(i,s,m)}else h.current=null}function by(i,s,h){try{h()}catch(m){Vn(i,s,m)}}var gw=!1;function tA(i,s){if(oy=rm,i=jb(),Jy(i)){if("selectionStart"in i)var h={start:i.selectionStart,end:i.selectionEnd};else e:{h=(h=i.ownerDocument)&&h.defaultView||window;var m=h.getSelection&&h.getSelection();if(m&&m.rangeCount!==0){h=m.anchorNode;var v=m.anchorOffset,T=m.focusNode;m=m.focusOffset;try{h.nodeType,T.nodeType}catch{h=null;break e}var I=0,a=-1,B=-1,G=0,he=0,le=i,ye=null;t:for(;;){for(var Fe;le!==h||v!==0&&le.nodeType!==3||(a=I+v),le!==T||m!==0&&le.nodeType!==3||(B=I+m),le.nodeType===3&&(I+=le.nodeValue.length),(Fe=le.firstChild)!==null;)ye=le,le=Fe;for(;;){if(le===i)break t;if(ye===h&&++G===v&&(a=I),ye===T&&++he===m&&(B=I),(Fe=le.nextSibling)!==null)break;le=ye,ye=le.parentNode}le=Fe}h=a===-1||B===-1?null:{start:a,end:B}}else h=null}h=h||{start:0,end:0}}else h=null;for(sy={focusedElem:i,selectionRange:h},rm=!1,ft=s;ft!==null;)if(s=ft,i=s.child,(s.subtreeFlags&1028)!==0&&i!==null)i.return=s,ft=i;else for(;ft!==null;){s=ft;try{var Ie=s.alternate;if((s.flags&1024)!==0)switch(s.tag){case 0:case 11:case 15:break;case 1:if(Ie!==null){var Ue=Ie.memoizedProps,Ft=Ie.memoizedState,me=s.stateNode,de=me.getSnapshotBeforeUpdate(s.elementType===s.type?Ue:to(s.type,Ue),Ft);me.__reactInternalSnapshotBeforeUpdate=de}break;case 3:var be=s.stateNode.containerInfo;be.nodeType===1?be.textContent="":be.nodeType===9&&be.documentElement&&be.removeChild(be.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Je(163))}}catch(He){Vn(s,s.return,He)}if(i=s.sibling,i!==null){i.return=s.return,ft=i;break}ft=s.return}return Ie=gw,gw=!1,Ie}function od(i,s,h){var m=s.updateQueue;if(m=m!==null?m.lastEffect:null,m!==null){var v=m=m.next;do{if((v.tag&i)===i){var T=v.destroy;v.destroy=void 0,T!==void 0&&by(s,h,T)}v=v.next}while(v!==m)}}function Pm(i,s){if(s=s.updateQueue,s=s!==null?s.lastEffect:null,s!==null){var h=s=s.next;do{if((h.tag&i)===i){var m=h.create;h.destroy=m()}h=h.next}while(h!==s)}}function Ty(i){var s=i.ref;if(s!==null){var h=i.stateNode;switch(i.tag){case 5:i=h;break;default:i=h}typeof s=="function"?s(i):s.current=i}}function F2(i){var s=i.alternate;s!==null&&(i.alternate=null,F2(s)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(s=i.stateNode,s!==null&&(delete s[Bo],delete s[yd],delete s[cy],delete s[OM],delete s[FM])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function U2(i){return i.tag===5||i.tag===3||i.tag===4}function yw(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||U2(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function Ey(i,s,h){var m=i.tag;if(m===5||m===6)i=i.stateNode,s?h.nodeType===8?h.parentNode.insertBefore(i,s):h.insertBefore(i,s):(h.nodeType===8?(s=h.parentNode,s.insertBefore(i,h)):(s=h,s.appendChild(i)),h=h._reactRootContainer,h!=null||s.onclick!==null||(s.onclick=sm));else if(m!==4&&(i=i.child,i!==null))for(Ey(i,s,h),i=i.sibling;i!==null;)Ey(i,s,h),i=i.sibling}function Sy(i,s,h){var m=i.tag;if(m===5||m===6)i=i.stateNode,s?h.insertBefore(i,s):h.appendChild(i);else if(m!==4&&(i=i.child,i!==null))for(Sy(i,s,h),i=i.sibling;i!==null;)Sy(i,s,h),i=i.sibling}var yr=null,no=!1;function Js(i,s,h){for(h=h.child;h!==null;)N2(i,s,h),h=h.sibling}function N2(i,s,h){if(Oo&&typeof Oo.onCommitFiberUnmount=="function")try{Oo.onCommitFiberUnmount(Em,h)}catch{}switch(h.tag){case 5:Dr||$c(h,s);case 6:var m=yr,v=no;yr=null,Js(i,s,h),yr=m,no=v,yr!==null&&(no?(i=yr,h=h.stateNode,i.nodeType===8?i.parentNode.removeChild(h):i.removeChild(h)):yr.removeChild(h.stateNode));break;case 18:yr!==null&&(no?(i=yr,h=h.stateNode,i.nodeType===8?Eg(i.parentNode,h):i.nodeType===1&&Eg(i,h),pd(i)):Eg(yr,h.stateNode));break;case 4:m=yr,v=no,yr=h.stateNode.containerInfo,no=!0,Js(i,s,h),yr=m,no=v;break;case 0:case 11:case 14:case 15:if(!Dr&&(m=h.updateQueue,m!==null&&(m=m.lastEffect,m!==null))){v=m=m.next;do{var T=v,I=T.destroy;T=T.tag,I!==void 0&&((T&2)!==0||(T&4)!==0)&&by(h,s,I),v=v.next}while(v!==m)}Js(i,s,h);break;case 1:if(!Dr&&($c(h,s),m=h.stateNode,typeof m.componentWillUnmount=="function"))try{m.props=h.memoizedProps,m.state=h.memoizedState,m.componentWillUnmount()}catch(a){Vn(h,s,a)}Js(i,s,h);break;case 21:Js(i,s,h);break;case 22:h.mode&1?(Dr=(m=Dr)||h.memoizedState!==null,Js(i,s,h),Dr=m):Js(i,s,h);break;default:Js(i,s,h)}}function xw(i){var s=i.updateQueue;if(s!==null){i.updateQueue=null;var h=i.stateNode;h===null&&(h=i.stateNode=new eA),s.forEach(function(m){var v=uA.bind(null,i,m);h.has(m)||(h.add(m),m.then(v,v))})}}function eo(i,s){var h=s.deletions;if(h!==null)for(var m=0;m<h.length;m++){var v=h[m];try{var T=i,I=s,a=I;e:for(;a!==null;){switch(a.tag){case 5:yr=a.stateNode,no=!1;break e;case 3:yr=a.stateNode.containerInfo,no=!0;break e;case 4:yr=a.stateNode.containerInfo,no=!0;break e}a=a.return}if(yr===null)throw Error(Je(160));N2(T,I,v),yr=null,no=!1;var B=v.alternate;B!==null&&(B.return=null),v.return=null}catch(G){Vn(v,s,G)}}if(s.subtreeFlags&12854)for(s=s.child;s!==null;)j2(s,i),s=s.sibling}function j2(i,s){var h=i.alternate,m=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(eo(s,i),Lo(i),m&4){try{od(3,i,i.return),Pm(3,i)}catch(Ue){Vn(i,i.return,Ue)}try{od(5,i,i.return)}catch(Ue){Vn(i,i.return,Ue)}}break;case 1:eo(s,i),Lo(i),m&512&&h!==null&&$c(h,h.return);break;case 5:if(eo(s,i),Lo(i),m&512&&h!==null&&$c(h,h.return),i.flags&32){var v=i.stateNode;try{cd(v,"")}catch(Ue){Vn(i,i.return,Ue)}}if(m&4&&(v=i.stateNode,v!=null)){var T=i.memoizedProps,I=h!==null?h.memoizedProps:T,a=i.type,B=i.updateQueue;if(i.updateQueue=null,B!==null)try{a==="input"&&T.type==="radio"&&T.name!=null&&lb(v,T),Hg(a,I);var G=Hg(a,T);for(I=0;I<B.length;I+=2){var he=B[I],le=B[I+1];he==="style"?pb(v,le):he==="dangerouslySetInnerHTML"?hb(v,le):he==="children"?cd(v,le):Uy(v,he,le,G)}switch(a){case"input":$g(v,T);break;case"textarea":cb(v,T);break;case"select":var ye=v._wrapperState.wasMultiple;v._wrapperState.wasMultiple=!!T.multiple;var Fe=T.value;Fe!=null?qc(v,!!T.multiple,Fe,!1):ye!==!!T.multiple&&(T.defaultValue!=null?qc(v,!!T.multiple,T.defaultValue,!0):qc(v,!!T.multiple,T.multiple?[]:"",!1))}v[yd]=T}catch(Ue){Vn(i,i.return,Ue)}}break;case 6:if(eo(s,i),Lo(i),m&4){if(i.stateNode===null)throw Error(Je(162));v=i.stateNode,T=i.memoizedProps;try{v.nodeValue=T}catch(Ue){Vn(i,i.return,Ue)}}break;case 3:if(eo(s,i),Lo(i),m&4&&h!==null&&h.memoizedState.isDehydrated)try{pd(s.containerInfo)}catch(Ue){Vn(i,i.return,Ue)}break;case 4:eo(s,i),Lo(i);break;case 13:eo(s,i),Lo(i),v=i.child,v.flags&8192&&(T=v.memoizedState!==null,v.stateNode.isHidden=T,!T||v.alternate!==null&&v.alternate.memoizedState!==null||(y0=Zn())),m&4&&xw(i);break;case 22:if(he=h!==null&&h.memoizedState!==null,i.mode&1?(Dr=(G=Dr)||he,eo(s,i),Dr=G):eo(s,i),Lo(i),m&8192){if(G=i.memoizedState!==null,(i.stateNode.isHidden=G)&&!he&&(i.mode&1)!==0)for(ft=i,he=i.child;he!==null;){for(le=ft=he;ft!==null;){switch(ye=ft,Fe=ye.child,ye.tag){case 0:case 11:case 14:case 15:od(4,ye,ye.return);break;case 1:$c(ye,ye.return);var Ie=ye.stateNode;if(typeof Ie.componentWillUnmount=="function"){m=ye,h=ye.return;try{s=m,Ie.props=s.memoizedProps,Ie.state=s.memoizedState,Ie.componentWillUnmount()}catch(Ue){Vn(m,h,Ue)}}break;case 5:$c(ye,ye.return);break;case 22:if(ye.memoizedState!==null){ww(le);continue}}Fe!==null?(Fe.return=ye,ft=Fe):ww(le)}he=he.sibling}e:for(he=null,le=i;;){if(le.tag===5){if(he===null){he=le;try{v=le.stateNode,G?(T=v.style,typeof T.setProperty=="function"?T.setProperty("display","none","important"):T.display="none"):(a=le.stateNode,B=le.memoizedProps.style,I=B!=null&&B.hasOwnProperty("display")?B.display:null,a.style.display=db("display",I))}catch(Ue){Vn(i,i.return,Ue)}}}else if(le.tag===6){if(he===null)try{le.stateNode.nodeValue=G?"":le.memoizedProps}catch(Ue){Vn(i,i.return,Ue)}}else if((le.tag!==22&&le.tag!==23||le.memoizedState===null||le===i)&&le.child!==null){le.child.return=le,le=le.child;continue}if(le===i)break e;for(;le.sibling===null;){if(le.return===null||le.return===i)break e;he===le&&(he=null),le=le.return}he===le&&(he=null),le.sibling.return=le.return,le=le.sibling}}break;case 19:eo(s,i),Lo(i),m&4&&xw(i);break;case 21:break;default:eo(s,i),Lo(i)}}function Lo(i){var s=i.flags;if(s&2){try{e:{for(var h=i.return;h!==null;){if(U2(h)){var m=h;break e}h=h.return}throw Error(Je(160))}switch(m.tag){case 5:var v=m.stateNode;m.flags&32&&(cd(v,""),m.flags&=-33);var T=yw(i);Sy(i,T,v);break;case 3:case 4:var I=m.stateNode.containerInfo,a=yw(i);Ey(i,a,I);break;default:throw Error(Je(161))}}catch(B){Vn(i,i.return,B)}i.flags&=-3}s&4096&&(i.flags&=-4097)}function nA(i,s,h){ft=i,V2(i)}function V2(i,s,h){for(var m=(i.mode&1)!==0;ft!==null;){var v=ft,T=v.child;if(v.tag===22&&m){var I=v.memoizedState!==null||Pf;if(!I){var a=v.alternate,B=a!==null&&a.memoizedState!==null||Dr;a=Pf;var G=Dr;if(Pf=I,(Dr=B)&&!G)for(ft=v;ft!==null;)I=ft,B=I.child,I.tag===22&&I.memoizedState!==null?bw(v):B!==null?(B.return=I,ft=B):bw(v);for(;T!==null;)ft=T,V2(T),T=T.sibling;ft=v,Pf=a,Dr=G}vw(i)}else(v.subtreeFlags&8772)!==0&&T!==null?(T.return=v,ft=T):vw(i)}}function vw(i){for(;ft!==null;){var s=ft;if((s.flags&8772)!==0){var h=s.alternate;try{if((s.flags&8772)!==0)switch(s.tag){case 0:case 11:case 15:Dr||Pm(5,s);break;case 1:var m=s.stateNode;if(s.flags&4&&!Dr)if(h===null)m.componentDidMount();else{var v=s.elementType===s.type?h.memoizedProps:to(s.type,h.memoizedProps);m.componentDidUpdate(v,h.memoizedState,m.__reactInternalSnapshotBeforeUpdate)}var T=s.updateQueue;T!==null&&rw(s,T,m);break;case 3:var I=s.updateQueue;if(I!==null){if(h=null,s.child!==null)switch(s.child.tag){case 5:h=s.child.stateNode;break;case 1:h=s.child.stateNode}rw(s,I,h)}break;case 5:var a=s.stateNode;if(h===null&&s.flags&4){h=a;var B=s.memoizedProps;switch(s.type){case"button":case"input":case"select":case"textarea":B.autoFocus&&h.focus();break;case"img":B.src&&(h.src=B.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(s.memoizedState===null){var G=s.alternate;if(G!==null){var he=G.memoizedState;if(he!==null){var le=he.dehydrated;le!==null&&pd(le)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Je(163))}Dr||s.flags&512&&Ty(s)}catch(ye){Vn(s,s.return,ye)}}if(s===i){ft=null;break}if(h=s.sibling,h!==null){h.return=s.return,ft=h;break}ft=s.return}}function ww(i){for(;ft!==null;){var s=ft;if(s===i){ft=null;break}var h=s.sibling;if(h!==null){h.return=s.return,ft=h;break}ft=s.return}}function bw(i){for(;ft!==null;){var s=ft;try{switch(s.tag){case 0:case 11:case 15:var h=s.return;try{Pm(4,s)}catch(B){Vn(s,h,B)}break;case 1:var m=s.stateNode;if(typeof m.componentDidMount=="function"){var v=s.return;try{m.componentDidMount()}catch(B){Vn(s,v,B)}}var T=s.return;try{Ty(s)}catch(B){Vn(s,T,B)}break;case 5:var I=s.return;try{Ty(s)}catch(B){Vn(s,I,B)}}}catch(B){Vn(s,s.return,B)}if(s===i){ft=null;break}var a=s.sibling;if(a!==null){a.return=s.return,ft=a;break}ft=s.return}}var rA=Math.ceil,gm=ms.ReactCurrentDispatcher,_0=ms.ReactCurrentOwner,Ri=ms.ReactCurrentBatchConfig,ln=0,ur=null,Wn=null,xr=0,di=0,Zc=ya(0),rr=0,Ed=null,gl=0,Dm=0,g0=0,sd=null,Xr=null,y0=0,iu=1/0,is=null,ym=!1,Cy=null,da=null,Df=!1,sa=null,xm=0,ad=0,My=null,Zf=-1,qf=0;function jr(){return(ln&6)!==0?Zn():Zf!==-1?Zf:Zf=Zn()}function pa(i){return(i.mode&1)===0?1:(ln&2)!==0&&xr!==0?xr&-xr:NM.transition!==null?(qf===0&&(qf=Sb()),qf):(i=xn,i!==0||(i=window.event,i=i===void 0?16:Pb(i.type)),i)}function oo(i,s,h,m){if(50<ad)throw ad=0,My=null,Error(Je(185));Ad(i,h,m),((ln&2)===0||i!==ur)&&(i===ur&&((ln&2)===0&&(Dm|=h),rr===4&&ra(i,xr)),Jr(i,m),h===1&&ln===0&&(s.mode&1)===0&&(iu=Zn()+500,Im&&xa()))}function Jr(i,s){var h=i.callbackNode;NC(i,s);var m=nm(i,i===ur?xr:0);if(m===0)h!==null&&k1(h),i.callbackNode=null,i.callbackPriority=0;else if(s=m&-m,i.callbackPriority!==s){if(h!=null&&k1(h),s===1)i.tag===0?UM(Tw.bind(null,i)):Kb(Tw.bind(null,i)),RM(function(){(ln&6)===0&&xa()}),h=null;else{switch(Cb(m)){case 1:h=$y;break;case 4:h=Tb;break;case 16:h=tm;break;case 536870912:h=Eb;break;default:h=tm}h=Y2(h,G2.bind(null,i))}i.callbackPriority=s,i.callbackNode=h}}function G2(i,s){if(Zf=-1,qf=0,(ln&6)!==0)throw Error(Je(327));var h=i.callbackNode;if(Kc()&&i.callbackNode!==h)return null;var m=nm(i,i===ur?xr:0);if(m===0)return null;if((m&30)!==0||(m&i.expiredLanes)!==0||s)s=vm(i,m);else{s=m;var v=ln;ln|=2;var T=Z2();(ur!==i||xr!==s)&&(is=null,iu=Zn()+500,dl(i,s));do try{sA();break}catch(a){$2(i,a)}while(1);r0(),gm.current=T,ln=v,Wn!==null?s=0:(ur=null,xr=0,s=rr)}if(s!==0){if(s===2&&(v=ey(i),v!==0&&(m=v,s=Ay(i,v))),s===1)throw h=Ed,dl(i,0),ra(i,m),Jr(i,Zn()),h;if(s===6)ra(i,m);else{if(v=i.current.alternate,(m&30)===0&&!iA(v)&&(s=vm(i,m),s===2&&(T=ey(i),T!==0&&(m=T,s=Ay(i,T))),s===1))throw h=Ed,dl(i,0),ra(i,m),Jr(i,Zn()),h;switch(i.finishedWork=v,i.finishedLanes=m,s){case 0:case 1:throw Error(Je(345));case 2:ll(i,Xr,is);break;case 3:if(ra(i,m),(m&130023424)===m&&(s=y0+500-Zn(),10<s)){if(nm(i,0)!==0)break;if(v=i.suspendedLanes,(v&m)!==m){jr(),i.pingedLanes|=i.suspendedLanes&v;break}i.timeoutHandle=ly(ll.bind(null,i,Xr,is),s);break}ll(i,Xr,is);break;case 4:if(ra(i,m),(m&4194240)===m)break;for(s=i.eventTimes,v=-1;0<m;){var I=31-io(m);T=1<<I,I=s[I],I>v&&(v=I),m&=~T}if(m=v,m=Zn()-m,m=(120>m?120:480>m?480:1080>m?1080:1920>m?1920:3e3>m?3e3:4320>m?4320:1960*rA(m/1960))-m,10<m){i.timeoutHandle=ly(ll.bind(null,i,Xr,is),m);break}ll(i,Xr,is);break;case 5:ll(i,Xr,is);break;default:throw Error(Je(329))}}}return Jr(i,Zn()),i.callbackNode===h?G2.bind(null,i):null}function Ay(i,s){var h=sd;return i.current.memoizedState.isDehydrated&&(dl(i,s).flags|=256),i=vm(i,s),i!==2&&(s=Xr,Xr=h,s!==null&&Iy(s)),i}function Iy(i){Xr===null?Xr=i:Xr.push.apply(Xr,i)}function iA(i){for(var s=i;;){if(s.flags&16384){var h=s.updateQueue;if(h!==null&&(h=h.stores,h!==null))for(var m=0;m<h.length;m++){var v=h[m],T=v.getSnapshot;v=v.value;try{if(!so(T(),v))return!1}catch{return!1}}}if(h=s.child,s.subtreeFlags&16384&&h!==null)h.return=s,s=h;else{if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function ra(i,s){for(s&=~g0,s&=~Dm,i.suspendedLanes|=s,i.pingedLanes&=~s,i=i.expirationTimes;0<s;){var h=31-io(s),m=1<<h;i[h]=-1,s&=~m}}function Tw(i){if((ln&6)!==0)throw Error(Je(327));Kc();var s=nm(i,0);if((s&1)===0)return Jr(i,Zn()),null;var h=vm(i,s);if(i.tag!==0&&h===2){var m=ey(i);m!==0&&(s=m,h=Ay(i,m))}if(h===1)throw h=Ed,dl(i,0),ra(i,s),Jr(i,Zn()),h;if(h===6)throw Error(Je(345));return i.finishedWork=i.current.alternate,i.finishedLanes=s,ll(i,Xr,is),Jr(i,Zn()),null}function x0(i,s){var h=ln;ln|=1;try{return i(s)}finally{ln=h,ln===0&&(iu=Zn()+500,Im&&xa())}}function yl(i){sa!==null&&sa.tag===0&&(ln&6)===0&&Kc();var s=ln;ln|=1;var h=Ri.transition,m=xn;try{if(Ri.transition=null,xn=1,i)return i()}finally{xn=m,Ri.transition=h,ln=s,(ln&6)===0&&xa()}}function v0(){di=Zc.current,Mn(Zc)}function dl(i,s){i.finishedWork=null,i.finishedLanes=0;var h=i.timeoutHandle;if(h!==-1&&(i.timeoutHandle=-1,LM(h)),Wn!==null)for(h=Wn.return;h!==null;){var m=h;switch(e0(m),m.tag){case 1:m=m.type.childContextTypes,m!=null&&am();break;case 3:nu(),Mn(Yr),Mn(Lr),c0();break;case 5:l0(m);break;case 4:nu();break;case 13:Mn(Rn);break;case 19:Mn(Rn);break;case 10:i0(m.type._context);break;case 22:case 23:v0()}h=h.return}if(ur=i,Wn=i=fa(i.current,null),xr=di=s,rr=0,Ed=null,g0=Dm=gl=0,Xr=sd=null,ul!==null){for(s=0;s<ul.length;s++)if(h=ul[s],m=h.interleaved,m!==null){h.interleaved=null;var v=m.next,T=h.pending;if(T!==null){var I=T.next;T.next=v,m.next=I}h.pending=m}ul=null}return i}function $2(i,s){do{var h=Wn;try{if(r0(),Vf.current=_m,mm){for(var m=Bn.memoizedState;m!==null;){var v=m.queue;v!==null&&(v.pending=null),m=m.next}mm=!1}if(_l=0,cr=nr=Bn=null,id=!1,wd=0,_0.current=null,h===null||h.return===null){rr=1,Ed=s,Wn=null;break}e:{var T=i,I=h.return,a=h,B=s;if(s=xr,a.flags|=32768,B!==null&&typeof B=="object"&&typeof B.then=="function"){var G=B,he=a,le=he.tag;if((he.mode&1)===0&&(le===0||le===11||le===15)){var ye=he.alternate;ye?(he.updateQueue=ye.updateQueue,he.memoizedState=ye.memoizedState,he.lanes=ye.lanes):(he.updateQueue=null,he.memoizedState=null)}var Fe=uw(I);if(Fe!==null){Fe.flags&=-257,hw(Fe,I,a,T,s),Fe.mode&1&&cw(T,G,s),s=Fe,B=G;var Ie=s.updateQueue;if(Ie===null){var Ue=new Set;Ue.add(B),s.updateQueue=Ue}else Ie.add(B);break e}else{if((s&1)===0){cw(T,G,s),w0();break e}B=Error(Je(426))}}else if(zn&&a.mode&1){var Ft=uw(I);if(Ft!==null){(Ft.flags&65536)===0&&(Ft.flags|=256),hw(Ft,I,a,T,s),t0(ru(B,a));break e}}T=B=ru(B,a),rr!==4&&(rr=2),sd===null?sd=[T]:sd.push(T),T=I;do{switch(T.tag){case 3:T.flags|=65536,s&=-s,T.lanes|=s;var me=M2(T,B,s);nw(T,me);break e;case 1:a=B;var de=T.type,be=T.stateNode;if((T.flags&128)===0&&(typeof de.getDerivedStateFromError=="function"||be!==null&&typeof be.componentDidCatch=="function"&&(da===null||!da.has(be)))){T.flags|=65536,s&=-s,T.lanes|=s;var He=A2(T,a,s);nw(T,He);break e}}T=T.return}while(T!==null)}W2(h)}catch(Me){s=Me,Wn===h&&h!==null&&(Wn=h=h.return);continue}break}while(1)}function Z2(){var i=gm.current;return gm.current=_m,i===null?_m:i}function w0(){(rr===0||rr===3||rr===2)&&(rr=4),ur===null||(gl&268435455)===0&&(Dm&268435455)===0||ra(ur,xr)}function vm(i,s){var h=ln;ln|=2;var m=Z2();(ur!==i||xr!==s)&&(is=null,dl(i,s));do try{oA();break}catch(v){$2(i,v)}while(1);if(r0(),ln=h,gm.current=m,Wn!==null)throw Error(Je(261));return ur=null,xr=0,rr}function oA(){for(;Wn!==null;)q2(Wn)}function sA(){for(;Wn!==null&&!kC();)q2(Wn)}function q2(i){var s=H2(i.alternate,i,di);i.memoizedProps=i.pendingProps,s===null?W2(i):Wn=s,_0.current=null}function W2(i){var s=i;do{var h=s.alternate;if(i=s.return,(s.flags&32768)===0){if(h=JM(h,s,di),h!==null){Wn=h;return}}else{if(h=QM(h,s),h!==null){h.flags&=32767,Wn=h;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{rr=6,Wn=null;return}}if(s=s.sibling,s!==null){Wn=s;return}Wn=s=i}while(s!==null);rr===0&&(rr=5)}function ll(i,s,h){var m=xn,v=Ri.transition;try{Ri.transition=null,xn=1,aA(i,s,h,m)}finally{Ri.transition=v,xn=m}return null}function aA(i,s,h,m){do Kc();while(sa!==null);if((ln&6)!==0)throw Error(Je(327));h=i.finishedWork;var v=i.finishedLanes;if(h===null)return null;if(i.finishedWork=null,i.finishedLanes=0,h===i.current)throw Error(Je(177));i.callbackNode=null,i.callbackPriority=0;var T=h.lanes|h.childLanes;if(jC(i,T),i===ur&&(Wn=ur=null,xr=0),(h.subtreeFlags&2064)===0&&(h.flags&2064)===0||Df||(Df=!0,Y2(tm,function(){return Kc(),null})),T=(h.flags&15990)!==0,(h.subtreeFlags&15990)!==0||T){T=Ri.transition,Ri.transition=null;var I=xn;xn=1;var a=ln;ln|=4,_0.current=null,tA(i,h),j2(h,i),MM(sy),rm=!!oy,sy=oy=null,i.current=h,nA(h),PC(),ln=a,xn=I,Ri.transition=T}else i.current=h;if(Df&&(Df=!1,sa=i,xm=v),T=i.pendingLanes,T===0&&(da=null),RC(h.stateNode),Jr(i,Zn()),s!==null)for(m=i.onRecoverableError,h=0;h<s.length;h++)v=s[h],m(v.value,{componentStack:v.stack,digest:v.digest});if(ym)throw ym=!1,i=Cy,Cy=null,i;return(xm&1)!==0&&i.tag!==0&&Kc(),T=i.pendingLanes,(T&1)!==0?i===My?ad++:(ad=0,My=i):ad=0,xa(),null}function Kc(){if(sa!==null){var i=Cb(xm),s=Ri.transition,h=xn;try{if(Ri.transition=null,xn=16>i?16:i,sa===null)var m=!1;else{if(i=sa,sa=null,xm=0,(ln&6)!==0)throw Error(Je(331));var v=ln;for(ln|=4,ft=i.current;ft!==null;){var T=ft,I=T.child;if((ft.flags&16)!==0){var a=T.deletions;if(a!==null){for(var B=0;B<a.length;B++){var G=a[B];for(ft=G;ft!==null;){var he=ft;switch(he.tag){case 0:case 11:case 15:od(8,he,T)}var le=he.child;if(le!==null)le.return=he,ft=le;else for(;ft!==null;){he=ft;var ye=he.sibling,Fe=he.return;if(F2(he),he===G){ft=null;break}if(ye!==null){ye.return=Fe,ft=ye;break}ft=Fe}}}var Ie=T.alternate;if(Ie!==null){var Ue=Ie.child;if(Ue!==null){Ie.child=null;do{var Ft=Ue.sibling;Ue.sibling=null,Ue=Ft}while(Ue!==null)}}ft=T}}if((T.subtreeFlags&2064)!==0&&I!==null)I.return=T,ft=I;else e:for(;ft!==null;){if(T=ft,(T.flags&2048)!==0)switch(T.tag){case 0:case 11:case 15:od(9,T,T.return)}var me=T.sibling;if(me!==null){me.return=T.return,ft=me;break e}ft=T.return}}var de=i.current;for(ft=de;ft!==null;){I=ft;var be=I.child;if((I.subtreeFlags&2064)!==0&&be!==null)be.return=I,ft=be;else e:for(I=de;ft!==null;){if(a=ft,(a.flags&2048)!==0)try{switch(a.tag){case 0:case 11:case 15:Pm(9,a)}}catch(Me){Vn(a,a.return,Me)}if(a===I){ft=null;break e}var He=a.sibling;if(He!==null){He.return=a.return,ft=He;break e}ft=a.return}}if(ln=v,xa(),Oo&&typeof Oo.onPostCommitFiberRoot=="function")try{Oo.onPostCommitFiberRoot(Em,i)}catch{}m=!0}return m}finally{xn=h,Ri.transition=s}}return!1}function Ew(i,s,h){s=ru(h,s),s=M2(i,s,1),i=ha(i,s,1),s=jr(),i!==null&&(Ad(i,1,s),Jr(i,s))}function Vn(i,s,h){if(i.tag===3)Ew(i,i,h);else for(;s!==null;){if(s.tag===3){Ew(s,i,h);break}else if(s.tag===1){var m=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(da===null||!da.has(m))){i=ru(h,i),i=A2(s,i,1),s=ha(s,i,1),i=jr(),s!==null&&(Ad(s,1,i),Jr(s,i));break}}s=s.return}}function lA(i,s,h){var m=i.pingCache;m!==null&&m.delete(s),s=jr(),i.pingedLanes|=i.suspendedLanes&h,ur===i&&(xr&h)===h&&(rr===4||rr===3&&(xr&130023424)===xr&&500>Zn()-y0?dl(i,0):g0|=h),Jr(i,s)}function X2(i,s){s===0&&((i.mode&1)===0?s=1:(s=Tf,Tf<<=1,(Tf&130023424)===0&&(Tf=4194304)));var h=jr();i=ps(i,s),i!==null&&(Ad(i,s,h),Jr(i,h))}function cA(i){var s=i.memoizedState,h=0;s!==null&&(h=s.retryLane),X2(i,h)}function uA(i,s){var h=0;switch(i.tag){case 13:var m=i.stateNode,v=i.memoizedState;v!==null&&(h=v.retryLane);break;case 19:m=i.stateNode;break;default:throw Error(Je(314))}m!==null&&m.delete(s),X2(i,h)}var H2;H2=function(i,s,h){if(i!==null)if(i.memoizedProps!==s.pendingProps||Yr.current)Hr=!0;else{if((i.lanes&h)===0&&(s.flags&128)===0)return Hr=!1,KM(i,s,h);Hr=(i.flags&131072)!==0}else Hr=!1,zn&&(s.flags&1048576)!==0&&Jb(s,um,s.index);switch(s.lanes=0,s.tag){case 2:var m=s.type;$f(i,s),i=s.pendingProps;var v=Qc(s,Lr.current);Yc(s,h),v=h0(null,s,m,i,v,h);var T=d0();return s.flags|=1,typeof v=="object"&&v!==null&&typeof v.render=="function"&&v.$$typeof===void 0?(s.tag=1,s.memoizedState=null,s.updateQueue=null,Kr(m)?(T=!0,lm(s)):T=!1,s.memoizedState=v.state!==null&&v.state!==void 0?v.state:null,s0(s),v.updater=zm,s.stateNode=v,v._reactInternals=s,my(s,m,i,h),s=yy(null,s,m,!0,T,h)):(s.tag=0,zn&&T&&Qy(s),Nr(null,s,v,h),s=s.child),s;case 16:m=s.elementType;e:{switch($f(i,s),i=s.pendingProps,v=m._init,m=v(m._payload),s.type=m,v=s.tag=dA(m),i=to(m,i),v){case 0:s=gy(null,s,m,i,h);break e;case 1:s=fw(null,s,m,i,h);break e;case 11:s=dw(null,s,m,i,h);break e;case 14:s=pw(null,s,m,to(m.type,i),h);break e}throw Error(Je(306,m,""))}return s;case 0:return m=s.type,v=s.pendingProps,v=s.elementType===m?v:to(m,v),gy(i,s,m,v,h);case 1:return m=s.type,v=s.pendingProps,v=s.elementType===m?v:to(m,v),fw(i,s,m,v,h);case 3:e:{if(P2(s),i===null)throw Error(Je(387));m=s.pendingProps,T=s.memoizedState,v=T.element,n2(i,s),pm(s,m,null,h);var I=s.memoizedState;if(m=I.element,T.isDehydrated)if(T={element:m,isDehydrated:!1,cache:I.cache,pendingSuspenseBoundaries:I.pendingSuspenseBoundaries,transitions:I.transitions},s.updateQueue.baseState=T,s.memoizedState=T,s.flags&256){v=ru(Error(Je(423)),s),s=mw(i,s,m,h,v);break e}else if(m!==v){v=ru(Error(Je(424)),s),s=mw(i,s,m,h,v);break e}else for(pi=ua(s.stateNode.containerInfo.firstChild),fi=s,zn=!0,ro=null,h=s2(s,null,m,h),s.child=h;h;)h.flags=h.flags&-3|4096,h=h.sibling;else{if(eu(),m===v){s=fs(i,s,h);break e}Nr(i,s,m,h)}s=s.child}return s;case 5:return a2(s),i===null&&dy(s),m=s.type,v=s.pendingProps,T=i!==null?i.memoizedProps:null,I=v.children,ay(m,v)?I=null:T!==null&&ay(m,T)&&(s.flags|=32),k2(i,s),Nr(i,s,I,h),s.child;case 6:return i===null&&dy(s),null;case 13:return D2(i,s,h);case 4:return a0(s,s.stateNode.containerInfo),m=s.pendingProps,i===null?s.child=tu(s,null,m,h):Nr(i,s,m,h),s.child;case 11:return m=s.type,v=s.pendingProps,v=s.elementType===m?v:to(m,v),dw(i,s,m,v,h);case 7:return Nr(i,s,s.pendingProps,h),s.child;case 8:return Nr(i,s,s.pendingProps.children,h),s.child;case 12:return Nr(i,s,s.pendingProps.children,h),s.child;case 10:e:{if(m=s.type._context,v=s.pendingProps,T=s.memoizedProps,I=v.value,En(hm,m._currentValue),m._currentValue=I,T!==null)if(so(T.value,I)){if(T.children===v.children&&!Yr.current){s=fs(i,s,h);break e}}else for(T=s.child,T!==null&&(T.return=s);T!==null;){var a=T.dependencies;if(a!==null){I=T.child;for(var B=a.firstContext;B!==null;){if(B.context===m){if(T.tag===1){B=ls(-1,h&-h),B.tag=2;var G=T.updateQueue;if(G!==null){G=G.shared;var he=G.pending;he===null?B.next=B:(B.next=he.next,he.next=B),G.pending=B}}T.lanes|=h,B=T.alternate,B!==null&&(B.lanes|=h),py(T.return,h,s),a.lanes|=h;break}B=B.next}}else if(T.tag===10)I=T.type===s.type?null:T.child;else if(T.tag===18){if(I=T.return,I===null)throw Error(Je(341));I.lanes|=h,a=I.alternate,a!==null&&(a.lanes|=h),py(I,h,s),I=T.sibling}else I=T.child;if(I!==null)I.return=T;else for(I=T;I!==null;){if(I===s){I=null;break}if(T=I.sibling,T!==null){T.return=I.return,I=T;break}I=I.return}T=I}Nr(i,s,v.children,h),s=s.child}return s;case 9:return v=s.type,m=s.pendingProps.children,Yc(s,h),v=Bi(v),m=m(v),s.flags|=1,Nr(i,s,m,h),s.child;case 14:return m=s.type,v=to(m,s.pendingProps),v=to(m.type,v),pw(i,s,m,v,h);case 15:return I2(i,s,s.type,s.pendingProps,h);case 17:return m=s.type,v=s.pendingProps,v=s.elementType===m?v:to(m,v),$f(i,s),s.tag=1,Kr(m)?(i=!0,lm(s)):i=!1,Yc(s,h),i2(s,m,v),my(s,m,v,h),yy(null,s,m,!0,i,h);case 19:return L2(i,s,h);case 22:return z2(i,s,h)}throw Error(Je(156,s.tag))};function Y2(i,s){return bb(i,s)}function hA(i,s,h,m){this.tag=i,this.key=h,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Li(i,s,h,m){return new hA(i,s,h,m)}function b0(i){return i=i.prototype,!(!i||!i.isReactComponent)}function dA(i){if(typeof i=="function")return b0(i)?1:0;if(i!=null){if(i=i.$$typeof,i===jy)return 11;if(i===Vy)return 14}return 2}function fa(i,s){var h=i.alternate;return h===null?(h=Li(i.tag,s,i.key,i.mode),h.elementType=i.elementType,h.type=i.type,h.stateNode=i.stateNode,h.alternate=i,i.alternate=h):(h.pendingProps=s,h.type=i.type,h.flags=0,h.subtreeFlags=0,h.deletions=null),h.flags=i.flags&14680064,h.childLanes=i.childLanes,h.lanes=i.lanes,h.child=i.child,h.memoizedProps=i.memoizedProps,h.memoizedState=i.memoizedState,h.updateQueue=i.updateQueue,s=i.dependencies,h.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},h.sibling=i.sibling,h.index=i.index,h.ref=i.ref,h}function Wf(i,s,h,m,v,T){var I=2;if(m=i,typeof i=="function")b0(i)&&(I=1);else if(typeof i=="string")I=5;else e:switch(i){case Rc:return pl(h.children,v,T,s);case Ny:I=8,v|=8;break;case Ug:return i=Li(12,h,s,v|2),i.elementType=Ug,i.lanes=T,i;case Ng:return i=Li(13,h,s,v),i.elementType=Ng,i.lanes=T,i;case jg:return i=Li(19,h,s,v),i.elementType=jg,i.lanes=T,i;case ob:return Lm(h,v,T,s);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case rb:I=10;break e;case ib:I=9;break e;case jy:I=11;break e;case Vy:I=14;break e;case ea:I=16,m=null;break e}throw Error(Je(130,i==null?i:typeof i,""))}return s=Li(I,h,s,v),s.elementType=i,s.type=m,s.lanes=T,s}function pl(i,s,h,m){return i=Li(7,i,m,s),i.lanes=h,i}function Lm(i,s,h,m){return i=Li(22,i,m,s),i.elementType=ob,i.lanes=h,i.stateNode={isHidden:!1},i}function Pg(i,s,h){return i=Li(6,i,null,s),i.lanes=h,i}function Dg(i,s,h){return s=Li(4,i.children!==null?i.children:[],i.key,s),s.lanes=h,s.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},s}function pA(i,s,h,m,v){this.tag=s,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=pg(0),this.expirationTimes=pg(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=pg(0),this.identifierPrefix=m,this.onRecoverableError=v,this.mutableSourceEagerHydrationData=null}function T0(i,s,h,m,v,T,I,a,B){return i=new pA(i,s,h,a,B),s===1?(s=1,T===!0&&(s|=8)):s=0,T=Li(3,null,null,s),i.current=T,T.stateNode=i,T.memoizedState={element:m,isDehydrated:h,cache:null,transitions:null,pendingSuspenseBoundaries:null},s0(T),i}function fA(i,s,h){var m=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Lc,key:m==null?null:""+m,children:i,containerInfo:s,implementation:h}}function K2(i){if(!i)return _a;i=i._reactInternals;e:{if(wl(i)!==i||i.tag!==1)throw Error(Je(170));var s=i;do{switch(s.tag){case 3:s=s.stateNode.context;break e;case 1:if(Kr(s.type)){s=s.stateNode.__reactInternalMemoizedMergedChildContext;break e}}s=s.return}while(s!==null);throw Error(Je(171))}if(i.tag===1){var h=i.type;if(Kr(h))return Yb(i,h,s)}return s}function J2(i,s,h,m,v,T,I,a,B){return i=T0(h,m,!0,i,v,T,I,a,B),i.context=K2(null),h=i.current,m=jr(),v=pa(h),T=ls(m,v),T.callback=s!=null?s:null,ha(h,T,v),i.current.lanes=v,Ad(i,v,m),Jr(i,m),i}function Rm(i,s,h,m){var v=s.current,T=jr(),I=pa(v);return h=K2(h),s.context===null?s.context=h:s.pendingContext=h,s=ls(T,I),s.payload={element:i},m=m===void 0?null:m,m!==null&&(s.callback=m),i=ha(v,s,I),i!==null&&(oo(i,v,I,T),jf(i,v,I)),I}function wm(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function Sw(i,s){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var h=i.retryLane;i.retryLane=h!==0&&h<s?h:s}}function E0(i,s){Sw(i,s),(i=i.alternate)&&Sw(i,s)}function mA(){return null}var Q2=typeof reportError=="function"?reportError:function(i){console.error(i)};function S0(i){this._internalRoot=i}Bm.prototype.render=S0.prototype.render=function(i){var s=this._internalRoot;if(s===null)throw Error(Je(409));Rm(i,s,null,null)};Bm.prototype.unmount=S0.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var s=i.containerInfo;yl(function(){Rm(null,i,null,null)}),s[ds]=null}};function Bm(i){this._internalRoot=i}Bm.prototype.unstable_scheduleHydration=function(i){if(i){var s=Ib();i={blockedOn:null,target:i,priority:s};for(var h=0;h<na.length&&s!==0&&s<na[h].priority;h++);na.splice(h,0,i),h===0&&kb(i)}};function C0(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function Om(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function Cw(){}function _A(i,s,h,m,v){if(v){if(typeof m=="function"){var T=m;m=function(){var G=wm(I);T.call(G)}}var I=J2(s,m,i,0,null,!1,!1,"",Cw);return i._reactRootContainer=I,i[ds]=I.current,_d(i.nodeType===8?i.parentNode:i),yl(),I}for(;v=i.lastChild;)i.removeChild(v);if(typeof m=="function"){var a=m;m=function(){var G=wm(B);a.call(G)}}var B=T0(i,0,!1,null,null,!1,!1,"",Cw);return i._reactRootContainer=B,i[ds]=B.current,_d(i.nodeType===8?i.parentNode:i),yl(function(){Rm(s,B,h,m)}),B}function Fm(i,s,h,m,v){var T=h._reactRootContainer;if(T){var I=T;if(typeof v=="function"){var a=v;v=function(){var B=wm(I);a.call(B)}}Rm(s,I,i,v)}else I=_A(h,s,i,v,m);return wm(I)}Mb=function(i){switch(i.tag){case 3:var s=i.stateNode;if(s.current.memoizedState.isDehydrated){var h=Yh(s.pendingLanes);h!==0&&(Zy(s,h|1),Jr(s,Zn()),(ln&6)===0&&(iu=Zn()+500,xa()))}break;case 13:yl(function(){var m=ps(i,1);if(m!==null){var v=jr();oo(m,i,1,v)}}),E0(i,1)}};qy=function(i){if(i.tag===13){var s=ps(i,134217728);if(s!==null){var h=jr();oo(s,i,134217728,h)}E0(i,134217728)}};Ab=function(i){if(i.tag===13){var s=pa(i),h=ps(i,s);if(h!==null){var m=jr();oo(h,i,s,m)}E0(i,s)}};Ib=function(){return xn};zb=function(i,s){var h=xn;try{return xn=i,s()}finally{xn=h}};Kg=function(i,s,h){switch(s){case"input":if($g(i,h),s=h.name,h.type==="radio"&&s!=null){for(h=i;h.parentNode;)h=h.parentNode;for(h=h.querySelectorAll("input[name="+JSON.stringify(""+s)+'][type="radio"]'),s=0;s<h.length;s++){var m=h[s];if(m!==i&&m.form===i.form){var v=Am(m);if(!v)throw Error(Je(90));ab(m),$g(m,v)}}}break;case"textarea":cb(i,h);break;case"select":s=h.value,s!=null&&qc(i,!!h.multiple,s,!1)}};_b=x0;gb=yl;var gA={usingClientEntryPoint:!1,Events:[zd,Uc,Am,fb,mb,x0]},qh={findFiberByHostInstance:cl,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},yA={bundleType:qh.bundleType,version:qh.version,rendererPackageName:qh.rendererPackageName,rendererConfig:qh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ms.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=vb(i),i===null?null:i.stateNode},findFiberByHostInstance:qh.findFiberByHostInstance||mA,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Lf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Lf.isDisabled&&Lf.supportsFiber)try{Em=Lf.inject(yA),Oo=Lf}catch{}}_i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=gA;_i.createPortal=function(i,s){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!C0(s))throw Error(Je(200));return fA(i,s,null,h)};_i.createRoot=function(i,s){if(!C0(i))throw Error(Je(299));var h=!1,m="",v=Q2;return s!=null&&(s.unstable_strictMode===!0&&(h=!0),s.identifierPrefix!==void 0&&(m=s.identifierPrefix),s.onRecoverableError!==void 0&&(v=s.onRecoverableError)),s=T0(i,1,!1,null,null,h,!1,m,v),i[ds]=s.current,_d(i.nodeType===8?i.parentNode:i),new S0(s)};_i.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var s=i._reactInternals;if(s===void 0)throw typeof i.render=="function"?Error(Je(188)):(i=Object.keys(i).join(","),Error(Je(268,i)));return i=vb(s),i=i===null?null:i.stateNode,i};_i.flushSync=function(i){return yl(i)};_i.hydrate=function(i,s,h){if(!Om(s))throw Error(Je(200));return Fm(null,i,s,!0,h)};_i.hydrateRoot=function(i,s,h){if(!C0(i))throw Error(Je(405));var m=h!=null&&h.hydratedSources||null,v=!1,T="",I=Q2;if(h!=null&&(h.unstable_strictMode===!0&&(v=!0),h.identifierPrefix!==void 0&&(T=h.identifierPrefix),h.onRecoverableError!==void 0&&(I=h.onRecoverableError)),s=J2(s,null,i,1,h!=null?h:null,v,!1,T,I),i[ds]=s.current,_d(i),m)for(i=0;i<m.length;i++)h=m[i],v=h._getVersion,v=v(h._source),s.mutableSourceEagerHydrationData==null?s.mutableSourceEagerHydrationData=[h,v]:s.mutableSourceEagerHydrationData.push(h,v);return new Bm(s)};_i.render=function(i,s,h){if(!Om(s))throw Error(Je(200));return Fm(null,i,s,!1,h)};_i.unmountComponentAtNode=function(i){if(!Om(i))throw Error(Je(40));return i._reactRootContainer?(yl(function(){Fm(null,null,i,!1,function(){i._reactRootContainer=null,i[ds]=null})}),!0):!1};_i.unstable_batchedUpdates=x0;_i.unstable_renderSubtreeIntoContainer=function(i,s,h,m){if(!Om(h))throw Error(Je(200));if(i==null||i._reactInternals===void 0)throw Error(Je(38));return Fm(i,s,h,!1,m)};_i.version="18.2.0-next-9e3b772b8-20220608";(function(i){function s(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(s)}catch(h){console.error(h)}}s(),i.exports=_i})(Tm);var Mw=Tm.exports;Og.createRoot=Mw.createRoot,Og.hydrateRoot=Mw.hydrateRoot;const xA="modulepreload",vA=function(i){return"/libraries-map/"+i},Aw={},wA=function(s,h,m){if(!h||h.length===0)return s();const v=document.getElementsByTagName("link");return Promise.all(h.map(T=>{if(T=vA(T),T in Aw)return;Aw[T]=!0;const I=T.endsWith(".css"),a=I?'[rel="stylesheet"]':"";if(!!m)for(let he=v.length-1;he>=0;he--){const le=v[he];if(le.href===T&&(!I||le.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${T}"]${a}`))return;const G=document.createElement("link");if(G.rel=I?"stylesheet":xA,I||(G.as="script",G.crossOrigin=""),G.href=T,document.head.appendChild(G),I)return new Promise((he,le)=>{G.addEventListener("load",he),G.addEventListener("error",()=>le(new Error(`Unable to preload CSS for ${T}`)))})})).then(()=>s())};var M0={exports:{}},Um={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bA=At.exports,TA=Symbol.for("react.element"),EA=Symbol.for("react.fragment"),SA=Object.prototype.hasOwnProperty,CA=bA.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,MA={key:!0,ref:!0,__self:!0,__source:!0};function eT(i,s,h){var m,v={},T=null,I=null;h!==void 0&&(T=""+h),s.key!==void 0&&(T=""+s.key),s.ref!==void 0&&(I=s.ref);for(m in s)SA.call(s,m)&&!MA.hasOwnProperty(m)&&(v[m]=s[m]);if(i&&i.defaultProps)for(m in s=i.defaultProps,s)v[m]===void 0&&(v[m]=s[m]);return{$$typeof:TA,type:i,key:T,ref:I,props:v,_owner:CA.current}}Um.Fragment=EA;Um.jsx=eT;Um.jsxs=eT;(function(i){i.exports=Um})(M0);const tr=M0.exports.jsx,Jh=M0.exports.jsxs,AA=At.exports.createContext(null);function IA(i){const s=i.clone();return s.pixelsToGLUnits=i.pixelsToGLUnits,s}function Iw(i){return{longitude:i.center.lng,latitude:i.center.lat,zoom:i.zoom,pitch:i.pitch,bearing:i.bearing,padding:i.padding}}function zw(i,s){const h=s.viewState||s;let m=!1;if("longitude"in h&&"latitude"in h){const v=i.center;i.center=new v.constructor(h.longitude,h.latitude),m=m||v!==i.center}if("zoom"in h){const v=i.zoom;i.zoom=h.zoom,m=m||v!==i.zoom}if("bearing"in h){const v=i.bearing;i.bearing=h.bearing,m=m||v!==i.bearing}if("pitch"in h){const v=i.pitch;i.pitch=h.pitch,m=m||v!==i.pitch}return h.padding&&!i.isPaddingEqual(h.padding)&&(m=!0,i.padding=h.padding),m}const zA=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function kw(i){if(!i)return null;if(typeof i=="string"||("toJS"in i&&(i=i.toJS()),!i.layers))return i;const s={};for(const m of i.layers)s[m.id]=m;const h=i.layers.map(m=>{const v=s[m.ref];let T=null;if("interactive"in m&&(T={...m},delete T.interactive),v){T=T||{...m},delete T.ref;for(const I of zA)I in v&&(T[I]=v[I])}return T||m});return{...i,layers:h}}function kA(i,s){const h=Array.isArray(i)?i[0]:i?i.x:0,m=Array.isArray(i)?i[1]:i?i.y:0,v=Array.isArray(s)?s[0]:s?s.x:0,T=Array.isArray(s)?s[1]:s?s.y:0;return h===v&&m===T}function ia(i,s){if(i===s)return!0;if(!i||!s)return!1;if(Array.isArray(i)){if(!Array.isArray(s)||i.length!==s.length)return!1;for(let h=0;h<i.length;h++)if(!ia(i[h],s[h]))return!1;return!0}else if(Array.isArray(s))return!1;if(typeof i=="object"&&typeof s=="object"){const h=Object.keys(i),m=Object.keys(s);if(h.length!==m.length)return!1;for(const v of h)if(!s.hasOwnProperty(v)||!ia(i[v],s[v]))return!1;return!0}return!1}const Pw={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Lg={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},Dw={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},PA=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],DA=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class ou{constructor(s,h,m){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=v=>{const T=this.props[Dw[v.type]];T&&T(v)},this._onPointerEvent=v=>{(v.type==="mousemove"||v.type==="mouseout")&&this._updateHover(v);const T=this.props[Pw[v.type]];if(T){if(this.props.interactiveLayerIds&&v.type!=="mouseover"&&v.type!=="mouseout"){const I=this._hoveredFeatures||this._map.queryRenderedFeatures(v.point,{layers:this.props.interactiveLayerIds});v.features=I}T(v),delete v.features}},this._onCameraEvent=v=>{if(!this._internalUpdate){const T=this.props[Lg[v.type]];T&&T(v)}v.type in this._deferredEvents&&(this._deferredEvents[v.type]=!1)},this._MapClass=s,this.props=h,this._initialize(m)}get map(){return this._map}get transform(){return this._renderTransform}setProps(s){const h=this.props;this.props=s;const m=this._updateSettings(s,h);m&&this._createShadowTransform(this._map);const v=this._updateSize(s),T=this._updateViewState(s,!0);this._updateStyle(s,h),this._updateStyleComponents(s,h),this._updateHandlers(s,h),(m||v||T&&!this._map.isMoving())&&this.redraw()}static reuse(s,h){const m=ou.savedMaps.pop();if(!m)return null;const v=m.map,T=v.getContainer();for(h.className=T.className;T.childNodes.length>0;)h.appendChild(T.childNodes[0]);v._container=h,m.setProps({...s,styleDiffing:!1}),v.resize();const{initialViewState:I}=s;return I&&(I.bounds?v.fitBounds(I.bounds,{...I.fitBoundsOptions,duration:0}):m._updateViewState(I,!1)),v.isStyleLoaded()?v.fire("load"):v.once("styledata",()=>v.fire("load")),m}_initialize(s){const{props:h}=this,m={...h,...h.initialViewState,accessToken:h.mapboxAccessToken||LA()||null,container:s,style:kw(h.mapStyle)},v=m.initialViewState||m.viewState||m;if(Object.assign(m,{center:[v.longitude||0,v.latitude||0],zoom:v.zoom||0,pitch:v.pitch||0,bearing:v.bearing||0}),h.gl){const G=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=G,h.gl)}const T=new this._MapClass(m);v.padding&&T.setPadding(v.padding),h.cursor&&(T.getCanvas().style.cursor=h.cursor),this._createShadowTransform(T);const I=T._render;T._render=G=>{this._inRender=!0,I.call(T,G),this._inRender=!1};const a=T._renderTaskQueue.run;T._renderTaskQueue.run=G=>{a.call(T._renderTaskQueue,G),this._onBeforeRepaint()},T.on("render",()=>this._onAfterRepaint());const B=T.fire;T.fire=this._fireEvent.bind(this,B),T.on("resize",()=>{this._renderTransform.resize(T.transform.width,T.transform.height)}),T.on("styledata",()=>this._updateStyleComponents(this.props,{})),T.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const G in Pw)T.on(G,this._onPointerEvent);for(const G in Lg)T.on(G,this._onCameraEvent);for(const G in Dw)T.on(G,this._onEvent);this._map=T}recycle(){ou.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const s=this._map;!this._inRender&&s.style&&(s._frame&&(s._frame.cancel(),s._frame=null),s._render())}_createShadowTransform(s){const h=IA(s.transform);s.painter.transform=h,this._renderTransform=h}_updateSize(s){const{viewState:h}=s;if(h){const m=this._map;if(h.width!==m.transform.width||h.height!==m.transform.height)return m.resize(),!0}return!1}_updateViewState(s,h){if(this._internalUpdate)return!1;const m=this._map,v=this._renderTransform,{zoom:T,pitch:I,bearing:a}=v,B=m.isMoving();B&&(v.cameraElevationReference="sea");const G=zw(v,{...Iw(m.transform),...s});if(B&&(v.cameraElevationReference="ground"),G&&h){const he=this._deferredEvents;he.move=!0,he.zoom||(he.zoom=T!==v.zoom),he.rotate||(he.rotate=a!==v.bearing),he.pitch||(he.pitch=I!==v.pitch)}return B||zw(m.transform,s),G}_updateSettings(s,h){const m=this._map;let v=!1;for(const T of PA)T in s&&!ia(s[T],h[T])&&(v=!0,m[`set${T[0].toUpperCase()}${T.slice(1)}`](s[T]));return v}_updateStyle(s,h){if(s.cursor!==h.cursor&&(this._map.getCanvas().style.cursor=s.cursor),s.mapStyle!==h.mapStyle){const m={diff:s.styleDiffing};return"localIdeographFontFamily"in s&&(m.localIdeographFontFamily=s.localIdeographFontFamily),this._map.setStyle(kw(s.mapStyle),m),!0}return!1}_updateStyleComponents(s,h){const m=this._map;let v=!1;return m.style.loaded()&&("light"in s&&!ia(s.light,h.light)&&(v=!0,m.setLight(s.light)),"fog"in s&&!ia(s.fog,h.fog)&&(v=!0,m.setFog(s.fog)),"terrain"in s&&!ia(s.terrain,h.terrain)&&(!s.terrain||m.getSource(s.terrain.source))&&(v=!0,m.setTerrain(s.terrain))),v}_updateHandlers(s,h){const m=this._map;let v=!1;for(const T of DA){const I=s[T];ia(I,h[T])||(v=!0,I?m[T].enable(I):m[T].disable())}return v}_updateHover(s){var h;const{props:m}=this;if(m.interactiveLayerIds&&(m.onMouseMove||m.onMouseEnter||m.onMouseLeave)){const T=s.type,I=((h=this._hoveredFeatures)===null||h===void 0?void 0:h.length)>0;let a;if(T==="mousemove")try{a=this._map.queryRenderedFeatures(s.point,{layers:m.interactiveLayerIds})}catch{a=[]}else a=[];const B=a.length>0;!B&&I&&(s.type="mouseleave",this._onPointerEvent(s)),this._hoveredFeatures=a,B&&!I&&(s.type="mouseenter",this._onPointerEvent(s)),s.type=T}else this._hoveredFeatures=null}_fireEvent(s,h,m){const v=this._map,T=v.transform,I=typeof h=="string"?h:h.type;return I==="move"&&this._updateViewState(this.props,!1),I in Lg&&(typeof h=="object"&&(h.viewState=Iw(T)),this._map.isMoving())?(v.transform=this._renderTransform,s.call(v,h,m),v.transform=T,v):(s.call(v,h,m),v)}_onBeforeRepaint(){const s=this._map;this._internalUpdate=!0;for(const m in this._deferredEvents)this._deferredEvents[m]&&s.fire(m);this._internalUpdate=!1;const h=this._map.transform;this._map.transform=this._renderTransform,this._onAfterRepaint=()=>{this._map.transform=h}}}ou.savedMaps=[];function LA(){let i=null;if(typeof location<"u"){const s=/access_token=([^&\/]*)/.exec(location.search);i=s&&s[1]}try{i=i||process.env.MapboxAccessToken}catch{}try{i=i||process.env.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return i}const RA=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function BA(i,s){if(!i)return null;const h=i.map,m={getMap:()=>h,getCenter:()=>i.transform.center,getZoom:()=>i.transform.zoom,getBearing:()=>i.transform.bearing,getPitch:()=>i.transform.pitch,getPadding:()=>i.transform.padding,getBounds:()=>i.transform.getBounds(),project:v=>i.transform.locationPoint(s.LngLat.convert(v)),unproject:v=>i.transform.pointLocation(s.Point.convert(v)),queryTerrainElevation:(v,T)=>{const I=h.transform;h.transform=i.transform;const a=h.queryTerrainElevation(v,T);return h.transform=I,a}};for(const v of OA(h))!(v in m)&&!RA.includes(v)&&(m[v]=h[v].bind(h));return m}function OA(i){const s=new Set;let h=i;for(;h;){for(const m of Object.getOwnPropertyNames(h))m[0]!=="_"&&typeof i[m]=="function"&&m!=="fire"&&m!=="setEventedParent"&&s.add(m);h=Object.getPrototypeOf(h)}return Array.from(s)}const FA=typeof document<"u"?At.exports.useLayoutEffect:At.exports.useEffect,UA=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function NA(i,s){for(const h of UA)h in s&&(i[h]=s[h]);s.RTLTextPlugin&&i.getRTLTextPluginStatus&&i.getRTLTextPluginStatus()==="unavailable"&&i.setRTLTextPlugin(s.RTLTextPlugin,h=>{h&&console.error(h)},!1)}const Nm=At.exports.createContext(null),jA={minZoom:0,maxZoom:22,minPitch:0,maxPitch:60,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,mapStyle:{version:8,sources:{},layers:[]},styleDiffing:!0,projection:"mercator",renderWorldCopies:!0,onError:i=>console.error(i.error),RTLTextPlugin:"https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"},A0=At.exports.forwardRef((i,s)=>{const h=At.exports.useContext(AA),[m,v]=At.exports.useState(null),T=At.exports.useRef(),{current:I}=At.exports.useRef({mapLib:null,map:null});At.exports.useEffect(()=>{const B=i.mapLib;let G=!0,he;return Promise.resolve(B||wA(()=>Promise.resolve().then(()=>Tz),void 0)).then(le=>{if(!!G){if(le.Map||(le=le.default),!le||!le.Map)throw new Error("Invalid mapLib");if(le.supported(i))NA(le,i),i.reuseMaps&&(he=ou.reuse(i,T.current)),he||(he=new ou(le.Map,i,T.current)),I.map=BA(he,le),I.mapLib=le,v(he),h==null||h.onMapMount(I.map,i.id);else throw new Error("Map is not supported by this browser")}}).catch(le=>{i.onError({type:"error",target:null,originalEvent:null,error:le})}),()=>{G=!1,he&&(h==null||h.onMapUnmount(i.id),i.reuseMaps?he.recycle():he.destroy())}},[]),FA(()=>{m&&m.setProps(i)}),At.exports.useImperativeHandle(s,()=>I.map,[m]);const a=At.exports.useMemo(()=>({position:"relative",width:"100%",height:"100%",...i.style}),[i.style]);return tr("div",{id:i.id,ref:T,style:a,children:m&&tr(Nm.Provider,{value:I,children:i.children})})});A0.displayName="Map";A0.defaultProps=jA;const VA=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function bl(i,s){if(!i||!s)return;const h=i.style;for(const m in s){const v=s[m];Number.isFinite(v)&&!VA.test(m)?h[m]=`${v}px`:h[m]=v}}const GA={draggable:!1,popup:null,rotation:0,rotationAlignment:"auto",pitchAlignment:"auto"};function tT(i){const{map:s,mapLib:h}=At.exports.useContext(Nm),m=At.exports.useRef({props:i});m.current.props=i;const v=At.exports.useMemo(()=>{let T=!1;At.exports.Children.forEach(i.children,B=>{B&&(T=!0)});const I={...i,element:T?document.createElement("div"):null},a=new h.Marker(I).setLngLat([i.longitude,i.latitude]);return a.getElement().addEventListener("click",B=>{var G,he;(he=(G=m.current.props).onClick)===null||he===void 0||he.call(G,{type:"click",target:a,originalEvent:B})}),a.on("dragstart",B=>{var G,he;const le=B;le.lngLat=v.getLngLat(),(he=(G=m.current.props).onDragStart)===null||he===void 0||he.call(G,le)}),a.on("drag",B=>{var G,he;const le=B;le.lngLat=v.getLngLat(),(he=(G=m.current.props).onDrag)===null||he===void 0||he.call(G,le)}),a.on("dragend",B=>{var G,he;const le=B;le.lngLat=v.getLngLat(),(he=(G=m.current.props).onDragEnd)===null||he===void 0||he.call(G,le)}),a},[]);return At.exports.useEffect(()=>(v.addTo(s.getMap()),()=>{v.remove()}),[]),At.exports.useEffect(()=>{bl(v.getElement(),i.style)},[i.style]),(v.getLngLat().lng!==i.longitude||v.getLngLat().lat!==i.latitude)&&v.setLngLat([i.longitude,i.latitude]),i.offset&&!kA(v.getOffset(),i.offset)&&v.setOffset(i.offset),v.isDraggable()!==i.draggable&&v.setDraggable(i.draggable),v.getRotation()!==i.rotation&&v.setRotation(i.rotation),v.getRotationAlignment()!==i.rotationAlignment&&v.setRotationAlignment(i.rotationAlignment),v.getPitchAlignment()!==i.pitchAlignment&&v.setPitchAlignment(i.pitchAlignment),v.getPopup()!==i.popup&&v.setPopup(i.popup),Tm.exports.createPortal(i.children,v.getElement())}tT.defaultProps=GA;const $A=At.exports.memo(tT);function Lw(i){return new Set(i?i.trim().split(/\s+/):[])}function ZA(i){const{map:s,mapLib:h}=At.exports.useContext(Nm),m=At.exports.useMemo(()=>document.createElement("div"),[]),v=At.exports.useRef({props:i});v.current.props=i;const T=At.exports.useMemo(()=>{const I={...i},a=new h.Popup(I).setLngLat([i.longitude,i.latitude]);return a.once("open",B=>{var G,he;(he=(G=v.current.props).onOpen)===null||he===void 0||he.call(G,B)}),a},[]);if(At.exports.useEffect(()=>{const I=a=>{var B,G;(G=(B=v.current.props).onClose)===null||G===void 0||G.call(B,a)};return T.on("close",I),T.setDOMContent(m).addTo(s.getMap()),()=>{T.off("close",I),T.isOpen()&&T.remove()}},[]),At.exports.useEffect(()=>{bl(T.getElement(),i.style)},[i.style]),T.isOpen()&&((T.getLngLat().lng!==i.longitude||T.getLngLat().lat!==i.latitude)&&T.setLngLat([i.longitude,i.latitude]),i.offset&&!ia(T.options.offset,i.offset)&&T.setOffset(i.offset),(T.options.anchor!==i.anchor||T.options.maxWidth!==i.maxWidth)&&(T.options.anchor=i.anchor,T.setMaxWidth(i.maxWidth)),T.options.className!==i.className)){const I=Lw(T.options.className),a=Lw(i.className);for(const B of I)a.has(B)||T.removeClassName(B);for(const B of a)I.has(B)||T.addClassName(B);T.options.className=i.className}return Tm.exports.createPortal(i.children,m)}At.exports.memo(ZA);function Pd(i,s,h,m){const v=At.exports.useContext(Nm),T=At.exports.useMemo(()=>i(v),[]);return At.exports.useEffect(()=>{const I=m||h||s,a=typeof s=="function"&&typeof h=="function"?s:null,B=typeof h=="function"?h:typeof s=="function"?s:null,{map:G}=v;return G.hasControl(T)||(G.addControl(T,I==null?void 0:I.position),a&&a(v)),()=>{B&&B(v),G.hasControl(T)&&G.removeControl(T)}},[]),T}function qA(i){const s=Pd(({mapLib:h})=>new h.AttributionControl(i),{position:i.position});return At.exports.useEffect(()=>{bl(s._container,i.style)},[i.style]),null}At.exports.memo(qA);function WA(i){const s=Pd(({mapLib:h})=>new h.FullscreenControl({container:i.containerId&&document.getElementById(i.containerId)}),{position:i.position});return At.exports.useEffect(()=>{bl(s._controlContainer,i.style)},[i.style]),null}const XA=At.exports.memo(WA),nT=At.exports.forwardRef((i,s)=>{const h=At.exports.useRef({props:i}),m=Pd(({mapLib:v})=>{const T=new v.GeolocateControl(i),I=T._setupUI;return T._setupUI=a=>{T._container.hasChildNodes()||I(a)},T.on("geolocate",a=>{var B,G;(G=(B=h.current.props).onGeolocate)===null||G===void 0||G.call(B,a)}),T.on("error",a=>{var B,G;(G=(B=h.current.props).onError)===null||G===void 0||G.call(B,a)}),T.on("outofmaxbounds",a=>{var B,G;(G=(B=h.current.props).onOutOfMaxBounds)===null||G===void 0||G.call(B,a)}),T.on("trackuserlocationstart",a=>{var B,G;(G=(B=h.current.props).onTrackUserLocationStart)===null||G===void 0||G.call(B,a)}),T.on("trackuserlocationend",a=>{var B,G;(G=(B=h.current.props).onTrackUserLocationEnd)===null||G===void 0||G.call(B,a)}),T},{position:i.position});return h.current.props=i,At.exports.useImperativeHandle(s,()=>({trigger:()=>m.trigger()}),[]),At.exports.useEffect(()=>{bl(m._container,i.style)},[i.style]),null});nT.displayName="GeolocateControl";const HA=At.exports.memo(nT);function YA(i){const s=Pd(({mapLib:h})=>new h.NavigationControl(i),{position:i.position});return At.exports.useEffect(()=>{bl(s._container,i.style)},[i.style]),null}const KA=At.exports.memo(YA),JA={unit:"metric",maxWidth:100};function rT(i){const s=Pd(({mapLib:h})=>new h.ScaleControl(i),{position:i.position});return(s.options.unit!==i.unit||s.options.maxWidth!==i.maxWidth)&&(s.options.maxWidth=i.maxWidth,s.setUnit(i.unit)),At.exports.useEffect(()=>{bl(s._container,i.style)},[i.style]),null}rT.defaultProps=JA;const QA=At.exports.memo(rT);const eI="_mapContainer_612cd_1",tI="_container_612cd_13",nI="_sidebar_612cd_23",rI="_marker_612cd_49",Rw={mapContainer:eI,container:tI,sidebar:nI,marker:rI},iI="_btn_14aou_1",oI={btn:iI};function Rf({text:i,...s}){return tr("button",{className:oI.btn,...s,children:i})}const sI=`M20.2,15.7L20.2,15.7c1.1-1.6,1.8-3.6,1.8-5.7c0-5.6-4.5-10-10-10S2,4.5,2,10c0,2,0.6,3.9,1.6,5.4c0,0.1,0.1,0.2,0.2,0.3
  c0,0,0.1,0.1,0.1,0.2c0.2,0.3,0.4,0.6,0.7,0.9c2.6,3.1,7.4,7.6,7.4,7.6s4.8-4.5,7.4-7.5c0.2-0.3,0.5-0.6,0.7-0.9
  C20.1,15.8,20.2,15.8,20.2,15.7z`,aI={cursor:"pointer",fill:"#d00",stroke:"none"};function lI({size:i=20}){return tr("svg",{height:i,viewBox:"0 0 24 24",style:aI,children:tr("path",{d:sI})})}const cI=At.exports.memo(lI);function iT(i,s){return function(){return i.apply(s,arguments)}}const{toString:oT}=Object.prototype,{getPrototypeOf:I0}=Object,z0=(i=>s=>{const h=oT.call(s);return i[h]||(i[h]=h.slice(8,-1).toLowerCase())})(Object.create(null)),_s=i=>(i=i.toLowerCase(),s=>z0(s)===i),jm=i=>s=>typeof s===i,{isArray:cu}=Array,Sd=jm("undefined");function uI(i){return i!==null&&!Sd(i)&&i.constructor!==null&&!Sd(i.constructor)&&xl(i.constructor.isBuffer)&&i.constructor.isBuffer(i)}const sT=_s("ArrayBuffer");function hI(i){let s;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?s=ArrayBuffer.isView(i):s=i&&i.buffer&&sT(i.buffer),s}const dI=jm("string"),xl=jm("function"),aT=jm("number"),k0=i=>i!==null&&typeof i=="object",pI=i=>i===!0||i===!1,Xf=i=>{if(z0(i)!=="object")return!1;const s=I0(i);return(s===null||s===Object.prototype||Object.getPrototypeOf(s)===null)&&!(Symbol.toStringTag in i)&&!(Symbol.iterator in i)},fI=_s("Date"),mI=_s("File"),_I=_s("Blob"),gI=_s("FileList"),yI=i=>k0(i)&&xl(i.pipe),xI=i=>{const s="[object FormData]";return i&&(typeof FormData=="function"&&i instanceof FormData||oT.call(i)===s||xl(i.toString)&&i.toString()===s)},vI=_s("URLSearchParams"),wI=i=>i.trim?i.trim():i.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Dd(i,s,{allOwnKeys:h=!1}={}){if(i===null||typeof i>"u")return;let m,v;if(typeof i!="object"&&(i=[i]),cu(i))for(m=0,v=i.length;m<v;m++)s.call(null,i[m],m,i);else{const T=h?Object.getOwnPropertyNames(i):Object.keys(i),I=T.length;let a;for(m=0;m<I;m++)a=T[m],s.call(null,i[a],a,i)}}function lT(i,s){s=s.toLowerCase();const h=Object.keys(i);let m=h.length,v;for(;m-- >0;)if(v=h[m],s===v.toLowerCase())return v;return null}const cT=typeof self>"u"?typeof global>"u"?globalThis:global:self,uT=i=>!Sd(i)&&i!==cT;function zy(){const{caseless:i}=uT(this)&&this||{},s={},h=(m,v)=>{const T=i&&lT(s,v)||v;Xf(s[T])&&Xf(m)?s[T]=zy(s[T],m):Xf(m)?s[T]=zy({},m):cu(m)?s[T]=m.slice():s[T]=m};for(let m=0,v=arguments.length;m<v;m++)arguments[m]&&Dd(arguments[m],h);return s}const bI=(i,s,h,{allOwnKeys:m}={})=>(Dd(s,(v,T)=>{h&&xl(v)?i[T]=iT(v,h):i[T]=v},{allOwnKeys:m}),i),TI=i=>(i.charCodeAt(0)===65279&&(i=i.slice(1)),i),EI=(i,s,h,m)=>{i.prototype=Object.create(s.prototype,m),i.prototype.constructor=i,Object.defineProperty(i,"super",{value:s.prototype}),h&&Object.assign(i.prototype,h)},SI=(i,s,h,m)=>{let v,T,I;const a={};if(s=s||{},i==null)return s;do{for(v=Object.getOwnPropertyNames(i),T=v.length;T-- >0;)I=v[T],(!m||m(I,i,s))&&!a[I]&&(s[I]=i[I],a[I]=!0);i=h!==!1&&I0(i)}while(i&&(!h||h(i,s))&&i!==Object.prototype);return s},CI=(i,s,h)=>{i=String(i),(h===void 0||h>i.length)&&(h=i.length),h-=s.length;const m=i.indexOf(s,h);return m!==-1&&m===h},MI=i=>{if(!i)return null;if(cu(i))return i;let s=i.length;if(!aT(s))return null;const h=new Array(s);for(;s-- >0;)h[s]=i[s];return h},AI=(i=>s=>i&&s instanceof i)(typeof Uint8Array<"u"&&I0(Uint8Array)),II=(i,s)=>{const m=(i&&i[Symbol.iterator]).call(i);let v;for(;(v=m.next())&&!v.done;){const T=v.value;s.call(i,T[0],T[1])}},zI=(i,s)=>{let h;const m=[];for(;(h=i.exec(s))!==null;)m.push(h);return m},kI=_s("HTMLFormElement"),PI=i=>i.toLowerCase().replace(/[_-\s]([a-z\d])(\w*)/g,function(h,m,v){return m.toUpperCase()+v}),Bw=(({hasOwnProperty:i})=>(s,h)=>i.call(s,h))(Object.prototype),DI=_s("RegExp"),hT=(i,s)=>{const h=Object.getOwnPropertyDescriptors(i),m={};Dd(h,(v,T)=>{s(v,T,i)!==!1&&(m[T]=v)}),Object.defineProperties(i,m)},LI=i=>{hT(i,(s,h)=>{if(xl(i)&&["arguments","caller","callee"].indexOf(h)!==-1)return!1;const m=i[h];if(!!xl(m)){if(s.enumerable=!1,"writable"in s){s.writable=!1;return}s.set||(s.set=()=>{throw Error("Can not rewrite read-only method '"+h+"'")})}})},RI=(i,s)=>{const h={},m=v=>{v.forEach(T=>{h[T]=!0})};return cu(i)?m(i):m(String(i).split(s)),h},BI=()=>{},OI=(i,s)=>(i=+i,Number.isFinite(i)?i:s),FI=i=>{const s=new Array(10),h=(m,v)=>{if(k0(m)){if(s.indexOf(m)>=0)return;if(!("toJSON"in m)){s[v]=m;const T=cu(m)?[]:{};return Dd(m,(I,a)=>{const B=h(I,v+1);!Sd(B)&&(T[a]=B)}),s[v]=void 0,T}}return m};return h(i,0)},je={isArray:cu,isArrayBuffer:sT,isBuffer:uI,isFormData:xI,isArrayBufferView:hI,isString:dI,isNumber:aT,isBoolean:pI,isObject:k0,isPlainObject:Xf,isUndefined:Sd,isDate:fI,isFile:mI,isBlob:_I,isRegExp:DI,isFunction:xl,isStream:yI,isURLSearchParams:vI,isTypedArray:AI,isFileList:gI,forEach:Dd,merge:zy,extend:bI,trim:wI,stripBOM:TI,inherits:EI,toFlatObject:SI,kindOf:z0,kindOfTest:_s,endsWith:CI,toArray:MI,forEachEntry:II,matchAll:zI,isHTMLForm:kI,hasOwnProperty:Bw,hasOwnProp:Bw,reduceDescriptors:hT,freezeMethods:LI,toObjectSet:RI,toCamelCase:PI,noop:BI,toFiniteNumber:OI,findKey:lT,global:cT,isContextDefined:uT,toJSONObject:FI};function an(i,s,h,m,v){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=i,this.name="AxiosError",s&&(this.code=s),h&&(this.config=h),m&&(this.request=m),v&&(this.response=v)}je.inherits(an,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:je.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const dT=an.prototype,pT={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(i=>{pT[i]={value:i}});Object.defineProperties(an,pT);Object.defineProperty(dT,"isAxiosError",{value:!0});an.from=(i,s,h,m,v,T)=>{const I=Object.create(dT);return je.toFlatObject(i,I,function(B){return B!==Error.prototype},a=>a!=="isAxiosError"),an.call(I,i.message,s,h,m,v),I.cause=i,I.name=i.name,T&&Object.assign(I,T),I};var UI=typeof self=="object"?self.FormData:window.FormData;const NI=UI;function ky(i){return je.isPlainObject(i)||je.isArray(i)}function fT(i){return je.endsWith(i,"[]")?i.slice(0,-2):i}function Ow(i,s,h){return i?i.concat(s).map(function(v,T){return v=fT(v),!h&&T?"["+v+"]":v}).join(h?".":""):s}function jI(i){return je.isArray(i)&&!i.some(ky)}const VI=je.toFlatObject(je,{},null,function(s){return/^is[A-Z]/.test(s)});function GI(i){return i&&je.isFunction(i.append)&&i[Symbol.toStringTag]==="FormData"&&i[Symbol.iterator]}function Vm(i,s,h){if(!je.isObject(i))throw new TypeError("target must be an object");s=s||new(NI||FormData),h=je.toFlatObject(h,{metaTokens:!0,dots:!1,indexes:!1},!1,function(Ue,Ft){return!je.isUndefined(Ft[Ue])});const m=h.metaTokens,v=h.visitor||he,T=h.dots,I=h.indexes,B=(h.Blob||typeof Blob<"u"&&Blob)&&GI(s);if(!je.isFunction(v))throw new TypeError("visitor must be a function");function G(Ie){if(Ie===null)return"";if(je.isDate(Ie))return Ie.toISOString();if(!B&&je.isBlob(Ie))throw new an("Blob is not supported. Use a Buffer instead.");return je.isArrayBuffer(Ie)||je.isTypedArray(Ie)?B&&typeof Blob=="function"?new Blob([Ie]):Buffer.from(Ie):Ie}function he(Ie,Ue,Ft){let me=Ie;if(Ie&&!Ft&&typeof Ie=="object"){if(je.endsWith(Ue,"{}"))Ue=m?Ue:Ue.slice(0,-2),Ie=JSON.stringify(Ie);else if(je.isArray(Ie)&&jI(Ie)||je.isFileList(Ie)||je.endsWith(Ue,"[]")&&(me=je.toArray(Ie)))return Ue=fT(Ue),me.forEach(function(be,He){!(je.isUndefined(be)||be===null)&&s.append(I===!0?Ow([Ue],He,T):I===null?Ue:Ue+"[]",G(be))}),!1}return ky(Ie)?!0:(s.append(Ow(Ft,Ue,T),G(Ie)),!1)}const le=[],ye=Object.assign(VI,{defaultVisitor:he,convertValue:G,isVisitable:ky});function Fe(Ie,Ue){if(!je.isUndefined(Ie)){if(le.indexOf(Ie)!==-1)throw Error("Circular reference detected in "+Ue.join("."));le.push(Ie),je.forEach(Ie,function(me,de){(!(je.isUndefined(me)||me===null)&&v.call(s,me,je.isString(de)?de.trim():de,Ue,ye))===!0&&Fe(me,Ue?Ue.concat(de):[de])}),le.pop()}}if(!je.isObject(i))throw new TypeError("data must be an object");return Fe(i),s}function Fw(i){const s={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(i).replace(/[!'()~]|%20|%00/g,function(m){return s[m]})}function P0(i,s){this._pairs=[],i&&Vm(i,this,s)}const mT=P0.prototype;mT.append=function(s,h){this._pairs.push([s,h])};mT.toString=function(s){const h=s?function(m){return s.call(this,m,Fw)}:Fw;return this._pairs.map(function(v){return h(v[0])+"="+h(v[1])},"").join("&")};function $I(i){return encodeURIComponent(i).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function _T(i,s,h){if(!s)return i;const m=h&&h.encode||$I,v=h&&h.serialize;let T;if(v?T=v(s,h):T=je.isURLSearchParams(s)?s.toString():new P0(s,h).toString(m),T){const I=i.indexOf("#");I!==-1&&(i=i.slice(0,I)),i+=(i.indexOf("?")===-1?"?":"&")+T}return i}class ZI{constructor(){this.handlers=[]}use(s,h,m){return this.handlers.push({fulfilled:s,rejected:h,synchronous:m?m.synchronous:!1,runWhen:m?m.runWhen:null}),this.handlers.length-1}eject(s){this.handlers[s]&&(this.handlers[s]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(s){je.forEach(this.handlers,function(m){m!==null&&s(m)})}}const Uw=ZI,gT={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},qI=typeof URLSearchParams<"u"?URLSearchParams:P0,WI=FormData,XI=(()=>{let i;return typeof navigator<"u"&&((i=navigator.product)==="ReactNative"||i==="NativeScript"||i==="NS")?!1:typeof window<"u"&&typeof document<"u"})(),cs={isBrowser:!0,classes:{URLSearchParams:qI,FormData:WI,Blob},isStandardBrowserEnv:XI,protocols:["http","https","file","blob","url","data"]};function HI(i,s){return Vm(i,new cs.classes.URLSearchParams,Object.assign({visitor:function(h,m,v,T){return cs.isNode&&je.isBuffer(h)?(this.append(m,h.toString("base64")),!1):T.defaultVisitor.apply(this,arguments)}},s))}function YI(i){return je.matchAll(/\w+|\[(\w*)]/g,i).map(s=>s[0]==="[]"?"":s[1]||s[0])}function KI(i){const s={},h=Object.keys(i);let m;const v=h.length;let T;for(m=0;m<v;m++)T=h[m],s[T]=i[T];return s}function yT(i){function s(h,m,v,T){let I=h[T++];const a=Number.isFinite(+I),B=T>=h.length;return I=!I&&je.isArray(v)?v.length:I,B?(je.hasOwnProp(v,I)?v[I]=[v[I],m]:v[I]=m,!a):((!v[I]||!je.isObject(v[I]))&&(v[I]=[]),s(h,m,v[I],T)&&je.isArray(v[I])&&(v[I]=KI(v[I])),!a)}if(je.isFormData(i)&&je.isFunction(i.entries)){const h={};return je.forEachEntry(i,(m,v)=>{s(YI(m),v,h,0)}),h}return null}const JI={"Content-Type":void 0};function QI(i,s,h){if(je.isString(i))try{return(s||JSON.parse)(i),je.trim(i)}catch(m){if(m.name!=="SyntaxError")throw m}return(h||JSON.stringify)(i)}const Gm={transitional:gT,adapter:["xhr","http"],transformRequest:[function(s,h){const m=h.getContentType()||"",v=m.indexOf("application/json")>-1,T=je.isObject(s);if(T&&je.isHTMLForm(s)&&(s=new FormData(s)),je.isFormData(s))return v&&v?JSON.stringify(yT(s)):s;if(je.isArrayBuffer(s)||je.isBuffer(s)||je.isStream(s)||je.isFile(s)||je.isBlob(s))return s;if(je.isArrayBufferView(s))return s.buffer;if(je.isURLSearchParams(s))return h.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),s.toString();let a;if(T){if(m.indexOf("application/x-www-form-urlencoded")>-1)return HI(s,this.formSerializer).toString();if((a=je.isFileList(s))||m.indexOf("multipart/form-data")>-1){const B=this.env&&this.env.FormData;return Vm(a?{"files[]":s}:s,B&&new B,this.formSerializer)}}return T||v?(h.setContentType("application/json",!1),QI(s)):s}],transformResponse:[function(s){const h=this.transitional||Gm.transitional,m=h&&h.forcedJSONParsing,v=this.responseType==="json";if(s&&je.isString(s)&&(m&&!this.responseType||v)){const I=!(h&&h.silentJSONParsing)&&v;try{return JSON.parse(s)}catch(a){if(I)throw a.name==="SyntaxError"?an.from(a,an.ERR_BAD_RESPONSE,this,null,this.response):a}}return s}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:cs.classes.FormData,Blob:cs.classes.Blob},validateStatus:function(s){return s>=200&&s<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};je.forEach(["delete","get","head"],function(s){Gm.headers[s]={}});je.forEach(["post","put","patch"],function(s){Gm.headers[s]=je.merge(JI)});const D0=Gm,ez=je.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),tz=i=>{const s={};let h,m,v;return i&&i.split(`
`).forEach(function(I){v=I.indexOf(":"),h=I.substring(0,v).trim().toLowerCase(),m=I.substring(v+1).trim(),!(!h||s[h]&&ez[h])&&(h==="set-cookie"?s[h]?s[h].push(m):s[h]=[m]:s[h]=s[h]?s[h]+", "+m:m)}),s},Nw=Symbol("internals");function Wh(i){return i&&String(i).trim().toLowerCase()}function Hf(i){return i===!1||i==null?i:je.isArray(i)?i.map(Hf):String(i)}function nz(i){const s=Object.create(null),h=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let m;for(;m=h.exec(i);)s[m[1]]=m[2];return s}function rz(i){return/^[-_a-zA-Z]+$/.test(i.trim())}function jw(i,s,h,m){if(je.isFunction(m))return m.call(this,s,h);if(!!je.isString(s)){if(je.isString(m))return s.indexOf(m)!==-1;if(je.isRegExp(m))return m.test(s)}}function iz(i){return i.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(s,h,m)=>h.toUpperCase()+m)}function oz(i,s){const h=je.toCamelCase(" "+s);["get","set","has"].forEach(m=>{Object.defineProperty(i,m+h,{value:function(v,T,I){return this[m].call(this,s,v,T,I)},configurable:!0})})}class $m{constructor(s){s&&this.set(s)}set(s,h,m){const v=this;function T(a,B,G){const he=Wh(B);if(!he)throw new Error("header name must be a non-empty string");const le=je.findKey(v,he);(!le||v[le]===void 0||G===!0||G===void 0&&v[le]!==!1)&&(v[le||B]=Hf(a))}const I=(a,B)=>je.forEach(a,(G,he)=>T(G,he,B));return je.isPlainObject(s)||s instanceof this.constructor?I(s,h):je.isString(s)&&(s=s.trim())&&!rz(s)?I(tz(s),h):s!=null&&T(h,s,m),this}get(s,h){if(s=Wh(s),s){const m=je.findKey(this,s);if(m){const v=this[m];if(!h)return v;if(h===!0)return nz(v);if(je.isFunction(h))return h.call(this,v,m);if(je.isRegExp(h))return h.exec(v);throw new TypeError("parser must be boolean|regexp|function")}}}has(s,h){if(s=Wh(s),s){const m=je.findKey(this,s);return!!(m&&(!h||jw(this,this[m],m,h)))}return!1}delete(s,h){const m=this;let v=!1;function T(I){if(I=Wh(I),I){const a=je.findKey(m,I);a&&(!h||jw(m,m[a],a,h))&&(delete m[a],v=!0)}}return je.isArray(s)?s.forEach(T):T(s),v}clear(){return Object.keys(this).forEach(this.delete.bind(this))}normalize(s){const h=this,m={};return je.forEach(this,(v,T)=>{const I=je.findKey(m,T);if(I){h[I]=Hf(v),delete h[T];return}const a=s?iz(T):String(T).trim();a!==T&&delete h[T],h[a]=Hf(v),m[a]=!0}),this}concat(...s){return this.constructor.concat(this,...s)}toJSON(s){const h=Object.create(null);return je.forEach(this,(m,v)=>{m!=null&&m!==!1&&(h[v]=s&&je.isArray(m)?m.join(", "):m)}),h}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([s,h])=>s+": "+h).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(s){return s instanceof this?s:new this(s)}static concat(s,...h){const m=new this(s);return h.forEach(v=>m.set(v)),m}static accessor(s){const m=(this[Nw]=this[Nw]={accessors:{}}).accessors,v=this.prototype;function T(I){const a=Wh(I);m[a]||(oz(v,I),m[a]=!0)}return je.isArray(s)?s.forEach(T):T(s),this}}$m.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent"]);je.freezeMethods($m.prototype);je.freezeMethods($m);const us=$m;function Rg(i,s){const h=this||D0,m=s||h,v=us.from(m.headers);let T=m.data;return je.forEach(i,function(a){T=a.call(h,T,v.normalize(),s?s.status:void 0)}),v.normalize(),T}function xT(i){return!!(i&&i.__CANCEL__)}function Ld(i,s,h){an.call(this,i==null?"canceled":i,an.ERR_CANCELED,s,h),this.name="CanceledError"}je.inherits(Ld,an,{__CANCEL__:!0});const sz=null;function az(i,s,h){const m=h.config.validateStatus;!h.status||!m||m(h.status)?i(h):s(new an("Request failed with status code "+h.status,[an.ERR_BAD_REQUEST,an.ERR_BAD_RESPONSE][Math.floor(h.status/100)-4],h.config,h.request,h))}const lz=cs.isStandardBrowserEnv?function(){return{write:function(h,m,v,T,I,a){const B=[];B.push(h+"="+encodeURIComponent(m)),je.isNumber(v)&&B.push("expires="+new Date(v).toGMTString()),je.isString(T)&&B.push("path="+T),je.isString(I)&&B.push("domain="+I),a===!0&&B.push("secure"),document.cookie=B.join("; ")},read:function(h){const m=document.cookie.match(new RegExp("(^|;\\s*)("+h+")=([^;]*)"));return m?decodeURIComponent(m[3]):null},remove:function(h){this.write(h,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function cz(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}function uz(i,s){return s?i.replace(/\/+$/,"")+"/"+s.replace(/^\/+/,""):i}function vT(i,s){return i&&!cz(s)?uz(i,s):s}const hz=cs.isStandardBrowserEnv?function(){const s=/(msie|trident)/i.test(navigator.userAgent),h=document.createElement("a");let m;function v(T){let I=T;return s&&(h.setAttribute("href",I),I=h.href),h.setAttribute("href",I),{href:h.href,protocol:h.protocol?h.protocol.replace(/:$/,""):"",host:h.host,search:h.search?h.search.replace(/^\?/,""):"",hash:h.hash?h.hash.replace(/^#/,""):"",hostname:h.hostname,port:h.port,pathname:h.pathname.charAt(0)==="/"?h.pathname:"/"+h.pathname}}return m=v(window.location.href),function(I){const a=je.isString(I)?v(I):I;return a.protocol===m.protocol&&a.host===m.host}}():function(){return function(){return!0}}();function dz(i){const s=/^([-+\w]{1,25})(:?\/\/|:)/.exec(i);return s&&s[1]||""}function pz(i,s){i=i||10;const h=new Array(i),m=new Array(i);let v=0,T=0,I;return s=s!==void 0?s:1e3,function(B){const G=Date.now(),he=m[T];I||(I=G),h[v]=B,m[v]=G;let le=T,ye=0;for(;le!==v;)ye+=h[le++],le=le%i;if(v=(v+1)%i,v===T&&(T=(T+1)%i),G-I<s)return;const Fe=he&&G-he;return Fe?Math.round(ye*1e3/Fe):void 0}}function Vw(i,s){let h=0;const m=pz(50,250);return v=>{const T=v.loaded,I=v.lengthComputable?v.total:void 0,a=T-h,B=m(a),G=T<=I;h=T;const he={loaded:T,total:I,progress:I?T/I:void 0,bytes:a,rate:B||void 0,estimated:B&&I&&G?(I-T)/B:void 0,event:v};he[s?"download":"upload"]=!0,i(he)}}const fz=typeof XMLHttpRequest<"u",mz=fz&&function(i){return new Promise(function(h,m){let v=i.data;const T=us.from(i.headers).normalize(),I=i.responseType;let a;function B(){i.cancelToken&&i.cancelToken.unsubscribe(a),i.signal&&i.signal.removeEventListener("abort",a)}je.isFormData(v)&&cs.isStandardBrowserEnv&&T.setContentType(!1);let G=new XMLHttpRequest;if(i.auth){const Fe=i.auth.username||"",Ie=i.auth.password?unescape(encodeURIComponent(i.auth.password)):"";T.set("Authorization","Basic "+btoa(Fe+":"+Ie))}const he=vT(i.baseURL,i.url);G.open(i.method.toUpperCase(),_T(he,i.params,i.paramsSerializer),!0),G.timeout=i.timeout;function le(){if(!G)return;const Fe=us.from("getAllResponseHeaders"in G&&G.getAllResponseHeaders()),Ue={data:!I||I==="text"||I==="json"?G.responseText:G.response,status:G.status,statusText:G.statusText,headers:Fe,config:i,request:G};az(function(me){h(me),B()},function(me){m(me),B()},Ue),G=null}if("onloadend"in G?G.onloadend=le:G.onreadystatechange=function(){!G||G.readyState!==4||G.status===0&&!(G.responseURL&&G.responseURL.indexOf("file:")===0)||setTimeout(le)},G.onabort=function(){!G||(m(new an("Request aborted",an.ECONNABORTED,i,G)),G=null)},G.onerror=function(){m(new an("Network Error",an.ERR_NETWORK,i,G)),G=null},G.ontimeout=function(){let Ie=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const Ue=i.transitional||gT;i.timeoutErrorMessage&&(Ie=i.timeoutErrorMessage),m(new an(Ie,Ue.clarifyTimeoutError?an.ETIMEDOUT:an.ECONNABORTED,i,G)),G=null},cs.isStandardBrowserEnv){const Fe=(i.withCredentials||hz(he))&&i.xsrfCookieName&&lz.read(i.xsrfCookieName);Fe&&T.set(i.xsrfHeaderName,Fe)}v===void 0&&T.setContentType(null),"setRequestHeader"in G&&je.forEach(T.toJSON(),function(Ie,Ue){G.setRequestHeader(Ue,Ie)}),je.isUndefined(i.withCredentials)||(G.withCredentials=!!i.withCredentials),I&&I!=="json"&&(G.responseType=i.responseType),typeof i.onDownloadProgress=="function"&&G.addEventListener("progress",Vw(i.onDownloadProgress,!0)),typeof i.onUploadProgress=="function"&&G.upload&&G.upload.addEventListener("progress",Vw(i.onUploadProgress)),(i.cancelToken||i.signal)&&(a=Fe=>{!G||(m(!Fe||Fe.type?new Ld(null,i,G):Fe),G.abort(),G=null)},i.cancelToken&&i.cancelToken.subscribe(a),i.signal&&(i.signal.aborted?a():i.signal.addEventListener("abort",a)));const ye=dz(he);if(ye&&cs.protocols.indexOf(ye)===-1){m(new an("Unsupported protocol "+ye+":",an.ERR_BAD_REQUEST,i));return}G.send(v||null)})},Yf={http:sz,xhr:mz};je.forEach(Yf,(i,s)=>{if(i){try{Object.defineProperty(i,"name",{value:s})}catch{}Object.defineProperty(i,"adapterName",{value:s})}});const _z={getAdapter:i=>{i=je.isArray(i)?i:[i];const{length:s}=i;let h,m;for(let v=0;v<s&&(h=i[v],!(m=je.isString(h)?Yf[h.toLowerCase()]:h));v++);if(!m)throw m===!1?new an(`Adapter ${h} is not supported by the environment`,"ERR_NOT_SUPPORT"):new Error(je.hasOwnProp(Yf,h)?`Adapter '${h}' is not available in the build`:`Unknown adapter '${h}'`);if(!je.isFunction(m))throw new TypeError("adapter is not a function");return m},adapters:Yf};function Bg(i){if(i.cancelToken&&i.cancelToken.throwIfRequested(),i.signal&&i.signal.aborted)throw new Ld}function Gw(i){return Bg(i),i.headers=us.from(i.headers),i.data=Rg.call(i,i.transformRequest),["post","put","patch"].indexOf(i.method)!==-1&&i.headers.setContentType("application/x-www-form-urlencoded",!1),_z.getAdapter(i.adapter||D0.adapter)(i).then(function(m){return Bg(i),m.data=Rg.call(i,i.transformResponse,m),m.headers=us.from(m.headers),m},function(m){return xT(m)||(Bg(i),m&&m.response&&(m.response.data=Rg.call(i,i.transformResponse,m.response),m.response.headers=us.from(m.response.headers))),Promise.reject(m)})}const $w=i=>i instanceof us?i.toJSON():i;function Cd(i,s){s=s||{};const h={};function m(G,he,le){return je.isPlainObject(G)&&je.isPlainObject(he)?je.merge.call({caseless:le},G,he):je.isPlainObject(he)?je.merge({},he):je.isArray(he)?he.slice():he}function v(G,he,le){if(je.isUndefined(he)){if(!je.isUndefined(G))return m(void 0,G,le)}else return m(G,he,le)}function T(G,he){if(!je.isUndefined(he))return m(void 0,he)}function I(G,he){if(je.isUndefined(he)){if(!je.isUndefined(G))return m(void 0,G)}else return m(void 0,he)}function a(G,he,le){if(le in s)return m(G,he);if(le in i)return m(void 0,G)}const B={url:T,method:T,data:T,baseURL:I,transformRequest:I,transformResponse:I,paramsSerializer:I,timeout:I,timeoutMessage:I,withCredentials:I,adapter:I,responseType:I,xsrfCookieName:I,xsrfHeaderName:I,onUploadProgress:I,onDownloadProgress:I,decompress:I,maxContentLength:I,maxBodyLength:I,beforeRedirect:I,transport:I,httpAgent:I,httpsAgent:I,cancelToken:I,socketPath:I,responseEncoding:I,validateStatus:a,headers:(G,he)=>v($w(G),$w(he),!0)};return je.forEach(Object.keys(i).concat(Object.keys(s)),function(he){const le=B[he]||v,ye=le(i[he],s[he],he);je.isUndefined(ye)&&le!==a||(h[he]=ye)}),h}const wT="1.2.0",L0={};["object","boolean","number","function","string","symbol"].forEach((i,s)=>{L0[i]=function(m){return typeof m===i||"a"+(s<1?"n ":" ")+i}});const Zw={};L0.transitional=function(s,h,m){function v(T,I){return"[Axios v"+wT+"] Transitional option '"+T+"'"+I+(m?". "+m:"")}return(T,I,a)=>{if(s===!1)throw new an(v(I," has been removed"+(h?" in "+h:"")),an.ERR_DEPRECATED);return h&&!Zw[I]&&(Zw[I]=!0,console.warn(v(I," has been deprecated since v"+h+" and will be removed in the near future"))),s?s(T,I,a):!0}};function gz(i,s,h){if(typeof i!="object")throw new an("options must be an object",an.ERR_BAD_OPTION_VALUE);const m=Object.keys(i);let v=m.length;for(;v-- >0;){const T=m[v],I=s[T];if(I){const a=i[T],B=a===void 0||I(a,T,i);if(B!==!0)throw new an("option "+T+" must be "+B,an.ERR_BAD_OPTION_VALUE);continue}if(h!==!0)throw new an("Unknown option "+T,an.ERR_BAD_OPTION)}}const Py={assertOptions:gz,validators:L0},Qs=Py.validators;class bm{constructor(s){this.defaults=s,this.interceptors={request:new Uw,response:new Uw}}request(s,h){typeof s=="string"?(h=h||{},h.url=s):h=s||{},h=Cd(this.defaults,h);const{transitional:m,paramsSerializer:v,headers:T}=h;m!==void 0&&Py.assertOptions(m,{silentJSONParsing:Qs.transitional(Qs.boolean),forcedJSONParsing:Qs.transitional(Qs.boolean),clarifyTimeoutError:Qs.transitional(Qs.boolean)},!1),v!==void 0&&Py.assertOptions(v,{encode:Qs.function,serialize:Qs.function},!0),h.method=(h.method||this.defaults.method||"get").toLowerCase();let I;I=T&&je.merge(T.common,T[h.method]),I&&je.forEach(["delete","get","head","post","put","patch","common"],Ie=>{delete T[Ie]}),h.headers=us.concat(I,T);const a=[];let B=!0;this.interceptors.request.forEach(function(Ue){typeof Ue.runWhen=="function"&&Ue.runWhen(h)===!1||(B=B&&Ue.synchronous,a.unshift(Ue.fulfilled,Ue.rejected))});const G=[];this.interceptors.response.forEach(function(Ue){G.push(Ue.fulfilled,Ue.rejected)});let he,le=0,ye;if(!B){const Ie=[Gw.bind(this),void 0];for(Ie.unshift.apply(Ie,a),Ie.push.apply(Ie,G),ye=Ie.length,he=Promise.resolve(h);le<ye;)he=he.then(Ie[le++],Ie[le++]);return he}ye=a.length;let Fe=h;for(le=0;le<ye;){const Ie=a[le++],Ue=a[le++];try{Fe=Ie(Fe)}catch(Ft){Ue.call(this,Ft);break}}try{he=Gw.call(this,Fe)}catch(Ie){return Promise.reject(Ie)}for(le=0,ye=G.length;le<ye;)he=he.then(G[le++],G[le++]);return he}getUri(s){s=Cd(this.defaults,s);const h=vT(s.baseURL,s.url);return _T(h,s.params,s.paramsSerializer)}}je.forEach(["delete","get","head","options"],function(s){bm.prototype[s]=function(h,m){return this.request(Cd(m||{},{method:s,url:h,data:(m||{}).data}))}});je.forEach(["post","put","patch"],function(s){function h(m){return function(T,I,a){return this.request(Cd(a||{},{method:s,headers:m?{"Content-Type":"multipart/form-data"}:{},url:T,data:I}))}}bm.prototype[s]=h(),bm.prototype[s+"Form"]=h(!0)});const Kf=bm;class R0{constructor(s){if(typeof s!="function")throw new TypeError("executor must be a function.");let h;this.promise=new Promise(function(T){h=T});const m=this;this.promise.then(v=>{if(!m._listeners)return;let T=m._listeners.length;for(;T-- >0;)m._listeners[T](v);m._listeners=null}),this.promise.then=v=>{let T;const I=new Promise(a=>{m.subscribe(a),T=a}).then(v);return I.cancel=function(){m.unsubscribe(T)},I},s(function(T,I,a){m.reason||(m.reason=new Ld(T,I,a),h(m.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(s){if(this.reason){s(this.reason);return}this._listeners?this._listeners.push(s):this._listeners=[s]}unsubscribe(s){if(!this._listeners)return;const h=this._listeners.indexOf(s);h!==-1&&this._listeners.splice(h,1)}static source(){let s;return{token:new R0(function(v){s=v}),cancel:s}}}const yz=R0;function xz(i){return function(h){return i.apply(null,h)}}function vz(i){return je.isObject(i)&&i.isAxiosError===!0}function bT(i){const s=new Kf(i),h=iT(Kf.prototype.request,s);return je.extend(h,Kf.prototype,s,{allOwnKeys:!0}),je.extend(h,s,null,{allOwnKeys:!0}),h.create=function(v){return bT(Cd(i,v))},h}const wr=bT(D0);wr.Axios=Kf;wr.CanceledError=Ld;wr.CancelToken=yz;wr.isCancel=xT;wr.VERSION=wT;wr.toFormData=Vm;wr.AxiosError=an;wr.Cancel=wr.CanceledError;wr.all=function(s){return Promise.all(s)};wr.spread=xz;wr.isAxiosError=vz;wr.AxiosHeaders=us;wr.formToJSON=i=>yT(je.isHTMLForm(i)?new FormData(i):i);wr.default=wr;const wz=wr;function bz(){const[i,s]=At.exports.useState(null),h=At.exports.useRef();At.exports.useEffect(()=>{wz.get("https://wfs-kbhkort.kk.dk/k101/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=k101:biblioteker&outputFormat=json&SRSNAME=EPSG:4326").then(Ue=>{s(Ue.data)})},[]);const m=[];if(i!==null){const Ue=i.features.map((Ft,me)=>tr($A,{longitude:Ft.geometry.coordinates[0][0],latitude:Ft.geometry.coordinates[0][1],anchor:"bottom",children:tr(cI,{})},`marker-${me}`));m.push(Ue)}const v="pk.eyJ1IjoiYWRlbGluYXJhZHVsZXNjdSIsImEiOiJjbGF0cWFmNTQwM2U4M3Btb2djZWxyM20zIn0.qMv2ldG5SYADLla1erJiLg",[T,I]=At.exports.useState(12.568337),[a,B]=At.exports.useState(55.676098),[G,he]=At.exports.useState(10),[le,ye]=At.exports.useState("");function Fe(){!h.current||(I(h.current.getCenter().lng.toFixed(4)),B(h.current.getCenter().lat.toFixed(4)),he(h.current.getZoom().toFixed(2)))}function Ie(Ue){ye(Ue.currentTarget.value)}return At.exports.useEffect(()=>{!h.current||(le==="Valby"?h.current.flyTo({center:[12.516775,55.661659],essential:!0,zoom:13}):le==="K\xF8benhavn \xD8"?h.current.flyTo({center:[12.57517469858807,55.70923313429004],essential:!0,zoom:13}):le==="All"?h.current.flyTo({center:[T,a],essential:!0,zoom:10}):le==="Br\xF8nsh\xF8j"&&h.current.flyTo({center:[12.49056929207108,55.70738055947126],essential:!0,zoom:13}))},[le]),Jh("div",{children:[Jh("div",{className:Rw.container,children:[tr(Rf,{text:"All",onClick:Ie,value:"All"}),tr(Rf,{text:"Valby",onClick:Ie,value:"Valby"}),tr(Rf,{text:"\xD8sterbro",onClick:Ie,value:"K\xF8benhavn \xD8"}),tr(Rf,{text:"Br\xF8nsh\xF8j",value:"Br\xF8nsh\xF8j",onClick:Ie})]}),Jh("div",{className:Rw.sidebar,children:["Longitude: ",T," | Latitude: ",a," | Zoom: ",G]}),Jh(A0,{ref:h,onMove:Fe,initialViewState:{longitude:12.568337,latitude:55.676098,zoom:G},style:{width:800,height:500},mapStyle:"mapbox://styles/mapbox/bright-v8",mapboxAccessToken:v,children:[tr(HA,{position:"top-left"}),tr(XA,{position:"top-left"}),tr(KA,{position:"top-left"}),tr(QA,{}),m]})]})}var B0={exports:{}};(function(i,s){(function(h,m){i.exports=m()})(QS,function(){var h,m,v;function T(a,B){if(!h)h=B;else if(!m)m=B;else{var G="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+h+")(sharedChunk); ("+m+")(sharedChunk); self.onerror = null;",he={};h(he),v=B(he),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(v.workerUrl=window.URL.createObjectURL(new Blob([G],{type:"text/javascript"})))}}T(["exports"],function(a){var B=typeof self<"u"?self:{},G="2.11.0";let he;const le={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(he==null){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{he=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):t}catch{he=t}}return he},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},ye={supported:!1,testSupport:function(t){!Ue&&Ie&&(Ft?me(t):Fe=t)}};let Fe,Ie,Ue=!1,Ft=!1;function me(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Ie),t.isContextLost())return;ye.supported=!0}catch{}t.deleteTexture(e),Ue=!0}B.document&&(Ie=B.document.createElement("img"),Ie.onload=function(){Fe&&me(Fe),Fe=null,Ft=!0},Ie.onerror=function(){Ue=!0,Fe=null},Ie.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const de="01";var be=He;function He(t,e,n,o){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(o-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=o}He.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,o=0;o<8;o++){var c=this.sampleCurveX(n)-t;if(Math.abs(c)<e)return n;var d=this.sampleCurveDerivativeX(n);if(Math.abs(d)<1e-6)break;n-=c/d}var f=0,g=1;for(n=t,o=0;o<20&&(c=this.sampleCurveX(n),!(Math.abs(c-t)<e));o++)t>c?f=n:g=n,n=.5*(g-f)+f;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var Me=ct;function ct(t,e){this.x=t,this.y=e}ct.prototype={clone:function(){return new ct(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),o=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=o,this},_rotateAround:function(t,e){var n=Math.cos(t),o=Math.sin(t),c=e.y+o*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-o*(this.y-e.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ct.convert=function(t){return t instanceof ct?t:Array.isArray(t)?new ct(t[0],t[1]):t};const dt=Math.PI/180,vt=180/Math.PI;function mt(t){return t*dt}function Ct(t){return t*vt}const hr=[[0,0],[1,0],[1,1],[0,1]];function yi(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function Qr(t,e,n,o){const c=new be(t,e,n,o);return function(d){return c.solve(d)}}const ao=Qr(.25,.1,.25,1);function Ot(t,e,n){return Math.min(n,Math.max(e,t))}function Fi(t,e,n){return(n=Ot((n-t)/(e-t),0,1))*n*(3-2*n)}function ei(t,e,n){const o=n-e,c=((t-e)%o+o)%o+e;return c===e?n:c}function st(t,e,n){if(!t.length)return n(null,[]);let o=t.length;const c=new Array(t.length);let d=null;t.forEach((f,g)=>{e(f,(x,w)=>{x&&(d=x),c[g]=w,--o==0&&n(d,c)})})}function zt(t){const e=[];for(const n in t)e.push(t[n]);return e}function _t(t,...e){for(const n of e)for(const o in n)t[o]=n[o];return t}let dn=1;function bn(){return dn++}function br(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function qn(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function ti(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function dr(t,e){t.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function Xn(t,e){return t.indexOf(e,t.length-e.length)!==-1}function lo(t,e,n){const o={};for(const c in t)o[c]=e.call(n||this,t[c],c,t);return o}function va(t,e,n){const o={};for(const c in t)e.call(n||this,t[c],c,t)&&(o[c]=t[c]);return o}function Rr(t){return Array.isArray(t)?t.map(Rr):typeof t=="object"&&t?lo(t,Rr):t}const Tl={};function Tn(t){Tl[t]||(typeof console<"u"&&console.warn(t),Tl[t]=!0)}function ni(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function Vt(t){let e=0;for(let n,o,c=0,d=t.length,f=d-1;c<d;f=c++)n=t[c],o=t[f],e+=(o.x-n.x)*(n.y+o.y);return e}function ri(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function wa(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,o,c,d)=>{const f=c||d;return e[o]=!f||f.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let Ui=null;function gs(t){if(Ui==null){const e=t.navigator?t.navigator.userAgent:null;Ui=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Ui}function ba(t){try{const e=B[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function co(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}const El="mapbox-tiles";let pr,uo,ys=500,Ta=50;function xs(){try{return B.caches}catch{}}function ho(){xs()&&!pr&&(pr=B.caches.open(El))}function Ea(t){const e=t.indexOf("?");if(e<0)return t;const n=function(c){const d=c.indexOf("?");return d>0?c.slice(d+1).split("&"):[]}(t),o=n.filter(c=>{const d=c.split("=");return d[0]==="language"||d[0]==="worldview"});return o.length?`${t.slice(0,e)}?${o.join("&")}`:t.slice(0,e)}let vs=1/0;const Br={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Br);class Sa extends Error{constructor(e,n,o){n===401&&Ss(o)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=o}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ws=ri()?()=>self.worker&&self.worker.referrer:()=>(B.location.protocol==="blob:"?B.parent:B).location.href,po=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(ws())&&!/^\w+:/.test(n))){if(B.fetch&&B.Request&&B.AbortController&&B.Request.prototype.hasOwnProperty("signal"))return function(o,c){const d=new B.AbortController,f=new B.Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:ws(),signal:d.signal});let g=!1,x=!1;const w=(E=f.url).indexOf("sku=")>0&&Ss(E);var E;o.type==="json"&&f.headers.set("Accept","application/json");const M=(P,D,O)=>{if(x)return;if(P&&P.message!=="SecurityError"&&Tn(P),D&&O)return A(D);const N=Date.now();B.fetch(f).then(J=>{if(J.ok){const re=w?J.clone():null;return A(J,re,N)}return c(new Sa(J.statusText,J.status,o.url))}).catch(J=>{J.code!==20&&c(new Error(J.message))})},A=(P,D,O)=>{(o.type==="arrayBuffer"?P.arrayBuffer():o.type==="json"?P.json():P.text()).then(N=>{x||(D&&O&&function(J,re,K){if(ho(),!pr)return;const te={status:re.status,statusText:re.statusText,headers:new B.Headers};re.headers.forEach((Se,Te)=>te.headers.set(Te,Se));const ce=wa(re.headers.get("Cache-Control")||"");if(ce["no-store"])return;ce["max-age"]&&te.headers.set("Expires",new Date(K+1e3*ce["max-age"]).toUTCString());const oe=te.headers.get("Expires");oe&&(new Date(oe).getTime()-K<42e4||function(Se,Te){if(uo===void 0)try{new Response(new ReadableStream),uo=!0}catch{uo=!1}uo?Te(Se.body):Se.blob().then(Te)}(re,Se=>{const Te=new B.Response(Se,te);ho(),pr&&pr.then(ke=>ke.put(Ea(J.url),Te)).catch(ke=>Tn(ke.message))}))}(f,D,O),g=!0,c(null,N,P.headers.get("Cache-Control"),P.headers.get("Expires")))}).catch(N=>{x||c(new Error(N.message))})};return w?function(P,D){if(ho(),!pr)return D(null);const O=Ea(P.url);pr.then(N=>{N.match(O).then(J=>{const re=function(K){if(!K)return!1;const te=new Date(K.headers.get("Expires")||0),ce=wa(K.headers.get("Cache-Control")||"");return te>Date.now()&&!ce["no-cache"]}(J);N.delete(O),re&&N.put(O,J.clone()),D(null,J,re)}).catch(D)}).catch(D)}(f,M):M(null,null),{cancel:()=>{x=!0,g||d.abort()}}}(t,e);if(ri()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(o,c){const d=new B.XMLHttpRequest;d.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(d.responseType="arraybuffer");for(const f in o.headers)d.setRequestHeader(f,o.headers[f]);return o.type==="json"&&(d.responseType="text",d.setRequestHeader("Accept","application/json")),d.withCredentials=o.credentials==="include",d.onerror=()=>{c(new Error(d.statusText))},d.onload=()=>{if((d.status>=200&&d.status<300||d.status===0)&&d.response!==null){let f=d.response;if(o.type==="json")try{f=JSON.parse(d.response)}catch(g){return c(g)}c(null,f,d.getResponseHeader("Cache-Control"),d.getResponseHeader("Expires"))}else c(new Sa(d.statusText,d.status,o.url))},d.send(o.body),{cancel:()=>d.abort()}}(t,e)},fo=function(t,e){return po(_t(t,{type:"arrayBuffer"}),e)};function Ca(t){const e=B.document.createElement("a");return e.href=t,e.protocol===B.document.location.protocol&&e.host===B.document.location.host}const Sl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let bs,mo;bs=[],mo=0;const Ts=function(t,e){if(ye.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),mo>=le.MAX_PARALLEL_IMAGE_REQUESTS){const d={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return bs.push(d),d}mo++;let n=!1;const o=()=>{if(!n)for(n=!0,mo--;bs.length&&mo<le.MAX_PARALLEL_IMAGE_REQUESTS;){const d=bs.shift(),{requestParameters:f,callback:g,cancelled:x}=d;x||(d.cancel=Ts(f,g).cancel)}},c=fo(t,(d,f,g,x)=>{o(),d?e(d):f&&(B.createImageBitmap?function(w,E){const M=new B.Blob([new Uint8Array(w)],{type:"image/png"});B.createImageBitmap(M).then(A=>{E(null,A)}).catch(A=>{E(new Error(`Could not load image because of ${A.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(f,(w,E)=>e(w,E,g,x)):function(w,E){const M=new B.Image,A=B.URL;M.onload=()=>{E(null,M),A.revokeObjectURL(M.src),M.onload=null,B.requestAnimationFrame(()=>{M.src=Sl})},M.onerror=()=>E(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const P=new B.Blob([new Uint8Array(w)],{type:"image/png"});M.src=w.byteLength?A.createObjectURL(P):Sl}(f,(w,E)=>e(w,E,g,x)))});return{cancel:()=>{c.cancel(),o()}}},Es="NO_ACCESS_TOKEN";function ii(t){return t.indexOf("mapbox:")===0}function Ss(t){return le.API_URL_REGEX.test(t)}function Cl(t){return le.API_STYLE_REGEX.test(t)&&!Cs(t)}function Cs(t){return le.API_SPRITE_REGEX.test(t)}const Ms=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Tr(t){const e=t.match(Ms);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Uo(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}function Ma(t){if(!t)return null;const e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(B.atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class No{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const n=Ma(le.ACCESS_TOKEN);let o="";return o=n&&n.u?B.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(c,d)=>String.fromCharCode(Number("0x"+d)))):le.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${o}`:`mapbox.eventData:${o}`}fetchEventData(){const e=ba("localStorage"),n=this.getStorageKey(),o=this.getStorageKey("uuid");if(e)try{const c=B.localStorage.getItem(n);c&&(this.eventData=JSON.parse(c));const d=B.localStorage.getItem(o);d&&(this.anonId=d)}catch{Tn("Unable to read from LocalStorage")}}saveEventData(){const e=ba("localStorage"),n=this.getStorageKey(),o=this.getStorageKey("uuid");if(e)try{B.localStorage.setItem(o,this.anonId),Object.keys(this.eventData).length>=1&&B.localStorage.setItem(n,JSON.stringify(this.eventData))}catch{Tn("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,o,c){if(!le.EVENTS_URL)return;const d=Tr(le.EVENTS_URL);d.params.push(`access_token=${c||le.ACCESS_TOKEN||""}`);const f={event:this.type,created:new Date(e).toISOString()},g=n?_t(f,n):f,x={url:Uo(d),headers:{"Content-Type":"text/plain"},body:JSON.stringify([g])};this.pendingRequest=function(w,E){return po(_t(w,{method:"POST"}),E)}(x,w=>{this.pendingRequest=null,o(w),this.saveEventData(),this.processRequests(c)})}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}const Y=new class extends No{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){le.EVENTS_URL&&le.ACCESS_TOKEN&&Array.isArray(t)&&t.some(n=>ii(n)||Ss(n))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Ma(le.ACCESS_TOKEN),n=e?e.u:le.ACCESS_TOKEN;let o=n!==this.eventData.tokenU;ti(this.anonId)||(this.anonId=br(),o=!0);const c=this.queue.shift();if(this.eventData.lastSuccess){const d=new Date(this.eventData.lastSuccess),f=new Date(c),g=(c-this.eventData.lastSuccess)/864e5;o=o||g>=1||g<-1||d.getDate()!==f.getDate()}else o=!0;o?this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:G,skuId:de,"enabled.telemetry":!1,userId:this.anonId},d=>{d||(this.eventData.lastSuccess=c,this.eventData.tokenU=n)},t):this.processRequests()}},L=Y.postTurnstileEvent.bind(Y),F=new class extends No{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,n,o){this.skuToken=e,this.errorCb=o,le.EVENTS_URL&&(n||le.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(Es)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),ti(this.anonId)||(this.anonId=br()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:G,skuId:de,skuToken:this.skuToken,userId:this.anonId},o=>{o?this.errorCb(o):e&&(this.success[e]=!0)},t))}},X=F.postMapLoadEvent.bind(F),ee=new class extends No{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){le.EVENTS_URL&&(t||le.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:n}=this.queue.shift(),o=function(c){const d=B.performance.getEntriesByType("resource"),f=B.performance.getEntriesByType("mark"),g=function(A){const P={};if(A){for(const D in A)if(D!=="other")for(const O of A[D]){const N=`${D}RequestCount`,J=`${D}ResolveRangeMin`,re=`${D}ResolveRangeMax`;P[J]=Math.min(P[J]||1/0,O.startTime),P[re]=Math.max(P[re]||-1/0,O.responseEnd),P[N]===void 0&&(P[N]=0),++P[N]}}return P}(function(A,P){const D={};if(A)for(const O of A){const N=P(O);D[N]===void 0&&(D[N]=[]),D[N].push(O)}return D}(d,tt)),x=B.devicePixelRatio,w=B.navigator.connection||B.navigator.mozConnection||B.navigator.webkitConnection,E={counters:[],metadata:[],attributes:[]},M=(A,P,D)=>{D!=null&&A.push({name:P,value:D.toString()})};for(const A in g)M(E.counters,A,g[A]);if(c.interactionRange[0]!==1/0&&c.interactionRange[1]!==-1/0&&(M(E.counters,"interactionRangeMin",c.interactionRange[0]),M(E.counters,"interactionRangeMax",c.interactionRange[1])),f)for(const A of Object.keys(we)){const P=we[A],D=f.find(O=>O.name===P);D&&M(E.counters,P,D.startTime)}return M(E.attributes,"style",function(A){if(A)for(const P of A){const D=P.name.split("?")[0];if(Cl(D)){const O=D.split("/").slice(-2);if(O.length===2)return`mapbox://styles/${O[0]}/${O[1]}`}}}(d)),M(E.attributes,"terrainEnabled",c.terrainEnabled?"true":"false"),M(E.attributes,"fogEnabled",c.fogEnabled?"true":"false"),M(E.attributes,"projection",c.projection.name),M(E.attributes,"zoom",c.zoom),M(E.metadata,"devicePixelRatio",x),M(E.metadata,"connectionEffectiveType",w?w.effectiveType:void 0),M(E.metadata,"navigatorUserAgent",B.navigator.userAgent),M(E.metadata,"screenWidth",B.screen.width),M(E.metadata,"screenHeight",B.screen.height),M(E.metadata,"windowWidth",B.innerWidth),M(E.metadata,"windowHeight",B.innerHeight),M(E.metadata,"mapWidth",c.width/x),M(E.metadata,"mapHeight",c.height/x),M(E.metadata,"webglRenderer",c.renderer),M(E.metadata,"webglVendor",c.vendor),M(E.metadata,"sdkVersion",G),M(E.metadata,"sdkIdentifier","mapbox-gl-js"),E}(n);for(const c of o.metadata);for(const c of o.counters);for(const c of o.attributes);this.postEvent(e,o,()=>{},t)}},ae=ee.postPerformanceEvent.bind(ee),ge=new class extends No{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,n,o){if(!le.API_URL||!le.SESSION_PATH)return;const c=Tr(le.API_URL+le.SESSION_PATH);c.params.push(`sku=${e||""}`),c.params.push(`access_token=${o||le.ACCESS_TOKEN||""}`);const d={url:Uo(c),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(f,g){return po(_t(f,{method:"GET"}),g)}(d,f=>{this.pendingRequest=null,n(f),this.saveEventData(),this.processRequests(o)})}getSessionAPI(t,e,n,o){this.skuToken=e,this.errorCb=o,le.SESSION_PATH&&le.API_URL&&(n||le.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(Es)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,o=>{o?this.errorCb(o):e&&(this.success[e]=!0)},t)}},_e=ge.getSessionAPI.bind(ge),ue=new Set,we={create:"create",load:"load",fullLoad:"fullLoad"},Oe={mark(t){B.performance.mark(t)},measure(t,e,n){B.performance.measure(t,e,n)}};function tt(t){const e=t.name.split("?")[0];return e.includes("mapbox-gl.js")?"javascript":e.includes("mapbox-gl.css")?"css":function(n){return le.API_FONTS_REGEX.test(n)}(e)?"fontRange":Cs(e)?"sprite":Cl(e)?"style":function(n){return le.API_TILEJSON_REGEX.test(n)}(e)?"tilejson":"other"}const Ve=B.performance;function gt(t){const e=t?t.url.toString():void 0;return Ve.getEntriesByName(e)}let pt,ht,Tt,Rt;const qt={now:()=>Tt!==void 0?Tt:B.performance.now(),setNow(t){Tt=t},restoreNow(){Tt=void 0},frame(t){const e=B.requestAnimationFrame(t);return{cancel:()=>B.cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:n,height:o}=t;Rt||(Rt=B.document.createElement("canvas"));const c=Rt.getContext("2d");if(!c)throw new Error("failed to create canvas 2d context");return(n>Rt.width||o>Rt.height)&&(Rt.width=n,Rt.height=o),c.clearRect(-e,-e,n+2*e,o+2*e),c.drawImage(t,0,0,n,o),c.getImageData(-e,-e,n+2*e,o+2*e)},resolveURL:t=>(pt||(pt=B.document.createElement("a")),pt.href=t,pt.href),get devicePixelRatio(){return B.devicePixelRatio},get prefersReducedMotion(){return!!B.matchMedia&&(ht==null&&(ht=B.matchMedia("(prefers-reduced-motion: reduce)")),ht.matches)}};function xt(t,e,n){n[t]&&n[t].indexOf(e)!==-1||(n[t]=n[t]||[],n[t].push(e))}function en(t,e,n){if(n&&n[t]){const o=n[t].indexOf(e);o!==-1&&n[t].splice(o,1)}}class tn{constructor(e,n={}){_t(this,n),this.type=e}}class _o extends tn{constructor(e,n={}){super("error",_t({error:e},n))}}class Ni{on(e,n){return this._listeners=this._listeners||{},xt(e,n,this._listeners),this}off(e,n){return en(e,n,this._listeners),en(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},xt(e,n,this._oneTimeListeners),this):new Promise(o=>this.once(e,o))}fire(e,n){typeof e=="string"&&(e=new tn(e,n||{}));const o=e.type;if(this.listens(o)){e.target=this;const c=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const g of c)g.call(this,e);const d=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const g of d)en(o,g,this._oneTimeListeners),g.call(this,e);const f=this._eventedParent;f&&(_t(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),f.fire(e))}else e instanceof _o&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var ze=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function ji(t,...e){for(const n of e)for(const o in n)t[o]=n[o];return t}function kn(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function go(t){if(Array.isArray(t))return t.map(go);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const n in t)e[n]=go(t[n]);return e}return kn(t)}class Rd extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}var xi=Rd;class As{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[o,c]of n)this.bindings[o]=c}concat(e){return new As(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var Bd=As;const Is={kind:"null"},Qe={kind:"number"},Bt={kind:"string"},Ut={kind:"boolean"},vi={kind:"color"},zs={kind:"object"},Nt={kind:"value"},Aa={kind:"collator"},ks={kind:"formatted"},Ps={kind:"resolvedImage"};function Or(t,e){return{kind:"array",itemType:t,N:e}}function _n(t){if(t.kind==="array"){const e=_n(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}const Zm=[Is,Qe,Bt,Ut,vi,ks,zs,Or(Nt),Ps];function oi(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!oi(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(const n of Zm)if(!oi(n,e))return null}}return`Expected ${_n(t)} but found ${_n(e)} instead.`}function Ml(t,e){return e.some(n=>n.kind===t.kind)}function Er(t,e){return e.some(n=>n==="null"?t===null:n==="array"?Array.isArray(t):n==="object"?t&&!Array.isArray(t)&&typeof t=="object":n===typeof t)}var uu,Al={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Il(t){return(t=Math.round(t))<0?0:t>255?255:t}function Ia(t){return Il(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function za(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function jo(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{uu={}.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in Al)return Al[n].slice();if(n[0]==="#")return n.length===4?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:n.length===7&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var o=n.indexOf("("),c=n.indexOf(")");if(o!==-1&&c+1===n.length){var d=n.substr(0,o),f=n.substr(o+1,c-(o+1)).split(","),g=1;switch(d){case"rgba":if(f.length!==4)return null;g=za(f.pop());case"rgb":return f.length!==3?null:[Ia(f[0]),Ia(f[1]),Ia(f[2]),g];case"hsla":if(f.length!==4)return null;g=za(f.pop());case"hsl":if(f.length!==3)return null;var x=(parseFloat(f[0])%360+360)%360/360,w=za(f[1]),E=za(f[2]),M=E<=.5?E*(w+1):E+w-E*w,A=2*E-M;return[Il(255*jo(A,M,x+1/3)),Il(255*jo(A,M,x)),Il(255*jo(A,M,x-1/3)),g];default:return null}}return null}}catch{}class ir{constructor(e,n,o,c=1){this.r=e,this.g=n,this.b=o,this.a=c}static parse(e){if(!e)return;if(e instanceof ir)return e;if(typeof e!="string")return;const n=uu(e);return n?new ir(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){const[e,n,o,c]=this.toArray();return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(o)},${c})`}toArray(){const{r:e,g:n,b:o,a:c}=this;return c===0?[0,0,0,0]:[255*e/c,255*n/c,255*o/c,c]}toArray01(){const{r:e,g:n,b:o,a:c}=this;return c===0?[0,0,0,0]:[e/c,n/c,o/c,c]}toArray01PremultipliedAlpha(){const{r:e,g:n,b:o,a:c}=this;return[e,n,o,c]}}ir.black=new ir(0,0,0,1),ir.white=new ir(1,1,1,1),ir.transparent=new ir(0,0,0,0),ir.red=new ir(1,0,0,1),ir.blue=new ir(0,0,1,1);var An=ir;class hu{constructor(e,n,o){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class du{constructor(e,n,o,c,d){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=o,this.fontStack=c,this.textColor=d}}class fr{constructor(e){this.sections=e}static fromString(e){return new fr([new du(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof fr?e:fr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const n of this.sections){if(n.image){e.push(["image",n.image.name]);continue}e.push(n.text);const o={};n.fontStack&&(o["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(o["font-scale"]=n.scale),n.textColor&&(o["text-color"]=["rgba"].concat(n.textColor.toArray())),e.push(o)}return e}}class Sr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Sr({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Od(t,e,n,o){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[t,e,n,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[t,e,n,o]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Vo(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof An||t instanceof hu||t instanceof fr||t instanceof Sr)return!0;if(Array.isArray(t)){for(const e of t)if(!Vo(e))return!1;return!0}if(typeof t=="object"){for(const e in t)if(!Vo(t[e]))return!1;return!0}return!1}function Fn(t){if(t===null)return Is;if(typeof t=="string")return Bt;if(typeof t=="boolean")return Ut;if(typeof t=="number")return Qe;if(t instanceof An)return vi;if(t instanceof hu)return Aa;if(t instanceof fr)return ks;if(t instanceof Sr)return Ps;if(Array.isArray(t)){const e=t.length;let n;for(const o of t){const c=Fn(o);if(n){if(n===c)continue;n=Nt;break}n=c}return Or(n||Nt,e)}return zs}function ka(t){const e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof An||t instanceof fr||t instanceof Sr?t.toString():JSON.stringify(t)}class pu{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Vo(e[1]))return n.error("invalid value");const o=e[1];let c=Fn(o);const d=n.expectedType;return c.kind!=="array"||c.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(c=d),new pu(c,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof An?["rgba"].concat(this.value.toArray()):this.value instanceof fr?this.value.serialize():this.value}}var Pa=pu,Hn=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const fu={string:Bt,number:Qe,boolean:Ut,object:zs};class mu{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let o,c=1;const d=e[0];if(d==="array"){let g,x;if(e.length>2){const w=e[1];if(typeof w!="string"||!(w in fu)||w==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);g=fu[w],c++}else g=Nt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);x=e[2],c++}o=Or(g,x)}else o=fu[d];const f=[];for(;c<e.length;c++){const g=n.parse(e[c],c,Nt);if(!g)return null;f.push(g)}return new mu(o,f)}evaluate(e){for(let n=0;n<this.args.length;n++){const o=this.args[n].evaluate(e);if(!oi(this.type,Fn(o)))return o;if(n===this.args.length-1)throw new Hn(`Expected value to be of type ${_n(this.type)}, but found ${_n(Fn(o))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,n=[e.kind];if(e.kind==="array"){const o=e.itemType;if(o.kind==="string"||o.kind==="number"||o.kind==="boolean"){n.push(o.kind);const c=e.N;(typeof c=="number"||this.args.length>1)&&n.push(c)}}return n.concat(this.args.map(o=>o.serialize()))}}var wi=mu;class yo{constructor(e){this.type=ks,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return n.error("First argument must be an image or text section.");const c=[];let d=!1;for(let f=1;f<=e.length-1;++f){const g=e[f];if(d&&typeof g=="object"&&!Array.isArray(g)){d=!1;let x=null;if(g["font-scale"]&&(x=n.parse(g["font-scale"],1,Qe),!x))return null;let w=null;if(g["text-font"]&&(w=n.parse(g["text-font"],1,Or(Bt)),!w))return null;let E=null;if(g["text-color"]&&(E=n.parse(g["text-color"],1,vi),!E))return null;const M=c[c.length-1];M.scale=x,M.font=w,M.textColor=E}else{const x=n.parse(e[f],1,Nt);if(!x)return null;const w=x.type.kind;if(w!=="string"&&w!=="value"&&w!=="null"&&w!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,c.push({content:x,scale:null,font:null,textColor:null})}}return new yo(c)}evaluate(e){return new fr(this.sections.map(n=>{const o=n.content.evaluate(e);return Fn(o)===Ps?new du("",o,null,null,null):new du(ka(o),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const n of this.sections){e.push(n.content.serialize());const o={};n.scale&&(o["font-scale"]=n.scale.serialize()),n.font&&(o["text-font"]=n.font.serialize()),n.textColor&&(o["text-color"]=n.textColor.serialize()),e.push(o)}return e}}class zl{constructor(e){this.type=Ps,this.input=e}static parse(e,n){if(e.length!==2)return n.error("Expected two arguments.");const o=n.parse(e[1],1,Bt);return o?new zl(o):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),o=Sr.fromString(n);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(n)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const qm={"to-boolean":Ut,"to-color":vi,"to-number":Qe,"to-string":Bt};class _u{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const o=e[0];if((o==="to-boolean"||o==="to-string")&&e.length!==2)return n.error("Expected one argument.");const c=qm[o],d=[];for(let f=1;f<e.length;f++){const g=n.parse(e[f],f,Nt);if(!g)return null;d.push(g)}return new _u(c,d)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let n,o;for(const c of this.args){if(n=c.evaluate(e),o=null,n instanceof An)return n;if(typeof n=="string"){const d=e.parseColor(n);if(d)return d}else if(Array.isArray(n)&&(o=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Od(n[0],n[1],n[2],n[3]),!o))return new An(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Hn(o||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(const o of this.args){if(n=o.evaluate(e),n===null)return 0;const c=Number(n);if(!isNaN(c))return c}throw new Hn(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?fr.fromString(ka(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Sr.fromString(ka(this.args[0].evaluate(e))):ka(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new yo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new zl(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}var Ds=_u;const Wm=["Unknown","Point","LineString","Polygon"];var Fd=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Wm[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:n,y:o}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*e-t[0])+this.featureDistanceData.bearing[1]*(o*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=An.parse(t)),e}};class Go{constructor(e,n,o,c){this.name=e,this.type=n,this._evaluate=o,this.args=c}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){const o=e[0],c=Go.definitions[o];if(!c)return n.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(c)?c[0]:c.type,f=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,g=f.filter(([w])=>!Array.isArray(w)||w.length===e.length-1);let x=null;for(const[w,E]of g){x=new Eu(n.registry,n.path,null,n.scope);const M=[];let A=!1;for(let P=1;P<e.length;P++){const D=e[P],O=Array.isArray(w)?w[P-1]:w.type,N=x.parse(D,1+M.length,O);if(!N){A=!0;break}M.push(N)}if(!A)if(Array.isArray(w)&&w.length!==M.length)x.error(`Expected ${w.length} arguments, but found ${M.length} instead.`);else{for(let P=0;P<M.length;P++){const D=Array.isArray(w)?w[P]:w.type,O=M[P];x.concat(P+1).checkSubtype(D,O.type)}if(x.errors.length===0)return new Go(o,d,E,M)}}if(g.length===1)n.errors.push(...x.errors);else{const w=(g.length?g:f).map(([M])=>{return A=M,Array.isArray(A)?`(${A.map(_n).join(", ")})`:`(${_n(A.type)}...)`;var A}).join(" | "),E=[];for(let M=1;M<e.length;M++){const A=n.parse(e[M],1+E.length);if(!A)return null;E.push(_n(A.type))}n.error(`Expected arguments of type ${w}, but found (${E.join(", ")}) instead.`)}return null}static register(e,n){Go.definitions=n;for(const o in n)e[o]=Go}}var si=Go;class kl{constructor(e,n,o){this.type=Aa,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return n.error("Collator options argument must be an object.");const c=n.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Ut);if(!c)return null;const d=n.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Ut);if(!d)return null;let f=null;return o.locale&&(f=n.parse(o.locale,1,Bt),!f)?null:new kl(c,d,f)}evaluate(e){return new hu(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const xo=8192;function gu(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Pl(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function bi(t,e){const n=(180+t[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(n*c*xo),Math.round(o*c*xo)]}function Ud(t,e,n){const o=t[0]-e[0],c=t[1]-e[1],d=t[0]-n[0],f=t[1]-n[1];return o*f-d*c==0&&o*d<=0&&c*f<=0}function Dl(t,e){let n=!1;for(let f=0,g=e.length;f<g;f++){const x=e[f];for(let w=0,E=x.length;w<E-1;w++){if(Ud(t,x[w],x[w+1]))return!1;(c=x[w])[1]>(o=t)[1]!=(d=x[w+1])[1]>o[1]&&o[0]<(d[0]-c[0])*(o[1]-c[1])/(d[1]-c[1])+c[0]&&(n=!n)}}var o,c,d;return n}function Nd(t,e){for(let n=0;n<e.length;n++)if(Dl(t,e[n]))return!0;return!1}function yu(t,e,n,o){const c=o[0]-n[0],d=o[1]-n[1],f=(t[0]-n[0])*d-c*(t[1]-n[1]),g=(e[0]-n[0])*d-c*(e[1]-n[1]);return f>0&&g<0||f<0&&g>0}function jd(t,e,n){for(const w of n)for(let E=0;E<w.length-1;++E)if((g=[(f=w[E+1])[0]-(d=w[E])[0],f[1]-d[1]])[0]*(x=[(c=e)[0]-(o=t)[0],c[1]-o[1]])[1]-g[1]*x[0]!=0&&yu(o,c,d,f)&&yu(d,f,o,c))return!0;var o,c,d,f,g,x;return!1}function xu(t,e){for(let n=0;n<t.length;++n)if(!Dl(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(jd(t[n],t[n+1],e))return!1;return!0}function vu(t,e){for(let n=0;n<e.length;n++)if(xu(t,e[n]))return!0;return!1}function $o(t,e,n){const o=[];for(let c=0;c<t.length;c++){const d=[];for(let f=0;f<t[c].length;f++){const g=bi(t[c][f],n);gu(e,g),d.push(g)}o.push(d)}return o}function wu(t,e,n){const o=[];for(let c=0;c<t.length;c++){const d=$o(t[c],e,n);o.push(d)}return o}function bu(t,e,n,o){if(t[0]<n[0]||t[0]>n[2]){const c=.5*o;let d=t[0]-n[0]>c?-o:n[0]-t[0]>c?o:0;d===0&&(d=t[0]-n[2]>c?-o:n[2]-t[0]>c?o:0),t[0]+=d}gu(e,t)}function Ll(t,e,n,o){const c=Math.pow(2,o.z)*xo,d=[o.x*xo,o.y*xo],f=[];if(!t)return f;for(const g of t)for(const x of g){const w=[x.x+d[0],x.y+d[1]];bu(w,e,n,c),f.push(w)}return f}function Tu(t,e,n,o){const c=Math.pow(2,o.z)*xo,d=[o.x*xo,o.y*xo],f=[];if(!t)return f;for(const x of t){const w=[];for(const E of x){const M=[E.x+d[0],E.y+d[1]];gu(e,M),w.push(M)}f.push(w)}if(e[2]-e[0]<=c/2){(g=e)[0]=g[1]=1/0,g[2]=g[3]=-1/0;for(const x of f)for(const w of x)bu(w,e,n,c)}var g;return f}class Ti{constructor(e,n){this.type=Ut,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Vo(e[1])){const o=e[1];if(o.type==="FeatureCollection")for(let c=0;c<o.features.length;++c){const d=o.features[c].geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new Ti(o,o.features[c].geometry)}else if(o.type==="Feature"){const c=o.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new Ti(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new Ti(o,o)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,o){const c=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=n.canonicalID();if(!f)return!1;if(o.type==="Polygon"){const g=$o(o.coordinates,d,f),x=Ll(n.geometry(),c,d,f);if(!Pl(c,d))return!1;for(const w of x)if(!Dl(w,g))return!1}if(o.type==="MultiPolygon"){const g=wu(o.coordinates,d,f),x=Ll(n.geometry(),c,d,f);if(!Pl(c,d))return!1;for(const w of x)if(!Nd(w,g))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,o){const c=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=n.canonicalID();if(!f)return!1;if(o.type==="Polygon"){const g=$o(o.coordinates,d,f),x=Tu(n.geometry(),c,d,f);if(!Pl(c,d))return!1;for(const w of x)if(!xu(w,g))return!1}if(o.type==="MultiPolygon"){const g=wu(o.coordinates,d,f),x=Tu(n.geometry(),c,d,f);if(!Pl(c,d))return!1;for(const w of x)if(!vu(w,g))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Wt=Ti;function Da(t){if(t instanceof si&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof Wt)return!1;let e=!0;return t.eachChild(n=>{e&&!Da(n)&&(e=!1)}),e}function Rl(t){if(t instanceof si&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(n=>{e&&!Rl(n)&&(e=!1)}),e}function Bl(t,e){if(t instanceof si&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(o=>{n&&!Bl(o,e)&&(n=!1)}),n}class Ol{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const o=e[1];return n.scope.has(o)?new Ol(o,n.scope.get(o)):n.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Vd=Ol;class Fl{constructor(e,n=[],o,c=new Bd,d=[]){this.registry=e,this.path=n,this.key=n.map(f=>`[${f}]`).join(""),this.scope=c,this.errors=d,this.expectedType=o}parse(e,n,o,c,d={}){return n?this.concat(n,o,c)._parse(e,d):this._parse(e,d)}_parse(e,n){function o(c,d,f){return f==="assert"?new wi(d,[c]):f==="coerce"?new Ds(d,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=e[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const d=this.registry[c];if(d){let f=d.parse(e,this);if(!f)return null;if(this.expectedType){const g=this.expectedType,x=f.type;if(g.kind!=="string"&&g.kind!=="number"&&g.kind!=="boolean"&&g.kind!=="object"&&g.kind!=="array"||x.kind!=="value")if(g.kind!=="color"&&g.kind!=="formatted"&&g.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string"){if(this.checkSubtype(g,x))return null}else f=o(f,g,n.typeAnnotation||"coerce");else f=o(f,g,n.typeAnnotation||"assert")}if(!(f instanceof Pa)&&f.type.kind!=="resolvedImage"&&Ul(f)){const g=new Fd;try{f=new Pa(f.type,f.evaluate(g))}catch(x){return this.error(x.message),null}}return f}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,o){const c=typeof e=="number"?this.path.concat(e):this.path,d=o?this.scope.concat(o):this.scope;return new Fl(this.registry,c,n||null,d,this.errors)}error(e,...n){const o=`${this.key}${n.map(c=>`[${c}]`).join("")}`;this.errors.push(new xi(o,e))}checkSubtype(e,n){const o=oi(e,n);return o&&this.error(o),o}}var Eu=Fl;function Ul(t){if(t instanceof Vd)return Ul(t.boundExpression);if(t instanceof si&&t.name==="error"||t instanceof kl||t instanceof Wt)return!1;const e=t instanceof Ds||t instanceof wi;let n=!0;return t.eachChild(o=>{n=e?n&&Ul(o):n&&o instanceof Pa}),!!n&&Da(t)&&Bl(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function La(t,e){const n=t.length-1;let o,c,d=0,f=n,g=0;for(;d<=f;)if(g=Math.floor((d+f)/2),o=t[g],c=t[g+1],o<=e){if(g===n||e<c)return g;d=g+1}else{if(!(o>e))throw new Hn("Input is not a number.");f=g-1}return 0}class vo{constructor(e,n,o){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[c,d]of o)this.labels.push(c),this.outputs.push(d)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const o=n.parse(e[1],1,Qe);if(!o)return null;const c=[];let d=null;n.expectedType&&n.expectedType.kind!=="value"&&(d=n.expectedType);for(let f=1;f<e.length;f+=2){const g=f===1?-1/0:e[f],x=e[f+1],w=f,E=f+1;if(typeof g!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(c.length&&c[c.length-1][0]>=g)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);const M=n.parse(x,E,d);if(!M)return null;d=d||M.type,c.push([g,M])}return new vo(d,o,c)}evaluate(e){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);const c=this.input.evaluate(e);if(c<=n[0])return o[0].evaluate(e);const d=n.length;return c>=n[d-1]?o[d-1].evaluate(e):o[La(n,c)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}var Ls=vo;function Gt(t,e,n){return t*(1-n)+e*n}var Rs=Object.freeze({__proto__:null,number:Gt,color:function(t,e,n){return new An(Gt(t.r,e.r,n),Gt(t.g,e.g,n),Gt(t.b,e.b,n),Gt(t.a,e.a,n))},array:function(t,e,n){return t.map((o,c)=>Gt(o,e[c],n))}});const Su=.95047,Gd=1.08883,$d=4/29,Nl=6/29,Zd=3*Nl*Nl,qd=Math.PI/180,Wd=180/Math.PI;function Cu(t){return t>.008856451679035631?Math.pow(t,1/3):t/Zd+$d}function jl(t){return t>Nl?t*t*t:Zd*(t-$d)}function Mu(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Vl(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Au(t){const e=Vl(t.r),n=Vl(t.g),o=Vl(t.b),c=Cu((.4124564*e+.3575761*n+.1804375*o)/Su),d=Cu((.2126729*e+.7151522*n+.072175*o)/1);return{l:116*d-16,a:500*(c-d),b:200*(d-Cu((.0193339*e+.119192*n+.9503041*o)/Gd)),alpha:t.a}}function Xd(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,o=isNaN(t.b)?e:e-t.b/200;return e=1*jl(e),n=Su*jl(n),o=Gd*jl(o),new An(Mu(3.2404542*n-1.5371385*e-.4985314*o),Mu(-.969266*n+1.8760108*e+.041556*o),Mu(.0556434*n-.2040259*e+1.0572252*o),t.alpha)}function Xm(t,e,n){const o=e-t;return t+n*(o>180||o<-180?o-360*Math.round(o/360):o)}const Ra={forward:Au,reverse:Xd,interpolate:function(t,e,n){return{l:Gt(t.l,e.l,n),a:Gt(t.a,e.a,n),b:Gt(t.b,e.b,n),alpha:Gt(t.alpha,e.alpha,n)}}},Ba={forward:function(t){const{l:e,a:n,b:o}=Au(t),c=Math.atan2(o,n)*Wd;return{h:c<0?c+360:c,c:Math.sqrt(n*n+o*o),l:e,alpha:t.a}},reverse:function(t){const e=t.h*qd,n=t.c;return Xd({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:Xm(t.h,e.h,n),c:Gt(t.c,e.c,n),l:Gt(t.l,e.l,n),alpha:Gt(t.alpha,e.alpha,n)}}};var Hd=Object.freeze({__proto__:null,lab:Ra,hcl:Ba});class Gl{constructor(e,n,o,c,d){this.type=e,this.operator=n,this.interpolation=o,this.input=c,this.labels=[],this.outputs=[];for(const[f,g]of d)this.labels.push(f),this.outputs.push(g)}static interpolationFactor(e,n,o,c){let d=0;if(e.name==="exponential")d=$l(n,e.base,o,c);else if(e.name==="linear")d=$l(n,1,o,c);else if(e.name==="cubic-bezier"){const f=e.controlPoints;d=new be(f[0],f[1],f[2],f[3]).solve($l(n,1,o,c))}return d}static parse(e,n){let[o,c,d,...f]=e;if(!Array.isArray(c)||c.length===0)return n.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const w=c[1];if(typeof w!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:w}}else{if(c[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const w=c.slice(1);if(w.length!==4||w.some(E=>typeof E!="number"||E<0||E>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:w}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(d=n.parse(d,2,Qe),!d)return null;const g=[];let x=null;o==="interpolate-hcl"||o==="interpolate-lab"?x=vi:n.expectedType&&n.expectedType.kind!=="value"&&(x=n.expectedType);for(let w=0;w<f.length;w+=2){const E=f[w],M=f[w+1],A=w+3,P=w+4;if(typeof E!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(g.length&&g[g.length-1][0]>=E)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',A);const D=n.parse(M,P,x);if(!D)return null;x=x||D.type,g.push([E,D])}return x.kind==="number"||x.kind==="color"||x.kind==="array"&&x.itemType.kind==="number"&&typeof x.N=="number"?new Gl(x,o,c,d,g):n.error(`Type ${_n(x)} is not interpolatable.`)}evaluate(e){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);const c=this.input.evaluate(e);if(c<=n[0])return o[0].evaluate(e);const d=n.length;if(c>=n[d-1])return o[d-1].evaluate(e);const f=La(n,c),g=Gl.interpolationFactor(this.interpolation,c,n[f],n[f+1]),x=o[f].evaluate(e),w=o[f+1].evaluate(e);return this.operator==="interpolate"?Rs[this.type.kind.toLowerCase()](x,w,g):this.operator==="interpolate-hcl"?Ba.reverse(Ba.interpolate(Ba.forward(x),Ba.forward(w),g)):Ra.reverse(Ra.interpolate(Ra.forward(x),Ra.forward(w),g))}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const n=[this.operator,e,this.input.serialize()];for(let o=0;o<this.labels.length;o++)n.push(this.labels[o],this.outputs[o].serialize());return n}}function $l(t,e,n,o){const c=o-n,d=t-n;return c===0?0:e===1?d/c:(Math.pow(e,d)-1)/(Math.pow(e,c)-1)}var Ei=Gl;class Iu{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let o=null;const c=n.expectedType;c&&c.kind!=="value"&&(o=c);const d=[];for(const g of e.slice(1)){const x=n.parse(g,1+d.length,o,void 0,{typeAnnotation:"omit"});if(!x)return null;o=o||x.type,d.push(x)}const f=c&&d.some(g=>oi(c,g.type));return new Iu(f?Nt:o,d)}evaluate(e){let n,o=null,c=0;for(const d of this.args){if(c++,o=d.evaluate(e),o&&o instanceof Sr&&!o.available&&(n||(n=o),o=null,c===this.args.length))return n;if(o!==null)break}return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var Yd=Iu;class zu{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let d=1;d<e.length-1;d+=2){const f=e[d];if(typeof f!="string")return n.error(`Expected string, but found ${typeof f} instead.`,d);if(/[^a-zA-Z0-9_]/.test(f))return n.error("Variable names must contain only alphanumeric characters or '_'.",d);const g=n.parse(e[d+1],d+1);if(!g)return null;o.push([f,g])}const c=n.parse(e[e.length-1],e.length-1,n.expectedType,o);return c?new zu(o,c):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[n,o]of this.bindings)e.push(n,o.serialize());return e.push(this.result.serialize()),e}}var ku=zu;class Zl{constructor(e,n,o){this.type=e,this.index=n,this.input=o}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,Qe),c=n.parse(e[2],2,Or(n.expectedType||Nt));return o&&c?new Zl(c.type.itemType,o,c):null}evaluate(e){const n=this.index.evaluate(e),o=this.input.evaluate(e);if(n<0)throw new Hn(`Array index out of bounds: ${n} < 0.`);if(n>=o.length)throw new Hn(`Array index out of bounds: ${n} > ${o.length-1}.`);if(n!==Math.floor(n))throw new Hn(`Array index must be an integer, but found ${n} instead.`);return o[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Kd=Zl;class Pu{constructor(e,n){this.type=Ut,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,Nt),c=n.parse(e[2],2,Nt);return o&&c?Ml(o.type,[Ut,Bt,Qe,Is,Nt])?new Pu(o,c):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${_n(o.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(o==null)return!1;if(!Er(n,["boolean","string","number","null"]))throw new Hn(`Expected first argument to be of type boolean, string, number or null, but found ${_n(Fn(n))} instead.`);if(!Er(o,["string","array"]))throw new Hn(`Expected second argument to be of type array or string, but found ${_n(Fn(o))} instead.`);return o.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Hm=Pu;class Oa{constructor(e,n,o){this.type=Qe,this.needle=e,this.haystack=n,this.fromIndex=o}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,Nt),c=n.parse(e[2],2,Nt);if(!o||!c)return null;if(!Ml(o.type,[Ut,Bt,Qe,Is,Nt]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${_n(o.type)} instead`);if(e.length===4){const d=n.parse(e[3],3,Qe);return d?new Oa(o,c,d):null}return new Oa(o,c)}evaluate(e){const n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!Er(n,["boolean","string","number","null"]))throw new Hn(`Expected first argument to be of type boolean, string, number or null, but found ${_n(Fn(n))} instead.`);if(!Er(o,["string","array"]))throw new Hn(`Expected second argument to be of type array or string, but found ${_n(Fn(o))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return o.indexOf(n,c)}return o.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Jd=Oa;class ql{constructor(e,n,o,c,d,f){this.inputType=e,this.type=n,this.input=o,this.cases=c,this.outputs=d,this.otherwise=f}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let o,c;n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);const d={},f=[];for(let w=2;w<e.length-1;w+=2){let E=e[w];const M=e[w+1];Array.isArray(E)||(E=[E]);const A=n.concat(w);if(E.length===0)return A.error("Expected at least one branch label.");for(const D of E){if(typeof D!="number"&&typeof D!="string")return A.error("Branch labels must be numbers or strings.");if(typeof D=="number"&&Math.abs(D)>Number.MAX_SAFE_INTEGER)return A.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof D=="number"&&Math.floor(D)!==D)return A.error("Numeric branch labels must be integer values.");if(o){if(A.checkSubtype(o,Fn(D)))return null}else o=Fn(D);if(d[String(D)]!==void 0)return A.error("Branch labels must be unique.");d[String(D)]=f.length}const P=n.parse(M,w,c);if(!P)return null;c=c||P.type,f.push(P)}const g=n.parse(e[1],1,Nt);if(!g)return null;const x=n.parse(e[e.length-1],e.length-1,c);return x?g.type.kind!=="value"&&n.concat(1).checkSubtype(o,g.type)?null:new ql(o,c,g,d,f,x):null}evaluate(e){const n=this.input.evaluate(e);return(Fn(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),o=[],c={};for(const f of n){const g=c[this.cases[f]];g===void 0?(c[this.cases[f]]=o.length,o.push([this.cases[f],[f]])):o[g][1].push(f)}const d=f=>this.inputType.kind==="number"?Number(f):f;for(const[f,g]of o)e.push(g.length===1?d(g[0]):g.map(d)),e.push(this.outputs[f].serialize());return e.push(this.otherwise.serialize()),e}}var Ym=ql;class Du{constructor(e,n,o){this.type=e,this.branches=n,this.otherwise=o}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let o;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);const c=[];for(let f=1;f<e.length-1;f+=2){const g=n.parse(e[f],f,Ut);if(!g)return null;const x=n.parse(e[f+1],f+1,o);if(!x)return null;c.push([g,x]),o=o||x.type}const d=n.parse(e[e.length-1],e.length-1,o);return d?new Du(o,c,d):null}evaluate(e){for(const[n,o]of this.branches)if(n.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,o]of this.branches)e(n),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var Km=Du;class Wl{constructor(e,n,o,c){this.type=e,this.input=n,this.beginIndex=o,this.endIndex=c}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,Nt),c=n.parse(e[2],2,Qe);if(!o||!c)return null;if(!Ml(o.type,[Or(Nt),Bt,Nt]))return n.error(`Expected first argument to be of type array or string, but found ${_n(o.type)} instead`);if(e.length===4){const d=n.parse(e[3],3,Qe);return d?new Wl(o.type,o,c,d):null}return new Wl(o.type,o,c)}evaluate(e){const n=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!Er(n,["string","array"]))throw new Hn(`Expected first argument to be of type array or string, but found ${_n(Fn(n))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return n.slice(o,c)}return n.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Xl=Wl;function Lu(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Ru(t,e,n,o){return o.compare(e,n)===0}function Bs(t,e,n){const o=t!=="=="&&t!=="!=";return class TT{constructor(d,f,g){this.type=Ut,this.lhs=d,this.rhs=f,this.collator=g,this.hasUntypedArgument=d.type.kind==="value"||f.type.kind==="value"}static parse(d,f){if(d.length!==3&&d.length!==4)return f.error("Expected two or three arguments.");const g=d[0];let x=f.parse(d[1],1,Nt);if(!x)return null;if(!Lu(g,x.type))return f.concat(1).error(`"${g}" comparisons are not supported for type '${_n(x.type)}'.`);let w=f.parse(d[2],2,Nt);if(!w)return null;if(!Lu(g,w.type))return f.concat(2).error(`"${g}" comparisons are not supported for type '${_n(w.type)}'.`);if(x.type.kind!==w.type.kind&&x.type.kind!=="value"&&w.type.kind!=="value")return f.error(`Cannot compare types '${_n(x.type)}' and '${_n(w.type)}'.`);o&&(x.type.kind==="value"&&w.type.kind!=="value"?x=new wi(w.type,[x]):x.type.kind!=="value"&&w.type.kind==="value"&&(w=new wi(x.type,[w])));let E=null;if(d.length===4){if(x.type.kind!=="string"&&w.type.kind!=="string"&&x.type.kind!=="value"&&w.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(E=f.parse(d[3],3,Aa),!E)return null}return new TT(x,w,E)}evaluate(d){const f=this.lhs.evaluate(d),g=this.rhs.evaluate(d);if(o&&this.hasUntypedArgument){const x=Fn(f),w=Fn(g);if(x.kind!==w.kind||x.kind!=="string"&&x.kind!=="number")throw new Hn(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${x.kind}, ${w.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const x=Fn(f),w=Fn(g);if(x.kind!=="string"||w.kind!=="string")return e(d,f,g)}return this.collator?n(d,f,g,this.collator.evaluate(d)):e(d,f,g)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}serialize(){const d=[t];return this.eachChild(f=>{d.push(f.serialize())}),d}}}const Jm=Bs("==",function(t,e,n){return e===n},Ru),Qm=Bs("!=",function(t,e,n){return e!==n},function(t,e,n,o){return!Ru(0,e,n,o)}),Qd=Bs("<",function(t,e,n){return e<n},function(t,e,n,o){return o.compare(e,n)<0}),ep=Bs(">",function(t,e,n){return e>n},function(t,e,n,o){return o.compare(e,n)>0}),tp=Bs("<=",function(t,e,n){return e<=n},function(t,e,n,o){return o.compare(e,n)<=0}),Bu=Bs(">=",function(t,e,n){return e>=n},function(t,e,n,o){return o.compare(e,n)>=0});class Ou{constructor(e,n,o,c,d,f){this.type=Bt,this.number=e,this.locale=n,this.currency=o,this.unit=c,this.minFractionDigits=d,this.maxFractionDigits=f}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const o=n.parse(e[1],1,Qe);if(!o)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return n.error("NumberFormat options argument must be an object.");let d=null;if(c.locale&&(d=n.parse(c.locale,1,Bt),!d))return null;let f=null;if(c.currency&&(f=n.parse(c.currency,1,Bt),!f))return null;let g=null;if(c.unit&&(g=n.parse(c.unit,1,Bt),!g))return null;let x=null;if(c["min-fraction-digits"]&&(x=n.parse(c["min-fraction-digits"],1,Qe),!x))return null;let w=null;return c["max-fraction-digits"]&&(w=n.parse(c["max-fraction-digits"],1,Qe),!w)?null:new Ou(o,d,f,g,x,w)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Fu{constructor(e){this.type=Qe,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=n.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${_n(o.type)} instead.`):new Fu(o):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new Hn(`Expected value to be of type string or array, but found ${_n(Fn(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}const np={"==":Jm,"!=":Qm,">":ep,"<":Qd,">=":Bu,"<=":tp,array:wi,at:Kd,boolean:wi,case:Km,coalesce:Yd,collator:kl,format:yo,image:zl,in:Hm,"index-of":Jd,interpolate:Ei,"interpolate-hcl":Ei,"interpolate-lab":Ei,length:Fu,let:ku,literal:Pa,match:Ym,number:wi,"number-format":Ou,object:wi,slice:Xl,step:Ls,string:wi,"to-boolean":Ds,"to-color":Ds,"to-number":Ds,"to-string":Ds,var:Vd,within:Wt};function rp(t,[e,n,o,c]){e=e.evaluate(t),n=n.evaluate(t),o=o.evaluate(t);const d=c?c.evaluate(t):1,f=Od(e,n,o,d);if(f)throw new Hn(f);return new An(e/255*d,n/255*d,o/255*d,d)}function ip(t,e){return t in e}function Uu(t,e){const n=e[t];return n===void 0?null:n}function Zo(t){return{type:t}}si.register(np,{error:[{kind:"error"},[Bt],(t,[e])=>{throw new Hn(e.evaluate(t))}],typeof:[Bt,[Nt],(t,[e])=>_n(Fn(e.evaluate(t)))],"to-rgba":[Or(Qe,4),[vi],(t,[e])=>e.evaluate(t).toArray()],rgb:[vi,[Qe,Qe,Qe],rp],rgba:[vi,[Qe,Qe,Qe,Qe],rp],has:{type:Ut,overloads:[[[Bt],(t,[e])=>ip(e.evaluate(t),t.properties())],[[Bt,zs],(t,[e,n])=>ip(e.evaluate(t),n.evaluate(t))]]},get:{type:Nt,overloads:[[[Bt],(t,[e])=>Uu(e.evaluate(t),t.properties())],[[Bt,zs],(t,[e,n])=>Uu(e.evaluate(t),n.evaluate(t))]]},"feature-state":[Nt,[Bt],(t,[e])=>Uu(e.evaluate(t),t.featureState||{})],properties:[zs,[],t=>t.properties()],"geometry-type":[Bt,[],t=>t.geometryType()],id:[Nt,[],t=>t.id()],zoom:[Qe,[],t=>t.globals.zoom],pitch:[Qe,[],t=>t.globals.pitch||0],"distance-from-center":[Qe,[],t=>t.distanceFromCenter()],"heatmap-density":[Qe,[],t=>t.globals.heatmapDensity||0],"line-progress":[Qe,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[Qe,[],t=>t.globals.skyRadialProgress||0],accumulated:[Nt,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[Qe,Zo(Qe),(t,e)=>{let n=0;for(const o of e)n+=o.evaluate(t);return n}],"*":[Qe,Zo(Qe),(t,e)=>{let n=1;for(const o of e)n*=o.evaluate(t);return n}],"-":{type:Qe,overloads:[[[Qe,Qe],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[Qe],(t,[e])=>-e.evaluate(t)]]},"/":[Qe,[Qe,Qe],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[Qe,[Qe,Qe],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[Qe,[],()=>Math.LN2],pi:[Qe,[],()=>Math.PI],e:[Qe,[],()=>Math.E],"^":[Qe,[Qe,Qe],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[Qe,[Qe],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Qe,[Qe],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Qe,[Qe],(t,[e])=>Math.log(e.evaluate(t))],log2:[Qe,[Qe],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Qe,[Qe],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Qe,[Qe],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Qe,[Qe],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Qe,[Qe],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Qe,[Qe],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Qe,[Qe],(t,[e])=>Math.atan(e.evaluate(t))],min:[Qe,Zo(Qe),(t,e)=>Math.min(...e.map(n=>n.evaluate(t)))],max:[Qe,Zo(Qe),(t,e)=>Math.max(...e.map(n=>n.evaluate(t)))],abs:[Qe,[Qe],(t,[e])=>Math.abs(e.evaluate(t))],round:[Qe,[Qe],(t,[e])=>{const n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[Qe,[Qe],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Qe,[Qe],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Ut,[Bt,Nt],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[Ut,[Nt],(t,[e])=>t.id()===e.value],"filter-type-==":[Ut,[Bt],(t,[e])=>t.geometryType()===e.value],"filter-<":[Ut,[Bt,Nt],(t,[e,n])=>{const o=t.properties()[e.value],c=n.value;return typeof o==typeof c&&o<c}],"filter-id-<":[Ut,[Nt],(t,[e])=>{const n=t.id(),o=e.value;return typeof n==typeof o&&n<o}],"filter->":[Ut,[Bt,Nt],(t,[e,n])=>{const o=t.properties()[e.value],c=n.value;return typeof o==typeof c&&o>c}],"filter-id->":[Ut,[Nt],(t,[e])=>{const n=t.id(),o=e.value;return typeof n==typeof o&&n>o}],"filter-<=":[Ut,[Bt,Nt],(t,[e,n])=>{const o=t.properties()[e.value],c=n.value;return typeof o==typeof c&&o<=c}],"filter-id-<=":[Ut,[Nt],(t,[e])=>{const n=t.id(),o=e.value;return typeof n==typeof o&&n<=o}],"filter->=":[Ut,[Bt,Nt],(t,[e,n])=>{const o=t.properties()[e.value],c=n.value;return typeof o==typeof c&&o>=c}],"filter-id->=":[Ut,[Nt],(t,[e])=>{const n=t.id(),o=e.value;return typeof n==typeof o&&n>=o}],"filter-has":[Ut,[Nt],(t,[e])=>e.value in t.properties()],"filter-has-id":[Ut,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[Ut,[Or(Bt)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Ut,[Or(Nt)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Ut,[Bt,Or(Nt)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Ut,[Bt,Or(Nt)],(t,[e,n])=>function(o,c,d,f){for(;d<=f;){const g=d+f>>1;if(c[g]===o)return!0;c[g]>o?f=g-1:d=g+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:Ut,overloads:[[[Ut,Ut],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[Zo(Ut),(t,e)=>{for(const n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:Ut,overloads:[[[Ut,Ut],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[Zo(Ut),(t,e)=>{for(const n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[Ut,[Ut],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Ut,[Bt],(t,[e])=>{const n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[Bt,[Bt],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Bt,[Bt],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Bt,Zo(Nt),(t,e)=>e.map(n=>ka(n.evaluate(t))).join("")],"resolved-locale":[Bt,[Aa],(t,[e])=>e.evaluate(t).resolvedLocale()]});var Os=np;function Nu(t){return{result:"success",value:t}}function Vi(t){return{result:"error",value:t}}function Fs(t){return t["property-type"]==="data-driven"||t["property-type"]==="cross-faded-data-driven"}function op(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Si(t){return!!t.expression&&t.expression.interpolated}function Xt(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function Gi(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function e_(t){return t}function sp(t,e){const n=e.type==="color",o=t.stops&&typeof t.stops[0][0]=="object",c=o||!(o||t.property!==void 0),d=t.type||(Si(e)?"exponential":"interval");if(n&&((t=ji({},t)).stops&&(t.stops=t.stops.map(w=>[w[0],An.parse(w[1])])),t.default=An.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!Hd[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let f,g,x;if(d==="exponential")f=Vu;else if(d==="interval")f=ju;else if(d==="categorical"){f=t_,g=Object.create(null);for(const w of t.stops)g[w[0]]=w[1];x=typeof t.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);f=Gu}if(o){const w={},E=[];for(let P=0;P<t.stops.length;P++){const D=t.stops[P],O=D[0].zoom;w[O]===void 0&&(w[O]={zoom:O,type:t.type,property:t.property,default:t.default,stops:[]},E.push(O)),w[O].stops.push([D[0].value,D[1]])}const M=[];for(const P of E)M.push([w[P].zoom,sp(w[P],e)]);const A={name:"linear"};return{kind:"composite",interpolationType:A,interpolationFactor:Ei.interpolationFactor.bind(void 0,A),zoomStops:M.map(P=>P[0]),evaluate:({zoom:P},D)=>Vu({stops:M,base:t.base},e,P).evaluate(P,D)}}if(c){const w=d==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:Ei.interpolationFactor.bind(void 0,w),zoomStops:t.stops.map(E=>E[0]),evaluate:({zoom:E})=>f(t,e,E,g,x)}}return{kind:"source",evaluate(w,E){const M=E&&E.properties?E.properties[t.property]:void 0;return M===void 0?Us(t.default,e.default):f(t,e,M,g,x)}}}function Us(t,e,n){return t!==void 0?t:e!==void 0?e:n!==void 0?n:void 0}function t_(t,e,n,o,c){return Us(typeof n===c?o[n]:void 0,t.default,e.default)}function ju(t,e,n){if(Xt(n)!=="number")return Us(t.default,e.default);const o=t.stops.length;if(o===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[o-1][0])return t.stops[o-1][1];const c=La(t.stops.map(d=>d[0]),n);return t.stops[c][1]}function Vu(t,e,n){const o=t.base!==void 0?t.base:1;if(Xt(n)!=="number")return Us(t.default,e.default);const c=t.stops.length;if(c===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[c-1][0])return t.stops[c-1][1];const d=La(t.stops.map(E=>E[0]),n),f=function(E,M,A,P){const D=P-A,O=E-A;return D===0?0:M===1?O/D:(Math.pow(M,O)-1)/(Math.pow(M,D)-1)}(n,o,t.stops[d][0],t.stops[d+1][0]),g=t.stops[d][1],x=t.stops[d+1][1];let w=Rs[e.type]||e_;if(t.colorSpace&&t.colorSpace!=="rgb"){const E=Hd[t.colorSpace];w=(M,A)=>E.reverse(E.interpolate(E.forward(M),E.forward(A),f))}return typeof g.evaluate=="function"?{evaluate(...E){const M=g.evaluate.apply(void 0,E),A=x.evaluate.apply(void 0,E);if(M!==void 0&&A!==void 0)return w(M,A,f)}}:w(g,x,f)}function Gu(t,e,n){return e.type==="color"?n=An.parse(n):e.type==="formatted"?n=fr.fromString(n.toString()):e.type==="resolvedImage"?n=Sr.fromString(n.toString()):Xt(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),Us(n,t.default,e.default)}class Fa{constructor(e,n){this.expression=e,this._warningHistory={},this._evaluator=new Fd,this._defaultValue=n?function(o){return o.type==="color"&&(Gi(o.default)||Array.isArray(o.default))?new An(0,0,0,0):o.type==="color"?An.parse(o.default)||null:o.default===void 0?null:o.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,o,c,d,f,g,x){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=o,this._evaluator.canonical=c||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=x||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,o,c,d,f,g,x){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=o||null,this._evaluator.canonical=c||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f||null,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=x||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new Hn(`Expected value to be one of ${Object.keys(this._enumValues).map(E=>JSON.stringify(E)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function Ua(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Os}function qo(t,e){const n=new Eu(Os,[],e?function(c){const d={color:vi,string:Bt,number:Qe,enum:Bt,boolean:Ut,formatted:ks,resolvedImage:Ps};return c.type==="array"?Or(d[c.value]||Nt,c.length):d[c.type]}(e):void 0),o=n.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?Nu(new Fa(o,e)):Vi(n.errors)}class Hl{constructor(e,n){this.kind=e,this._styleExpression=n,this.isStateDependent=e!=="constant"&&!Rl(n.expression)}evaluateWithoutErrorHandling(e,n,o,c,d,f){return this._styleExpression.evaluateWithoutErrorHandling(e,n,o,c,d,f)}evaluate(e,n,o,c,d,f){return this._styleExpression.evaluate(e,n,o,c,d,f)}}class Yl{constructor(e,n,o,c){this.kind=e,this.zoomStops=o,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!Rl(n.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,n,o,c,d,f){return this._styleExpression.evaluateWithoutErrorHandling(e,n,o,c,d,f)}evaluate(e,n,o,c,d,f){return this._styleExpression.evaluate(e,n,o,c,d,f)}interpolationFactor(e,n,o){return this.interpolationType?Ei.interpolationFactor(this.interpolationType,e,n,o):0}}function Na(t,e){if((t=qo(t,e)).result==="error")return t;const n=t.value.expression,o=Da(n);if(!o&&!Fs(e))return Vi([new xi("","data expressions not supported")]);const c=Bl(n,["zoom","pitch","distance-from-center"]);if(!c&&!op(e))return Vi([new xi("","zoom expressions not supported")]);const d=ja(n);return d||c?d instanceof xi?Vi([d]):d instanceof Ei&&!Si(e)?Vi([new xi("",'"interpolate" expressions cannot be used with this property')]):Nu(d?new Yl(o?"camera":"composite",t.value,d.labels,d instanceof Ei?d.interpolation:void 0):new Hl(o?"constant":"source",t.value)):Vi([new xi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class $i{constructor(e,n){this._parameters=e,this._specification=n,ji(this,sp(this._parameters,this._specification))}static deserialize(e){return new $i(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function ja(t){let e=null;if(t instanceof ku)e=ja(t.result);else if(t instanceof Yd){for(const n of t.args)if(e=ja(n),e)break}else(t instanceof Ls||t instanceof Ei)&&t.input instanceof si&&t.input.name==="zoom"&&(e=t);return e instanceof xi||t.eachChild(n=>{const o=ja(n);o instanceof xi?e=o:!e&&o?e=new xi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new xi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class nt{constructor(e,n,o,c){this.message=(e?`${e}: `:"")+o,c&&(this.identifier=c),n!=null&&n.__line__&&(this.line=n.__line__)}}function Fr(t){const e=t.key,n=t.value,o=t.valueSpec||{},c=t.objectElementValidators||{},d=t.style,f=t.styleSpec;let g=[];const x=Xt(n);if(x!=="object")return[new nt(e,n,`object expected, ${x} found`)];for(const w in n){const E=w.split(".")[0],M=o[E]||o["*"];let A;c[E]?A=c[E]:o[E]?A=or:c["*"]?A=c["*"]:o["*"]&&(A=or),A?g=g.concat(A({key:(e&&`${e}.`)+w,value:n[w],valueSpec:M,style:d,styleSpec:f,object:n,objectKey:w},n)):g.push(new nt(e,n[w],`unknown property "${w}"`))}for(const w in o)c[w]||o[w].required&&o[w].default===void 0&&n[w]===void 0&&g.push(new nt(e,n,`missing required property "${w}"`));return g}function $u(t){const e=t.value,n=t.valueSpec,o=t.style,c=t.styleSpec,d=t.key,f=t.arrayElementValidator||or;if(Xt(e)!=="array")return[new nt(d,e,`array expected, ${Xt(e)} found`)];if(n.length&&e.length!==n.length)return[new nt(d,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new nt(d,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let g={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};c.$version<7&&(g.function=n.function),Xt(n.value)==="object"&&(g=n.value);let x=[];for(let w=0;w<e.length;w++)x=x.concat(f({array:e,arrayIndex:w,value:e[w],valueSpec:g,style:o,styleSpec:c,key:`${d}[${w}]`}));return x}function ap(t){const e=t.key,n=t.value,o=t.valueSpec;let c=Xt(n);if(c==="number"&&n!=n&&(c="NaN"),c!=="number")return[new nt(e,n,`number expected, ${c} found`)];if("minimum"in o){let d=o.minimum;if(Xt(o.minimum)==="array"&&(d=o.minimum[t.arrayIndex]),n<d)return[new nt(e,n,`${n} is less than the minimum value ${d}`)]}if("maximum"in o){let d=o.maximum;if(Xt(o.maximum)==="array"&&(d=o.maximum[t.arrayIndex]),n>d)return[new nt(e,n,`${n} is greater than the maximum value ${d}`)]}return[]}function Zu(t){const e=t.valueSpec,n=kn(t.value.type);let o,c,d,f={};const g=n!=="categorical"&&t.value.property===void 0,x=!g,w=Xt(t.value.stops)==="array"&&Xt(t.value.stops[0])==="array"&&Xt(t.value.stops[0][0])==="object",E=Fr({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(P){if(n==="identity")return[new nt(P.key,P.value,'identity function may not have a "stops" property')];let D=[];const O=P.value;return D=D.concat($u({key:P.key,value:O,valueSpec:P.valueSpec,style:P.style,styleSpec:P.styleSpec,arrayElementValidator:M})),Xt(O)==="array"&&O.length===0&&D.push(new nt(P.key,O,"array must have at least one stop")),D},default:function(P){return or({key:P.key,value:P.value,valueSpec:e,style:P.style,styleSpec:P.styleSpec})}}});return n==="identity"&&g&&E.push(new nt(t.key,t.value,'missing required property "property"')),n==="identity"||t.value.stops||E.push(new nt(t.key,t.value,'missing required property "stops"')),n==="exponential"&&t.valueSpec.expression&&!Si(t.valueSpec)&&E.push(new nt(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(x&&!Fs(t.valueSpec)?E.push(new nt(t.key,t.value,"property functions not supported")):g&&!op(t.valueSpec)&&E.push(new nt(t.key,t.value,"zoom functions not supported"))),n!=="categorical"&&!w||t.value.property!==void 0||E.push(new nt(t.key,t.value,'"property" property is required')),E;function M(P){let D=[];const O=P.value,N=P.key;if(Xt(O)!=="array")return[new nt(N,O,`array expected, ${Xt(O)} found`)];if(O.length!==2)return[new nt(N,O,`array length 2 expected, length ${O.length} found`)];if(w){if(Xt(O[0])!=="object")return[new nt(N,O,`object expected, ${Xt(O[0])} found`)];if(O[0].zoom===void 0)return[new nt(N,O,"object stop key must have zoom")];if(O[0].value===void 0)return[new nt(N,O,"object stop key must have value")];const J=kn(O[0].zoom);if(typeof J!="number")return[new nt(N,O[0].zoom,"stop zoom values must be numbers")];if(d&&d>J)return[new nt(N,O[0].zoom,"stop zoom values must appear in ascending order")];J!==d&&(d=J,c=void 0,f={}),D=D.concat(Fr({key:`${N}[0]`,value:O[0],valueSpec:{zoom:{}},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{zoom:ap,value:A}}))}else D=D.concat(A({key:`${N}[0]`,value:O[0],valueSpec:{},style:P.style,styleSpec:P.styleSpec},O));return Ua(go(O[1]))?D.concat([new nt(`${N}[1]`,O[1],"expressions are not allowed in function stops.")]):D.concat(or({key:`${N}[1]`,value:O[1],valueSpec:e,style:P.style,styleSpec:P.styleSpec}))}function A(P,D){const O=Xt(P.value),N=kn(P.value),J=P.value!==null?P.value:D;if(o){if(O!==o)return[new nt(P.key,J,`${O} stop domain type must match previous stop domain type ${o}`)]}else o=O;if(O!=="number"&&O!=="string"&&O!=="boolean"&&typeof N!="number"&&typeof N!="string"&&typeof N!="boolean")return[new nt(P.key,J,"stop domain value must be a number, string, or boolean")];if(O!=="number"&&n!=="categorical"){let re=`number expected, ${O} found`;return Fs(e)&&n===void 0&&(re+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new nt(P.key,J,re)]}return n!=="categorical"||O!=="number"||typeof N=="number"&&isFinite(N)&&Math.floor(N)===N?n!=="categorical"&&O==="number"&&typeof N=="number"&&typeof c=="number"&&c!==void 0&&N<c?[new nt(P.key,J,"stop domain values must appear in ascending order")]:(c=N,n==="categorical"&&N in f?[new nt(P.key,J,"stop domain values must be unique")]:(f[N]=!0,[])):[new nt(P.key,J,`integer expected, found ${String(N)}`)]}}function Zi(t){const e=(t.expressionContext==="property"?Na:qo)(go(t.value),t.valueSpec);if(e.result==="error")return e.value.map(o=>new nt(`${t.key}${o.key}`,t.value,o.message));const n=e.value.expression||e.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!n.outputDefined())return[new nt(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!Rl(n))return[new nt(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter")return lp(n,t);if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!Bl(n,["zoom","feature-state"]))return[new nt(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!Da(n))return[new nt(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function lp(t,e){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const c of e.valueSpec.expression.parameters)n.delete(c);if(n.size===0)return[];const o=[];return t instanceof si&&n.has(t.name)?[new nt(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(c=>{o.push(...lp(c,e))}),o)}function Kl(t){const e=t.key,n=t.value,o=t.valueSpec,c=[];return Array.isArray(o.values)?o.values.indexOf(kn(n))===-1&&c.push(new nt(e,n,`expected one of [${o.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(o.values).indexOf(kn(n))===-1&&c.push(new nt(e,n,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(n)} found`)),c}function qu(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!qu(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Jl(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};qu(t)||(t=ec(t));const n=t;let o=!0;try{o=function(w){if(!qi(w))return w;let E=go(w);return Va(E),E=cp(E),E}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(n,null,2)}
        `)}const c=ze[`filter_${e}`],d=qo(o,c);let f=null;if(d.result==="error")throw new Error(d.value.map(w=>`${w.key}: ${w.message}`).join(", "));f=(w,E,M)=>d.value.evaluate(w,E,{},M);let g=null,x=null;if(o!==n){const w=qo(n,c);if(w.result==="error")throw new Error(w.value.map(E=>`${E.key}: ${E.message}`).join(", "));g=(E,M,A,P,D)=>w.value.evaluate(E,M,{},A,void 0,void 0,P,D),x=!Da(w.value.expression)}return{filter:f,dynamicFilter:g||void 0,needGeometry:up(o),needFeature:!!x}}function cp(t){if(!Array.isArray(t))return t;const e=function(n){if(Ur.has(n[0])){for(let o=1;o<n.length;o++)if(qi(n[o]))return!0}return n}(t);return e===!0?e:e.map(n=>cp(n))}function Va(t){let e=!1;const n=[];if(t[0]==="case"){for(let o=1;o<t.length-1;o+=2)e=e||qi(t[o]),n.push(t[o+1]);n.push(t[t.length-1])}else if(t[0]==="match"){e=e||qi(t[1]);for(let o=2;o<t.length-1;o+=2)n.push(t[o+1]);n.push(t[t.length-1])}else if(t[0]==="step"){e=e||qi(t[1]);for(let o=1;o<t.length-1;o+=2)n.push(t[o+1])}e&&(t.length=0,t.push("any",...n));for(let o=1;o<t.length;o++)Va(t[o])}function qi(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<t.length;n++)if(qi(t[n]))return!0;return!1}const Ur=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Ql(t,e){return t<e?-1:t>e?1:0}function up(t){if(!Array.isArray(t))return!1;if(t[0]==="within")return!0;for(let e=1;e<t.length;e++)if(up(t[e]))return!0;return!1}function ec(t){if(!t)return!0;const e=t[0];return t.length<=1?e!=="any":e==="=="?Wu(t[1],t[2],"=="):e==="!="?nc(Wu(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Wu(t[1],t[2],e):e==="any"?(n=t.slice(1),["any"].concat(n.map(ec))):e==="all"?["all"].concat(t.slice(1).map(ec)):e==="none"?["all"].concat(t.slice(1).map(ec).map(nc)):e==="in"?hp(t[1],t.slice(2)):e==="!in"?nc(hp(t[1],t.slice(2))):e==="has"?tc(t[1]):e==="!has"?nc(tc(t[1])):e!=="within"||t;var n}function Wu(t,e,n){switch(t){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,t,e]}}function hp(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",t,["literal",e.sort(Ql)]]:["filter-in-small",t,["literal",e]]}}function tc(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function nc(t){return["!",t]}function Ga(t){return qu(go(t.value))?Zi(ji({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):dp(t)}function dp(t){const e=t.value,n=t.key;if(Xt(e)!=="array")return[new nt(n,e,`array expected, ${Xt(e)} found`)];const o=t.styleSpec;let c,d=[];if(e.length<1)return[new nt(n,e,"filter array must have at least 1 element")];switch(d=d.concat(Kl({key:`${n}[0]`,value:e[0],valueSpec:o.filter_operator,style:t.style,styleSpec:t.styleSpec})),kn(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&kn(e[1])==="$type"&&d.push(new nt(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&d.push(new nt(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(c=Xt(e[1]),c!=="string"&&d.push(new nt(`${n}[1]`,e[1],`string expected, ${c} found`)));for(let f=2;f<e.length;f++)c=Xt(e[f]),kn(e[1])==="$type"?d=d.concat(Kl({key:`${n}[${f}]`,value:e[f],valueSpec:o.geometry_type,style:t.style,styleSpec:t.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&d.push(new nt(`${n}[${f}]`,e[f],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let f=1;f<e.length;f++)d=d.concat(dp({key:`${n}[${f}]`,value:e[f],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":c=Xt(e[1]),e.length!==2?d.push(new nt(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="string"&&d.push(new nt(`${n}[1]`,e[1],`string expected, ${c} found`));break;case"within":c=Xt(e[1]),e.length!==2?d.push(new nt(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="object"&&d.push(new nt(`${n}[1]`,e[1],`object expected, ${c} found`))}return d}function pp(t,e){const n=t.key,o=t.style,c=t.styleSpec,d=t.value,f=t.objectKey,g=c[`${e}_${t.layerType}`];if(!g)return[];const x=f.match(/^(.*)-transition$/);if(e==="paint"&&x&&g[x[1]]&&g[x[1]].transition)return or({key:n,value:d,valueSpec:c.transition,style:o,styleSpec:c});const w=t.valueSpec||g[f];if(!w)return[new nt(n,d,`unknown property "${f}"`)];let E;if(Xt(d)==="string"&&Fs(w)&&!w.tokens&&(E=/^{([^}]+)}$/.exec(d)))return[new nt(n,d,`"${f}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(E[1])} }\`.`)];const M=[];return t.layerType==="symbol"&&(f==="text-field"&&o&&!o.glyphs&&M.push(new nt(n,d,'use of "text-field" requires a style "glyphs" property')),f==="text-font"&&Gi(go(d))&&kn(d.type)==="identity"&&M.push(new nt(n,d,'"text-font" does not support identity functions'))),M.concat(or({key:t.key,value:d,valueSpec:w,style:o,styleSpec:c,expressionContext:"property",propertyType:e,propertyKey:f}))}function rc(t){return pp(t,"paint")}function fp(t){return pp(t,"layout")}function Xu(t){let e=[];const n=t.value,o=t.key,c=t.style,d=t.styleSpec;n.type||n.ref||e.push(new nt(o,n,'either "type" or "ref" is required'));let f=kn(n.type);const g=kn(n.ref);if(n.id){const x=kn(n.id);for(let w=0;w<t.arrayIndex;w++){const E=c.layers[w];kn(E.id)===x&&e.push(new nt(o,n.id,`duplicate layer id "${n.id}", previously used at line ${E.id.__line__}`))}}if("ref"in n){let x;["type","source","source-layer","filter","layout"].forEach(w=>{w in n&&e.push(new nt(o,n[w],`"${w}" is prohibited for ref layers`))}),c.layers.forEach(w=>{kn(w.id)===g&&(x=w)}),x?x.ref?e.push(new nt(o,n.ref,"ref cannot reference another ref layer")):f=kn(x.type):typeof g=="string"&&e.push(new nt(o,n.ref,`ref layer "${g}" not found`))}else if(f!=="background"&&f!=="sky")if(n.source){const x=c.sources&&c.sources[n.source],w=x&&kn(x.type);x?w==="vector"&&f==="raster"?e.push(new nt(o,n.source,`layer "${n.id}" requires a raster source`)):w==="raster"&&f!=="raster"?e.push(new nt(o,n.source,`layer "${n.id}" requires a vector source`)):w!=="vector"||n["source-layer"]?w==="raster-dem"&&f!=="hillshade"?e.push(new nt(o,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):f!=="line"||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||w==="geojson"&&x.lineMetrics||e.push(new nt(o,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new nt(o,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new nt(o,n.source,`source "${n.source}" not found`))}else e.push(new nt(o,n,'missing required property "source"'));return e=e.concat(Fr({key:o,value:n,valueSpec:d.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>or({key:`${o}.type`,value:n.type,valueSpec:d.layer.type,style:t.style,styleSpec:t.styleSpec,object:n,objectKey:"type"}),filter:x=>Ga(ji({layerType:f},x)),layout:x=>Fr({layer:n,key:x.key,value:x.value,valueSpec:{},style:x.style,styleSpec:x.styleSpec,objectElementValidators:{"*":w=>fp(ji({layerType:f},w))}}),paint:x=>Fr({layer:n,key:x.key,value:x.value,valueSpec:{},style:x.style,styleSpec:x.styleSpec,objectElementValidators:{"*":w=>rc(ji({layerType:f},w))}})}})),e}function Wo(t){const e=t.value,n=t.key,o=Xt(e);return o!=="string"?[new nt(n,e,`string expected, ${o} found`)]:[]}const mp={promoteId:function({key:t,value:e}){if(Xt(e)==="string")return Wo({key:t,value:e});{const n=[];for(const o in e)n.push(...Wo({key:`${t}.${o}`,value:e[o]}));return n}}};function ic(t){const e=t.value,n=t.key,o=t.styleSpec,c=t.style;if(!e.type)return[new nt(n,e,'"type" is required')];const d=kn(e.type);let f;switch(d){case"vector":case"raster":case"raster-dem":return f=Fr({key:n,value:e,valueSpec:o[`source_${d.replace("-","_")}`],style:t.style,styleSpec:o,objectElementValidators:mp}),f;case"geojson":if(f=Fr({key:n,value:e,valueSpec:o.source_geojson,style:c,styleSpec:o,objectElementValidators:mp}),e.cluster)for(const g in e.clusterProperties){const[x,w]=e.clusterProperties[g],E=typeof x=="string"?[x,["accumulated"],["get",g]]:x;f.push(...Zi({key:`${n}.${g}.map`,value:w,expressionContext:"cluster-map"})),f.push(...Zi({key:`${n}.${g}.reduce`,value:E,expressionContext:"cluster-reduce"}))}return f;case"video":return Fr({key:n,value:e,valueSpec:o.source_video,style:c,styleSpec:o});case"image":return Fr({key:n,value:e,valueSpec:o.source_image,style:c,styleSpec:o});case"canvas":return[new nt(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Kl({key:`${n}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:c,styleSpec:o})}}function $a(t){const e=t.value,n=t.styleSpec,o=n.light,c=t.style;let d=[];const f=Xt(e);if(e===void 0)return d;if(f!=="object")return d=d.concat([new nt("light",e,`object expected, ${f} found`)]),d;for(const g in e){const x=g.match(/^(.*)-transition$/);d=d.concat(x&&o[x[1]]&&o[x[1]].transition?or({key:g,value:e[g],valueSpec:n.transition,style:c,styleSpec:n}):o[g]?or({key:g,value:e[g],valueSpec:o[g],style:c,styleSpec:n}):[new nt(g,e[g],`unknown property "${g}"`)])}return d}function Hu(t){const e=t.value,n=t.key,o=t.style,c=t.styleSpec,d=c.terrain;let f=[];const g=Xt(e);if(e===void 0)return f;if(g!=="object")return f=f.concat([new nt("terrain",e,`object expected, ${g} found`)]),f;for(const x in e){const w=x.match(/^(.*)-transition$/);f=f.concat(w&&d[w[1]]&&d[w[1]].transition?or({key:x,value:e[x],valueSpec:c.transition,style:o,styleSpec:c}):d[x]?or({key:x,value:e[x],valueSpec:d[x],style:o,styleSpec:c}):[new nt(x,e[x],`unknown property "${x}"`)])}if(e.source){const x=o.sources&&o.sources[e.source],w=x&&kn(x.type);x?w!=="raster-dem"&&f.push(new nt(n,e.source,`terrain cannot be used with a source of type ${String(w)}, it only be used with a "raster-dem" source type`)):f.push(new nt(n,e.source,`source "${e.source}" not found`))}else f.push(new nt(n,e,'terrain is missing required property "source"'));return f}function _p(t){const e=t.value,n=t.style,o=t.styleSpec,c=o.fog;let d=[];const f=Xt(e);if(e===void 0)return d;if(f!=="object")return d=d.concat([new nt("fog",e,`object expected, ${f} found`)]),d;for(const g in e){const x=g.match(/^(.*)-transition$/);d=d.concat(x&&c[x[1]]&&c[x[1]].transition?or({key:g,value:e[g],valueSpec:o.transition,style:n,styleSpec:o}):c[g]?or({key:g,value:e[g],valueSpec:c[g],style:n,styleSpec:o}):[new nt(g,e[g],`unknown property "${g}"`)])}return d}const Yu={"*":()=>[],array:$u,boolean:function(t){const e=t.value,n=t.key,o=Xt(e);return o!=="boolean"?[new nt(n,e,`boolean expected, ${o} found`)]:[]},number:ap,color:function(t){const e=t.key,n=t.value,o=Xt(n);return o!=="string"?[new nt(e,n,`color expected, ${o} found`)]:uu(n)===null?[new nt(e,n,`color expected, "${n}" found`)]:[]},enum:Kl,filter:Ga,function:Zu,layer:Xu,object:Fr,source:ic,light:$a,terrain:Hu,fog:_p,string:Wo,formatted:function(t){return Wo(t).length===0?[]:Zi(t)},resolvedImage:function(t){return Wo(t).length===0?[]:Zi(t)},projection:function(t){const e=t.value,n=t.styleSpec,o=n.projection,c=t.style;let d=[];const f=Xt(e);if(f==="object")for(const g in e)d=d.concat(or({key:g,value:e[g],valueSpec:o[g],style:c,styleSpec:n}));else f!=="string"&&(d=d.concat([new nt("projection",e,`object or string expected, ${f} found`)]));return d}};function or(t){const e=t.value,n=t.valueSpec,o=t.styleSpec;return n.expression&&Gi(kn(e))?Zu(t):n.expression&&Ua(go(e))?Zi(t):n.type&&Yu[n.type]?Yu[n.type](t):Fr(ji({},t,{valueSpec:n.type?o[n.type]:n}))}function Ku(t){const e=t.value,n=t.key,o=Wo(t);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new nt(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new nt(n,e,'"glyphs" url must include a "{range}" token'))),o}function gp(t,e=ze){return Wi(or({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:Ku,"*":()=>[]}}))}const n_=t=>Wi(rc(t)),r_=t=>Wi(fp(t));function Wi(t){return t.slice().sort((e,n)=>e.line&&n.line?e.line-n.line:0)}function Ju(t,e){let n=!1;if(e&&e.length)for(const o of e)t.fire(new _o(new Error(o.message))),n=!0;return n}var Ns=Ci;function Ci(t,e,n){var o=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var c=new Int32Array(this.arrayBuffer);t=c[0],this.d=(e=c[1])+2*(n=c[2]);for(var d=0;d<this.d*this.d;d++){var f=c[3+d],g=c[3+d+1];o.push(f===g?null:c.subarray(f,g))}var x=c[3+o.length+1];this.keys=c.subarray(c[3+o.length],x),this.bboxes=c.subarray(x),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var w=0;w<this.d*this.d;w++)o.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var E=n/e*t;this.min=-E,this.max=t+E}Ci.prototype.insert=function(t,e,n,o,c){this._forEachCell(e,n,o,c,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(c)},Ci.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ci.prototype._insertCell=function(t,e,n,o,c,d){this.cells[c].push(d)},Ci.prototype.query=function(t,e,n,o,c){var d=this.min,f=this.max;if(t<=d&&e<=d&&f<=n&&f<=o&&!c)return Array.prototype.slice.call(this.keys);var g=[];return this._forEachCell(t,e,n,o,this._queryCell,g,{},c),g},Ci.prototype._queryCell=function(t,e,n,o,c,d,f,g){var x=this.cells[c];if(x!==null)for(var w=this.keys,E=this.bboxes,M=0;M<x.length;M++){var A=x[M];if(f[A]===void 0){var P=4*A;(g?g(E[P+0],E[P+1],E[P+2],E[P+3]):t<=E[P+2]&&e<=E[P+3]&&n>=E[P+0]&&o>=E[P+1])?(f[A]=!0,d.push(w[A])):f[A]=!1}}},Ci.prototype._forEachCell=function(t,e,n,o,c,d,f,g){for(var x=this._convertToCellCoord(t),w=this._convertToCellCoord(e),E=this._convertToCellCoord(n),M=this._convertToCellCoord(o),A=x;A<=E;A++)for(var P=w;P<=M;P++){var D=this.d*P+A;if((!g||g(this._convertFromCellCoord(A),this._convertFromCellCoord(P),this._convertFromCellCoord(A+1),this._convertFromCellCoord(P+1)))&&c.call(this,t,e,n,o,D,d,f,g))return}},Ci.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Ci.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Ci.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,n=0,o=0;o<this.cells.length;o++)n+=this.cells[o].length;var c=new Int32Array(e+n+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;for(var d=e,f=0;f<t.length;f++){var g=t[f];c[3+f]=d,c.set(g,d),d+=g.length}return c[3+t.length]=d,c.set(this.keys,d),c[3+t.length+1]=d+=this.keys.length,c.set(this.bboxes,d),d+=this.bboxes.length,c.buffer};const oc={};function rt(t,e,n={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),oc[e]={klass:t,omit:n.omit||[]}}rt(Object,"Object"),Ns.serialize=function(t,e){const n=t.toArrayBuffer();return e&&e.push(n),{buffer:n}},Ns.deserialize=function(t){return new Ns(t.buffer)},Object.defineProperty(Ns,"name",{value:"Grid"}),rt(Ns,"Grid"),rt(An,"Color"),rt(Error,"Error"),rt(Sa,"AJAXError"),rt(Sr,"ResolvedImage"),rt($i,"StylePropertyFunction"),rt(Fa,"StyleExpression",{omit:["_evaluator"]}),rt(Yl,"ZoomDependentExpression"),rt(Hl,"ZoomConstantExpression"),rt(si,"CompoundExpression",{omit:["_evaluate"]});for(const t in Os)oc[Os[t]._classRegistryKey]||rt(Os[t],`Expression${t}`);function yp(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function xp(t){return B.ImageBitmap&&t instanceof B.ImageBitmap}function Za(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(yp(t)||xp(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const n=t;return e&&e.push(n.buffer),n}if(t instanceof B.ImageData)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const n=[];for(const o of t)n.push(Za(o,e));return n}if(typeof t=="object"){const n=t.constructor,o=n._classRegistryKey;if(!o)throw new Error(`can't serialize object of unregistered class ${o}`);const c=n.serialize?n.serialize(t,e):{};if(!n.serialize){for(const d in t)t.hasOwnProperty(d)&&(oc[o].omit.indexOf(d)>=0||(c[d]=Za(t[d],e)));t instanceof Error&&(c.message=t.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(c.$name=o),c}throw new Error("can't serialize object of type "+typeof t)}function wo(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||yp(t)||xp(t)||ArrayBuffer.isView(t)||t instanceof B.ImageData)return t;if(Array.isArray(t))return t.map(wo);if(typeof t=="object"){const e=t.$name||"Object",{klass:n}=oc[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(t);const o=Object.create(n.prototype);for(const c of Object.keys(t))c!=="$name"&&(o[c]=wo(t[c]));return o}throw new Error("can't deserialize object of type "+typeof t)}class vp{constructor(){this.first=!0}update(e,n){const o=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=n),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=o,!0))}}const wp=t=>t>=1536&&t<=1791,qa=t=>t>=1872&&t<=1919,bp=t=>t>=2208&&t<=2303,Qu=t=>t>=11904&&t<=12031,Tp=t=>t>=12032&&t<=12255,eh=t=>t>=12272&&t<=12287,Wa=t=>t>=12288&&t<=12351,sc=t=>t>=12352&&t<=12447,Xa=t=>t>=12448&&t<=12543,ac=t=>t>=12544&&t<=12591,lc=t=>t>=12704&&t<=12735,Ep=t=>t>=12736&&t<=12783,Sp=t=>t>=12784&&t<=12799,th=t=>t>=12800&&t<=13055,Cp=t=>t>=13056&&t<=13311,Mp=t=>t>=13312&&t<=19903,nh=t=>t>=19968&&t<=40959,cc=t=>t>=40960&&t<=42127,Ap=t=>t>=42128&&t<=42191,Ip=t=>t>=44032&&t<=55215,zp=t=>t>=63744&&t<=64255,rh=t=>t>=64336&&t<=65023,kp=t=>t>=65040&&t<=65055,uc=t=>t>=65072&&t<=65103,Ha=t=>t>=65104&&t<=65135,u=t=>t>=65136&&t<=65279,r=t=>t>=65280&&t<=65519;function l(t){for(const e of t)if(y(e.charCodeAt(0)))return!0;return!1}function p(t){for(const e of t)if(!_(e.charCodeAt(0)))return!1;return!0}function _(t){return!(wp(t)||qa(t)||bp(t)||rh(t)||u(t))}function y(t){return!(t!==746&&t!==747&&(t<4352||!(lc(t)||ac(t)||uc(t)&&!(t>=65097&&t<=65103)||zp(t)||Cp(t)||Qu(t)||Ep(t)||!(!Wa(t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||Mp(t)||nh(t)||th(t)||(e=>e>=12592&&e<=12687)(t)||(e=>e>=43360&&e<=43391)(t)||(e=>e>=55216&&e<=55295)(t)||(e=>e>=4352&&e<=4607)(t)||Ip(t)||sc(t)||eh(t)||(e=>e>=12688&&e<=12703)(t)||Tp(t)||Sp(t)||Xa(t)&&t!==12540||!(!r(t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!Ha(t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||(e=>e>=5120&&e<=5759)(t)||(e=>e>=6320&&e<=6399)(t)||kp(t)||(e=>e>=19904&&e<=19967)(t)||cc(t)||Ap(t))))}function b(t){return!(y(t)||function(e){return!!((n=>n>=128&&n<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(n=>n>=8192&&n<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(n=>n>=8448&&n<=8527)(e)||(n=>n>=8528&&n<=8591)(e)||(n=>n>=8960&&n<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(n=>n>=9216&&n<=9279)(e)&&e!==9251||(n=>n>=9280&&n<=9311)(e)||(n=>n>=9312&&n<=9471)(e)||(n=>n>=9632&&n<=9727)(e)||(n=>n>=9728&&n<=9983)(e)&&!(e>=9754&&e<=9759)||(n=>n>=11008&&n<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Wa(e)||Xa(e)||(n=>n>=57344&&n<=63743)(e)||uc(e)||Ha(e)||r(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function S(t){return t>=1424&&t<=2303||rh(t)||u(t)}function C(t,e){return!(!e&&S(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||(n=>n>=6016&&n<=6143)(t))}function z(t){for(const e of t)if(S(e.charCodeAt(0)))return!0;return!1}const k="deferred",R="loading",U="loaded";let q=null,V="unavailable",W=null;const $=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(V="error"),q&&q(t)};function j(){H.fire(new tn("pluginStateChange",{pluginStatus:V,pluginURL:W}))}const H=new Ni,Z=function(){return V},ne=function(){if(V!==k||!W)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");V=R,j(),W&&fo({url:W},t=>{t?$(t):(V=U,j())})},ie={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>V===U||ie.applyArabicShaping!=null,isLoading:()=>V===R,setState(t){V=t.pluginStatus,W=t.pluginURL},isParsed:()=>ie.applyArabicShaping!=null&&ie.processBidirectionalText!=null&&ie.processStyledBidirectionalText!=null,getPluginURL:()=>W};class Q{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition,this.pitch=n.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new vp,this.transition={},this.pitch=0)}isSupportedScript(e){return function(n,o){for(const c of n)if(!C(c.charCodeAt(0),o))return!1;return!0}(e,ie.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,n=e-Math.floor(e),o=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*n}}}class se{constructor(e,n){this.property=e,this.value=n,this.expression=function(o,c){if(Gi(o))return new $i(o,c);if(Ua(o)){const d=Na(o,c);if(d.result==="error")throw new Error(d.value.map(f=>`${f.key}: ${f.message}`).join(", "));return d.value}{let d=o;return typeof o=="string"&&c.type==="color"&&(d=An.parse(o)),{kind:"constant",evaluate:()=>d}}}(n===void 0?e.specification.default:n,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,o){return this.property.possiblyEvaluate(this,e,n,o)}}class xe{constructor(e){this.property=e,this.value=new se(e,void 0)}transitioned(e,n){return new Ee(this.property,this.value,n,_t({},e.transition,this.transition),e.now)}untransitioned(){return new Ee(this.property,this.value,null,{},0)}}class Ce{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Rr(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new xe(this._values[e].property)),this._values[e].value=new se(this._values[e].property,n===null?void 0:Rr(n))}getTransition(e){return Rr(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new xe(this._values[e].property)),this._values[e].transition=Rr(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(e[n]=o);const c=this.getTransition(n);c!==void 0&&(e[`${n}-transition`]=c)}return e}transitioned(e,n){const o=new Ge(this._properties);for(const c of Object.keys(this._values))o._values[c]=this._values[c].transitioned(e,n._values[c]);return o}untransitioned(){const e=new Ge(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class Ee{constructor(e,n,o,c,d){const f=c.delay||0,g=c.duration||0;d=d||0,this.property=e,this.value=n,this.begin=d+f,this.end=this.begin+g,e.specification.transition&&(c.delay||c.duration)&&(this.prior=o)}possiblyEvaluate(e,n,o){const c=e.now||0,d=this.value.possiblyEvaluate(e,n,o),f=this.prior;if(f){if(c>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(c<this.begin)return f.possiblyEvaluate(e,n,o);{const g=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(e,n,o),d,yi(g))}}return d}}class Ge{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,o){const c=new De(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].possiblyEvaluate(e,n,o);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class fe{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Rr(this._values[e].value)}setValue(e,n){this._values[e]=new se(this._values[e].property,n===null?void 0:Rr(n))}serialize(){const e={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(e[n]=o)}return e}possiblyEvaluate(e,n,o){const c=new De(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].possiblyEvaluate(e,n,o);return c}}class Le{constructor(e,n,o){this.property=e,this.value=n,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,o,c){return this.property.evaluate(this.value,this.parameters,e,n,o,c)}}class De{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ve{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,o){const c=Rs[this.specification.type];return c?c(e,n,o):e}}class pe{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,o,c){return new Le(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},o,c)}:e.expression,n)}interpolate(e,n,o){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new Le(this,{kind:"constant",value:void 0},e.parameters);const c=Rs[this.specification.type];return c?new Le(this,{kind:"constant",value:c(e.value.value,n.value.value,o)},e.parameters):e}evaluate(e,n,o,c,d,f){return e.kind==="constant"?e.value:e.evaluate(n,o,c,d,f)}}class Ke extends pe{possiblyEvaluate(e,n,o,c){if(e.value===void 0)return new Le(this,{kind:"constant",value:void 0},n);if(e.expression.kind==="constant"){const d=e.expression.evaluate(n,null,{},o,c),f=e.property.specification.type==="resolvedImage"&&typeof d!="string"?d.name:d,g=this._calculate(f,f,f,n);return new Le(this,{kind:"constant",value:g},n)}if(e.expression.kind==="camera"){const d=this._calculate(e.expression.evaluate({zoom:n.zoom-1}),e.expression.evaluate({zoom:n.zoom}),e.expression.evaluate({zoom:n.zoom+1}),n);return new Le(this,{kind:"constant",value:d},n)}return new Le(this,e.expression,n)}evaluate(e,n,o,c,d,f){if(e.kind==="source"){const g=e.evaluate(n,o,c,d,f);return this._calculate(g,g,g,n)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(n.zoom)-1},o,c),e.evaluate({zoom:Math.floor(n.zoom)},o,c),e.evaluate({zoom:Math.floor(n.zoom)+1},o,c),n):e.value}_calculate(e,n,o,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:n,other:o}:{from:o,to:n,other:e}}interpolate(e){return e}}class qe{constructor(e){this.specification=e}possiblyEvaluate(e,n,o,c){if(e.value!==void 0){if(e.expression.kind==="constant"){const d=e.expression.evaluate(n,null,{},o,c);return this._calculate(d,d,d,n)}return this._calculate(e.expression.evaluate(new Q(Math.floor(n.zoom-1),n)),e.expression.evaluate(new Q(Math.floor(n.zoom),n)),e.expression.evaluate(new Q(Math.floor(n.zoom+1),n)),n)}}_calculate(e,n,o,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:o,to:n}}interpolate(e){return e}}class Ye{constructor(e){this.specification=e}possiblyEvaluate(e,n,o,c){return!!e.expression.evaluate(n,null,{},o,c)}interpolate(){return!1}}class We{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const n=new Q(0,{});for(const o in e){const c=e[o];c.specification.overridable&&this.overridableProperties.push(o);const d=this.defaultPropertyValues[o]=new se(c,void 0),f=this.defaultTransitionablePropertyValues[o]=new xe(c);this.defaultTransitioningPropertyValues[o]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=d.possiblyEvaluate(n)}}}function at(t,e){return 256*(t=Ot(Math.floor(t),0,255))+Ot(Math.floor(e),0,255)}rt(pe,"DataDrivenProperty"),rt(ve,"DataConstantProperty"),rt(Ke,"CrossFadedDataDrivenProperty"),rt(qe,"CrossFadedProperty"),rt(Ye,"ColorRampProperty");const wt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class yt{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ut{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Xe(t,e=1){let n=0,o=0;return{members:t.map(c=>{const d=wt[c.type].BYTES_PER_ELEMENT,f=n=Mt(n,Math.max(e,d)),g=c.components||1;return o=Math.max(o,d),n+=d*g,{name:c.name,type:c.type,components:g,offset:f}}),size:Mt(n,Math.max(o,e)),alignment:e}}function Mt(t,e){return Math.ceil(t/e)*e}class Dt extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const c=2*e;return this.int16[c+0]=n,this.int16[c+1]=o,e}}Dt.prototype.bytesPerElement=4,rt(Dt,"StructArrayLayout2i4");class nn extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){const d=3*e;return this.int16[d+0]=n,this.int16[d+1]=o,this.int16[d+2]=c,e}}nn.prototype.bytesPerElement=6,rt(nn,"StructArrayLayout3i6");class rn extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,o,c)}emplace(e,n,o,c,d){const f=4*e;return this.int16[f+0]=n,this.int16[f+1]=o,this.int16[f+2]=c,this.int16[f+3]=d,e}}rn.prototype.bytesPerElement=8,rt(rn,"StructArrayLayout4i8");class Jt extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,d,f,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,o,c,d,f,g)}emplace(e,n,o,c,d,f,g,x){const w=6*e,E=12*e,M=3*e;return this.int16[w+0]=n,this.int16[w+1]=o,this.uint8[E+4]=c,this.uint8[E+5]=d,this.uint8[E+6]=f,this.uint8[E+7]=g,this.float32[M+2]=x,e}}Jt.prototype.bytesPerElement=12,rt(Jt,"StructArrayLayout2i4ub1f12");class Gn extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,o,c)}emplace(e,n,o,c,d){const f=4*e;return this.float32[f+0]=n,this.float32[f+1]=o,this.float32[f+2]=c,this.float32[f+3]=d,e}}Gn.prototype.bytesPerElement=16,rt(Gn,"StructArrayLayout4f16");class mr extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,d,f,g,x,w,E){const M=this.length;return this.resize(M+1),this.emplace(M,e,n,o,c,d,f,g,x,w,E)}emplace(e,n,o,c,d,f,g,x,w,E,M){const A=10*e;return this.uint16[A+0]=n,this.uint16[A+1]=o,this.uint16[A+2]=c,this.uint16[A+3]=d,this.uint16[A+4]=f,this.uint16[A+5]=g,this.uint16[A+6]=x,this.uint16[A+7]=w,this.uint16[A+8]=E,this.uint16[A+9]=M,e}}mr.prototype.bytesPerElement=20,rt(mr,"StructArrayLayout10ui20");class Mi extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,d,f,g,x){const w=this.length;return this.resize(w+1),this.emplace(w,e,n,o,c,d,f,g,x)}emplace(e,n,o,c,d,f,g,x,w){const E=8*e;return this.uint16[E+0]=n,this.uint16[E+1]=o,this.uint16[E+2]=c,this.uint16[E+3]=d,this.uint16[E+4]=f,this.uint16[E+5]=g,this.uint16[E+6]=x,this.uint16[E+7]=w,e}}Mi.prototype.bytesPerElement=16,rt(Mi,"StructArrayLayout8ui16");class pn extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,d,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,o,c,d,f)}emplace(e,n,o,c,d,f,g){const x=6*e;return this.int16[x+0]=n,this.int16[x+1]=o,this.int16[x+2]=c,this.int16[x+3]=d,this.int16[x+4]=f,this.int16[x+5]=g,e}}pn.prototype.bytesPerElement=12,rt(pn,"StructArrayLayout6i12");class vn extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,d,f,g,x,w,E,M,A){const P=this.length;return this.resize(P+1),this.emplace(P,e,n,o,c,d,f,g,x,w,E,M,A)}emplace(e,n,o,c,d,f,g,x,w,E,M,A,P){const D=12*e;return this.int16[D+0]=n,this.int16[D+1]=o,this.int16[D+2]=c,this.int16[D+3]=d,this.uint16[D+4]=f,this.uint16[D+5]=g,this.uint16[D+6]=x,this.uint16[D+7]=w,this.int16[D+8]=E,this.int16[D+9]=M,this.int16[D+10]=A,this.int16[D+11]=P,e}}vn.prototype.bytesPerElement=24,rt(vn,"StructArrayLayout4i4ui4i24");class Yt extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,d,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,o,c,d,f)}emplace(e,n,o,c,d,f,g){const x=10*e,w=5*e;return this.int16[x+0]=n,this.int16[x+1]=o,this.int16[x+2]=c,this.float32[w+2]=d,this.float32[w+3]=f,this.float32[w+4]=g,e}}Yt.prototype.bytesPerElement=20,rt(Yt,"StructArrayLayout3i3f20");class Pn extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}Pn.prototype.bytesPerElement=4,rt(Pn,"StructArrayLayout1ul4");class sr extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,d,f,g,x,w,E,M,A,P){const D=this.length;return this.resize(D+1),this.emplace(D,e,n,o,c,d,f,g,x,w,E,M,A,P)}emplace(e,n,o,c,d,f,g,x,w,E,M,A,P,D){const O=20*e,N=10*e;return this.int16[O+0]=n,this.int16[O+1]=o,this.int16[O+2]=c,this.int16[O+3]=d,this.int16[O+4]=f,this.float32[N+3]=g,this.float32[N+4]=x,this.float32[N+5]=w,this.float32[N+6]=E,this.int16[O+14]=M,this.uint32[N+8]=A,this.uint16[O+18]=P,this.uint16[O+19]=D,e}}sr.prototype.bytesPerElement=40,rt(sr,"StructArrayLayout5i4f1i1ul2ui40");class cn extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,d,f,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,o,c,d,f,g)}emplace(e,n,o,c,d,f,g,x){const w=8*e;return this.int16[w+0]=n,this.int16[w+1]=o,this.int16[w+2]=c,this.int16[w+4]=d,this.int16[w+5]=f,this.int16[w+6]=g,this.int16[w+7]=x,e}}cn.prototype.bytesPerElement=16,rt(cn,"StructArrayLayout3i2i2i16");class Cr extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,o,c,d)}emplace(e,n,o,c,d,f){const g=4*e,x=8*e;return this.float32[g+0]=n,this.float32[g+1]=o,this.float32[g+2]=c,this.int16[x+6]=d,this.int16[x+7]=f,e}}Cr.prototype.bytesPerElement=16,rt(Cr,"StructArrayLayout2f1f2i16");class Xo extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,o,c)}emplace(e,n,o,c,d){const f=12*e,g=3*e;return this.uint8[f+0]=n,this.uint8[f+1]=o,this.float32[g+1]=c,this.float32[g+2]=d,e}}Xo.prototype.bytesPerElement=12,rt(Xo,"StructArrayLayout2ub2f12");class ai extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){const d=3*e;return this.float32[d+0]=n,this.float32[d+1]=o,this.float32[d+2]=c,e}}ai.prototype.bytesPerElement=12,rt(ai,"StructArrayLayout3f12");class _r extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){const d=3*e;return this.uint16[d+0]=n,this.uint16[d+1]=o,this.uint16[d+2]=c,e}}_r.prototype.bytesPerElement=6,rt(_r,"StructArrayLayout3ui6");class js extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,d,f,g,x,w,E,M,A,P,D,O,N,J,re,K,te,ce){const oe=this.length;return this.resize(oe+1),this.emplace(oe,e,n,o,c,d,f,g,x,w,E,M,A,P,D,O,N,J,re,K,te,ce)}emplace(e,n,o,c,d,f,g,x,w,E,M,A,P,D,O,N,J,re,K,te,ce,oe){const Se=30*e,Te=15*e,ke=60*e;return this.int16[Se+0]=n,this.int16[Se+1]=o,this.int16[Se+2]=c,this.float32[Te+2]=d,this.float32[Te+3]=f,this.uint16[Se+8]=g,this.uint16[Se+9]=x,this.uint32[Te+5]=w,this.uint32[Te+6]=E,this.uint32[Te+7]=M,this.uint16[Se+16]=A,this.uint16[Se+17]=P,this.uint16[Se+18]=D,this.float32[Te+10]=O,this.float32[Te+11]=N,this.uint8[ke+48]=J,this.uint8[ke+49]=re,this.uint8[ke+50]=K,this.uint32[Te+13]=te,this.int16[Se+28]=ce,this.uint8[ke+58]=oe,e}}js.prototype.bytesPerElement=60,rt(js,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class bo extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,d,f,g,x,w,E,M,A,P,D,O,N,J,re,K,te,ce,oe,Se,Te,ke,$e,Ae,Re,Be,Ne){const Ze=this.length;return this.resize(Ze+1),this.emplace(Ze,e,n,o,c,d,f,g,x,w,E,M,A,P,D,O,N,J,re,K,te,ce,oe,Se,Te,ke,$e,Ae,Re,Be,Ne)}emplace(e,n,o,c,d,f,g,x,w,E,M,A,P,D,O,N,J,re,K,te,ce,oe,Se,Te,ke,$e,Ae,Re,Be,Ne,Ze){const Pe=38*e,it=19*e;return this.int16[Pe+0]=n,this.int16[Pe+1]=o,this.int16[Pe+2]=c,this.float32[it+2]=d,this.float32[it+3]=f,this.int16[Pe+8]=g,this.int16[Pe+9]=x,this.int16[Pe+10]=w,this.int16[Pe+11]=E,this.int16[Pe+12]=M,this.int16[Pe+13]=A,this.uint16[Pe+14]=P,this.uint16[Pe+15]=D,this.uint16[Pe+16]=O,this.uint16[Pe+17]=N,this.uint16[Pe+18]=J,this.uint16[Pe+19]=re,this.uint16[Pe+20]=K,this.uint16[Pe+21]=te,this.uint16[Pe+22]=ce,this.uint16[Pe+23]=oe,this.uint16[Pe+24]=Se,this.uint16[Pe+25]=Te,this.uint16[Pe+26]=ke,this.uint16[Pe+27]=$e,this.uint16[Pe+28]=Ae,this.uint32[it+15]=Re,this.float32[it+16]=Be,this.float32[it+17]=Ne,this.float32[it+18]=Ze,e}}bo.prototype.bytesPerElement=76,rt(bo,"StructArrayLayout3i2f6i15ui1ul3f76");class Yn extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}Yn.prototype.bytesPerElement=4,rt(Yn,"StructArrayLayout1f4");class Ai extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,o,c,d)}emplace(e,n,o,c,d,f){const g=5*e;return this.float32[g+0]=n,this.float32[g+1]=o,this.float32[g+2]=c,this.float32[g+3]=d,this.float32[g+4]=f,e}}Ai.prototype.bytesPerElement=20,rt(Ai,"StructArrayLayout5f20");class To extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,o,c)}emplace(e,n,o,c,d){const f=6*e;return this.uint32[3*e+0]=n,this.uint16[f+2]=o,this.uint16[f+3]=c,this.uint16[f+4]=d,e}}To.prototype.bytesPerElement=12,rt(To,"StructArrayLayout1ul3ui12");class li extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const c=2*e;return this.uint16[c+0]=n,this.uint16[c+1]=o,e}}li.prototype.bytesPerElement=4,rt(li,"StructArrayLayout2ui4");class ih extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}ih.prototype.bytesPerElement=2,rt(ih,"StructArrayLayout1ui2");class Pp extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const c=2*e;return this.float32[c+0]=n,this.float32[c+1]=o,e}}Pp.prototype.bytesPerElement=8,rt(Pp,"StructArrayLayout2f8");class O0 extends yt{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}O0.prototype.size=12;class F0 extends pn{get(e){return new O0(this,e)}}rt(F0,"FillExtrusionExtArray");class U0 extends yt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}U0.prototype.size=40;class i_ extends sr{get(e){return new U0(this,e)}}rt(i_,"CollisionBoxArray");class N0 extends yt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}N0.prototype.size=60;class j0 extends js{get(e){return new N0(this,e)}}rt(j0,"PlacedSymbolArray");class V0 extends yt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}V0.prototype.size=76;class G0 extends bo{get(e){return new V0(this,e)}}rt(G0,"SymbolInstanceArray");class $0 extends Yn{getoffsetX(e){return this.float32[1*e+0]}}rt($0,"GlyphOffsetArray");class Z0 extends nn{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}rt(Z0,"SymbolLineVertexArray");class q0 extends yt{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}q0.prototype.size=12;class W0 extends To{get(e){return new q0(this,e)}}rt(W0,"FeatureIndexArray");class X0 extends yt{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}X0.prototype.size=4;class H0 extends li{get(e){return new X0(this,e)}}rt(H0,"FillExtrusionCentroidArray");class Y0 extends yt{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}Y0.prototype.size=12;class K0 extends pn{get(e){return new Y0(this,e)}}rt(K0,"CircleGlobeExtArray");const ST=Xe([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),CT=Xe([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var hc={exports:{}},J0={exports:{}};J0.exports=function(t,e){var n,o,c,d,f,g,x,w;for(o=t.length-(n=3&t.length),c=e,f=3432918353,g=461845907,w=0;w<o;)x=255&t.charCodeAt(w)|(255&t.charCodeAt(++w))<<8|(255&t.charCodeAt(++w))<<16|(255&t.charCodeAt(++w))<<24,++w,c=27492+(65535&(d=5*(65535&(c=(c^=x=(65535&(x=(x=(65535&x)*f+(((x>>>16)*f&65535)<<16)&4294967295)<<15|x>>>17))*g+(((x>>>16)*g&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(d>>>16)&65535)<<16);switch(x=0,n){case 3:x^=(255&t.charCodeAt(w+2))<<16;case 2:x^=(255&t.charCodeAt(w+1))<<8;case 1:c^=x=(65535&(x=(x=(65535&(x^=255&t.charCodeAt(w)))*f+(((x>>>16)*f&65535)<<16)&4294967295)<<15|x>>>17))*g+(((x>>>16)*g&65535)<<16)&4294967295}return c^=t.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0};var Q0={exports:{}};Q0.exports=function(t,e){for(var n,o=t.length,c=e^o,d=0;o>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(d)|(255&t.charCodeAt(++d))<<8|(255&t.charCodeAt(++d))<<16|(255&t.charCodeAt(++d))<<24))+((1540483477*(n>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),o-=4,++d;switch(o){case 3:c^=(255&t.charCodeAt(d+2))<<16;case 2:c^=(255&t.charCodeAt(d+1))<<8;case 1:c=1540483477*(65535&(c^=255&t.charCodeAt(d)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0};var ex=J0.exports,MT=Q0.exports;hc.exports=ex,hc.exports.murmur3=ex,hc.exports.murmur2=MT;class Dp{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,o,c){this.ids.push(tx(e)),this.positions.push(n,o,c)}getPositions(e){const n=tx(e);let o=0,c=this.ids.length-1;for(;o<c;){const f=o+c>>1;this.ids[f]>=n?c=f:o=f+1}const d=[];for(;this.ids[o]===n;)d.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return d}static serialize(e,n){const o=new Float64Array(e.ids),c=new Uint32Array(e.positions);return o_(o,c,0,o.length-1),n&&n.push(o.buffer,c.buffer),{ids:o,positions:c}}static deserialize(e){const n=new Dp;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function tx(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:hc.exports(String(t))}function o_(t,e,n,o){for(;n<o;){const c=t[n+o>>1];let d=n-1,f=o+1;for(;;){do d++;while(t[d]<c);do f--;while(t[f]>c);if(d>=f)break;Lp(t,d,f),Lp(e,3*d,3*f),Lp(e,3*d+1,3*f+1),Lp(e,3*d+2,3*f+2)}f-n<o-f?(o_(t,e,n,f),n=f+1):(o_(t,e,f+1,o),o=f)}}function Lp(t,e,n){const o=t[e];t[e]=t[n],t[n]=o}rt(Dp,"FeaturePositionMap");class Ho{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}}class Rp extends Ho{constructor(e){super(e),this.current=0}set(e,n,o){this.fetchUniformLocation(e,n)&&this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class nx extends Ho{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,o){this.fetchUniformLocation(e,n)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3])))}}class rx extends Ho{constructor(e){super(e),this.current=An.transparent}set(e,n,o){this.fetchUniformLocation(e,n)&&(o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a)))}}const AT=new Float32Array(16),IT=new Float32Array(9),zT=new Float32Array(4);function s_(t){return[at(255*t.r,255*t.g),at(255*t.b,255*t.a)]}class oh{constructor(e,n,o){this.value=e,this.uniformNames=n.map(c=>`u_${c}`),this.type=o}setUniform(e,n,o,c,d){n.set(e,d,c.constantOr(this.value))}getBinding(e,n){return this.type==="color"?new rx(e):new Rp(e)}}class dc{constructor(e,n){this.uniformNames=n.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,n){this.pixelRatioFrom=n.pixelRatio||1,this.pixelRatioTo=e.pixelRatio||1,this.patternFrom=n.tl.concat(n.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,n,o,c,d){const f=d==="u_pattern_to"||d==="u_dash_to"?this.patternTo:d==="u_pattern_from"||d==="u_dash_from"?this.patternFrom:d==="u_pixel_ratio_to"?this.pixelRatioTo:d==="u_pixel_ratio_from"?this.pixelRatioFrom:null;f&&n.set(e,d,f)}getBinding(e,n){return n==="u_pattern_from"||n==="u_pattern_to"||n==="u_dash_from"||n==="u_dash_to"?new nx(e):new Rp(e)}}class Yo{constructor(e,n,o,c){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=n.map(d=>({name:`a_${d}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,n,o,c,d,f){const g=this.paintVertexArray.length,x=this.expression.evaluate(new Q(0),n,{},d,c,f);this.paintVertexArray.resize(e),this._setPaintValue(g,e,x)}updatePaintArray(e,n,o,c,d){const f=this.expression.evaluate({zoom:0},o,c,void 0,d);this._setPaintValue(e,n,f)}_setPaintValue(e,n,o){if(this.type==="color"){const c=s_(o);for(let d=e;d<n;d++)this.paintVertexArray.emplace(d,c[0],c[1])}else{for(let c=e;c<n;c++)this.paintVertexArray.emplace(c,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Xi{constructor(e,n,o,c,d,f){this.expression=e,this.uniformNames=n.map(g=>`u_${g}_t`),this.type=o,this.useIntegerZoom=c,this.zoom=d,this.maxValue=0,this.paintVertexAttributes=n.map(g=>({name:`a_${g}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,n,o,c,d,f){const g=this.expression.evaluate(new Q(this.zoom),n,{},d,c,f),x=this.expression.evaluate(new Q(this.zoom+1),n,{},d,c,f),w=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(w,e,g,x)}updatePaintArray(e,n,o,c,d){const f=this.expression.evaluate({zoom:this.zoom},o,c,void 0,d),g=this.expression.evaluate({zoom:this.zoom+1},o,c,void 0,d);this._setPaintValue(e,n,f,g)}_setPaintValue(e,n,o,c){if(this.type==="color"){const d=s_(o),f=s_(c);for(let g=e;g<n;g++)this.paintVertexArray.emplace(g,d[0],d[1],f[0],f[1])}else{for(let d=e;d<n;d++)this.paintVertexArray.emplace(d,o,c);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,o,c,d){const f=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,g=Ot(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);n.set(e,d,g)}getBinding(e,n){return new Rp(e)}}class Vs{constructor(e,n,o,c,d,f,g){this.expression=e,this.type=o,this.useIntegerZoom=c,this.zoom=d,this.layerId=g,this.paintVertexAttributes=(o==="array"?CT:ST).members;for(let x=0;x<n.length;++x);this.zoomInPaintVertexArray=new f,this.zoomOutPaintVertexArray=new f}populatePaintArray(e,n,o){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(c,e,n.patterns&&n.patterns[this.layerId],o)}updatePaintArray(e,n,o,c,d,f){this._setPaintValues(e,n,o.patterns&&o.patterns[this.layerId],f)}_setPaintValues(e,n,o,c){if(!c||!o)return;const{min:d,mid:f,max:g}=o,x=c[d],w=c[f],E=c[g];if(x&&w&&E)for(let M=e;M<n;M++)this._setPaintValue(this.zoomInPaintVertexArray,M,w,x),this._setPaintValue(this.zoomOutPaintVertexArray,M,w,E)}_setPaintValue(e,n,o,c){e.emplace(n,o.tl[0],o.tl[1],o.br[0],o.br[1],c.tl[0],c.tl[1],c.br[0],c.br[1],o.pixelRatio,c.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Gs{constructor(e,n,o=()=>!0){this.binders={},this._buffers=[];const c=[];for(const d in e.paint._values){if(!o(d))continue;const f=e.paint.get(d);if(!(f instanceof Le&&Fs(f.property.specification)))continue;const g=PT(d,e.type),x=f.value,w=f.property.specification.type,E=f.property.useIntegerZoom,M=f.property.specification["property-type"],A=M==="cross-faded"||M==="cross-faded-data-driven",P=String(d)==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(x.kind!=="constant"||P)if(x.kind==="source"||P||A){const D=ix(d,w,"source");this.binders[d]=A?new Vs(x,g,w,E,n,D,e.id):new Yo(x,g,w,D),c.push(`/a_${d}`)}else{const D=ix(d,w,"composite");this.binders[d]=new Xi(x,g,w,E,n,D),c.push(`/z_${d}`)}else this.binders[d]=A?new dc(x.value,g):new oh(x.value,g,w),c.push(`/u_${d}`)}this.cacheKey=c.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof Yo||n instanceof Xi?n.maxValue:0}populatePaintArrays(e,n,o,c,d,f){for(const g in this.binders){const x=this.binders[g];(x instanceof Yo||x instanceof Xi||x instanceof Vs)&&x.populatePaintArray(e,n,o,c,d,f)}}setConstantPatternPositions(e,n){for(const o in this.binders){const c=this.binders[o];c instanceof dc&&c.setConstantPatternPositions(e,n)}}updatePaintArrays(e,n,o,c,d,f){let g=!1;for(const x in e){const w=n.getPositions(x);for(const E of w){const M=o.feature(E.index);for(const A in this.binders){const P=this.binders[A];if((P instanceof Yo||P instanceof Xi||P instanceof Vs)&&P.expression.isStateDependent===!0){const D=c.paint.get(A);P.expression=D.value,P.updatePaintArray(E.start,E.end,M,e[x],d,f),g=!0}}}}return g}defines(){const e=[];for(const n in this.binders){const o=this.binders[n];(o instanceof oh||o instanceof dc)&&e.push(...o.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof Yo||o instanceof Xi||o instanceof Vs)for(let c=0;c<o.paintVertexAttributes.length;c++)e.push(o.paintVertexAttributes[c].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof oh||o instanceof dc||o instanceof Xi)for(const c of o.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const n=[];for(const o in this.binders){const c=this.binders[o];if(c instanceof oh||c instanceof dc||c instanceof Xi)for(const d of c.uniformNames)n.push({name:d,property:o,binding:c.getBinding(e,d)})}return n}setUniforms(e,n,o,c,d){for(const{name:f,property:g,binding:x}of o)this.binders[g].setUniform(e,x,d,c.get(g),f)}updatePaintBuffers(e){this._buffers=[];for(const n in this.binders){const o=this.binders[n];if(e&&o instanceof Vs){const c=e.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(o instanceof Yo||o instanceof Xi)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const n in this.binders){const o=this.binders[n];(o instanceof Yo||o instanceof Xi||o instanceof Vs)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof Yo||n instanceof Xi||n instanceof Vs)&&n.destroy()}}}class Ya{constructor(e,n,o=()=>!0){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new Gs(c,n,o);this.needsUpload=!1,this._featureMap=new Dp,this._bufferOffset=0}populatePaintArrays(e,n,o,c,d,f,g){for(const x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(e,n,c,d,f,g);n.id!==void 0&&this._featureMap.add(n.id,o,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,o,c,d){for(const f of o)this.needsUpload=this.programConfigurations[f.id].updatePaintArrays(e,this._featureMap,n,f,c,d)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const kT={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function PT(t,e){return kT[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const DT={"line-pattern":{source:mr,composite:mr},"fill-pattern":{source:mr,composite:mr},"fill-extrusion-pattern":{source:mr,composite:mr},"line-dasharray":{source:Mi,composite:Mi}},LT={color:{source:Pp,composite:Gn},number:{source:Yn,composite:Pp}};function ix(t,e,n){const o=DT[t];return o&&o[n]||LT[e][n]}rt(oh,"ConstantBinder"),rt(dc,"CrossFadedConstantBinder"),rt(Yo,"SourceExpressionBinder"),rt(Vs,"CrossFadedCompositeBinder"),rt(Xi,"CompositeExpressionBinder"),rt(Gs,"ProgramConfiguration",{omit:["_buffers"]}),rt(Ya,"ProgramConfigurationSet");const Bp="-transition";class Hi extends Ni{constructor(e,n){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new fe(n.layout)),n.paint)){this._transitionablePaint=new Ce(n.paint);for(const o in e.paint)this.setPaintProperty(o,e.paint[o],{validate:!1});for(const o in e.layout)this.setLayoutProperty(o,e.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new De(n.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n,o={}){n!=null&&this._validate(r_,`layers.${this.id}.layout.${e}`,e,n,o)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,n):this.visibility=n)}getPaintProperty(e){return Xn(e,Bp)?this._transitionablePaint.getTransition(e.slice(0,-Bp.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,o={}){if(n!=null&&this._validate(n_,`layers.${this.id}.paint.${e}`,e,n,o))return!1;if(Xn(e,Bp))return this._transitionablePaint.setTransition(e.slice(0,-Bp.length),n||void 0),!1;{const c=this._transitionablePaint._values[e],d=c.property.specification["property-type"]==="cross-faded-data-driven",f=c.value.isDataDriven(),g=c.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);const x=this._transitionablePaint._values[e].value;return x.isDataDriven()||f||d||this._handleOverridablePaintPropertyUpdate(e,g,x)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,n,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),va(e,(n,o)=>!(n===void 0||o==="layout"&&!Object.keys(n).length||o==="paint"&&!Object.keys(n).length))}_validate(e,n,o,c,d={}){return(!d||d.validate!==!1)&&Ju(this,e.call(gp,{key:n,layerType:this.type,objectKey:o,value:c,styleSpec:ze,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof Le&&Fs(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Jl(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const RT=Xe([{name:"a_pos",components:2,type:"Int16"}],4),BT=Xe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Un{constructor(e=[]){this.segments=e}prepareSegment(e,n,o,c){let d=this.segments[this.segments.length-1];return e>Un.MAX_VERTEX_ARRAY_LENGTH&&Tn(`Max vertices per segment is ${Un.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!d||d.vertexLength+e>Un.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==c)&&(d={vertexOffset:n.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0},c!==void 0&&(d.sortKey=c),this.segments.push(d)),d}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,o,c){return new Un([{vertexOffset:e,primitiveOffset:n,vertexLength:o,primitiveLength:c,vaos:{},sortKey:0}])}}Un.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,rt(Un,"SegmentVector");var Et=8192;class $s{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Ht?new Ht(e.lng,e.lat):Ht.convert(e),this}setSouthWest(e){return this._sw=e instanceof Ht?new Ht(e.lng,e.lat):Ht.convert(e),this}extend(e){const n=this._sw,o=this._ne;let c,d;if(e instanceof Ht)c=e,d=e;else{if(!(e instanceof $s))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend($s.convert(e)):this.extend(Ht.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&e.hasOwnProperty("lon")?this.extend(Ht.convert(e)):this;if(c=e._sw,d=e._ne,!c||!d)return this}return n||o?(n.lng=Math.min(c.lng,n.lng),n.lat=Math.min(c.lat,n.lat),o.lng=Math.max(d.lng,o.lng),o.lat=Math.max(d.lat,o.lat)):(this._sw=new Ht(c.lng,c.lat),this._ne=new Ht(d.lng,d.lat)),this}getCenter(){return new Ht((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ht(this.getWest(),this.getNorth())}getSouthEast(){return new Ht(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:o}=Ht.convert(e);let c=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&c}static convert(e){return!e||e instanceof $s?e:new $s(e)}}const Op=63710088e-1;class Ht{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ht(ei(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,o=this.lat*n,c=e.lat*n,d=Math.sin(o)*Math.sin(c)+Math.cos(o)*Math.cos(c)*Math.cos((e.lng-this.lng)*n);return Op*Math.acos(Math.min(d,1))}toBounds(e=0){const n=360*e/40075017,o=n/Math.cos(Math.PI/180*this.lat);return new $s(new Ht(this.lng-o,this.lat-n),new Ht(this.lng+o,this.lat+n))}static convert(e){if(e instanceof Ht)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Ht(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Ht(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const ox=2*Math.PI*Op;function a_(t){return ox*Math.cos(t*Math.PI/180)}function Eo(t){return(180+t)/360}function So(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Ii(t,e){return t/a_(e)}function ci(t){return 360*t-180}function ar(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function sx(t,e){return t*a_(ar(e))}const Co=85.051129;function ax(t){return 1/Math.cos(t*Math.PI/180)}class pc{constructor(e,n,o=0){this.x=+e,this.y=+n,this.z=+o}static fromLngLat(e,n=0){const o=Ht.convert(e);return new pc(Eo(o.lng),So(o.lat),Ii(n,o.lat))}toLngLat(){return new Ht(ci(this.x),ar(this.y))}toAltitude(){return sx(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ox*ax(ar(this.y))}}function l_(t,e,n,o,c,d,f,g,x){const w=(e+o)/2,E=(n+c)/2,M=new Me(w,E);g(M),function(A,P,D,O,N,J){const re=D-N,K=O-J;return Math.abs((O-P)*re-(D-A)*K)/Math.hypot(re,K)}(M.x,M.y,d.x,d.y,f.x,f.y)>=x?(l_(t,e,n,w,E,d,M,g,x),l_(t,w,E,o,c,M,f,g,x)):t.push(f)}function lx(t,e,n){let o=t[0],c=o.x,d=o.y;e(o);const f=[o];for(let g=1;g<t.length;g++){const x=t[g],{x:w,y:E}=x;e(x),l_(f,c,d,w,E,o,x,e,n),c=w,d=E,o=x}return f}function c_(t,e,n,o){if(o(e,n)){const c=e.add(n)._mult(.5);c_(t,e,c,o),c_(t,c,n,o)}else t.push(n)}function OT(t,e){let n=t[0];const o=[n];for(let c=1;c<t.length;c++){const d=t[c];c_(o,n,d,e),n=d}return o}const u_=Math.pow(2,14)-1,cx=-u_-1;function FT(t,e){const n=Math.round(t.x*e),o=Math.round(t.y*e);return t.x=Ot(n,cx,u_),t.y=Ot(o,cx,u_),(n<t.x||n>t.x+1||o<t.y||o>t.y+1)&&Tn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function Ko(t,e,n){const o=t.loadGeometry(),c=t.extent,d=Et/c;if(e&&n&&n.projection.isReprojectedInTileSpace){const f=1<<e.z,{scale:g,x,y:w,projection:E}=n,M=A=>{const P=ci((e.x+A.x/c)/f),D=ar((e.y+A.y/c)/f),O=E.project(P,D);A.x=(O.x*g-x)*c,A.y=(O.y*g-w)*c};for(let A=0;A<o.length;A++)if(t.type!==1)o[A]=lx(o[A],M,1);else{const P=[];for(const D of o[A])D.x<0||D.x>=c||D.y<0||D.y>=c||(M(D),P.push(D));o[A]=P}}for(const f of o)for(const g of f)FT(g,d);return o}function Ka(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Ko(t):[]}}function Fp(t,e,n,o,c){t.emplaceBack(2*e+(o+1)/2,2*n+(c+1)/2)}function Up(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class h_{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Dt,this.indexArray=new _r,this.segments=new Un,this.programConfigurations=new Ya(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,o,c){const d=this.layers[0],f=[];let g=null;d.type==="circle"&&(g=d.layout.get("circle-sort-key"));for(const{feature:w,id:E,index:M,sourceLayerIndex:A}of e){const P=this.layers[0]._featureFilter.needGeometry,D=Ka(w,P);if(!this.layers[0]._featureFilter.filter(new Q(this.zoom),D,o))continue;const O=g?g.evaluate(D,{},o):void 0,N={id:E,properties:w.properties,type:w.type,sourceLayerIndex:A,index:M,geometry:P?D.geometry:Ko(w,o,c),patterns:{},sortKey:O};f.push(N)}g&&f.sort((w,E)=>w.sortKey-E.sortKey);let x=null;c.projection.name==="globe"&&(this.globeExtVertexArray=new K0,x=c.projection);for(const w of f){const{geometry:E,index:M,sourceLayerIndex:A}=w,P=e[M].feature;this.addFeature(w,E,M,n.availableImages,o,x),n.featureIndex.insert(P,E,M,A,this.index)}}update(e,n,o,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,o,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,RT.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,BT.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,o,c,d,f){for(const g of n)for(const x of g){const w=x.x,E=x.y;if(w<0||w>=Et||E<0||E>=Et)continue;if(f){const P=f.projectTilePoint(w,E,d),D=f.upVector(d,w,E),O=this.globeExtVertexArray;Up(O,P,D),Up(O,P,D),Up(O,P,D),Up(O,P,D)}const M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),A=M.vertexLength;Fp(this.layoutVertexArray,w,E,-1,-1),Fp(this.layoutVertexArray,w,E,1,-1),Fp(this.layoutVertexArray,w,E,1,1),Fp(this.layoutVertexArray,w,E,-1,1),this.indexArray.emplaceBack(A,A+1,A+2),this.indexArray.emplaceBack(A,A+2,A+3),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},c,d)}}function ux(t,e){for(let n=0;n<t.length;n++)if(Ja(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Ja(t,e[n]))return!0;return!!d_(t,e)}function UT(t,e,n){return!!Ja(t,e)||!!p_(e,t,n)}function hx(t,e){if(t.length===1)return px(e,t[0]);for(let n=0;n<e.length;n++){const o=e[n];for(let c=0;c<o.length;c++)if(Ja(t,o[c]))return!0}for(let n=0;n<t.length;n++)if(px(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(d_(t,e[n]))return!0;return!1}function NT(t,e,n){if(t.length>1){if(d_(t,e))return!0;for(let o=0;o<e.length;o++)if(p_(e[o],t,n))return!0}for(let o=0;o<t.length;o++)if(p_(t[o],e,n))return!0;return!1}function d_(t,e){if(t.length===0||e.length===0)return!1;for(let n=0;n<t.length-1;n++){const o=t[n],c=t[n+1];for(let d=0;d<e.length-1;d++)if(jT(o,c,e[d],e[d+1]))return!0}return!1}function jT(t,e,n,o){return ni(t,n,o)!==ni(e,n,o)&&ni(t,e,n)!==ni(t,e,o)}function p_(t,e,n){const o=n*n;if(e.length===1)return t.distSqr(e[0])<o;for(let c=1;c<e.length;c++)if(dx(t,e[c-1],e[c])<o)return!0;return!1}function dx(t,e,n){const o=e.distSqr(n);if(o===0)return t.distSqr(e);const c=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/o;return t.distSqr(c<0?e:c>1?n:n.sub(e)._mult(c)._add(e))}function px(t,e){let n,o,c,d=!1;for(let f=0;f<t.length;f++){n=t[f];for(let g=0,x=n.length-1;g<n.length;x=g++)o=n[g],c=n[x],o.y>e.y!=c.y>e.y&&e.x<(c.x-o.x)*(e.y-o.y)/(c.y-o.y)+o.x&&(d=!d)}return d}function Ja(t,e){let n=!1;for(let o=0,c=t.length-1;o<t.length;c=o++){const d=t[o],f=t[c];d.y>e.y!=f.y>e.y&&e.x<(f.x-d.x)*(e.y-d.y)/(f.y-d.y)+d.x&&(n=!n)}return n}function fx(t,e,n,o,c){for(const f of t)if(e<=f.x&&n<=f.y&&o>=f.x&&c>=f.y)return!0;const d=[new Me(e,n),new Me(e,c),new Me(o,c),new Me(o,n)];if(t.length>2){for(const f of d)if(Ja(t,f))return!0}for(let f=0;f<t.length-1;f++)if(VT(t[f],t[f+1],d))return!0;return!1}function VT(t,e,n){const o=n[0],c=n[2];if(t.x<o.x&&e.x<o.x||t.x>c.x&&e.x>c.x||t.y<o.y&&e.y<o.y||t.y>c.y&&e.y>c.y)return!1;const d=ni(t,e,n[0]);return d!==ni(t,e,n[1])||d!==ni(t,e,n[2])||d!==ni(t,e,n[3])}function fc(t,e,n){const o=e.paint.get(t).value;return o.kind==="constant"?o.value:n.programConfigurations.get(e.id).getMaxValue(t)}function Np(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function mx(t,e,n,o,c){if(!e[0]&&!e[1])return t;const d=Me.convert(e)._mult(c);n==="viewport"&&d._rotate(-o);const f=[];for(let g=0;g<t.length;g++)f.push(t[g].sub(d));return f}function _x(t,e,n,o){const c=Me.convert(t)._mult(o);return e==="viewport"&&c._rotate(-n),c}rt(h_,"CircleBucket",{omit:["layers"]});const GT=new We({"circle-sort-key":new pe(ze.layout_circle["circle-sort-key"])});var $T={paint:new We({"circle-radius":new pe(ze.paint_circle["circle-radius"]),"circle-color":new pe(ze.paint_circle["circle-color"]),"circle-blur":new pe(ze.paint_circle["circle-blur"]),"circle-opacity":new pe(ze.paint_circle["circle-opacity"]),"circle-translate":new ve(ze.paint_circle["circle-translate"]),"circle-translate-anchor":new ve(ze.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ve(ze.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ve(ze.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new pe(ze.paint_circle["circle-stroke-width"]),"circle-stroke-color":new pe(ze.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new pe(ze.paint_circle["circle-stroke-opacity"])}),layout:GT},jp=1e-6,$r=typeof Float32Array<"u"?Float32Array:Array;function gx(){var t=new $r(9);return $r!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function yx(t,e,n){var o=e[0],c=e[1],d=e[2],f=e[3],g=e[4],x=e[5],w=e[6],E=e[7],M=e[8],A=n[0],P=n[1],D=n[2],O=n[3],N=n[4],J=n[5],re=n[6],K=n[7],te=n[8];return t[0]=A*o+P*f+D*w,t[1]=A*c+P*g+D*E,t[2]=A*d+P*x+D*M,t[3]=O*o+N*f+J*w,t[4]=O*c+N*g+J*E,t[5]=O*d+N*x+J*M,t[6]=re*o+K*f+te*w,t[7]=re*c+K*g+te*E,t[8]=re*d+K*x+te*M,t}function Mo(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function f_(t,e){var n=e[0],o=e[1],c=e[2],d=e[3],f=e[4],g=e[5],x=e[6],w=e[7],E=e[8],M=e[9],A=e[10],P=e[11],D=e[12],O=e[13],N=e[14],J=e[15],re=n*g-o*f,K=n*x-c*f,te=n*w-d*f,ce=o*x-c*g,oe=o*w-d*g,Se=c*w-d*x,Te=E*O-M*D,ke=E*N-A*D,$e=E*J-P*D,Ae=M*N-A*O,Re=M*J-P*O,Be=A*J-P*N,Ne=re*Be-K*Re+te*Ae+ce*$e-oe*ke+Se*Te;return Ne?(t[0]=(g*Be-x*Re+w*Ae)*(Ne=1/Ne),t[1]=(c*Re-o*Be-d*Ae)*Ne,t[2]=(O*Se-N*oe+J*ce)*Ne,t[3]=(A*oe-M*Se-P*ce)*Ne,t[4]=(x*$e-f*Be-w*ke)*Ne,t[5]=(n*Be-c*$e+d*ke)*Ne,t[6]=(N*te-D*Se-J*K)*Ne,t[7]=(E*Se-A*te+P*K)*Ne,t[8]=(f*Re-g*$e+w*Te)*Ne,t[9]=(o*$e-n*Re-d*Te)*Ne,t[10]=(D*oe-O*te+J*re)*Ne,t[11]=(M*te-E*oe-P*re)*Ne,t[12]=(g*ke-f*Ae-x*Te)*Ne,t[13]=(n*Ae-o*ke+c*Te)*Ne,t[14]=(O*K-D*ce-N*re)*Ne,t[15]=(E*ce-M*K+A*re)*Ne,t):null}function mc(t,e,n){var o=e[0],c=e[1],d=e[2],f=e[3],g=e[4],x=e[5],w=e[6],E=e[7],M=e[8],A=e[9],P=e[10],D=e[11],O=e[12],N=e[13],J=e[14],re=e[15],K=n[0],te=n[1],ce=n[2],oe=n[3];return t[0]=K*o+te*g+ce*M+oe*O,t[1]=K*c+te*x+ce*A+oe*N,t[2]=K*d+te*w+ce*P+oe*J,t[3]=K*f+te*E+ce*D+oe*re,t[4]=(K=n[4])*o+(te=n[5])*g+(ce=n[6])*M+(oe=n[7])*O,t[5]=K*c+te*x+ce*A+oe*N,t[6]=K*d+te*w+ce*P+oe*J,t[7]=K*f+te*E+ce*D+oe*re,t[8]=(K=n[8])*o+(te=n[9])*g+(ce=n[10])*M+(oe=n[11])*O,t[9]=K*c+te*x+ce*A+oe*N,t[10]=K*d+te*w+ce*P+oe*J,t[11]=K*f+te*E+ce*D+oe*re,t[12]=(K=n[12])*o+(te=n[13])*g+(ce=n[14])*M+(oe=n[15])*O,t[13]=K*c+te*x+ce*A+oe*N,t[14]=K*d+te*w+ce*P+oe*J,t[15]=K*f+te*E+ce*D+oe*re,t}function sh(t,e,n){var o,c,d,f,g,x,w,E,M,A,P,D,O=n[0],N=n[1],J=n[2];return e===t?(t[12]=e[0]*O+e[4]*N+e[8]*J+e[12],t[13]=e[1]*O+e[5]*N+e[9]*J+e[13],t[14]=e[2]*O+e[6]*N+e[10]*J+e[14],t[15]=e[3]*O+e[7]*N+e[11]*J+e[15]):(c=e[1],d=e[2],f=e[3],g=e[4],x=e[5],w=e[6],E=e[7],M=e[8],A=e[9],P=e[10],D=e[11],t[0]=o=e[0],t[1]=c,t[2]=d,t[3]=f,t[4]=g,t[5]=x,t[6]=w,t[7]=E,t[8]=M,t[9]=A,t[10]=P,t[11]=D,t[12]=o*O+g*N+M*J+e[12],t[13]=c*O+x*N+A*J+e[13],t[14]=d*O+w*N+P*J+e[14],t[15]=f*O+E*N+D*J+e[15]),t}function Qa(t,e,n){var o=n[0],c=n[1],d=n[2];return t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t[3]=e[3]*o,t[4]=e[4]*c,t[5]=e[5]*c,t[6]=e[6]*c,t[7]=e[7]*c,t[8]=e[8]*d,t[9]=e[9]*d,t[10]=e[10]*d,t[11]=e[11]*d,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function m_(t,e,n){var o=Math.sin(n),c=Math.cos(n),d=e[4],f=e[5],g=e[6],x=e[7],w=e[8],E=e[9],M=e[10],A=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=d*c+w*o,t[5]=f*c+E*o,t[6]=g*c+M*o,t[7]=x*c+A*o,t[8]=w*c-d*o,t[9]=E*c-f*o,t[10]=M*c-g*o,t[11]=A*c-x*o,t}function Vp(t,e,n){var o=Math.sin(n),c=Math.cos(n),d=e[0],f=e[1],g=e[2],x=e[3],w=e[8],E=e[9],M=e[10],A=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=d*c-w*o,t[1]=f*c-E*o,t[2]=g*c-M*o,t[3]=x*c-A*o,t[8]=d*o+w*c,t[9]=f*o+E*c,t[10]=g*o+M*c,t[11]=x*o+A*c,t}function xx(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function vx(t,e,n){var o,c,d,f=n[0],g=n[1],x=n[2],w=Math.hypot(f,g,x);return w<jp?null:(f*=w=1/w,g*=w,x*=w,o=Math.sin(e),c=Math.cos(e),t[0]=f*f*(d=1-c)+c,t[1]=g*f*d+x*o,t[2]=x*f*d-g*o,t[3]=0,t[4]=f*g*d-x*o,t[5]=g*g*d+c,t[6]=x*g*d+f*o,t[7]=0,t[8]=f*x*d+g*o,t[9]=g*x*d-f*o,t[10]=x*x*d+c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var ZT=mc;function __(){var t=new $r(3);return $r!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function wx(t){var e=new $r(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function ah(t){return Math.hypot(t[0],t[1],t[2])}function _c(t,e,n){var o=new $r(3);return o[0]=t,o[1]=e,o[2]=n,o}function Jo(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function g_(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function bx(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function lh(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function ch(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function ui(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function uh(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t}function Mr(t,e){var n=e[0],o=e[1],c=e[2],d=n*n+o*o+c*c;return d>0&&(d=1/Math.sqrt(d)),t[0]=e[0]*d,t[1]=e[1]*d,t[2]=e[2]*d,t}function zi(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function y_(t,e,n){var o=e[0],c=e[1],d=e[2],f=n[0],g=n[1],x=n[2];return t[0]=c*x-d*g,t[1]=d*f-o*x,t[2]=o*g-c*f,t}function Nn(t,e,n){var o=e[0],c=e[1],d=e[2],f=n[3]*o+n[7]*c+n[11]*d+n[15];return t[0]=(n[0]*o+n[4]*c+n[8]*d+n[12])/(f=f||1),t[1]=(n[1]*o+n[5]*c+n[9]*d+n[13])/f,t[2]=(n[2]*o+n[6]*c+n[10]*d+n[14])/f,t}function Tx(t,e,n){var o=n[0],c=n[1],d=n[2],f=e[0],g=e[1],x=e[2],w=c*x-d*g,E=d*f-o*x,M=o*g-c*f,A=c*M-d*E,P=d*w-o*M,D=o*E-c*w,O=2*n[3];return E*=O,M*=O,P*=2,D*=2,t[0]=f+(w*=O)+(A*=2),t[1]=g+E+P,t[2]=x+M+D,t}var hh,Yi=g_,qT=bx,WT=ah;function Ex(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function Sx(t,e){var n=e[0],o=e[1],c=e[2],d=e[3],f=n*n+o*o+c*c+d*d;return f>0&&(f=1/Math.sqrt(f)),t[0]=n*f,t[1]=o*f,t[2]=c*f,t[3]=d*f,t}function el(t,e,n){var o=e[0],c=e[1],d=e[2],f=e[3];return t[0]=n[0]*o+n[4]*c+n[8]*d+n[12]*f,t[1]=n[1]*o+n[5]*c+n[9]*d+n[13]*f,t[2]=n[2]*o+n[6]*c+n[10]*d+n[14]*f,t[3]=n[3]*o+n[7]*c+n[11]*d+n[15]*f,t}function Cx(){var t=new $r(4);return $r!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Mx(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Ax(t,e,n){n*=.5;var o=e[0],c=e[1],d=e[2],f=e[3],g=Math.sin(n),x=Math.cos(n);return t[0]=o*x+f*g,t[1]=c*x+d*g,t[2]=d*x-c*g,t[3]=f*x-o*g,t}function Ix(t,e,n){n*=.5;var o=e[0],c=e[1],d=e[2],f=e[3],g=Math.sin(n),x=Math.cos(n);return t[0]=o*x-d*g,t[1]=c*x+f*g,t[2]=d*x+o*g,t[3]=f*x-c*g,t}__(),hh=new $r(4),$r!=Float32Array&&(hh[0]=0,hh[1]=0,hh[2]=0,hh[3]=0);var XT=Sx;__(),_c(1,0,0),_c(0,1,0),Cx(),Cx(),gx();class x_{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,o){const c=zi(n,this.dir);if(Math.abs(c)<1e-6)return!1;const d=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/c;return o[0]=this.pos[0]+this.dir[0]*d,o[1]=this.pos[1]+this.dir[1]*d,o[2]=this.pos[2]+this.dir[2]*d,!0}closestPointOnSphere(e,n,o){if(function(P,D){var O=P[0],N=P[1],J=P[2],re=D[0],K=D[1],te=D[2];return Math.abs(O-re)<=jp*Math.max(1,Math.abs(O),Math.abs(re))&&Math.abs(N-K)<=jp*Math.max(1,Math.abs(N),Math.abs(K))&&Math.abs(J-te)<=jp*Math.max(1,Math.abs(J),Math.abs(te))}(this.pos,e)||n===0)return o[0]=o[1]=o[2]=0,!1;const[c,d,f]=this.dir,g=this.pos[0]-e[0],x=this.pos[1]-e[1],w=this.pos[2]-e[2],E=c*c+d*d+f*f,M=2*(g*c+x*d+w*f),A=M*M-4*E*(g*g+x*x+w*w-n*n);if(A<0){const P=Math.max(-M/2,0),D=g+c*P,O=x+d*P,N=w+f*P,J=Math.hypot(D,O,N);return o[0]=D*n/J,o[1]=O*n/J,o[2]=N*n/J,!1}{const P=(-M-Math.sqrt(A))/(2*E);if(P<0){const D=Math.hypot(g,x,w);return o[0]=g*n/D,o[1]=x*n/D,o[2]=w*n/D,!1}return o[0]=g+c*P,o[1]=x+d*P,o[2]=w+f*P,!0}}}class v_{constructor(e,n,o,c,d){this.TL=e,this.TR=n,this.BR=o,this.BL=c,this.horizon=d}static fromInvProjectionMatrix(e,n,o){const c=[-1,1,1],d=[1,1,1],f=[1,-1,1],g=[-1,-1,1],x=Nn(c,c,e),w=Nn(d,d,e),E=Nn(f,f,e),M=Nn(g,g,e);return new v_(x,w,E,M,n/o)}}class w_{constructor(e,n){this.points=e,this.planes=n}static fromInvProjectionMatrix(e,n,o,c){const d=Math.pow(2,o),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(x=>{const w=el([],x,e),E=1/w[3]/n*d;return function(M,A,P){return M[0]=A[0]*P[0],M[1]=A[1]*P[1],M[2]=A[2]*P[2],M[3]=A[3]*P[3],M}(w,w,[E,E,c?1/w[3]:E,E])}),g=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(x=>{const w=Mr([],y_([],Yi([],f[x[0]],f[x[1]]),Yi([],f[x[2]],f[x[1]]))),E=-zi(w,f[x[1]]);return w.concat(E)});return new w_(f,g)}}class Ar{static fromPoints(e){const n=[1/0,1/0,1/0],o=[-1/0,-1/0,-1/0];for(const c of e)lh(n,n,c),ch(o,o,c);return new Ar(n,o)}static applyTransform(e,n){const o=e.getCorners();for(let c=0;c<o.length;++c)Nn(o[c],o[c],n);return Ar.fromPoints(o)}constructor(e,n){this.min=e,this.max=n,this.center=ui([],Jo([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],o=wx(this.min),c=wx(this.max);for(let d=0;d<n.length;d++)o[d]=n[d]?this.min[d]:this.center[d],c[d]=n[d]?this.center[d]:this.max[d];return c[2]=this.max[2],new Ar(o,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){const n=this.getCorners();let o=!0;for(let c=0;c<e.planes.length;c++){const d=e.planes[c];let f=0;for(let g=0;g<n.length;g++)f+=zi(d,n[g])+d[3]>=0;if(f===0)return 0;f!==n.length&&(o=!1)}if(o)return 2;for(let c=0;c<3;c++){let d=Number.MAX_VALUE,f=-Number.MAX_VALUE;for(let g=0;g<e.points.length;g++){const x=e.points[g][c]-this.min[c];d=Math.min(d,x),f=Math.max(f,x)}if(f<0||d>this.max[c]-this.min[c])return 0}return 1}}function zx(t,e,n,o,c,d,f,g,x){if(d&&t.queryGeometry.isAboveHorizon)return!1;d&&(x*=t.pixelToTileUnitsFactor);const w=t.tileID.canonical,E=n.projection.upVectorScale(w,n.center.lat,n.worldSize).metersToTile;for(const M of e)for(const A of M){const P=A.add(g),D=c&&n.elevation?n.elevation.exaggeration()*c.getElevationAt(P.x,P.y,!0):0,O=n.projection.projectTilePoint(P.x,P.y,w);if(D>0){const K=n.projection.upVector(w,P.x,P.y);O.x+=K[0]*E*D,O.y+=K[1]*E*D,O.z+=K[2]*E*D}const N=d?P:HT(O.x,O.y,O.z,o),J=d?t.tilespaceRays.map(K=>KT(K,D)):t.queryGeometry.screenGeometry,re=el([],[O.x,O.y,O.z,1],o);if(!f&&d?x*=re[3]/n.cameraToCenterDistance:f&&!d&&(x*=n.cameraToCenterDistance/re[3]),d){const K=ar((A.y/Et+w.y)/(1<<w.z));x/=n.projection.pixelsPerMeter(K,1)/Ii(1,K)}if(UT(J,N,x))return!0}return!1}function HT(t,e,n,o){const c=el([],[t,e,n,1],o);return new Me(c[0]/c[3],c[1]/c[3])}const kx=_c(0,0,0),YT=_c(0,0,1);function KT(t,e){const n=__();return kx[2]=e,t.intersectsPlane(kx,YT,n),new Me(n[0],n[1])}class Px extends h_{}function Dx(t,{width:e,height:n},o,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*n*o)throw new RangeError("mismatched image size")}else c=new Uint8Array(e*n*o);return t.width=e,t.height=n,t.data=c,t}function Lx(t,e,n){const{width:o,height:c}=e;o===t.width&&c===t.height||(b_(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,o),height:Math.min(t.height,c)},n),t.width=o,t.height=c,t.data=e.data)}function b_(t,e,n,o,c,d){if(c.width===0||c.height===0)return e;if(c.width>t.width||c.height>t.height||n.x>t.width-c.width||n.y>t.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||o.x>e.width-c.width||o.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const f=t.data,g=e.data;for(let x=0;x<c.height;x++){const w=((n.y+x)*t.width+n.x)*d,E=((o.y+x)*e.width+o.x)*d;for(let M=0;M<c.width*d;M++)g[E+M]=f[w+M]}return e}rt(Px,"HeatmapBucket",{omit:["layers"]});class Qo{constructor(e,n){Dx(this,e,1,n)}resize(e){Lx(this,new Qo(e),1)}clone(){return new Qo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,o,c,d){b_(e,n,o,c,d,1)}}class Zr{constructor(e,n){Dx(this,e,4,n)}resize(e){Lx(this,new Zr(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Zr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,o,c,d){b_(e,n,o,c,d,4)}}rt(Qo,"AlphaImage"),rt(Zr,"RGBAImage");var JT={paint:new We({"heatmap-radius":new pe(ze.paint_heatmap["heatmap-radius"]),"heatmap-weight":new pe(ze.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ve(ze.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ye(ze.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ve(ze.paint_heatmap["heatmap-opacity"])})};function T_(t){const e={},n=t.resolution||256,o=t.clips?t.clips.length:1,c=t.image||new Zr({width:n,height:o}),d=(f,g,x)=>{e[t.evaluationKey]=x;const w=t.expression.evaluate(e);c.data[f+g+0]=Math.floor(255*w.r/w.a),c.data[f+g+1]=Math.floor(255*w.g/w.a),c.data[f+g+2]=Math.floor(255*w.b/w.a),c.data[f+g+3]=Math.floor(255*w.a)};if(t.clips)for(let f=0,g=0;f<o;++f,g+=4*n)for(let x=0,w=0;x<n;x++,w+=4){const E=x/(n-1),{start:M,end:A}=t.clips[f];d(g,w,M*(1-E)+A*E)}else for(let f=0,g=0;f<n;f++,g+=4)d(0,g,f/(n-1));return c}var QT={paint:new We({"hillshade-illumination-direction":new ve(ze.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ve(ze.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ve(ze.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ve(ze.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ve(ze.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ve(ze.paint_hillshade["hillshade-accent-color"])})};const eE=Xe([{name:"a_pos",components:2,type:"Int16"}],4),{members:tE}=eE;var dh={exports:{}};function Gp(t,e,n){n=n||2;var o,c,d,f,g,x,w,E=e&&e.length,M=E?e[0]*n:t.length,A=Rx(t,0,M,n,!0),P=[];if(!A||A.next===A.prev)return P;if(E&&(A=function(O,N,J,re){var K,te,ce,oe=[];for(K=0,te=N.length;K<te;K++)(ce=Rx(O,N[K]*re,K<te-1?N[K+1]*re:O.length,re,!1))===ce.next&&(ce.steiner=!0),oe.push(cE(ce));for(oe.sort(sE),K=0;K<oe.length;K++)J=aE(oe[K],J);return J}(t,e,A,n)),t.length>80*n){o=d=t[0],c=f=t[1];for(var D=n;D<M;D+=n)(g=t[D])<o&&(o=g),(x=t[D+1])<c&&(c=x),g>d&&(d=g),x>f&&(f=x);w=(w=Math.max(d-o,f-c))!==0?32767/w:0}return ph(A,P,n,o,c,w,0),P}function Rx(t,e,n,o,c){var d,f;if(c===C_(t,e,n,o)>0)for(d=e;d<n;d+=o)f=Fx(d,t[d],t[d+1],f);else for(d=n-o;d>=e;d-=o)f=Fx(d,t[d],t[d+1],f);return f&&$p(f,f.next)&&(mh(f),f=f.next),f}function tl(t,e){if(!t)return t;e||(e=t);var n,o=t;do if(n=!1,o.steiner||!$p(o,o.next)&&Dn(o.prev,o,o.next)!==0)o=o.next;else{if(mh(o),(o=e=o.prev)===o.next)break;n=!0}while(n||o!==e);return e}function ph(t,e,n,o,c,d,f){if(t){!f&&d&&function(E,M,A,P){var D=E;do D.z===0&&(D.z=E_(D.x,D.y,M,A,P)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==E);D.prevZ.nextZ=null,D.prevZ=null,function(O){var N,J,re,K,te,ce,oe,Se,Te=1;do{for(J=O,O=null,te=null,ce=0;J;){for(ce++,re=J,oe=0,N=0;N<Te&&(oe++,re=re.nextZ);N++);for(Se=Te;oe>0||Se>0&&re;)oe!==0&&(Se===0||!re||J.z<=re.z)?(K=J,J=J.nextZ,oe--):(K=re,re=re.nextZ,Se--),te?te.nextZ=K:O=K,K.prevZ=te,te=K;J=re}te.nextZ=null,Te*=2}while(ce>1)}(D)}(t,o,c,d);for(var g,x,w=t;t.prev!==t.next;)if(g=t.prev,x=t.next,d?rE(t,o,c,d):nE(t))e.push(g.i/n|0),e.push(t.i/n|0),e.push(x.i/n|0),mh(t),t=x.next,w=x.next;else if((t=x)===w){f?f===1?ph(t=iE(tl(t),e,n),e,n,o,c,d,2):f===2&&oE(t,e,n,o,c,d):ph(tl(t),e,n,o,c,d,1);break}}}function nE(t){var e=t.prev,n=t,o=t.next;if(Dn(e,n,o)>=0)return!1;for(var c=e.x,d=n.x,f=o.x,g=e.y,x=n.y,w=o.y,E=c<d?c<f?c:f:d<f?d:f,M=g<x?g<w?g:w:x<w?x:w,A=c>d?c>f?c:f:d>f?d:f,P=g>x?g>w?g:w:x>w?x:w,D=o.next;D!==e;){if(D.x>=E&&D.x<=A&&D.y>=M&&D.y<=P&&gc(c,g,d,x,f,w,D.x,D.y)&&Dn(D.prev,D,D.next)>=0)return!1;D=D.next}return!0}function rE(t,e,n,o){var c=t.prev,d=t,f=t.next;if(Dn(c,d,f)>=0)return!1;for(var g=c.x,x=d.x,w=f.x,E=c.y,M=d.y,A=f.y,P=g<x?g<w?g:w:x<w?x:w,D=E<M?E<A?E:A:M<A?M:A,O=g>x?g>w?g:w:x>w?x:w,N=E>M?E>A?E:A:M>A?M:A,J=E_(P,D,e,n,o),re=E_(O,N,e,n,o),K=t.prevZ,te=t.nextZ;K&&K.z>=J&&te&&te.z<=re;){if(K.x>=P&&K.x<=O&&K.y>=D&&K.y<=N&&K!==c&&K!==f&&gc(g,E,x,M,w,A,K.x,K.y)&&Dn(K.prev,K,K.next)>=0||(K=K.prevZ,te.x>=P&&te.x<=O&&te.y>=D&&te.y<=N&&te!==c&&te!==f&&gc(g,E,x,M,w,A,te.x,te.y)&&Dn(te.prev,te,te.next)>=0))return!1;te=te.nextZ}for(;K&&K.z>=J;){if(K.x>=P&&K.x<=O&&K.y>=D&&K.y<=N&&K!==c&&K!==f&&gc(g,E,x,M,w,A,K.x,K.y)&&Dn(K.prev,K,K.next)>=0)return!1;K=K.prevZ}for(;te&&te.z<=re;){if(te.x>=P&&te.x<=O&&te.y>=D&&te.y<=N&&te!==c&&te!==f&&gc(g,E,x,M,w,A,te.x,te.y)&&Dn(te.prev,te,te.next)>=0)return!1;te=te.nextZ}return!0}function iE(t,e,n){var o=t;do{var c=o.prev,d=o.next.next;!$p(c,d)&&Bx(c,o,o.next,d)&&fh(c,d)&&fh(d,c)&&(e.push(c.i/n|0),e.push(o.i/n|0),e.push(d.i/n|0),mh(o),mh(o.next),o=t=d),o=o.next}while(o!==t);return tl(o)}function oE(t,e,n,o,c,d){var f=t;do{for(var g=f.next.next;g!==f.prev;){if(f.i!==g.i&&uE(f,g)){var x=Ox(f,g);return f=tl(f,f.next),x=tl(x,x.next),ph(f,e,n,o,c,d,0),void ph(x,e,n,o,c,d,0)}g=g.next}f=f.next}while(f!==t)}function sE(t,e){return t.x-e.x}function aE(t,e){var n=function(c,d){var f,g=d,x=c.x,w=c.y,E=-1/0;do{if(w<=g.y&&w>=g.next.y&&g.next.y!==g.y){var M=g.x+(w-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(M<=x&&M>E&&(E=M,f=g.x<g.next.x?g:g.next,M===x))return f}g=g.next}while(g!==d);if(!f)return null;var A,P=f,D=f.x,O=f.y,N=1/0;g=f;do x>=g.x&&g.x>=D&&x!==g.x&&gc(w<O?x:E,w,D,O,w<O?E:x,w,g.x,g.y)&&(A=Math.abs(w-g.y)/(x-g.x),fh(g,c)&&(A<N||A===N&&(g.x>f.x||g.x===f.x&&lE(f,g)))&&(f=g,N=A)),g=g.next;while(g!==P);return f}(t,e);if(!n)return e;var o=Ox(n,t);return tl(o,o.next),tl(n,n.next)}function lE(t,e){return Dn(t.prev,t,e.prev)<0&&Dn(e.next,t,t.next)<0}function E_(t,e,n,o,c){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*c|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function cE(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function gc(t,e,n,o,c,d,f,g){return(c-f)*(e-g)>=(t-f)*(d-g)&&(t-f)*(o-g)>=(n-f)*(e-g)&&(n-f)*(d-g)>=(c-f)*(o-g)}function uE(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(n,o){var c=n;do{if(c.i!==n.i&&c.next.i!==n.i&&c.i!==o.i&&c.next.i!==o.i&&Bx(c,c.next,n,o))return!0;c=c.next}while(c!==n);return!1}(t,e)&&(fh(t,e)&&fh(e,t)&&function(n,o){var c=n,d=!1,f=(n.x+o.x)/2,g=(n.y+o.y)/2;do c.y>g!=c.next.y>g&&c.next.y!==c.y&&f<(c.next.x-c.x)*(g-c.y)/(c.next.y-c.y)+c.x&&(d=!d),c=c.next;while(c!==n);return d}(t,e)&&(Dn(t.prev,t,e.prev)||Dn(t,e.prev,e))||$p(t,e)&&Dn(t.prev,t,t.next)>0&&Dn(e.prev,e,e.next)>0)}function Dn(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function $p(t,e){return t.x===e.x&&t.y===e.y}function Bx(t,e,n,o){var c=qp(Dn(t,e,n)),d=qp(Dn(t,e,o)),f=qp(Dn(n,o,t)),g=qp(Dn(n,o,e));return c!==d&&f!==g||!(c!==0||!Zp(t,n,e))||!(d!==0||!Zp(t,o,e))||!(f!==0||!Zp(n,t,o))||!(g!==0||!Zp(n,e,o))}function Zp(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function qp(t){return t>0?1:t<0?-1:0}function fh(t,e){return Dn(t.prev,t,t.next)<0?Dn(t,e,t.next)>=0&&Dn(t,t.prev,e)>=0:Dn(t,e,t.prev)<0||Dn(t,t.next,e)<0}function Ox(t,e){var n=new S_(t.i,t.x,t.y),o=new S_(e.i,e.x,e.y),c=t.next,d=e.prev;return t.next=e,e.prev=t,n.next=c,c.prev=n,o.next=n,n.prev=o,d.next=o,o.prev=d,o}function Fx(t,e,n,o){var c=new S_(t,e,n);return o?(c.next=o.next,c.prev=o,o.next.prev=c,o.next=c):(c.prev=c,c.next=c),c}function mh(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function S_(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function C_(t,e,n,o){for(var c=0,d=e,f=n-o;d<n;d+=o)c+=(t[f]-t[d])*(t[d+1]+t[f+1]),f=d;return c}function hE(t,e,n,o,c){Ux(t,e,n||0,o||t.length-1,c||dE)}function Ux(t,e,n,o,c){for(;o>n;){if(o-n>600){var d=o-n+1,f=e-n+1,g=Math.log(d),x=.5*Math.exp(2*g/3),w=.5*Math.sqrt(g*x*(d-x)/d)*(f-d/2<0?-1:1);Ux(t,e,Math.max(n,Math.floor(e-f*x/d+w)),Math.min(o,Math.floor(e+(d-f)*x/d+w)),c)}var E=t[e],M=n,A=o;for(_h(t,n,e),c(t[o],E)>0&&_h(t,n,o);M<A;){for(_h(t,M,A),M++,A--;c(t[M],E)<0;)M++;for(;c(t[A],E)>0;)A--}c(t[n],E)===0?_h(t,n,A):_h(t,++A,o),A<=e&&(n=A+1),e<=A&&(o=A-1)}}function _h(t,e,n){var o=t[e];t[e]=t[n],t[n]=o}function dE(t,e){return t<e?-1:t>e?1:0}function M_(t,e){const n=t.length;if(n<=1)return[t];const o=[];let c,d;for(let f=0;f<n;f++){const g=Vt(t[f]);g!==0&&(t[f].area=Math.abs(g),d===void 0&&(d=g<0),d===g<0?(c&&o.push(c),c=[t[f]]):c.push(t[f]))}if(c&&o.push(c),e>1)for(let f=0;f<o.length;f++)o[f].length<=e||(hE(o[f],e,1,o[f].length-1,pE),o[f]=o[f].slice(0,e));return o}function pE(t,e){return e.area-t.area}function A_(t,e,n){const o=n.patternDependencies;let c=!1;for(const d of e){const f=d.paint.get(`${t}-pattern`);f.isConstant()||(c=!0);const g=f.constantOr(null);g&&(c=!0,o[g.to]=!0,o[g.from]=!0)}return c}function I_(t,e,n,o,c){const d=c.patternDependencies;for(const f of e){const g=f.paint.get(`${t}-pattern`).value;if(g.kind!=="constant"){let x=g.evaluate({zoom:o-1},n,{},c.availableImages),w=g.evaluate({zoom:o},n,{},c.availableImages),E=g.evaluate({zoom:o+1},n,{},c.availableImages);x=x&&x.name?x.name:x,w=w&&w.name?w.name:w,E=E&&E.name?E.name:E,d[x]=!0,d[w]=!0,d[E]=!0,n.patterns[f.id]={min:x,mid:w,max:E}}}return n}dh.exports=Gp,dh.exports.default=Gp,Gp.deviation=function(t,e,n,o){var c=e&&e.length,d=Math.abs(C_(t,0,c?e[0]*n:t.length,n));if(c)for(var f=0,g=e.length;f<g;f++)d-=Math.abs(C_(t,e[f]*n,f<g-1?e[f+1]*n:t.length,n));var x=0;for(f=0;f<o.length;f+=3){var w=o[f]*n,E=o[f+1]*n,M=o[f+2]*n;x+=Math.abs((t[w]-t[M])*(t[E+1]-t[w+1])-(t[w]-t[E])*(t[M+1]-t[w+1]))}return d===0&&x===0?0:Math.abs((x-d)/d)},Gp.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},o=0,c=0;c<t.length;c++){for(var d=0;d<t[c].length;d++)for(var f=0;f<e;f++)n.vertices.push(t[c][d][f]);c>0&&n.holes.push(o+=t[c-1].length)}return n};class Wp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Dt,this.indexArray=new _r,this.indexArray2=new li,this.programConfigurations=new Ya(e.layers,e.zoom),this.segments=new Un,this.segments2=new Un,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}populate(e,n,o,c){this.hasPattern=A_("fill",this.layers,n);const d=this.layers[0].layout.get("fill-sort-key"),f=[];for(const{feature:g,id:x,index:w,sourceLayerIndex:E}of e){const M=this.layers[0]._featureFilter.needGeometry,A=Ka(g,M);if(!this.layers[0]._featureFilter.filter(new Q(this.zoom),A,o))continue;const P=d?d.evaluate(A,{},o,n.availableImages):void 0,D={id:x,properties:g.properties,type:g.type,sourceLayerIndex:E,index:w,geometry:M?A.geometry:Ko(g,o,c),patterns:{},sortKey:P};f.push(D)}d&&f.sort((g,x)=>g.sortKey-x.sortKey);for(const g of f){const{geometry:x,index:w,sourceLayerIndex:E}=g;if(this.hasPattern){const M=I_("fill",this.layers,g,this.zoom,n);this.patternFeatures.push(M)}else this.addFeature(g,x,w,o,{},n.availableImages);n.featureIndex.insert(e[w].feature,x,w,E,this.index)}}update(e,n,o,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,o,c)}addFeatures(e,n,o,c,d){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,n,o,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,tE),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,o,c,d,f=[]){for(const g of M_(n,500)){let x=0;for(const D of g)x+=D.length;const w=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray),E=w.vertexLength,M=[],A=[];for(const D of g){if(D.length===0)continue;D!==g[0]&&A.push(M.length/2);const O=this.segments2.prepareSegment(D.length,this.layoutVertexArray,this.indexArray2),N=O.vertexLength;this.layoutVertexArray.emplaceBack(D[0].x,D[0].y),this.indexArray2.emplaceBack(N+D.length-1,N),M.push(D[0].x),M.push(D[0].y);for(let J=1;J<D.length;J++)this.layoutVertexArray.emplaceBack(D[J].x,D[J].y),this.indexArray2.emplaceBack(N+J-1,N+J),M.push(D[J].x),M.push(D[J].y);O.vertexLength+=D.length,O.primitiveLength+=D.length}const P=dh.exports(M,A);for(let D=0;D<P.length;D+=3)this.indexArray.emplaceBack(E+P[D],E+P[D+1],E+P[D+2]);w.vertexLength+=x,w.primitiveLength+=P.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,d,f,c)}}rt(Wp,"FillBucket",{omit:["layers","patternFeatures"]});const fE=new We({"fill-sort-key":new pe(ze.layout_fill["fill-sort-key"])});var mE={paint:new We({"fill-antialias":new ve(ze.paint_fill["fill-antialias"]),"fill-opacity":new pe(ze.paint_fill["fill-opacity"]),"fill-color":new pe(ze.paint_fill["fill-color"]),"fill-outline-color":new pe(ze.paint_fill["fill-outline-color"]),"fill-translate":new ve(ze.paint_fill["fill-translate"]),"fill-translate-anchor":new ve(ze.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ke(ze.paint_fill["fill-pattern"])}),layout:fE};const _E=Xe([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),gE=Xe([{name:"a_centroid_pos",components:2,type:"Uint16"}]),yE=Xe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:xE}=_E;var Xp={},vE=Me,Nx=yc;function yc(t,e,n,o,c){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=o,this._values=c,t.readFields(wE,this,e)}function wE(t,e,n){t==1?e.id=n.readVarint():t==2?function(o,c){for(var d=o.readVarint()+o.pos;o.pos<d;){var f=c._keys[o.readVarint()],g=c._values[o.readVarint()];c.properties[f]=g}}(n,e):t==3?e.type=n.readVarint():t==4&&(e._geometry=n.pos)}function bE(t){for(var e,n,o=0,c=0,d=t.length,f=d-1;c<d;f=c++)o+=((n=t[f]).x-(e=t[c]).x)*(e.y+n.y);return o}yc.types=["Unknown","Point","LineString","Polygon"],yc.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,o=1,c=0,d=0,f=0,g=[];t.pos<n;){if(c<=0){var x=t.readVarint();o=7&x,c=x>>3}if(c--,o===1||o===2)d+=t.readSVarint(),f+=t.readSVarint(),o===1&&(e&&g.push(e),e=[]),e.push(new vE(d,f));else{if(o!==7)throw new Error("unknown command "+o);e&&e.push(e[0].clone())}}return e&&g.push(e),g},yc.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,o=0,c=0,d=0,f=1/0,g=-1/0,x=1/0,w=-1/0;t.pos<e;){if(o<=0){var E=t.readVarint();n=7&E,o=E>>3}if(o--,n===1||n===2)(c+=t.readSVarint())<f&&(f=c),c>g&&(g=c),(d+=t.readSVarint())<x&&(x=d),d>w&&(w=d);else if(n!==7)throw new Error("unknown command "+n)}return[f,x,g,w]},yc.prototype.toGeoJSON=function(t,e,n){var o,c,d=this.extent*Math.pow(2,n),f=this.extent*t,g=this.extent*e,x=this.loadGeometry(),w=yc.types[this.type];function E(P){for(var D=0;D<P.length;D++){var O=P[D];P[D]=[360*(O.x+f)/d-180,360/Math.PI*Math.atan(Math.exp((180-360*(O.y+g)/d)*Math.PI/180))-90]}}switch(this.type){case 1:var M=[];for(o=0;o<x.length;o++)M[o]=x[o][0];E(x=M);break;case 2:for(o=0;o<x.length;o++)E(x[o]);break;case 3:for(x=function(P){var D=P.length;if(D<=1)return[P];for(var O,N,J=[],re=0;re<D;re++){var K=bE(P[re]);K!==0&&(N===void 0&&(N=K<0),N===K<0?(O&&J.push(O),O=[P[re]]):O.push(P[re]))}return O&&J.push(O),J}(x),o=0;o<x.length;o++)for(c=0;c<x[o].length;c++)E(x[o][c])}x.length===1?x=x[0]:w="Multi"+w;var A={type:"Feature",geometry:{type:w,coordinates:x},properties:this.properties};return"id"in this&&(A.id=this.id),A};var TE=Nx,jx=Vx;function Vx(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(EE,this,e),this.length=this._features.length}function EE(t,e,n){t===15?e.version=n.readVarint():t===1?e.name=n.readString():t===5?e.extent=n.readVarint():t===2?e._features.push(n.pos):t===3?e._keys.push(n.readString()):t===4&&e._values.push(function(o){for(var c=null,d=o.readVarint()+o.pos;o.pos<d;){var f=o.readVarint()>>3;c=f===1?o.readString():f===2?o.readFloat():f===3?o.readDouble():f===4?o.readVarint64():f===5?o.readVarint():f===6?o.readSVarint():f===7?o.readBoolean():null}return c}(n))}Vx.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new TE(this._pbf,e,this.extent,this._keys,this._values)};var SE=jx;function CE(t,e,n){if(t===3){var o=new SE(n,n.readVarint()+n.pos);o.length&&(e[o.name]=o)}}var z_=Xp.VectorTile=function(t,e){this.layers=t.readFields(CE,{},e)},Hp=Xp.VectorTileFeature=Nx;function Yp(t,e,n,o){const c=[],d=o===0?(f,g,x,w,E,M)=>{f.push(new Me(M,x+(M-g)/(w-g)*(E-x)))}:(f,g,x,w,E,M)=>{f.push(new Me(g+(M-x)/(E-x)*(w-g),M))};for(const f of t){const g=[];for(const x of f){if(x.length<=2)continue;const w=[];for(let A=0;A<x.length-1;A++){const P=x[A].x,D=x[A].y,O=x[A+1].x,N=x[A+1].y,J=o===0?P:D,re=o===0?O:N;J<e?re>e&&d(w,P,D,O,N,e):J>n?re<n&&d(w,P,D,O,N,n):w.push(x[A]),re<e&&J>=e&&d(w,P,D,O,N,e),re>n&&J<=n&&d(w,P,D,O,N,n)}let E=x[x.length-1];const M=o===0?E.x:E.y;M>=e&&M<=n&&w.push(E),w.length&&(E=w[w.length-1],w[0].x===E.x&&w[0].y===E.y||w.push(w[0]),g.push(w))}g.length&&c.push(g)}return c}Xp.VectorTileLayer=jx;const ME=Hp.types,AE=Math.pow(2,13);function gh(t,e,n,o,c,d,f,g){t.emplaceBack((e<<1)+f,(n<<1)+d,(Math.floor(o*AE)<<1)+c,Math.round(g))}function yh(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class Gx{constructor(){this.acc=new Me(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Me(e.x,e.y),this.max=new Me(e.x,e.y))}append(e,n){this.currentPolyCount.edges++,this.acc._add(e);const o=this.min,c=this.max;e.x<o.x?o.x=e.x:e.x>c.x&&(c.x=e.x),e.y<o.y?o.y=e.y:e.y>c.y&&(c.y=e.y),((e.x===0||e.x===Et)&&e.x===n.x)!=((e.y===0||e.y===Et)&&e.y===n.y)&&this.processBorderOverlap(e,n),n.x<0!=e.x<0&&this.addBorderIntersection(0,Gt(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>Et!=e.x>Et&&this.addBorderIntersection(1,Gt(n.y,e.y,(Et-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,Gt(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>Et!=e.y>Et&&this.addBorderIntersection(3,Gt(n.x,e.x,(Et-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const o=this.borders[e];n<o[0]&&(o[0]=n),n>o[1]&&(o[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;const o=e.x===0?0:1;this.addBorderIntersection(o,n.y),this.addBorderIntersection(o,e.y)}else{const o=e.y===0?2:3;this.addBorderIntersection(o,n.x),this.addBorderIntersection(o,e.x)}}centroid(){const e=this.polyCount.reduce((n,o)=>n+o.edges,0);return e!==0?this.acc.div(e)._round():new Me(0,0)}span(){return new Me(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0)}}class xh{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new rn,this.centroidVertexArray=new H0,this.indexArray=new _r,this.programConfigurations=new Ya(e.layers,e.zoom),this.segments=new Un,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.enableTerrain=e.enableTerrain}populate(e,n,o,c){this.features=[],this.hasPattern=A_("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(d){const f=Math.exp(Math.PI*(1-d.y/(1<<d.z)*2));return 80150034*f/(f*f+1)/Et/(1<<d.z)}(o),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:d,id:f,index:g,sourceLayerIndex:x}of e){const w=this.layers[0]._featureFilter.needGeometry,E=Ka(d,w);if(!this.layers[0]._featureFilter.filter(new Q(this.zoom),E,o))continue;const M={id:f,sourceLayerIndex:x,index:g,geometry:w?E.geometry:Ko(d,o,c),properties:d.properties,type:d.type,patterns:{}},A=this.layoutVertexArray.length;this.hasPattern?this.features.push(I_("fill-extrusion",this.layers,M,this.zoom,n)):this.addFeature(M,M.geometry,g,o,{},n.availableImages,c),n.featureIndex.insert(d,M.geometry,g,x,this.index,A)}this.sortBorders()}addFeatures(e,n,o,c,d){for(const f of this.features){const{geometry:g}=f;this.addFeature(f,g,f.index,n,o,c,d)}this.sortBorders()}update(e,n,o,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,o,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,xE),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,yE.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,gE.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,o,c,d,f,g){const x=[new Me(0,0),new Me(Et,Et)],w=g.projection,E=w.name==="globe",M=this.enableTerrain&&!E?new Gx:null,A=ME[e.type]==="Polygon";E&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new F0);const P=M_(n,500);for(let J=P.length-1;J>=0;J--){const re=P[J];(re.length===0||(D=re[0]).every(K=>K.x<=0)||D.every(K=>K.x>=Et)||D.every(K=>K.y<=0)||D.every(K=>K.y>=Et))&&P.splice(J,1)}var D;let O;if(E)O=Yx(P,x,c);else{O=[];for(const J of P)O.push({polygon:J,bounds:x})}const N=A?this.edgeRadius:0;for(const{polygon:J,bounds:re}of O){let K=0,te=0;for(const oe of J)A&&!oe[0].equals(oe[oe.length-1])&&oe.push(oe[0]),te+=A?oe.length-1:oe.length;const ce=this.segments.prepareSegment((A?5:4)*te,this.layoutVertexArray,this.indexArray);if(A){const oe=[],Se=[];K=ce.vertexLength;for(const ke of J){let $e,Ae;ke.length&&ke!==J[0]&&Se.push(oe.length/2),$e=ke[1].sub(ke[0])._perp()._unit();for(let Re=1;Re<ke.length;Re++){const Be=ke[Re],Ne=ke[Re===ke.length-1?1:Re+1];let{x:Ze,y:Pe}=Be;if(N){Ae=Ne.sub(Be)._perp()._unit();const it=$e.add(Ae)._unit(),St=N*Math.min(4,1/($e.x*it.x+$e.y*it.y));Ze+=St*it.x,Pe+=St*it.y,$e=Ae}gh(this.layoutVertexArray,Ze,Pe,0,0,1,1,0),ce.vertexLength++,oe.push(Be.x,Be.y),E&&yh(this.layoutVertexExtArray,w.projectTilePoint(Ze,Pe,c),w.upVector(c,Ze,Pe))}}const Te=dh.exports(oe,Se);for(let ke=0;ke<Te.length;ke+=3)this.indexArray.emplaceBack(K+Te[ke],K+Te[ke+2],K+Te[ke+1]),ce.primitiveLength++}for(const oe of J){M&&oe.length&&M.startRing(oe[0]);let Se,Te,ke,$e=oe.length>4&&Wx(oe[oe.length-2],oe[0],oe[1]),Ae=N?IE(oe[oe.length-2],oe[0],oe[1],N):0;Te=oe[1].sub(oe[0])._perp()._unit();let Re=!0;for(let Be=1,Ne=0;Be<oe.length;Be++){let Ze=oe[Be-1],Pe=oe[Be];const it=oe[Be===oe.length-1?1:Be+1];if(M&&A&&M.currentPolyCount.top++,qx(Pe,Ze,re)){N&&(Te=it.sub(Pe)._perp()._unit(),Re=!Re);continue}M&&M.append(Pe,Ze);const St=Pe.sub(Ze)._perp(),lt=St.x/(Math.abs(St.x)+Math.abs(St.y)),ot=St.y>0?1:0,et=Ze.dist(Pe);if(Ne+et>32768&&(Ne=0),N){ke=it.sub(Pe)._perp()._unit();let $t=Zx(Ze,Pe,it,$x(Te,ke),N);isNaN($t)&&($t=0);const It=Pe.sub(Ze)._unit();Ze=Ze.add(It.mult(Ae))._round(),Pe=Pe.add(It.mult(-$t))._round(),Ae=$t,Te=ke}const bt=ce.vertexLength,kt=oe.length>4&&Wx(Ze,Pe,it);let Pt=Xx(Ne,$e,Re);if(gh(this.layoutVertexArray,Ze.x,Ze.y,lt,ot,0,0,Pt),gh(this.layoutVertexArray,Ze.x,Ze.y,lt,ot,0,1,Pt),Ne+=et,Pt=Xx(Ne,kt,!Re),$e=kt,gh(this.layoutVertexArray,Pe.x,Pe.y,lt,ot,0,0,Pt),gh(this.layoutVertexArray,Pe.x,Pe.y,lt,ot,0,1,Pt),ce.vertexLength+=4,this.indexArray.emplaceBack(bt+0,bt+1,bt+2),this.indexArray.emplaceBack(bt+1,bt+3,bt+2),ce.primitiveLength+=2,N){const $t=K+(Be===1?oe.length-2:Be-2),It=Be===1?K:$t+1;if(this.indexArray.emplaceBack(bt+1,$t,bt+3),this.indexArray.emplaceBack($t,It,bt+3),ce.primitiveLength+=2,Se===void 0&&(Se=bt),!qx(it,oe[Be],re)){const gn=Be===oe.length-1?Se:ce.vertexLength;this.indexArray.emplaceBack(bt+2,bt+3,gn),this.indexArray.emplaceBack(bt+3,gn+1,gn),this.indexArray.emplaceBack(bt+3,It,gn+1),ce.primitiveLength+=3}Re=!Re}if(E){const $t=this.layoutVertexExtArray,It=w.projectTilePoint(Ze.x,Ze.y,c),gn=w.projectTilePoint(Pe.x,Pe.y,c),Lt=w.upVector(c,Ze.x,Ze.y),jt=w.upVector(c,Pe.x,Pe.y);yh($t,It,Lt),yh($t,It,Lt),yh($t,gn,jt),yh($t,gn,jt)}}A&&(K+=oe.length-1)}}if(M&&M.polyCount.length>0){if(M.borders){M.vertexArrayOffset=this.centroidVertexArray.length;const J=M.borders,re=this.featuresOnBorder.push(M)-1;for(let K=0;K<4;K++)J[K][0]!==Number.MAX_VALUE&&this.borders[K].push(re)}this.encodeCentroid(M.borders?void 0:M.centroid(),M)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,d,f,c)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((n,o)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[o].borders[e][0])}encodeCentroid(e,n,o=!0){let c,d;if(e)if(e.y!==0){const g=n.span()._mult(this.tileToMeter);c=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(g.x/10)),d=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(g.y/10))}else c=Math.ceil(7*(e.x+450)),d=0;else c=0,d=+o;let f=o?this.centroidVertexArray.length:n.vertexArrayOffset;for(const g of n.polyCount){o&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*g.edges+g.top);for(let x=0;x<g.top;x++)this.centroidVertexArray.emplace(f++,c,d);for(let x=0;x<2*g.edges;x++)this.centroidVertexArray.emplace(f++,0,d),this.centroidVertexArray.emplace(f++,c,d)}}}function $x(t,e){const n=t.add(e)._unit();return t.x*n.x+t.y*n.y}function IE(t,e,n,o){const c=e.sub(t)._perp()._unit(),d=n.sub(e)._perp()._unit();return Zx(t,e,n,$x(c,d),o)}function Zx(t,e,n,o,c){const d=Math.sqrt(1-o*o);return Math.min(t.dist(e)/3,e.dist(n)/3,c*d/o)}function qx(t,e,n){return t.x<n[0].x&&e.x<n[0].x||t.x>n[1].x&&e.x>n[1].x||t.y<n[0].y&&e.y<n[0].y||t.y>n[1].y&&e.y>n[1].y}function Wx(t,e,n){if(t.x<0||t.x>=Et||e.x<0||e.x>=Et||n.x<0||n.x>=Et)return!1;const o=n.sub(e),c=o.perp(),d=t.sub(e);return(o.x*d.x+o.y*d.y)/Math.sqrt((o.x*o.x+o.y*o.y)*(d.x*d.x+d.y*d.y))>-.866&&c.x*d.x+c.y*d.y<0}function Xx(t,e,n){const o=e?2|t:-3&t;return n?1|o:-2&o}function Hx(){const t=Math.PI/32,e=Math.tan(t),n=Op;return n*Math.sqrt(1+2*e*e)-n}function Yx(t,e,n){const o=1<<n.z,c=ci(n.x/o),d=ci((n.x+1)/o),f=ar(n.y/o),g=ar((n.y+1)/o);return function(x,w,E,M,A=0,P){const D=[];if(!x.length||!E||!M)return D;const O=(oe,Se)=>{for(const Te of oe)D.push({polygon:Te,bounds:Se})},N=Math.ceil(Math.log2(E)),J=Math.ceil(Math.log2(M)),re=N-J,K=[];for(let oe=0;oe<Math.abs(re);oe++)K.push(re>0?0:1);for(let oe=0;oe<Math.min(N,J);oe++)K.push(0),K.push(1);let te=x;if(te=Yp(te,w[0].y-A,w[1].y+A,1),te=Yp(te,w[0].x-A,w[1].x+A,0),!te.length)return D;const ce=[];for(K.length?ce.push({polygons:te,bounds:w,depth:0}):O(te,w);ce.length;){const oe=ce.pop(),Se=oe.depth,Te=K[Se],ke=oe.bounds[0],$e=oe.bounds[1],Ae=Te===0?ke.x:ke.y,Re=Te===0?$e.x:$e.y,Be=P?P(Te,Ae,Re):.5*(Ae+Re),Ne=Yp(oe.polygons,Ae-A,Be+A,Te),Ze=Yp(oe.polygons,Be-A,Re+A,Te);if(Ne.length){const Pe=[ke,new Me(Te===0?Be:$e.x,Te===1?Be:$e.y)];K.length>Se+1?ce.push({polygons:Ne,bounds:Pe,depth:Se+1}):O(Ne,Pe)}if(Ze.length){const Pe=[new Me(Te===0?Be:ke.x,Te===1?Be:ke.y),$e];K.length>Se+1?ce.push({polygons:Ze,bounds:Pe,depth:Se+1}):O(Ze,Pe)}}return D}(t,e,Math.ceil((d-c)/11.25),Math.ceil((f-g)/11.25),1,(x,w,E)=>{if(x===0)return .5*(w+E);{const M=ar((n.y+w/Et)/o);return(So(.5*(ar((n.y+E/Et)/o)+M))*o-n.y)*Et}})}rt(xh,"FillExtrusionBucket",{omit:["layers","features"]}),rt(Gx,"PartMetadata");const zE=new We({"fill-extrusion-edge-radius":new ve(ze["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var kE={paint:new We({"fill-extrusion-opacity":new ve(ze["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new pe(ze["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ve(ze["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ve(ze["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ke(ze["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new pe(ze["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new pe(ze["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ve(ze["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new ve(ze["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new ve(ze["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:zE};function Kx(t,e,n){var o=2*Math.PI*6378137/256/Math.pow(2,n);return[t*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}class Kp{constructor(e,n,o){this.z=e,this.x=n,this.y=o,this.key=vh(0,e,e,n,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){const o=function(d,f,g){var x=Kx(256*d,256*(f=Math.pow(2,g)-f-1),g),w=Kx(256*(d+1),256*(f+1),g);return x[0]+","+x[1]+","+w[0]+","+w[1]}(this.x,this.y,this.z),c=function(d,f,g){let x,w="";for(let E=d;E>0;E--)x=1<<E-1,w+=(f&x?1:0)+(g&x?2:0);return w}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",c).replace("{bbox-epsg-3857}",o)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Jx{constructor(e,n){this.wrap=e,this.canonical=n,this.key=vh(e,n.z,n.z,n.x,n.y)}}class Ir{constructor(e,n,o,c,d){this.overscaledZ=e,this.wrap=n,this.canonical=new Kp(o,+c,+d),this.key=n===0&&e===o?this.canonical.key:vh(n,e,o,c,d)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const n=this.canonical.z-e;return e>this.canonical.z?new Ir(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ir(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return vh(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{const o=this.canonical.z-e;return vh(this.wrap*+n,e,e,this.canonical.x>>o,this.canonical.y>>o)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new Ir(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,o=2*this.canonical.x,c=2*this.canonical.y;return[new Ir(n,this.wrap,n,o,c),new Ir(n,this.wrap,n,o+1,c),new Ir(n,this.wrap,n,o,c+1),new Ir(n,this.wrap,n,o+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Ir(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Ir(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Jx(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function vh(t,e,n,o,c){const d=1<<Math.min(n,22);let f=d*(c%d)+o%d;return t&&n<22&&(f+=d*d*((t<0?-2*t-1:2*t)%(1<<2*(22-n)))),16*(32*f+n)+(e-n)}rt(Kp,"CanonicalTileID"),rt(Ir,"OverscaledTileID",{omit:["projMatrix"]});class xc extends Me{constructor(e,n,o){super(e,n),this.z=o}}function wh(t,e){return t.x*e.x+t.y*e.y}function Qx(t,e){if(t.length===1){let n=0;const o=e[n++];let c;for(;!c||o.equals(c);)if(c=e[n++],!c)return 1/0;for(;n<e.length;n++){const d=e[n],f=t[0],g=c.sub(o),x=d.sub(o),w=f.sub(o),E=wh(g,g),M=wh(g,x),A=wh(x,x),P=wh(w,g),D=wh(w,x),O=E*A-M*M,N=(A*P-M*D)/O,J=(E*D-M*P)/O,re=o.z*(1-N-J)+c.z*N+d.z*J;if(isFinite(re))return re}return 1/0}{let n=1/0;for(const o of e)n=Math.min(n,o.z);return n}}function ev(t,e,n,o,c,d,f,g){const x=f*c.getElevationAt(t,e,!0,!0),w=d[0]!==0,E=w?d[1]===0?f*(d[0]/7-450):f*function(M,A,P){const D=Math.floor(A[0]/8),O=Math.floor(A[1]/8),N=10*(A[0]-8*D),J=10*(A[1]-8*O),re=M.getElevationAt(D,O,!0,!0),K=M.getMeterToDEM(P),te=Math.floor(.5*(N*K-1)),ce=Math.floor(.5*(J*K-1)),oe=M.tileCoordToPixel(D,O),Se=2*te+1,Te=2*ce+1,ke=function(Ze,Pe,it,St,lt){return[Ze.getElevationAtPixel(Pe,it,!0),Ze.getElevationAtPixel(Pe+lt,it,!0),Ze.getElevationAtPixel(Pe,it+lt,!0),Ze.getElevationAtPixel(Pe+St,it+lt,!0)]}(M,oe.x-te,oe.y-ce,Se,Te),$e=Math.abs(ke[0]-ke[1]),Ae=Math.abs(ke[2]-ke[3]),Re=Math.abs(ke[0]-ke[2])+Math.abs(ke[1]-ke[3]),Be=Math.min(.25,.5*K*($e+Ae)/Se),Ne=Math.min(.25,.5*K*Re/Te);return re+Math.max(Be*N,Ne*J)}(c,d,g):x;return{base:x+(n===0)?-1:n,top:w?Math.max(E+o,x+n+2):x+o}}const PE=Xe([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:DE}=PE,LE=Xe([{name:"a_packed",components:4,type:"Float32"}]),{members:RE}=LE,BE=Hp.types,OE=Math.cos(Math.PI/180*37.5);class Jp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new Jt,this.layoutVertexArray2=new Gn,this.indexArray=new _r,this.programConfigurations=new Ya(e.layers,e.zoom),this.segments=new Un,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,o,c){this.hasPattern=A_("line",this.layers,n);const d=this.layers[0].layout.get("line-sort-key"),f=[];for(const{feature:E,id:M,index:A,sourceLayerIndex:P}of e){const D=this.layers[0]._featureFilter.needGeometry,O=Ka(E,D);if(!this.layers[0]._featureFilter.filter(new Q(this.zoom),O,o))continue;const N=d?d.evaluate(O,{},o):void 0,J={id:M,properties:E.properties,type:E.type,sourceLayerIndex:P,index:A,geometry:D?O.geometry:Ko(E,o,c),patterns:{},sortKey:N};f.push(J)}d&&f.sort((E,M)=>E.sortKey-M.sortKey);const{lineAtlas:g,featureIndex:x}=n,w=this.addConstantDashes(g);for(const E of f){const{geometry:M,index:A,sourceLayerIndex:P}=E;if(w&&this.addFeatureDashes(E,g),this.hasPattern){const D=I_("line",this.layers,E,this.zoom,n);this.patternFeatures.push(D)}else this.addFeature(E,M,A,o,g.positions,n.availableImages);x.insert(e[A].feature,M,A,P,this.index)}}addConstantDashes(e){let n=!1;for(const o of this.layers){const c=o.paint.get("line-dasharray").value,d=o.layout.get("line-cap").value;if(c.kind!=="constant"||d.kind!=="constant")n=!0;else{const f=d.value,g=c.value;if(!g)continue;e.addDash(g.from,f),e.addDash(g.to,f),g.other&&e.addDash(g.other,f)}}return n}addFeatureDashes(e,n){const o=this.zoom;for(const c of this.layers){const d=c.paint.get("line-dasharray").value,f=c.layout.get("line-cap").value;if(d.kind==="constant"&&f.kind==="constant")continue;let g,x,w,E,M,A;if(d.kind==="constant"){const N=d.value;if(!N)continue;g=N.other||N.to,x=N.to,w=N.from}else g=d.evaluate({zoom:o-1},e),x=d.evaluate({zoom:o},e),w=d.evaluate({zoom:o+1},e);f.kind==="constant"?E=M=A=f.value:(E=f.evaluate({zoom:o-1},e),M=f.evaluate({zoom:o},e),A=f.evaluate({zoom:o+1},e)),n.addDash(g,E),n.addDash(x,M),n.addDash(w,A);const P=n.getKey(g,E),D=n.getKey(x,M),O=n.getKey(w,A);e.patterns[c.id]={min:P,mid:D,max:O}}}update(e,n,o,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,o,c)}addFeatures(e,n,o,c,d){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,n,o,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,RE)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,DE),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,o,c,d,f){const g=this.layers[0].layout,x=g.get("line-join").evaluate(e,{}),w=g.get("line-cap").evaluate(e,{}),E=g.get("line-miter-limit"),M=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const A of n)this.addLine(A,e,x,w,E,M);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,d,f,c)}addLine(e,n,o,c,d,f){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let J=0;J<e.length-1;J++)this.totalDistance+=e[J].dist(e[J+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const g=BE[n.type]==="Polygon";let x=e.length;for(;x>=2&&e[x-1].equals(e[x-2]);)x--;let w=0;for(;w<x-1&&e[w].equals(e[w+1]);)w++;if(x<(g?3:2))return;o==="bevel"&&(d=1.05);const E=this.overscaling<=16?122880/(512*this.overscaling):0,M=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray);let A,P,D,O,N;this.e1=this.e2=-1,g&&(A=e[x-2],N=e[w].sub(A)._unit()._perp());for(let J=w;J<x;J++){if(D=J===x-1?g?e[w+1]:void 0:e[J+1],D&&e[J].equals(D))continue;N&&(O=N),A&&(P=A),A=e[J],N=D?D.sub(A)._unit()._perp():O,O=O||N;let re=O.add(N);re.x===0&&re.y===0||re._unit();const K=O.x*N.x+O.y*N.y,te=re.x*N.x+re.y*N.y,ce=te!==0?1/te:1/0,oe=2*Math.sqrt(2-2*te),Se=te<OE&&P&&D,Te=O.x*N.y-O.y*N.x>0;if(Se&&J>w){const Ae=A.dist(P);if(Ae>2*E){const Re=A.sub(A.sub(P)._mult(E/Ae)._round());this.updateDistance(P,Re),this.addCurrentVertex(Re,O,0,0,M),P=Re}}const ke=P&&D;let $e=ke?o:g?"butt":c;if(ke&&$e==="round"&&(ce<f?$e="miter":ce<=2&&($e="fakeround")),$e==="miter"&&ce>d&&($e="bevel"),$e==="bevel"&&(ce>2&&($e="flipbevel"),ce<d&&($e="miter")),P&&this.updateDistance(P,A),$e==="miter")re._mult(ce),this.addCurrentVertex(A,re,0,0,M);else if($e==="flipbevel"){if(ce>100)re=N.mult(-1);else{const Ae=ce*O.add(N).mag()/O.sub(N).mag();re._perp()._mult(Ae*(Te?-1:1))}this.addCurrentVertex(A,re,0,0,M),this.addCurrentVertex(A,re.mult(-1),0,0,M)}else if($e==="bevel"||$e==="fakeround"){const Ae=-Math.sqrt(ce*ce-1),Re=Te?Ae:0,Be=Te?0:Ae;if(P&&this.addCurrentVertex(A,O,Re,Be,M),$e==="fakeround"){const Ne=Math.round(180*oe/Math.PI/20);for(let Ze=1;Ze<Ne;Ze++){let Pe=Ze/Ne;if(Pe!==.5){const St=Pe-.5;Pe+=Pe*St*(Pe-1)*((1.0904+K*(K*(3.55645-1.43519*K)-3.2452))*St*St+(.848013+K*(.215638*K-1.06021)))}const it=N.sub(O)._mult(Pe)._add(O)._unit()._mult(Te?-1:1);this.addHalfVertex(A,it.x,it.y,!1,Te,0,M)}}D&&this.addCurrentVertex(A,N,-Re,-Be,M)}else if($e==="butt")this.addCurrentVertex(A,re,0,0,M);else if($e==="square"){const Ae=P?1:-1;P||this.addCurrentVertex(A,re,Ae,Ae,M),this.addCurrentVertex(A,re,0,0,M),P&&this.addCurrentVertex(A,re,Ae,Ae,M)}else $e==="round"&&(P&&(this.addCurrentVertex(A,O,0,0,M),this.addCurrentVertex(A,O,1,1,M,!0)),D&&(this.addCurrentVertex(A,N,-1,-1,M,!0),this.addCurrentVertex(A,N,0,0,M)));if(Se&&J<x-1){const Ae=A.dist(D);if(Ae>2*E){const Re=A.add(D.sub(A)._mult(E/Ae)._round());this.updateDistance(A,Re),this.addCurrentVertex(Re,N,0,0,M),A=Re}}}}addCurrentVertex(e,n,o,c,d,f=!1){const g=n.y*c-n.x,x=-n.y-n.x*c;this.addHalfVertex(e,n.x+n.y*o,n.y-n.x*o,f,!1,o,d),this.addHalfVertex(e,g,x,f,!0,-c,d)}addHalfVertex({x:e,y:n},o,c,d,f,g,x){this.layoutVertexArray.emplaceBack((e<<1)+(d?1:0),(n<<1)+(f?1:0),Math.round(63*o)+128,Math.round(63*c)+128,1+(g===0?0:g<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const w=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,w),x.primitiveLength++),f?this.e2=w:this.e1=w}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}rt(Jp,"LineBucket",{omit:["layers","patternFeatures"]});const FE=new We({"line-cap":new pe(ze.layout_line["line-cap"]),"line-join":new pe(ze.layout_line["line-join"]),"line-miter-limit":new ve(ze.layout_line["line-miter-limit"]),"line-round-limit":new ve(ze.layout_line["line-round-limit"]),"line-sort-key":new pe(ze.layout_line["line-sort-key"])});var tv={paint:new We({"line-opacity":new pe(ze.paint_line["line-opacity"]),"line-color":new pe(ze.paint_line["line-color"]),"line-translate":new ve(ze.paint_line["line-translate"]),"line-translate-anchor":new ve(ze.paint_line["line-translate-anchor"]),"line-width":new pe(ze.paint_line["line-width"]),"line-gap-width":new pe(ze.paint_line["line-gap-width"]),"line-offset":new pe(ze.paint_line["line-offset"]),"line-blur":new pe(ze.paint_line["line-blur"]),"line-dasharray":new Ke(ze.paint_line["line-dasharray"]),"line-pattern":new Ke(ze.paint_line["line-pattern"]),"line-gradient":new Ye(ze.paint_line["line-gradient"]),"line-trim-offset":new ve(ze.paint_line["line-trim-offset"])}),layout:FE};const nv=new class extends pe{possiblyEvaluate(t,e){return e=new Q(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,o){return e=_t({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,o)}}(tv.paint.properties["line-width"].specification);function rv(t,e){return e>0?e+2*t:t}nv.useIntegerZoom=!0;const UE=Xe([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),NE=Xe([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),jE=Xe([{name:"a_projected_pos",components:4,type:"Float32"}],4);Xe([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const VE=Xe([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),GE=Xe([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Xe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const iv=Xe([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),$E=Xe([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Xe([{name:"triangle",components:3,type:"Uint16"}]),Xe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Xe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Xe([{type:"Float32",name:"offsetX"}]),Xe([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var lr=24;const Ao=128;function k_(t,e){const{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new Q(t+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:c}=n;let d=0;for(;d<o.length&&o[d]<=t;)d++;d=Math.max(0,d-1);let f=d;for(;f<o.length&&o[f]<t+1;)f++;f=Math.min(o.length-1,f);const g=o[d],x=o[f];return n.kind==="composite"?{kind:"composite",minZoom:g,maxZoom:x,interpolationType:c}:{kind:"camera",minZoom:g,maxZoom:x,minSize:n.evaluate(new Q(g)),maxSize:n.evaluate(new Q(x)),interpolationType:c}}}function Qp(t,{uSize:e,uSizeT:n},{lowerSize:o,upperSize:c}){return t.kind==="source"?o/Ao:t.kind==="composite"?Gt(o/Ao,c/Ao,n):e}function vc(t,e){let n=0,o=0;if(t.kind==="constant")o=t.layoutSize;else if(t.kind!=="source"){const{interpolationType:c,minZoom:d,maxZoom:f}=t,g=c?Ot(Ei.interpolationFactor(c,e,d,f),0,1):0;t.kind==="camera"?o=Gt(t.minSize,t.maxSize,g):n=g}return{uSizeT:n,uSize:o}}var ZE=Object.freeze({__proto__:null,getSizeData:k_,evaluateSizeForFeature:Qp,evaluateSizeForZoom:vc,SIZE_PACK_FACTOR:Ao});function qE(t,e,n){return t.sections.forEach(o=>{o.text=function(c,d,f){const g=d.layout.get("text-transform").evaluate(f,{});return g==="uppercase"?c=c.toLocaleUpperCase():g==="lowercase"&&(c=c.toLocaleLowerCase()),ie.applyArabicShaping&&(c=ie.applyArabicShaping(c)),c}(o.text,e,n)}),t}const bh={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};function WE(t){return t==="\uFE36"||t==="\uFE48"||t==="\uFE38"||t==="\uFE44"||t==="\uFE42"||t==="\uFE3E"||t==="\uFE3C"||t==="\uFE3A"||t==="\uFE18"||t==="\uFE40"||t==="\uFE10"||t==="\uFE13"||t==="\uFE14"||t==="\uFF40"||t==="\uFFE3"||t==="\uFE11"||t==="\uFE12"}function XE(t){return t==="\uFE35"||t==="\uFE47"||t==="\uFE37"||t==="\uFE43"||t==="\uFE41"||t==="\uFE3D"||t==="\uFE3B"||t==="\uFE39"||t==="\uFE17"||t==="\uFE3F"}var Th=un,ov=function(t,e,n,o,c){var d,f,g=8*c-o-1,x=(1<<g)-1,w=x>>1,E=-7,M=n?c-1:0,A=n?-1:1,P=t[e+M];for(M+=A,d=P&(1<<-E)-1,P>>=-E,E+=g;E>0;d=256*d+t[e+M],M+=A,E-=8);for(f=d&(1<<-E)-1,d>>=-E,E+=o;E>0;f=256*f+t[e+M],M+=A,E-=8);if(d===0)d=1-w;else{if(d===x)return f?NaN:1/0*(P?-1:1);f+=Math.pow(2,o),d-=w}return(P?-1:1)*f*Math.pow(2,d-o)},sv=function(t,e,n,o,c,d){var f,g,x,w=8*d-c-1,E=(1<<w)-1,M=E>>1,A=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,P=o?0:d-1,D=o?1:-1,O=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(g=isNaN(e)?1:0,f=E):(f=Math.floor(Math.log(e)/Math.LN2),e*(x=Math.pow(2,-f))<1&&(f--,x*=2),(e+=f+M>=1?A/x:A*Math.pow(2,1-M))*x>=2&&(f++,x/=2),f+M>=E?(g=0,f=E):f+M>=1?(g=(e*x-1)*Math.pow(2,c),f+=M):(g=e*Math.pow(2,M-1)*Math.pow(2,c),f=0));c>=8;t[n+P]=255&g,P+=D,g/=256,c-=8);for(f=f<<c|g,w+=c;w>0;t[n+P]=255&f,P+=D,f/=256,w-=8);t[n+P-D]|=128*O};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function un(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}un.Varint=0,un.Fixed64=1,un.Bytes=2,un.Fixed32=5;var P_=4294967296,av=1/P_,lv=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function es(t){return t.type===un.Bytes?t.readVarint()+t.pos:t.pos+1}function wc(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function cv(t,e,n){var o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(o);for(var c=n.pos-1;c>=t;c--)n.buf[c+o]=n.buf[c]}function HE(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function YE(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function KE(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function JE(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function QE(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function eS(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function tS(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function nS(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function rS(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function ef(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function bc(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function uv(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function iS(t,e,n){e.glyphs=[],t===1&&n.readMessage(oS,e)}function oS(t,e,n){if(t===3){const{id:o,bitmap:c,width:d,height:f,left:g,top:x,advance:w}=n.readMessage(sS,{});e.glyphs.push({id:o,bitmap:new Qo({width:d+6,height:f+6},c),metrics:{width:d,height:f,left:g,top:x,advance:w}})}else t===4?e.ascender=n.readSVarint():t===5&&(e.descender=n.readSVarint())}function sS(t,e,n){t===1?e.id=n.readVarint():t===2?e.bitmap=n.readBytes():t===3?e.width=n.readVarint():t===4?e.height=n.readVarint():t===5?e.left=n.readSVarint():t===6?e.top=n.readSVarint():t===7&&(e.advance=n.readVarint())}function D_(t){let e=0,n=0;for(const f of t)e+=f.w*f.h,n=Math.max(n,f.w);t.sort((f,g)=>g.h-f.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let c=0,d=0;for(const f of t)for(let g=o.length-1;g>=0;g--){const x=o[g];if(!(f.w>x.w||f.h>x.h)){if(f.x=x.x,f.y=x.y,d=Math.max(d,f.y+f.h),c=Math.max(c,f.x+f.w),f.w===x.w&&f.h===x.h){const w=o.pop();g<o.length&&(o[g]=w)}else f.h===x.h?(x.x+=f.w,x.w-=f.w):f.w===x.w?(x.y+=f.h,x.h-=f.h):(o.push({x:x.x+f.w,y:x.y,w:x.w-f.w,h:f.h}),x.y+=f.h,x.h-=f.h);break}}return{w:c,h:d,fill:e/(c*d)||0}}un.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var o=this.readVarint(),c=o>>3,d=this.pos;this.type=7&o,t(c,e,this),this.pos===d&&this.skip(o)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=ef(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=uv(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=ef(this.buf,this.pos)+ef(this.buf,this.pos+4)*P_;return this.pos+=8,t},readSFixed64:function(){var t=ef(this.buf,this.pos)+uv(this.buf,this.pos+4)*P_;return this.pos+=8,t},readFloat:function(){var t=ov(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=ov(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,o=this.buf;return e=127&(n=o[this.pos++]),n<128?e:(e|=(127&(n=o[this.pos++]))<<7,n<128?e:(e|=(127&(n=o[this.pos++]))<<14,n<128?e:(e|=(127&(n=o[this.pos++]))<<21,n<128?e:function(c,d,f){var g,x,w=f.buf;if(g=(112&(x=w[f.pos++]))>>4,x<128||(g|=(127&(x=w[f.pos++]))<<3,x<128)||(g|=(127&(x=w[f.pos++]))<<10,x<128)||(g|=(127&(x=w[f.pos++]))<<17,x<128)||(g|=(127&(x=w[f.pos++]))<<24,x<128)||(g|=(1&(x=w[f.pos++]))<<31,x<128))return wc(c,g,d);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=o[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&lv?function(n,o,c){return lv.decode(n.subarray(o,c))}(this.buf,e,t):function(n,o,c){for(var d="",f=o;f<c;){var g,x,w,E=n[f],M=null,A=E>239?4:E>223?3:E>191?2:1;if(f+A>c)break;A===1?E<128&&(M=E):A===2?(192&(g=n[f+1]))==128&&(M=(31&E)<<6|63&g)<=127&&(M=null):A===3?(x=n[f+2],(192&(g=n[f+1]))==128&&(192&x)==128&&((M=(15&E)<<12|(63&g)<<6|63&x)<=2047||M>=55296&&M<=57343)&&(M=null)):A===4&&(x=n[f+2],w=n[f+3],(192&(g=n[f+1]))==128&&(192&x)==128&&(192&w)==128&&((M=(15&E)<<18|(63&g)<<12|(63&x)<<6|63&w)<=65535||M>=1114112)&&(M=null)),M===null?(M=65533,A=1):M>65535&&(M-=65536,d+=String.fromCharCode(M>>>10&1023|55296),M=56320|1023&M),d+=String.fromCharCode(M),f+=A}return d}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==un.Bytes)return t.push(this.readVarint(e));var n=es(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==un.Bytes)return t.push(this.readSVarint());var e=es(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==un.Bytes)return t.push(this.readBoolean());var e=es(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==un.Bytes)return t.push(this.readFloat());var e=es(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==un.Bytes)return t.push(this.readDouble());var e=es(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==un.Bytes)return t.push(this.readFixed32());var e=es(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==un.Bytes)return t.push(this.readSFixed32());var e=es(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==un.Bytes)return t.push(this.readFixed64());var e=es(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==un.Bytes)return t.push(this.readSFixed64());var e=es(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===un.Varint)for(;this.buf[this.pos++]>127;);else if(e===un.Bytes)this.pos=this.readVarint()+this.pos;else if(e===un.Fixed32)this.pos+=4;else{if(e!==un.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),bc(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),bc(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),bc(this.buf,-1&t,this.pos),bc(this.buf,Math.floor(t*av),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),bc(this.buf,-1&t,this.pos),bc(this.buf,Math.floor(t*av),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,n){var o,c;if(e>=0?(o=e%4294967296|0,c=e/4294967296|0):(c=~(-e/4294967296),4294967295^(o=~(-e%4294967296))?o=o+1|0:(o=0,c=c+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(d,f,g){g.buf[g.pos++]=127&d|128,d>>>=7,g.buf[g.pos++]=127&d|128,d>>>=7,g.buf[g.pos++]=127&d|128,d>>>=7,g.buf[g.pos++]=127&d|128,g.buf[g.pos]=127&(d>>>=7)}(o,0,n),function(d,f){var g=(7&d)<<4;f.buf[f.pos++]|=g|((d>>>=3)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d)))))}(c,n)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(o,c,d){for(var f,g,x=0;x<c.length;x++){if((f=c.charCodeAt(x))>55295&&f<57344){if(!g){f>56319||x+1===c.length?(o[d++]=239,o[d++]=191,o[d++]=189):g=f;continue}if(f<56320){o[d++]=239,o[d++]=191,o[d++]=189,g=f;continue}f=g-55296<<10|f-56320|65536,g=null}else g&&(o[d++]=239,o[d++]=191,o[d++]=189,g=null);f<128?o[d++]=f:(f<2048?o[d++]=f>>6|192:(f<65536?o[d++]=f>>12|224:(o[d++]=f>>18|240,o[d++]=f>>12&63|128),o[d++]=f>>6&63|128),o[d++]=63&f|128)}return d}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&cv(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),sv(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),sv(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var o=this.pos-n;o>=128&&cv(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o},writeMessage:function(t,e,n){this.writeTag(t,un.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,HE,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,YE,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,QE,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,KE,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,JE,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,eS,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,tS,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,nS,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,rS,e)},writeBytesField:function(t,e){this.writeTag(t,un.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,un.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,un.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,un.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,un.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,un.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,un.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,un.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,un.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,un.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};class L_{constructor(e,{pixelRatio:n,version:o,stretchX:c,stretchY:d,content:f}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=c,this.stretchY=d,this.content=f,this.version=o}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class hv{constructor(e,n){const o={},c={};this.haveRenderCallbacks=[];const d=[];this.addImages(e,o,d),this.addImages(n,c,d);const{w:f,h:g}=D_(d),x=new Zr({width:f||1,height:g||1});for(const w in e){const E=e[w],M=o[w].paddedRect;Zr.copy(E.data,x,{x:0,y:0},{x:M.x+1,y:M.y+1},E.data)}for(const w in n){const E=n[w],M=c[w].paddedRect,A=M.x+1,P=M.y+1,D=E.data.width,O=E.data.height;Zr.copy(E.data,x,{x:0,y:0},{x:A,y:P},E.data),Zr.copy(E.data,x,{x:0,y:O-1},{x:A,y:P-1},{width:D,height:1}),Zr.copy(E.data,x,{x:0,y:0},{x:A,y:P+O},{width:D,height:1}),Zr.copy(E.data,x,{x:D-1,y:0},{x:A-1,y:P},{width:1,height:O}),Zr.copy(E.data,x,{x:0,y:0},{x:A+D,y:P},{width:1,height:O})}this.image=x,this.iconPositions=o,this.patternPositions=c}addImages(e,n,o){for(const c in e){const d=e[c],f={x:0,y:0,w:d.data.width+2,h:d.data.height+2};o.push(f),n[c]=new L_(f,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,n){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(o=>e.hasImage(o)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in e.updatedImages)this.patchUpdatedImage(this.iconPositions[o],e.getImage(o),n),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o),n)}patchUpdatedImage(e,n,o){if(!e||!n||e.version===n.version)return;e.version=n.version;const[c,d]=e.tl;o.update(n.data,void 0,{x:c,y:d})}}rt(L_,"ImagePosition"),rt(hv,"ImageAtlas");const hi={horizontal:1,vertical:2,horizontalOnly:3};class Eh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){const o=new Eh;return o.scale=e||1,o.fontStack=n,o}static forImage(e){const n=new Eh;return n.imageName=e,n}}class Tc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){const o=new Tc;for(let c=0;c<e.sections.length;c++){const d=e.sections[c];d.image?o.addImageSection(d):o.addTextSection(d,n)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(n,o){let c="";for(let d=0;d<n.length;d++){const f=n.charCodeAt(d+1)||null,g=n.charCodeAt(d-1)||null;c+=!o&&(f&&b(f)&&!bh[n[d+1]]||g&&b(g)&&!bh[n[d-1]])||!bh[n[d]]?n[d]:bh[n[d]]}return c}(this.text,e)}trim(){let e=0;for(let o=0;o<this.text.length&&tf[this.text.charCodeAt(o)];o++)e++;let n=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&tf[this.text.charCodeAt(o)];o--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const o=new Tc;return o.text=this.text.substring(e,n),o.sectionIndex=this.sectionIndex.slice(e,n),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(Eh.forText(e.scale,e.fontStack||n));const o=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(o)}addImageSection(e){const n=e.image?e.image.name:"";if(n.length===0)return void Tn("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(Eh.forImage(n)),this.sectionIndex.push(this.sections.length-1)):Tn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function R_(t,e,n,o,c,d,f,g,x,w,E,M,A,P,D,O){const N=Tc.fromFeature(t,c);let J;M===hi.vertical&&N.verticalizePunctuation(A);const{processBidirectionalText:re,processStyledBidirectionalText:K}=ie;if(re&&N.sections.length===1){J=[];const oe=re(N.toString(),B_(N,w,d,e,o,P,D));for(const Se of oe){const Te=new Tc;Te.text=Se,Te.sections=N.sections;for(let ke=0;ke<Se.length;ke++)Te.sectionIndex.push(0);J.push(Te)}}else if(K){J=[];const oe=K(N.text,N.sectionIndex,B_(N,w,d,e,o,P,D));for(const Se of oe){const Te=new Tc;Te.text=Se[0],Te.sectionIndex=Se[1],Te.sections=N.sections,J.push(Te)}}else J=function(oe,Se){const Te=[],ke=oe.text;let $e=0;for(const Ae of Se)Te.push(oe.substring($e,Ae)),$e=Ae;return $e<ke.length&&Te.push(oe.substring($e,ke.length)),Te}(N,B_(N,w,d,e,o,P,D));const te=[],ce={positionedLines:te,text:N.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:M,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(oe,Se,Te,ke,$e,Ae,Re,Be,Ne,Ze,Pe,it){let St=0,lt=0,ot=0;const et=Be==="right"?1:Be==="left"?0:.5;let bt=!1;for(const Lt of $e){const jt=Lt.getSections();for(const on of jt){if(on.imageName)continue;const fn=Se[on.fontStack];if(fn&&(bt=fn.ascender!==void 0&&fn.descender!==void 0,!bt))break}if(!bt)break}let kt=0;for(const Lt of $e){Lt.trim();const jt=Lt.getMaxScale(),on=(jt-1)*lr,fn={positionedGlyphs:[],lineOffset:0};oe.positionedLines[kt]=fn;const hn=fn.positionedGlyphs;let mn=0;if(!Lt.length()){lt+=Ae,++kt;continue}let yn=0,Sn=0;for(let Qt=0;Qt<Lt.length();Qt++){const jn=Lt.getSection(Qt),Ln=Lt.getSectionIndex(Qt),Zt=Lt.getCharCode(Qt);let wn=jn.scale,$n=null,sn=null,In=null,gr=lr,Jn=0;const Qn=!(Ne===hi.horizontal||!Pe&&!y(Zt)||Pe&&(tf[Zt]||(Pt=Zt,wp(Pt)||qa(Pt)||bp(Pt)||rh(Pt)||u(Pt))));if(jn.imageName){const zr=ke[jn.imageName];if(!zr)continue;In=jn.imageName,oe.iconsInText=oe.iconsInText||!0,sn=zr.paddedRect;const er=zr.displaySize;wn=wn*lr/it,$n={width:er[0],height:er[1],left:1,top:-3,advance:Qn?er[1]:er[0],localGlyph:!1},Jn=bt?-$n.height*wn:jt*lr-17-er[1]*wn,gr=$n.advance;const rs=(Qn?er[0]:er[1])*wn-lr*jt;rs>0&&rs>mn&&(mn=rs)}else{const zr=Te[jn.fontStack];if(!zr)continue;zr[Zt]&&(sn=zr[Zt]);const er=Se[jn.fontStack];if(!er)continue;const rs=er.glyphs[Zt];if(!rs)continue;if($n=rs.metrics,gr=Zt!==8203?lr:0,bt){const Pc=er.ascender!==void 0?Math.abs(er.ascender):0,Bh=er.descender!==void 0?Math.abs(er.descender):0,Oh=(Pc+Bh)*wn;yn<Oh&&(yn=Oh,Sn=(Pc-Bh)/2*wn),Jn=-Pc*wn}else Jn=(jt-wn)*lr-17}Qn?(oe.verticalizable=!0,hn.push({glyph:Zt,imageName:In,x:St,y:lt+Jn,vertical:Qn,scale:wn,localGlyph:$n.localGlyph,fontStack:jn.fontStack,sectionIndex:Ln,metrics:$n,rect:sn}),St+=gr*wn+Ze):(hn.push({glyph:Zt,imageName:In,x:St,y:lt+Jn,vertical:Qn,scale:wn,localGlyph:$n.localGlyph,fontStack:jn.fontStack,sectionIndex:Ln,metrics:$n,rect:sn}),St+=$n.advance*wn+Ze)}hn.length!==0&&(ot=Math.max(St-Ze,ot),bt?_v(hn,et,mn,Sn,Ae*jt/2):_v(hn,et,mn,0,Ae/2)),St=0;const Kn=Ae*jt+mn;fn.lineOffset=Math.max(mn,on),lt+=Kn,++kt}var Pt;const $t=lt,{horizontalAlign:It,verticalAlign:gn}=O_(Re);(function(Lt,jt,on,fn,hn,mn){const yn=(jt-on)*hn,Sn=-mn*fn;for(const Kn of Lt)for(const Qt of Kn.positionedGlyphs)Qt.x+=yn,Qt.y+=Sn})(oe.positionedLines,et,It,gn,ot,$t),oe.top+=-gn*$t,oe.bottom=oe.top+$t,oe.left+=-It*ot,oe.right=oe.left+ot,oe.hasBaseline=bt}(ce,e,n,o,J,f,g,x,M,w,A,O),!function(oe){for(const Se of oe)if(Se.positionedGlyphs.length!==0)return!1;return!0}(te)&&ce}const tf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},aS={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function dv(t,e,n,o,c,d){if(e.imageName){const f=o[e.imageName];return f?f.displaySize[0]*e.scale*lr/d+c:0}{const f=n[e.fontStack],g=f&&f.glyphs[t];return g?g.metrics.advance*e.scale+c:0}}function pv(t,e,n,o){const c=Math.pow(t-e,2);return o?t<e?c/2:2*c:c+Math.abs(n)*n}function lS(t,e,n){let o=0;return t===10&&(o-=1e4),n&&(o+=150),t!==40&&t!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function fv(t,e,n,o,c,d){let f=null,g=pv(e,n,c,d);for(const x of o){const w=pv(e-x.x,n,c,d)+x.badness;w<=g&&(f=x,g=w)}return{index:t,x:e,priorBreak:f,badness:g}}function mv(t){return t?mv(t.priorBreak).concat(t.index):[]}function B_(t,e,n,o,c,d,f){if(d!=="point")return[];if(!t)return[];const g=[],x=function(A,P,D,O,N,J){let re=0;for(let K=0;K<A.length();K++){const te=A.getSection(K);re+=dv(A.getCharCode(K),te,O,N,P,J)}return re/Math.max(1,Math.ceil(re/D))}(t,e,n,o,c,f),w=t.text.indexOf("\u200B")>=0;let E=0;for(let A=0;A<t.length();A++){const P=t.getSection(A),D=t.getCharCode(A);if(tf[D]||(E+=dv(D,P,o,c,e,f)),A<t.length()-1){const O=!((M=D)<11904||!(lc(M)||ac(M)||uc(M)||zp(M)||Cp(M)||Qu(M)||Ep(M)||Wa(M)||Mp(M)||nh(M)||th(M)||r(M)||sc(M)||eh(M)||Tp(M)||Sp(M)||Xa(M)||kp(M)||Ap(M)||cc(M)));(aS[D]||O||P.imageName)&&g.push(fv(A+1,E,x,g,lS(D,t.getCharCode(A+1),O&&w),!1))}}var M;return mv(fv(t.length(),E,x,g,0,!0))}function O_(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function _v(t,e,n,o,c){if(!(e||n||o||c))return;const d=t.length-1,f=t[d],g=(f.x+f.metrics.advance*f.scale)*e;for(let x=0;x<=d;x++)t[x].x-=g,t[x].y+=n+o+c}function cS(t,e,n){const{horizontalAlign:o,verticalAlign:c}=O_(n),d=e[0]-t.displaySize[0]*o,f=e[1]-t.displaySize[1]*c;return{image:t,top:f,bottom:f+t.displaySize[1],left:d,right:d+t.displaySize[0]}}function gv(t,e,n,o,c,d){const f=t.image;let g;if(f.content){const N=f.content,J=f.pixelRatio||1;g=[N[0]/J,N[1]/J,f.displaySize[0]-N[2]/J,f.displaySize[1]-N[3]/J]}const x=e.left*d,w=e.right*d;let E,M,A,P;n==="width"||n==="both"?(P=c[0]+x-o[3],M=c[0]+w+o[1]):(P=c[0]+(x+w-f.displaySize[0])/2,M=P+f.displaySize[0]);const D=e.top*d,O=e.bottom*d;return n==="height"||n==="both"?(E=c[1]+D-o[0],A=c[1]+O+o[2]):(E=c[1]+(D+O-f.displaySize[1])/2,A=E+f.displaySize[1]),{image:f,top:E,right:M,bottom:A,left:P,collisionPadding:g}}class ts extends Me{constructor(e,n,o,c,d){super(e,n),this.angle=c,this.z=o,d!==void 0&&(this.segment=d)}clone(){return new ts(this.x,this.y,this.z,this.angle,this.segment)}}function yv(t,e,n,o,c){if(e.segment===void 0)return!0;let d=e,f=e.segment+1,g=0;for(;g>-n/2;){if(f--,f<0)return!1;g-=t[f].dist(d),d=t[f]}g+=t[f].dist(t[f+1]),f++;const x=[];let w=0;for(;g<n/2;){const E=t[f],M=t[f+1];if(!M)return!1;let A=t[f-1].angleTo(E)-E.angleTo(M);for(A=Math.abs((A+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:g,angleDelta:A}),w+=A;g-x[0].distance>o;)w-=x.shift().angleDelta;if(w>c)return!1;f++,g+=E.dist(M)}return!0}function xv(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function vv(t,e,n){return t?.6*e*n:0}function wv(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function uS(t,e,n,o,c,d){const f=vv(n,c,d),g=wv(n,o)*d;let x=0;const w=xv(t)/2;for(let E=0;E<t.length-1;E++){const M=t[E],A=t[E+1],P=M.dist(A);if(x+P>w){const D=(w-x)/P,O=Gt(M.x,A.x,D),N=Gt(M.y,A.y,D),J=new ts(O,N,0,A.angleTo(M),E);return!f||yv(t,J,g,f,e)?J:void 0}x+=P}}function hS(t,e,n,o,c,d,f,g,x){const w=vv(o,d,f),E=wv(o,c),M=E*f,A=t[0].x===0||t[0].x===x||t[0].y===0||t[0].y===x;return e-M<e/4&&(e=M+e/4),bv(t,A?e/2*g%e:(E/2+2*d)*f*g%e,e,w,n,M,A,!1,x)}function bv(t,e,n,o,c,d,f,g,x){const w=d/2,E=xv(t);let M=0,A=e-n,P=[];for(let D=0;D<t.length-1;D++){const O=t[D],N=t[D+1],J=O.dist(N),re=N.angleTo(O);for(;A+n<M+J;){A+=n;const K=(A-M)/J,te=Gt(O.x,N.x,K),ce=Gt(O.y,N.y,K);if(te>=0&&te<x&&ce>=0&&ce<x&&A-w>=0&&A+w<=E){const oe=new ts(te,ce,0,re,D);oe._round(),o&&!yv(t,oe,d,o,c)||P.push(oe)}}M+=J}return g||P.length||f||(P=bv(t,M/2,n,o,c,d,f,!0,x)),P}function Tv(t,e,n,o,c){const d=[];for(let f=0;f<t.length;f++){const g=t[f];let x;for(let w=0;w<g.length-1;w++){let E=g[w],M=g[w+1];E.x<e&&M.x<e||(E.x<e?E=new Me(e,E.y+(e-E.x)/(M.x-E.x)*(M.y-E.y))._round():M.x<e&&(M=new Me(e,E.y+(e-E.x)/(M.x-E.x)*(M.y-E.y))._round()),E.y<n&&M.y<n||(E.y<n?E=new Me(E.x+(n-E.y)/(M.y-E.y)*(M.x-E.x),n)._round():M.y<n&&(M=new Me(E.x+(n-E.y)/(M.y-E.y)*(M.x-E.x),n)._round()),E.x>=o&&M.x>=o||(E.x>=o?E=new Me(o,E.y+(o-E.x)/(M.x-E.x)*(M.y-E.y))._round():M.x>=o&&(M=new Me(o,E.y+(o-E.x)/(M.x-E.x)*(M.y-E.y))._round()),E.y>=c&&M.y>=c||(E.y>=c?E=new Me(E.x+(c-E.y)/(M.y-E.y)*(M.x-E.x),c)._round():M.y>=c&&(M=new Me(E.x+(c-E.y)/(M.y-E.y)*(M.x-E.x),c)._round()),x&&E.equals(x[x.length-1])||(x=[E],d.push(x)),x.push(M)))))}}return d}rt(ts,"Anchor");const Sh=1e20;function Ev(t,e,n,o,c,d,f,g,x){for(let w=e;w<e+o;w++)Sv(t,n*d+w,d,c,f,g,x);for(let w=n;w<n+c;w++)Sv(t,w*d+e,1,o,f,g,x)}function Sv(t,e,n,o,c,d,f){d[0]=0,f[0]=-Sh,f[1]=Sh,c[0]=t[e];for(let g=1,x=0,w=0;g<o;g++){c[g]=t[e+g*n];const E=g*g;do{const M=d[x];w=(c[g]-c[M]+E-M*M)/(g-M)/2}while(w<=f[x]&&--x>-1);x++,d[x]=g,f[x]=w,f[x+1]=Sh}for(let g=0,x=0;g<o;g++){for(;f[x+1]<g;)x++;const w=d[x],E=g-w;t[e+g*n]=c[w]+E*E}}const F_={none:0,ideographs:1,all:2};class Ec{constructor(e,n,o){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=o,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,n){const o=[];for(const c in e)for(const d of e[c])o.push({stack:c,id:d});st(o,({stack:c,id:d},f)=>{let g=this.entries[c];g||(g=this.entries[c]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let x=g.glyphs[d];if(x!==void 0)return void f(null,{stack:c,id:d,glyph:x});if(x=this._tinySDF(g,c,d),x)return g.glyphs[d]=x,void f(null,{stack:c,id:d,glyph:x});const w=Math.floor(d/256);if(256*w>65535)return void f(new Error("glyphs > 65535 not supported"));if(g.ranges[w])return void f(null,{stack:c,id:d,glyph:x});let E=g.requests[w];E||(E=g.requests[w]=[],Ec.loadGlyphRange(c,w,this.url,this.requestManager,(M,A)=>{if(A){g.ascender=A.ascender,g.descender=A.descender;for(const P in A.glyphs)this._doesCharSupportLocalGlyph(+P)||(g.glyphs[+P]=A.glyphs[+P]);g.ranges[w]=!0}for(const P of E)P(M,A);delete g.requests[w]})),E.push((M,A)=>{M?f(M):A&&f(null,{stack:c,id:d,glyph:A.glyphs[d]||null})})},(c,d)=>{if(c)n(c);else if(d){const f={};for(const{stack:g,id:x,glyph:w}of d)f[g]===void 0&&(f[g]={}),f[g].glyphs===void 0&&(f[g].glyphs={}),f[g].glyphs[x]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics},f[g].ascender=this.entries[g].ascender,f[g].descender=this.entries[g].descender;n(null,f)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==F_.none&&(this.localGlyphMode===F_.all?!!this.localFontFamily:!!this.localFontFamily&&(nh(e)||Ip(e)||sc(e)||Xa(e)||Wa(e)))}_tinySDF(e,n,o){const c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(o))return;let d=e.tinySDF;if(!d){let O="400";/bold/i.test(n)?O="900":/medium/i.test(n)?O="500":/light/i.test(n)&&(O="200"),d=e.tinySDF=new Ec.TinySDF({fontFamily:c,fontWeight:O,fontSize:48,buffer:6,radius:16}),d.fontWeight=O}if(this.localGlyphs[d.fontWeight][o])return this.localGlyphs[d.fontWeight][o];const f=String.fromCharCode(o),{data:g,width:x,height:w,glyphWidth:E,glyphHeight:M,glyphLeft:A,glyphTop:P,glyphAdvance:D}=d.draw(f);return this.localGlyphs[d.fontWeight][o]={id:o,bitmap:new Qo({width:x,height:w},g),metrics:{width:E/2,height:M/2,left:A/2,top:P/2-27,advance:D/2,localGlyph:!0}}}}function Cv(t,e,n,o){const c=[],d=t.image,f=d.pixelRatio,g=d.paddedRect.w-2,x=d.paddedRect.h-2,w=t.right-t.left,E=t.bottom-t.top,M=d.stretchX||[[0,g]],A=d.stretchY||[[0,x]],P=(Ae,Re)=>Ae+Re[1]-Re[0],D=M.reduce(P,0),O=A.reduce(P,0),N=g-D,J=x-O;let re=0,K=D,te=0,ce=O,oe=0,Se=N,Te=0,ke=J;if(d.content&&o){const Ae=d.content;re=nf(M,0,Ae[0]),te=nf(A,0,Ae[1]),K=nf(M,Ae[0],Ae[2]),ce=nf(A,Ae[1],Ae[3]),oe=Ae[0]-re,Te=Ae[1]-te,Se=Ae[2]-Ae[0]-K,ke=Ae[3]-Ae[1]-ce}const $e=(Ae,Re,Be,Ne)=>{const Ze=rf(Ae.stretch-re,K,w,t.left),Pe=of(Ae.fixed-oe,Se,Ae.stretch,D),it=rf(Re.stretch-te,ce,E,t.top),St=of(Re.fixed-Te,ke,Re.stretch,O),lt=rf(Be.stretch-re,K,w,t.left),ot=of(Be.fixed-oe,Se,Be.stretch,D),et=rf(Ne.stretch-te,ce,E,t.top),bt=of(Ne.fixed-Te,ke,Ne.stretch,O),kt=new Me(Ze,it),Pt=new Me(lt,it),$t=new Me(lt,et),It=new Me(Ze,et),gn=new Me(Pe/f,St/f),Lt=new Me(ot/f,bt/f),jt=e*Math.PI/180;if(jt){const hn=Math.sin(jt),mn=Math.cos(jt),yn=[mn,-hn,hn,mn];kt._matMult(yn),Pt._matMult(yn),It._matMult(yn),$t._matMult(yn)}const on=Ae.stretch+Ae.fixed,fn=Re.stretch+Re.fixed;return{tl:kt,tr:Pt,bl:It,br:$t,tex:{x:d.paddedRect.x+1+on,y:d.paddedRect.y+1+fn,w:Be.stretch+Be.fixed-on,h:Ne.stretch+Ne.fixed-fn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:gn,pixelOffsetBR:Lt,minFontScaleX:Se/f/w,minFontScaleY:ke/f/E,isSDF:n}};if(o&&(d.stretchX||d.stretchY)){const Ae=Mv(M,N,D),Re=Mv(A,J,O);for(let Be=0;Be<Ae.length-1;Be++){const Ne=Ae[Be],Ze=Ae[Be+1];for(let Pe=0;Pe<Re.length-1;Pe++)c.push($e(Ne,Re[Pe],Ze,Re[Pe+1]))}}else c.push($e({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:g+1},{fixed:0,stretch:x+1}));return c}function nf(t,e,n){let o=0;for(const c of t)o+=Math.max(e,Math.min(n,c[1]))-Math.max(e,Math.min(n,c[0]));return o}function Mv(t,e,n){const o=[{fixed:-1,stretch:0}];for(const[c,d]of t){const f=o[o.length-1];o.push({fixed:c-f.stretch,stretch:f.stretch}),o.push({fixed:c-f.stretch,stretch:f.stretch+(d-c)})}return o.push({fixed:e+1,stretch:n}),o}function rf(t,e,n,o){return t/e*n+o}function of(t,e,n,o){return t-e*n/o}function dS(t,e,n,o){const c=e+t.positionedLines[o].lineOffset;return o===0?n+c/2:n+(c+(e+t.positionedLines[o-1].lineOffset))/2}Ec.loadGlyphRange=function(t,e,n,o,c){const d=256*e,f=d+255,g=o.transformRequest(o.normalizeGlyphsURL(n).replace("{fontstack}",t).replace("{range}",`${d}-${f}`),Br.Glyphs);fo(g,(x,w)=>{if(x)c(x);else if(w){const E={},M=function(A){return new Th(A).readFields(iS,{})}(w);for(const A of M.glyphs)E[A.id]=A;c(null,{glyphs:E,ascender:M.ascender,descender:M.descender})}})},Ec.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:o=.25,fontFamily:c="sans-serif",fontWeight:d="normal",fontStyle:f="normal"}={}){this.buffer=e,this.cutoff=o,this.radius=n;const g=this.size=t+4*e,x=this._createCanvas(g),w=this.ctx=x.getContext("2d",{willReadFrequently:!0});w.font=`${f} ${d} ${t}px ${c}`,w.textBaseline="alphabetic",w.textAlign="left",w.fillStyle="black",this.gridOuter=new Float64Array(g*g),this.gridInner=new Float64Array(g*g),this.f=new Float64Array(g),this.z=new Float64Array(g+1),this.v=new Uint16Array(g)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:o,actualBoundingBoxLeft:c,actualBoundingBoxRight:d}=this.ctx.measureText(t),f=Math.ceil(n),g=Math.min(this.size-this.buffer,Math.ceil(d-c)),x=Math.min(this.size-this.buffer,f+Math.ceil(o)),w=g+2*this.buffer,E=x+2*this.buffer,M=Math.max(w*E,0),A=new Uint8ClampedArray(M),P={data:A,width:w,height:E,glyphWidth:g,glyphHeight:x,glyphTop:f,glyphLeft:0,glyphAdvance:e};if(g===0||x===0)return P;const{ctx:D,buffer:O,gridInner:N,gridOuter:J}=this;D.clearRect(O,O,g,x),D.fillText(t,O,O+f);const re=D.getImageData(O,O,g,x);J.fill(Sh,0,M),N.fill(0,0,M);for(let K=0;K<x;K++)for(let te=0;te<g;te++){const ce=re.data[4*(K*g+te)+3]/255;if(ce===0)continue;const oe=(K+O)*w+te+O;if(ce===1)J[oe]=0,N[oe]=Sh;else{const Se=.5-ce;J[oe]=Se>0?Se*Se:0,N[oe]=Se<0?Se*Se:0}}Ev(J,0,0,w,E,w,this.f,this.v,this.z),Ev(N,O,O,g,x,w,this.f,this.v,this.z);for(let K=0;K<M;K++){const te=Math.sqrt(J[K])-Math.sqrt(N[K]);A[K]=Math.round(255-255*(te/this.radius+this.cutoff))}return P}};class pS{constructor(e=[],n=fS){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:o}=this,c=n[e];for(;e>0;){const d=e-1>>1,f=n[d];if(o(c,f)>=0)break;n[e]=f,e=d}n[e]=c}_down(e){const{data:n,compare:o}=this,c=this.length>>1,d=n[e];for(;e<c;){let f=1+(e<<1),g=n[f];const x=f+1;if(x<this.length&&o(n[x],g)<0&&(f=x,g=n[x]),o(g,d)>=0)break;n[e]=g,e=f}n[e]=d}}function fS(t,e){return t<e?-1:t>e?1:0}function mS(t,e=1,n=!1){let o=1/0,c=1/0,d=-1/0,f=-1/0;const g=t[0];for(let P=0;P<g.length;P++){const D=g[P];(!P||D.x<o)&&(o=D.x),(!P||D.y<c)&&(c=D.y),(!P||D.x>d)&&(d=D.x),(!P||D.y>f)&&(f=D.y)}const x=Math.min(d-o,f-c);let w=x/2;const E=new pS([],_S);if(x===0)return new Me(o,c);for(let P=o;P<d;P+=x)for(let D=c;D<f;D+=x)E.push(new Sc(P+w,D+w,w,t));let M=function(P){let D=0,O=0,N=0;const J=P[0];for(let re=0,K=J.length,te=K-1;re<K;te=re++){const ce=J[re],oe=J[te],Se=ce.x*oe.y-oe.x*ce.y;O+=(ce.x+oe.x)*Se,N+=(ce.y+oe.y)*Se,D+=3*Se}return new Sc(O/D,N/D,0,P)}(t),A=E.length;for(;E.length;){const P=E.pop();(P.d>M.d||!M.d)&&(M=P,n&&console.log("found best %d after %d probes",Math.round(1e4*P.d)/1e4,A)),P.max-M.d<=e||(w=P.h/2,E.push(new Sc(P.p.x-w,P.p.y-w,w,t)),E.push(new Sc(P.p.x+w,P.p.y-w,w,t)),E.push(new Sc(P.p.x-w,P.p.y+w,w,t)),E.push(new Sc(P.p.x+w,P.p.y+w,w,t)),A+=4)}return n&&(console.log(`num probes: ${A}`),console.log(`best distance: ${M.d}`)),M.p}function _S(t,e){return e.max-t.max}function Sc(t,e,n,o){this.p=new Me(t,e),this.h=n,this.d=function(c,d){let f=!1,g=1/0;for(let x=0;x<d.length;x++){const w=d[x];for(let E=0,M=w.length,A=M-1;E<M;A=E++){const P=w[E],D=w[A];P.y>c.y!=D.y>c.y&&c.x<(D.x-P.x)*(c.y-P.y)/(D.y-P.y)+P.x&&(f=!f),g=Math.min(g,dx(c,P,D))}}return(f?1:-1)*Math.sqrt(g)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}const U_=Number.POSITIVE_INFINITY,gS=Math.sqrt(2);function Av(t,e){return e[1]!==U_?function(n,o,c){let d=0,f=0;switch(o=Math.abs(o),c=Math.abs(c),n){case"top-right":case"top-left":case"top":f=c-7;break;case"bottom-right":case"bottom-left":case"bottom":f=7-c}switch(n){case"top-right":case"bottom-right":case"right":d=-o;break;case"top-left":case"bottom-left":case"left":d=o}return[d,f]}(t,e[0],e[1]):function(n,o){let c=0,d=0;o<0&&(o=0);const f=o/gS;switch(n){case"top-right":case"top-left":d=f-7;break;case"bottom-right":case"bottom-left":d=7-f;break;case"bottom":d=7-o;break;case"top":d=o-7}switch(n){case"top-right":case"bottom-right":c=-f;break;case"top-left":case"bottom-left":c=f;break;case"left":c=o;break;case"right":c=-o}return[c,d]}(t,e[0])}function yS(t,e,n,o,c,d,f,g,x,w){t.createArrays(),t.tilePixelRatio=Et/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const E=t.layers[0].layout,M=t.layers[0]._unevaluatedLayout._values,A={};if(t.textSizeData.kind==="composite"){const{minZoom:O,maxZoom:N}=t.textSizeData;A.compositeTextSizes=[M["text-size"].possiblyEvaluate(new Q(O),g),M["text-size"].possiblyEvaluate(new Q(N),g)]}if(t.iconSizeData.kind==="composite"){const{minZoom:O,maxZoom:N}=t.iconSizeData;A.compositeIconSizes=[M["icon-size"].possiblyEvaluate(new Q(O),g),M["icon-size"].possiblyEvaluate(new Q(N),g)]}A.layoutTextSize=M["text-size"].possiblyEvaluate(new Q(x+1),g),A.layoutIconSize=M["icon-size"].possiblyEvaluate(new Q(x+1),g),A.textMaxSize=M["text-size"].possiblyEvaluate(new Q(18),g);const P=E.get("text-rotation-alignment")==="map"&&E.get("symbol-placement")!=="point",D=E.get("text-size");for(const O of t.features){const N=E.get("text-font").evaluate(O,{},g).join(","),J=D.evaluate(O,{},g),re=A.layoutTextSize.evaluate(O,{},g),K=(A.layoutIconSize.evaluate(O,{},g),{horizontal:{},vertical:void 0}),te=O.text;let ce,oe=[0,0];if(te){const ke=te.toString(),$e=E.get("text-letter-spacing").evaluate(O,{},g)*lr,Ae=E.get("text-line-height").evaluate(O,{},g)*lr,Re=p(ke)?$e:0,Be=E.get("text-anchor").evaluate(O,{},g),Ne=E.get("text-variable-anchor");if(!Ne){const ot=E.get("text-radial-offset").evaluate(O,{},g);oe=ot?Av(Be,[ot*lr,U_]):E.get("text-offset").evaluate(O,{},g).map(et=>et*lr)}let Ze=P?"center":E.get("text-justify").evaluate(O,{},g);const Pe=E.get("symbol-placement"),it=Pe==="point",St=Pe==="point"?E.get("text-max-width").evaluate(O,{},g)*lr:0,lt=ot=>{t.allowVerticalPlacement&&l(ke)&&(K.vertical=R_(te,e,n,c,N,St,Ae,Be,ot,Re,oe,hi.vertical,!0,Pe,re,J))};if(!P&&Ne){const ot=Ze==="auto"?Ne.map(bt=>N_(bt)):[Ze];let et=!1;for(let bt=0;bt<ot.length;bt++){const kt=ot[bt];if(!K.horizontal[kt])if(et)K.horizontal[kt]=K.horizontal[0];else{const Pt=R_(te,e,n,c,N,St,Ae,"center",kt,Re,oe,hi.horizontal,!1,Pe,re,J);Pt&&(K.horizontal[kt]=Pt,et=Pt.positionedLines.length===1)}}lt("left")}else{if(Ze==="auto"&&(Ze=N_(Be)),it||E.get("text-writing-mode").indexOf("horizontal")>=0||!l(ke)){const ot=R_(te,e,n,c,N,St,Ae,Be,Ze,Re,oe,hi.horizontal,!1,Pe,re,J);ot&&(K.horizontal[Ze]=ot)}lt(Pe==="point"?"left":Ze)}}let Se=!1;if(O.icon&&O.icon.name){const ke=o[O.icon.name];ke&&(ce=cS(c[O.icon.name],E.get("icon-offset").evaluate(O,{},g),E.get("icon-anchor").evaluate(O,{},g)),Se=ke.sdf,t.sdfIcons===void 0?t.sdfIcons=ke.sdf:t.sdfIcons!==ke.sdf&&Tn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ke.pixelRatio!==t.pixelRatio||E.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}const Te=zv(K.horizontal)||K.vertical;t.iconsInText||(t.iconsInText=!!Te&&Te.iconsInText),(Te||ce)&&xS(t,O,K,ce,o,A,re,0,oe,Se,f,g,w)}d&&t.generateCollisionDebugBuffers(x,t.collisionBoxArray)}function N_(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function xS(t,e,n,o,c,d,f,g,x,w,E,M,A){let P=d.textMaxSize.evaluate(e,{},M);P===void 0&&(P=f);const D=t.layers[0].layout,O=D.get("icon-offset").evaluate(e,{},M),N=zv(n.horizontal)||n.vertical,J=A.name==="globe",re=f/24,K=t.tilePixelRatio*P/24,te=(Re=t.overscaling,t.zoom>18&&Re>2&&(Re>>=1),Math.max(Et/(512*Re),1)*D.get("symbol-spacing")),ce=D.get("text-padding")*t.tilePixelRatio,oe=D.get("icon-padding")*t.tilePixelRatio,Se=mt(D.get("text-max-angle")),Te=D.get("text-rotation-alignment")==="map"&&D.get("symbol-placement")!=="point",ke=D.get("icon-rotation-alignment")==="map"&&D.get("symbol-placement")!=="point",$e=D.get("symbol-placement"),Ae=te/2;var Re;const Be=D.get("icon-text-fit");let Ne;o&&Be!=="none"&&(t.allowVerticalPlacement&&n.vertical&&(Ne=gv(o,n.vertical,Be,D.get("icon-text-fit-padding"),O,re)),N&&(o=gv(o,N,Be,D.get("icon-text-fit-padding"),O,re)));const Ze=(Pe,it,St)=>{if(it.x<0||it.x>=Et||it.y<0||it.y>=Et)return;let lt=null;if(J){const{x:ot,y:et,z:bt}=A.projectTilePoint(it.x,it.y,St);lt={anchor:new ts(ot,et,bt,0,void 0),up:A.upVector(St,it.x,it.y)}}(function(ot,et,bt,kt,Pt,$t,It,gn,Lt,jt,on,fn,hn,mn,yn,Sn,Kn,Qt,jn,Ln,Zt,wn,$n,sn,In){const gr=ot.addToLineVertexArray(et,kt);let Jn,Qn,zr,er,rs,Pc,Bh,Oh=0,f1=0,m1=0,_1=0,ng=-1,rg=-1;const Do={};let g1=hc.exports("");const ol=bt?bt.anchor:et;let ig=0,og=0;if(Lt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[ig,og]=Lt.layout.get("text-offset").evaluate(Zt,{},In).map(qr=>qr*lr):(ig=Lt.layout.get("text-radial-offset").evaluate(Zt,{},In)*lr,og=U_),ot.allowVerticalPlacement&&Pt.vertical){const qr=Pt.vertical;if(yn)Pc=j_(qr),gn&&(Bh=j_(gn));else{const Wr=Lt.layout.get("text-rotate").evaluate(Zt,{},In)+90;zr=sf(jt,ol,et,on,fn,hn,qr,mn,Wr,Sn),gn&&(er=sf(jt,ol,et,on,fn,hn,gn,Qt,Wr))}}if($t){const qr=Lt.layout.get("icon-rotate").evaluate(Zt,{},In),Wr=Lt.layout.get("icon-text-fit")!=="none",Fh=Cv($t,qr,$n,Wr),ag=gn?Cv(gn,qr,$n,Wr):void 0;Qn=sf(jt,ol,et,on,fn,hn,$t,Qt,qr),Oh=4*Fh.length;const y1=ot.iconSizeData;let sl=null;y1.kind==="source"?(sl=[Ao*Lt.layout.get("icon-size").evaluate(Zt,{},In)],sl[0]>Zs&&Tn(`${ot.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):y1.kind==="composite"&&(sl=[Ao*wn.compositeIconSizes[0].evaluate(Zt,{},In),Ao*wn.compositeIconSizes[1].evaluate(Zt,{},In)],(sl[0]>Zs||sl[1]>Zs)&&Tn(`${ot.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),ot.addSymbols(ot.icon,Fh,sl,Ln,jn,Zt,!1,bt,et,gr.lineStartIndex,gr.lineLength,-1,sn,In),ng=ot.icon.placedSymbolArray.length-1,ag&&(f1=4*ag.length,ot.addSymbols(ot.icon,ag,sl,Ln,jn,Zt,hi.vertical,bt,et,gr.lineStartIndex,gr.lineLength,-1,sn,In),rg=ot.icon.placedSymbolArray.length-1)}for(const qr in Pt.horizontal){const Wr=Pt.horizontal[qr];Jn||(g1=hc.exports(Wr.text),yn?rs=j_(Wr):Jn=sf(jt,ol,et,on,fn,hn,Wr,mn,Lt.layout.get("text-rotate").evaluate(Zt,{},In),Sn));const Fh=Wr.positionedLines.length===1;if(m1+=Iv(ot,bt,et,Wr,It,Lt,yn,Zt,Sn,gr,Pt.vertical?hi.horizontal:hi.horizontalOnly,Fh?Object.keys(Pt.horizontal):[qr],Do,ng,wn,sn,In),Fh)break}Pt.vertical&&(_1+=Iv(ot,bt,et,Pt.vertical,It,Lt,yn,Zt,Sn,gr,hi.vertical,["vertical"],Do,rg,wn,sn,In));let Ks=-1;const sg=(qr,Wr)=>qr?Math.max(qr,Wr):Wr;Ks=sg(rs,Ks),Ks=sg(Pc,Ks),Ks=sg(Bh,Ks);const KS=Ks>-1?1:0;ot.glyphOffsetArray.length>=Ws.MAX_GLYPHS&&Tn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Zt.sortKey!==void 0&&ot.addToSortKeyRanges(ot.symbolInstances.length,Zt.sortKey),ot.symbolInstances.emplaceBack(ol.x,ol.y,ol.z,et.x,et.y,Do.right>=0?Do.right:-1,Do.center>=0?Do.center:-1,Do.left>=0?Do.left:-1,Do.vertical>=0?Do.vertical:-1,ng,rg,g1,Jn!==void 0?Jn:ot.collisionBoxArray.length,Jn!==void 0?Jn+1:ot.collisionBoxArray.length,zr!==void 0?zr:ot.collisionBoxArray.length,zr!==void 0?zr+1:ot.collisionBoxArray.length,Qn!==void 0?Qn:ot.collisionBoxArray.length,Qn!==void 0?Qn+1:ot.collisionBoxArray.length,er||ot.collisionBoxArray.length,er?er+1:ot.collisionBoxArray.length,on,m1,_1,Oh,f1,KS,0,ig,og,Ks)})(t,it,lt,Pe,n,o,c,Ne,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,ce,Te,x,0,oe,ke,O,e,d,w,E,M)};if($e==="line")for(const Pe of Tv(e.geometry,0,0,Et,Et)){const it=hS(Pe,te,Se,n.vertical||N,o,24,K,t.overscaling,Et);for(const St of it){const lt=N;lt&&vS(t,lt.text,Ae,St)||Ze(Pe,St,M)}}else if($e==="line-center"){for(const Pe of e.geometry)if(Pe.length>1){const it=uS(Pe,Se,n.vertical||N,o,24,K);it&&Ze(Pe,it,M)}}else if(e.type==="Polygon")for(const Pe of M_(e.geometry,0)){const it=mS(Pe,16);Ze(Pe[0],new ts(it.x,it.y,0,0,void 0),M)}else if(e.type==="LineString")for(const Pe of e.geometry)Ze(Pe,new ts(Pe[0].x,Pe[0].y,0,0,void 0),M);else if(e.type==="Point")for(const Pe of e.geometry)for(const it of Pe)Ze([it],new ts(it.x,it.y,0,0,void 0),M)}const Zs=32640;function Iv(t,e,n,o,c,d,f,g,x,w,E,M,A,P,D,O,N){const J=function(te,ce,oe,Se,Te,ke,$e,Ae){const Re=[];if(ce.positionedLines.length===0)return Re;const Be=Se.layout.get("text-rotate").evaluate(ke,{})*Math.PI/180,Ne=function(lt){const ot=lt[0],et=lt[1],bt=ot*et;return bt>0?[ot,-et]:bt<0?[-ot,et]:ot===0?[et,ot]:[et,-ot]}(oe);let Ze=Math.abs(ce.top-ce.bottom);for(const lt of ce.positionedLines)Ze-=lt.lineOffset;const Pe=ce.positionedLines.length,it=Ze/Pe;let St=ce.top-oe[1];for(let lt=0;lt<Pe;++lt){const ot=ce.positionedLines[lt];St=dS(ce,it,St,lt);for(const et of ot.positionedGlyphs){if(!et.rect)continue;const bt=et.rect||{};let kt=4,Pt=!0,$t=1,It=0;if(et.imageName){const sn=$e[et.imageName];if(!sn)continue;if(sn.sdf){Tn("SDF images are not supported in formatted text and will be ignored.");continue}Pt=!1,$t=sn.pixelRatio,kt=1/$t}const gn=(Te||Ae)&&et.vertical,Lt=et.metrics.advance*et.scale/2,jt=et.metrics,on=et.rect;if(on===null)continue;Ae&&ce.verticalizable&&(It=et.imageName?Lt-et.metrics.width*et.scale/2:0);const fn=Te?[et.x+Lt,et.y]:[0,0];let hn=[0,0],mn=[0,0],yn=!1;Te||(gn?(mn=[et.x+Lt+Ne[0],et.y+Ne[1]-It],yn=!0):hn=[et.x+Lt+oe[0],et.y+oe[1]-It]);const Sn=on.w*et.scale/($t*(et.localGlyph?2:1)),Kn=on.h*et.scale/($t*(et.localGlyph?2:1));let Qt,jn,Ln,Zt;if(gn){const sn=et.y-St,In=new Me(-Lt,Lt-sn),gr=-Math.PI/2,Jn=new Me(...mn);Qt=new Me(-Lt+hn[0],hn[1]),Qt._rotateAround(gr,In)._add(Jn),Qt.x+=-sn+Lt,Qt.y-=(jt.left-kt)*et.scale;const Qn=et.imageName?jt.advance*et.scale:lr*et.scale,zr=String.fromCharCode(et.glyph);WE(zr)?Qt.x+=(1-kt)*et.scale:XE(zr)?Qt.x+=Qn-jt.height*et.scale+(-kt-1)*et.scale:Qt.x+=et.imageName||jt.width+2*kt===on.w&&jt.height+2*kt===on.h?(Qn-Kn)/2:(Qn-(jt.height+2*kt)*et.scale)/2,jn=new Me(Qt.x,Qt.y-Sn),Ln=new Me(Qt.x+Kn,Qt.y),Zt=new Me(Qt.x+Kn,Qt.y-Sn)}else{const sn=(jt.left-kt)*et.scale-Lt+hn[0],In=(-jt.top-kt)*et.scale+hn[1],gr=sn+Sn,Jn=In+Kn;Qt=new Me(sn,In),jn=new Me(gr,In),Ln=new Me(sn,Jn),Zt=new Me(gr,Jn)}if(Be){let sn;sn=Te?new Me(0,0):yn?new Me(Ne[0],Ne[1]):new Me(oe[0],oe[1]),Qt._rotateAround(Be,sn),jn._rotateAround(Be,sn),Ln._rotateAround(Be,sn),Zt._rotateAround(Be,sn)}const wn=new Me(0,0),$n=new Me(0,0);Re.push({tl:Qt,tr:jn,bl:Ln,br:Zt,tex:bt,writingMode:ce.writingMode,glyphOffset:fn,sectionIndex:et.sectionIndex,isSDF:Pt,pixelOffsetTL:wn,pixelOffsetBR:$n,minFontScaleX:0,minFontScaleY:0})}}return Re}(0,o,x,d,f,g,c,t.allowVerticalPlacement),re=t.textSizeData;let K=null;re.kind==="source"?(K=[Ao*d.layout.get("text-size").evaluate(g,{},N)],K[0]>Zs&&Tn(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):re.kind==="composite"&&(K=[Ao*D.compositeTextSizes[0].evaluate(g,{},N),Ao*D.compositeTextSizes[1].evaluate(g,{},N)],(K[0]>Zs||K[1]>Zs)&&Tn(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),t.addSymbols(t.text,J,K,x,f,g,E,e,n,w.lineStartIndex,w.lineLength,P,O,N);for(const te of M)A[te]=t.text.placedSymbolArray.length-1;return 4*J.length}function zv(t){for(const e in t)return t[e];return null}function sf(t,e,n,o,c,d,f,g,x,w){let E=f.top,M=f.bottom,A=f.left,P=f.right;const D=f.collisionPadding;if(D&&(A-=D[0],E-=D[1],P+=D[2],M+=D[3]),x){const O=new Me(A,E),N=new Me(P,E),J=new Me(A,M),re=new Me(P,M),K=mt(x);let te=new Me(0,0);w&&(te=new Me(w[0],w[1])),O._rotateAround(K,te),N._rotateAround(K,te),J._rotateAround(K,te),re._rotateAround(K,te),A=Math.min(O.x,N.x,J.x,re.x),P=Math.max(O.x,N.x,J.x,re.x),E=Math.min(O.y,N.y,J.y,re.y),M=Math.max(O.y,N.y,J.y,re.y)}return t.emplaceBack(e.x,e.y,e.z,n.x,n.y,A,E,P,M,g,o,c,d),t.length-1}function j_(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function vS(t,e,n,o){const c=t.compareText;if(e in c){const d=c[e];for(let f=d.length-1;f>=0;f--)if(o.dist(d[f])<n)return!0}else c[e]=[];return c[e].push(o),!1}const wS=Xe([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:kv}=wS,Pv=Xe([{name:"a_pos_3",components:3,type:"Int16"}]);var Ch=Xe([{name:"a_pos",type:"Int16",components:2}]);const ns=Et/Math.PI/2,V_=2*Ii(1,0)*ns*Math.PI,Cc=64,Mc=[Cc,32,16],Ki=-ns,Ji=ns,bS=[new Ar([Ki,Ki,Ki],[Ji,Ji,Ji]),new Ar([Ki,Ki,Ki],[0,0,Ji]),new Ar([0,Ki,Ki],[Ji,0,Ji]),new Ar([Ki,0,Ki],[0,Ji,Ji]),new Ar([0,0,Ki],[Ji,Ji,Ji])];function Dv(t,e,n,o=!0){const c=ui([],t._camera.position,t.worldSize),d=[e,n,1,1];el(d,d,t.pixelMatrixInverse),Ex(d,d,1/d[3]);const f=Mr([],Yi([],d,c)),g=t.globeMatrix,x=[g[12],g[13],g[14]],w=Yi([],x,c),E=ah(w),M=Mr([],w),A=t.worldSize/(2*Math.PI),P=zi(M,f),D=Math.asin(A/E);if(D<Math.acos(P)){if(!o)return null;const $e=[],Ae=[];ui($e,f,E/P),Mr(Ae,Yi(Ae,$e,w)),Mr(f,Jo(f,w,ui(f,Ae,Math.tan(D)*E)))}const O=[];new x_(c,f).closestPointOnSphere(x,A,O);const N=Mr([],co(g,0)),J=Mr([],co(g,1)),re=Mr([],co(g,2)),K=zi(N,O),te=zi(J,O),ce=zi(re,O),oe=Ct(Math.asin(-te/A));let Se=Ct(Math.atan2(K,ce));Se=t.center.lng+function($e,Ae){const Re=(Ae-$e+180)%360-180;return Re<-180?Re+360:Re}(t.center.lng,Se);const Te=Eo(Se),ke=Ot(So(oe),0,1);return new pc(Te,ke)}class TS{constructor(e,n,o){this.a=Yi([],e,o),this.b=Yi([],n,o),this.center=o;const c=Mr([],this.a),d=Mr([],this.b);this.angle=Math.acos(zi(c,d))}}function G_(t,e){if(t.angle===0)return null;let n;return n=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),n<0||n>1?null:function(o,c,d,f){const g=Math.sin(d);return o*(Math.sin((1-f)*d)/g)+c*(Math.sin(f*d)/g)}(t.a[e],t.b[e],t.angle,Ot(n,0,1))+t.center[e]}function Io(t){if(t.z<=1)return bS[t.z+2*t.y+t.x];const e=$_(af(t));return Ar.fromPoints(e)}function nl(t,e,n){return ui(t,t,1-n),uh(t,t,e,n)}function Lv(t,e){const n=Ic(e.zoom);if(n===0)return Io(t);const o=af(t),c=$_(o),d=Eo(o.getWest())*e.worldSize,f=Eo(o.getEast())*e.worldSize,g=So(o.getNorth())*e.worldSize,x=So(o.getSouth())*e.worldSize,w=[d,g,0],E=[f,g,0],M=[d,x,0],A=[f,x,0],P=f_([],e.globeMatrix);return Nn(w,w,P),Nn(E,E,P),Nn(M,M,P),Nn(A,A,P),c[0]=nl(c[0],M,n),c[1]=nl(c[1],A,n),c[2]=nl(c[2],E,n),c[3]=nl(c[3],w,n),Ar.fromPoints(c)}function Rv(t,e,n){for(const o of t)Nn(o,o,e),ui(o,o,n)}function ES(t,e,n){const o=e/t.worldSize,c=t.globeMatrix;if(n.z<=1){const Te=Io(n).getCorners();return Rv(Te,c,o),Ar.fromPoints(Te)}const d=af(n),f=$_(d);Rv(f,c,o);const g=Number.MAX_VALUE,x=[-g,-g,-g],w=[g,g,g];if(d.contains(t.center)){for(const $e of f)lh(w,w,$e),ch(x,x,$e);x[2]=0;const Te=t.point,ke=[Te.x*o,Te.y*o,0];return lh(w,w,ke),ch(x,x,ke),new Ar(w,x)}const E=[c[12]*o,c[13]*o,c[14]*o],M=d.getCenter(),A=Ot(t.center.lat,-85.051129,Co),P=Ot(M.lat,-85.051129,Co),D=Eo(t.center.lng),O=So(A);let N=D-Eo(M.lng);const J=O-So(P);N>.5?N-=1:N<-.5&&(N+=1);let re=0;Math.abs(N)>Math.abs(J)?re=N>=0?1:3:(re=J>=0?0:2,uh(E,E,[c[4]*o,c[5]*o,c[6]*o],-Math.sin(mt(J>=0?d.getSouth():d.getNorth()))*ns));const K=f[re],te=f[(re+1)%4],ce=new TS(K,te,E),oe=[G_(ce,0)||K[0],G_(ce,1)||K[1],G_(ce,2)||K[2]],Se=Ic(t.zoom);if(Se>0){const Te=function({x:$e,y:Ae,z:Re},Be,Ne,Ze,Pe){const it=1/(1<<Re);let St=$e*it,lt=St+it,ot=Ae*it,et=ot+it,bt=0;const kt=(St+lt)/2-Ze;return kt>.5?bt=-1:kt<-.5&&(bt=1),St=((St+bt)*Be-(Ze*=Be))*Ne+Ze,lt=((lt+bt)*Be-Ze)*Ne+Ze,ot=(ot*Be-(Pe*=Be))*Ne+Pe,et=(et*Be-Pe)*Ne+Pe,[[St,et,0],[lt,et,0],[lt,ot,0],[St,ot,0]]}(n,e,t._pixelsPerMercatorPixel,D,O);for(let $e=0;$e<f.length;$e++)nl(f[$e],Te[$e],Se);const ke=Jo([],Te[re],Te[(re+1)%4]);ui(ke,ke,.5),nl(oe,ke,Se)}for(const Te of f)lh(w,w,Te),ch(x,x,Te);return w[2]=Math.min(K[2],te[2]),lh(w,w,oe),ch(x,x,oe),new Ar(w,x)}function af({x:t,y:e,z:n}){const o=1/(1<<n),c=new Ht(ci(t*o),ar((e+1)*o)),d=new Ht(ci((t+1)*o),ar(e*o));return new $s(c,d)}function $_(t){const e=mt(t.getNorth()),n=mt(t.getSouth()),o=Math.cos(e),c=Math.cos(n),d=Math.sin(e),f=Math.sin(n),g=t.getWest(),x=t.getEast();return[Ac(c,f,g),Ac(c,f,x),Ac(o,d,x),Ac(o,d,g)]}function Ac(t,e,n,o=ns){return n=mt(n),[t*Math.sin(n)*o,-e*o,t*Math.cos(n)*o]}function Mh(t,e,n){return Ac(Math.cos(mt(t)),Math.sin(mt(t)),e,n)}function Ah(t,e,n,o){const c=1<<n.z,d=(t/Et+n.x)/c;return Mh(ar((e/Et+n.y)/c),ci(d),o)}function lf({min:t,max:e}){return 16383/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const Bv=new Float64Array(16);function Ih(t){const e=lf(t),n=xx(Bv,[e,e,e]);return sh(n,n,((o=[])[0]=-(c=t.min)[0],o[1]=-c[1],o[2]=-c[2],o));var o,c}function Z_(t){const e=(o=t.min,(n=Bv)[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=o[0],n[13]=o[1],n[14]=o[2],n[15]=1,n);var n,o;const c=1/lf(t);return Qa(e,e,[c,c,c])}function Ov(t,e,n,o,c){const d=function(x){const w=Et/(2*Math.PI);return x/(2*Math.PI)/w}(n),f=[t,e,-n/(2*Math.PI)],g=Mo(new Float64Array(16));return sh(g,g,f),Qa(g,g,[d,d,d]),m_(g,g,mt(-c)),Vp(g,g,mt(-o)),g}function Ic(t){return Fi(5,6,t)}function Fv(t,e){const n=Mh(e.lat,e.lng),o=function(D){const O=Mh(D._center.lat,D._center.lng);let N=y_([],_c(0,1,0),O);const J=vx([],-D.angle,O);N=Nn(N,N,J),vx(J,-D._pitch,N);const re=Mr([],O);return ui(re,re,D.cameraToCenterDistance/D.pixelsPerMeter*V_),Nn(re,re,J),Jo([],O,re)}(t);return f=(c=g_([],o,n))[0],g=c[1],x=c[2],w=(d=n)[0],E=d[1],M=d[2],P=(A=Math.sqrt(f*f+g*g+x*x)*Math.sqrt(w*w+E*E+M*M))&&zi(c,d)/A,Math.acos(Math.min(Math.max(P,-1),1));var c,d,f,g,x,w,E,M,A,P}const Uv=mt(85),SS=Math.cos(Uv),CS=Math.sin(Uv);function Nv(t,e){const n=t.fovAboveCenter,o=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,c=(t._camera.position[2]*t.worldSize-o)/Math.cos(t._pitch),d=Math.sin(n)*c/Math.sin(Math.max(Math.PI/2-t._pitch-n,.01)),f=Math.sin(t._pitch)*d+c;return Math.min(1.01*f,c*(1/t._horizonShift))}function rl(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const n=Math.pow(2,-t.z),o=t.x*n,c=(t.x+1)*n,d=t.y*n,f=(t.y+1)*n,g=ci(o),x=ci(c),w=ar(d),E=ar(f),M=e.project(g,w),A=e.project(x,w),P=e.project(x,E),D=e.project(g,E);let O=Math.min(M.x,A.x,P.x,D.x),N=Math.min(M.y,A.y,P.y,D.y),J=Math.max(M.x,A.x,P.x,D.x),re=Math.max(M.y,A.y,P.y,D.y);const K=n/16;function te(oe,Se,Te,ke,$e,Ae){const Re=(Te+$e)/2,Be=(ke+Ae)/2,Ne=e.project(ci(Re),ar(Be)),Ze=Math.max(0,O-Ne.x,N-Ne.y,Ne.x-J,Ne.y-re);O=Math.min(O,Ne.x),J=Math.max(J,Ne.x),N=Math.min(N,Ne.y),re=Math.max(re,Ne.y),Ze>K&&(te(oe,Ne,Te,ke,Re,Be),te(Ne,Se,Re,Be,$e,Ae))}te(M,A,o,d,c,d),te(A,P,c,d,c,f),te(P,D,c,f,o,f),te(D,M,o,f,o,d),O-=K,N-=K,J+=K,re+=K;const ce=1/Math.max(J-O,re-N);return{scale:ce,x:O*ce,y:N*ce,x2:J*ce,y2:re*ce,projection:e}}const MS=Mo(new Float32Array(16));class qs{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new Ht(0,0)}projectTilePoint(e,n,o){return{x:e,y:n,z:0}}locationPoint(e,n,o=!0){return e._coordinatePoint(e.locationCoordinate(n),o)}pixelsPerMeter(e,n){return Ii(1,e)*n}pixelSpaceConversion(e,n,o){return 1}farthestPixelDistance(e){return Nv(e,e.pixelsPerMeter)}pointCoordinate(e,n,o,c){const d=e.horizonLineFromTop(!1),f=new Me(n,Math.max(d,o));return e.rayIntersectionCoordinate(e.pointRayIntersection(f,c))}pointCoordinate3D(e,n,o){const c=new Me(n,o);if(e.elevation)return e.elevation.pointCoordinate(c);{const d=this.pointCoordinate(e,c.x,c.y,0);return[d.x,d.y,d.z]}}isPointAboveHorizon(e,n){if(e.elevation)return!this.pointCoordinate3D(e,n.x,n.y);const o=e.horizonLineFromTop();return n.y<o}createInversionMatrix(e,n){return MS}createTileMatrix(e,n,o){let c,d,f;const g=o.canonical,x=Mo(new Float64Array(16));if(this.isReprojectedInTileSpace){const w=rl(g,this);c=1,d=w.x+o.wrap*w.scale,f=w.y,Qa(x,x,[c/w.scale,c/w.scale,e.pixelsPerMeter/n])}else c=n/e.zoomScale(g.z),d=(g.x+Math.pow(2,g.z)*o.wrap)*c,f=g.y*c;return sh(x,x,[d,f,0]),Qa(x,x,[c/Et,c/Et,1]),x}upVector(e,n,o){return[0,0,1]}upVectorScale(e,n,o){return{metersToTile:1}}}class AS extends qs{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[n,o]=this.parallels=e.parallels||[29.5,45.5],c=Math.sin(mt(n));this.n=(c+Math.sin(mt(o)))/2,this.c=1+c*(2*this.n-c),this.r0=Math.sqrt(this.c)/this.n}project(e,n){const{n:o,c,r0:d}=this,f=mt(e-this.center[0]),g=mt(n),x=Math.sqrt(c-2*o*Math.sin(g))/o;return{x:x*Math.sin(f*o),y:x*Math.cos(f*o)-d,z:0}}unproject(e,n){const{n:o,c,r0:d}=this,f=d+n;let g=Math.atan2(e,Math.abs(f))*Math.sign(f);f*o<0&&(g-=Math.PI*Math.sign(e)*Math.sign(f));const x=mt(this.center[0])*o;g=ei(g,-Math.PI-x,Math.PI-x);const w=Ot(Ct(g/o)+this.center[0],-180,180),E=Math.asin(Ot((c-(e*e+f*f)*o*o)/(2*o),-1,1)),M=Ot(Ct(E),-85.051129,Co);return new Ht(w,M)}}const zh=1.340264,kh=-.081106,Ph=893e-6,Dh=.003796,cf=Math.sqrt(3)/2;class IS extends qs{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;const o=Math.asin(cf*Math.sin(n)),c=o*o,d=c*c*c;return{x:.5*(e*Math.cos(o)/(cf*(zh+3*kh*c+d*(7*Ph+9*Dh*c)))/Math.PI+.5),y:1-.5*(o*(zh+kh*c+d*(Ph+Dh*c))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let o=n=(2*(1-n)-1)*Math.PI,c=o*o,d=c*c*c;for(let E,M,A,P=0;P<12&&(M=o*(zh+kh*c+d*(Ph+Dh*c))-n,A=zh+3*kh*c+d*(7*Ph+9*Dh*c),E=M/A,o=Ot(o-E,-Math.PI/3,Math.PI/3),c=o*o,d=c*c*c,!(Math.abs(E)<1e-12));++P);const f=cf*e*(zh+3*kh*c+d*(7*Ph+9*Dh*c))/Math.cos(o),g=Math.asin(Math.sin(o)/cf),x=Ot(180*f/Math.PI,-180,180),w=Ot(180*g/Math.PI,-85.051129,Co);return new Ht(x,w)}}class zS extends qs{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){const o=360*(e-.5),c=Ot(360*(.5-n),-85.051129,Co);return new Ht(o,c)}}const zc=Math.PI/2;function uf(t){return Math.tan((zc+t)/2)}class kS extends qs{constructor(e){super(e),this.center=e.center||[0,30];const[n,o]=this.parallels=e.parallels||[30,30];let c=mt(n),d=mt(o);this.southernCenter=c+d<0,this.southernCenter&&(c=-c,d=-d);const f=Math.cos(c),g=uf(c);this.n=c===d?Math.sin(c):Math.log(f/Math.cos(d))/Math.log(uf(d)/g),this.f=f*Math.pow(uf(c),this.n)/this.n}project(e,n){n=mt(n),this.southernCenter&&(n=-n),e=mt(e-this.center[0]);const o=1e-6,{n:c,f:d}=this;d>0?n<-zc+o&&(n=-zc+o):n>zc-o&&(n=zc-o);const f=d/Math.pow(uf(n),c);let g=f*Math.sin(c*e),x=d-f*Math.cos(c*e);return g=.5*(g/Math.PI+.5),x=.5*(x/Math.PI+.5),{x:g,y:this.southernCenter?x:1-x,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;const{n:o,f:c}=this,d=c-n,f=Math.sign(d),g=Math.sign(o)*Math.sqrt(e*e+d*d);let x=Math.atan2(e,Math.abs(d))*f;d*o<0&&(x-=Math.PI*Math.sign(e)*f);const w=Ot(Ct(x/o)+this.center[0],-180,180),E=Ot(Ct(2*Math.atan(Math.pow(c/g,1/o))-zc),-85.051129,Co);return new Ht(w,this.southernCenter?-E:E)}}class jv extends qs{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:Eo(e),y:So(n),z:0}}unproject(e,n){const o=ci(e),c=ar(n);return new Ht(o,c)}}const Vv=mt(Co);class PS extends qs{project(e,n){const o=(n=mt(n))*n,c=o*o;return{x:.5*((e=mt(e))*(.8707-.131979*o+c*(c*(.003971*o-.001529*c)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+o*(.015085+c*(.028874*o-.044475-.005916*c)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let o=n=(2*(1-n)-1)*Math.PI,c=25,d=0,f=o*o;do{f=o*o;const w=f*f;d=(o*(1.007226+f*(.015085+w*(.028874*f-.044475-.005916*w)))-n)/(1.007226+f*(.045255+w*(.259866*f-.311325-.005916*11*w))),o=Ot(o-d,-Vv,Vv)}while(Math.abs(d)>1e-6&&--c>0);f=o*o;const g=Ot(Ct(e/(.8707+f*(f*(f*f*f*(.003971-.001529*f)-.013791)-.131979))),-180,180),x=Ct(o);return new Ht(g,x)}}const Gv=mt(Co);class DS extends qs{project(e,n){n=mt(n),e=mt(e);const o=Math.cos(n),c=2/Math.PI,d=Math.acos(o*Math.cos(e/2)),f=Math.sin(d)/d,g=.5*(e*c+2*o*Math.sin(e/2)/f)||0,x=.5*(n+Math.sin(n)/f)||0;return{x:.5*(g/Math.PI+.5),y:1-.5*(x/Math.PI+1),z:0}}unproject(e,n){let o=e=(2*e-.5)*Math.PI,c=n=(2*(1-n)-1)*Math.PI,d=25;const f=1e-6;let g=0,x=0;do{const w=Math.cos(c),E=Math.sin(c),M=2*E*w,A=E*E,P=w*w,D=Math.cos(o/2),O=Math.sin(o/2),N=2*D*O,J=O*O,re=1-P*D*D,K=re?1/re:0,te=re?Math.acos(w*D)*Math.sqrt(1/re):0,ce=.5*(2*te*w*O+2*o/Math.PI)-e,oe=.5*(te*E+c)-n,Se=.5*K*(P*J+te*w*D*A)+1/Math.PI,Te=K*(N*M/4-te*E*O),ke=.125*K*(M*O-te*E*P*N),$e=.5*K*(A*D+te*J*w)+.5,Ae=Te*ke-$e*Se;g=(oe*Te-ce*$e)/Ae,x=(ce*ke-oe*Se)/Ae,o=Ot(o-g,-Math.PI,Math.PI),c=Ot(c-x,-Gv,Gv)}while((Math.abs(g)>f||Math.abs(x)>f)&&--d>0);return new Ht(Ct(o),Ct(c))}}class $v extends qs{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(mt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){const{scale:o,cosPhi:c}=this;return{x:mt(e)*c*o+.5,y:-Math.sin(mt(n))/c*o+.5,z:0}}unproject(e,n){const{scale:o,cosPhi:c}=this,d=-(n-.5)/o,f=Ot(Ct((e-.5)/o)/c,-180,180),g=Math.asin(Ot(d*c,-1,1)),x=Ot(Ct(g),-85.051129,Co);return new Ht(f,x)}}class LS extends jv{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(e,n,o){const c=Ah(e,n,o);return Nn(c,c,Ih(Io(o))),{x:c[0],y:c[1],z:c[2]}}locationPoint(e,n){const o=Mh(n.lat,n.lng),c=Mr([],o),d=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude;uh(o,o,c,Ii(1,0)*Et*d);const f=Mo(new Float64Array(16));return mc(f,e.pixelMatrix,e.globeMatrix),Nn(o,o,f),new Me(o[0],o[1])}pixelsPerMeter(e,n){return Ii(1,0)*n}pixelSpaceConversion(e,n,o){const c=Ii(1,e)*n,d=Gt(Ii(1,45)*n,c,o);return this.pixelsPerMeter(e,n)/d}createTileMatrix(e,n,o){const c=Z_(Io(o.canonical));return mc(new Float64Array(16),e.globeMatrix,c)}createInversionMatrix(e,n){const{center:o}=e,c=Ih(Io(n));return Vp(c,c,mt(o.lng)),m_(c,c,mt(o.lat)),Qa(c,c,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(c)}pointCoordinate(e,n,o,c){return Dv(e,n,o,!0)||new pc(0,0)}pointCoordinate3D(e,n,o){const c=this.pointCoordinate(e,n,o,0);return[c.x,c.y,c.z]}isPointAboveHorizon(e,n){return!Dv(e,n.x,n.y,!1)}farthestPixelDistance(e){const n=function(c,d){const f=c.cameraToCenterDistance,g=c._centerAltitude*d,x=c._camera,w=c._camera.forward(),E=Jo([],ui([],w,-f),[0,0,g]),M=c.worldSize/(2*Math.PI),A=[0,0,-M],P=c.width/c.height,D=Math.tan(c.fovAboveCenter),O=ui([],x.up(),D),N=ui([],x.right(),D*P),J=Mr([],Jo([],Jo([],w,O),N)),re=[];let K;if(new x_(E,J).closestPointOnSphere(A,M,re)){const te=Jo([],re,A),ce=Yi([],te,E);K=Math.cos(c.fovAboveCenter)*ah(ce)}else{const te=Yi([],E,A),ce=Yi([],A,E);Mr(ce,ce);const oe=ah(te)-M;K=Math.sqrt(oe*(oe+2*M));const Se=Math.acos(K/(M+oe))-Math.acos(zi(w,ce));K*=Math.cos(Se)}return 1.01*K}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),o=Ic(e.zoom);if(o>0){const c=Nv(e,Ii(1,e.center.lat)*e.worldSize),d=e.worldSize/(2*Math.PI),f=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Gt(n,c+d*(1-Math.cos(f)),Math.pow(o,10))}return n}upVector(e,n,o){return Ah(n,o,e,1)}upVectorScale(e){return{metersToTile:V_*lf(Io(e))}}}function Zv(t){const e=t.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new jv(t);case"equirectangular":return new zS(t);case"naturalEarth":return new PS(t);case"equalEarth":return new IS(t);case"winkelTripel":return new DS(t);case"albers":return n?new $v(t):new AS(t);case"lambertConformalConic":return n?new $v(t):new kS(t);case"globe":return new LS(t)}throw new Error(`Invalid projection name: ${t.name}`)}const RS=Hp.types,BS=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function hf(t,e,n,o,c,d,f,g,x,w,E,M,A){const P=g?Math.min(Zs,Math.round(g[0])):0,D=g?Math.min(Zs,Math.round(g[1])):0;t.emplaceBack(e,n,Math.round(32*o),Math.round(32*c),d,f,(P<<1)+(x?1:0),D,16*w,16*E,256*M,256*A)}function df(t,e,n,o,c,d,f){t.emplaceBack(e,n,o,c,d,f)}function pf(t,e,n,o,c){t.emplaceBack(e,n,o,c),t.emplaceBack(e,n,o,c),t.emplaceBack(e,n,o,c),t.emplaceBack(e,n,o,c)}function OS(t){for(const e of t.sections)if(z(e.text))return!0;return!1}class q_{constructor(e){this.layoutVertexArray=new vn,this.indexArray=new _r,this.programConfigurations=e,this.segments=new Un,this.dynamicLayoutVertexArray=new Gn,this.opacityVertexArray=new Pn,this.placedSymbolArray=new j0,this.globeExtVertexArray=new Yt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,n,o,c){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,UE.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,jE.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,BS,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,NE.members,!0)),this.opacityVertexBuffer.itemSize=1),(o||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}rt(q_,"SymbolBuffers");class W_{constructor(e,n,o){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new o,this.segments=new Un,this.collisionVertexArray=new Xo,this.collisionVertexArrayExt=new ai}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,VE.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,GE.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}rt(W_,"CollisionBuffers");class Ws{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(f=>f.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Mo([]),this.placementViewportMatrix=Mo([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=k_(this.zoom,n["text-size"]),this.iconSizeData=k_(this.zoom,n["icon-size"]);const o=this.layers[0].layout,c=o.get("symbol-sort-key"),d=o.get("symbol-z-order");this.canOverlap=o.get("text-allow-overlap")||o.get("icon-allow-overlap")||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&c.constantOr(1)!==void 0,this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=o.get("text-writing-mode").map(f=>hi[f]),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new q_(new Ya(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new q_(new Ya(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new $0,this.lineVertexArray=new Z0,this.symbolInstances=new G0}calculateGlyphDependencies(e,n,o,c,d){for(let f=0;f<e.length;f++)if(n[e.charCodeAt(f)]=!0,c&&d){const g=bh[e.charAt(f)];g&&(n[g.charCodeAt(0)]=!0)}}populate(e,n,o,c){const d=this.layers[0],f=d.layout,g=this.projection.name==="globe",x=f.get("text-font"),w=f.get("text-field"),E=f.get("icon-image"),M=(w.value.kind!=="constant"||w.value.value instanceof fr&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),A=E.value.kind!=="constant"||!!E.value.value||Object.keys(E.parameters).length>0,P=f.get("symbol-sort-key");if(this.features=[],!M&&!A)return;const D=n.iconDependencies,O=n.glyphDependencies,N=n.availableImages,J=new Q(this.zoom);for(const{feature:re,id:K,index:te,sourceLayerIndex:ce}of e){const oe=d._featureFilter.needGeometry,Se=Ka(re,oe);if(!d._featureFilter.filter(J,Se,o))continue;if(oe||(Se.geometry=Ko(re,o,c)),g&&re.type!==1&&o.z<=5){const Ae=Se.geometry,Re=.98078528056,Be=(Ne,Ze)=>zi(Ah(Ne.x,Ne.y,o,1),Ah(Ze.x,Ze.y,o,1))<Re;for(let Ne=0;Ne<Ae.length;Ne++)Ae[Ne]=OT(Ae[Ne],Be)}let Te,ke;if(M){const Ae=d.getValueAndResolveTokens("text-field",Se,o,N),Re=fr.factory(Ae);OS(Re)&&(this.hasRTLText=!0),(!this.hasRTLText||Z()==="unavailable"||this.hasRTLText&&ie.isParsed())&&(Te=qE(Re,d,Se))}if(A){const Ae=d.getValueAndResolveTokens("icon-image",Se,o,N);ke=Ae instanceof Sr?Ae:Sr.fromString(Ae)}if(!Te&&!ke)continue;const $e=this.sortFeaturesByKey?P.evaluate(Se,{},o):void 0;if(this.features.push({id:K,text:Te,icon:ke,index:te,sourceLayerIndex:ce,geometry:Se.geometry,properties:re.properties,type:RS[re.type],sortKey:$e}),ke&&(D[ke.name]=!0),Te){const Ae=x.evaluate(Se,{},o).join(","),Re=f.get("text-rotation-alignment")==="map"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(hi.vertical)>=0;for(const Be of Te.sections)if(Be.image)D[Be.image.name]=!0;else{const Ne=l(Te.toString()),Ze=Be.fontStack||Ae,Pe=O[Ze]=O[Ze]||{};this.calculateGlyphDependencies(Be.text,Pe,Re,this.allowVerticalPlacement,Ne)}}}f.get("symbol-placement")==="line"&&(this.features=function(re){const K={},te={},ce=[];let oe=0;function Se(Ae){ce.push(re[Ae]),oe++}function Te(Ae,Re,Be){const Ne=te[Ae];return delete te[Ae],te[Re]=Ne,ce[Ne].geometry[0].pop(),ce[Ne].geometry[0]=ce[Ne].geometry[0].concat(Be[0]),Ne}function ke(Ae,Re,Be){const Ne=K[Re];return delete K[Re],K[Ae]=Ne,ce[Ne].geometry[0].shift(),ce[Ne].geometry[0]=Be[0].concat(ce[Ne].geometry[0]),Ne}function $e(Ae,Re,Be){const Ne=Be?Re[0][Re[0].length-1]:Re[0][0];return`${Ae}:${Ne.x}:${Ne.y}`}for(let Ae=0;Ae<re.length;Ae++){const Re=re[Ae],Be=Re.geometry,Ne=Re.text?Re.text.toString():null;if(!Ne){Se(Ae);continue}const Ze=$e(Ne,Be),Pe=$e(Ne,Be,!0);if(Ze in te&&Pe in K&&te[Ze]!==K[Pe]){const it=ke(Ze,Pe,Be),St=Te(Ze,Pe,ce[it].geometry);delete K[Ze],delete te[Pe],te[$e(Ne,ce[St].geometry,!0)]=St,ce[it].geometry=null}else Ze in te?Te(Ze,Pe,Be):Pe in K?ke(Ze,Pe,Be):(Se(Ae),K[Ze]=oe-1,te[Pe]=oe-1)}return ce.filter(Ae=>Ae.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((re,K)=>re.sortKey-K.sortKey)}update(e,n,o,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,o,c),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,o,c))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Zv(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const o=this.lineVertexArray.length,c=e.segment;if(c!==void 0){let d=e.dist(n[c+1]),f=e.dist(n[c]);const g={};for(let x=c+1;x<n.length;x++)g[x]={x:n[x].x,y:n[x].y,tileUnitDistanceFromAnchor:d},x<n.length-1&&(d+=n[x+1].dist(n[x]));for(let x=c||0;x>=0;x--)g[x]={x:n[x].x,y:n[x].y,tileUnitDistanceFromAnchor:f},x>0&&(f+=n[x-1].dist(n[x]));for(let x=0;x<n.length;x++){const w=g[x];this.lineVertexArray.emplaceBack(w.x,w.y,w.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,n,o,c,d,f,g,x,w,E,M,A,P,D){const O=e.indexArray,N=e.layoutVertexArray,J=e.globeExtVertexArray,re=e.segments.prepareSegment(4*n.length,N,O,this.canOverlap?f.sortKey:void 0),K=this.glyphOffsetArray.length,te=re.vertexLength,ce=this.allowVerticalPlacement&&g===hi.vertical?Math.PI/2:0,oe=f.text&&f.text.sections;for(let Te=0;Te<n.length;Te++){const{tl:ke,tr:$e,bl:Ae,br:Re,tex:Be,pixelOffsetTL:Ne,pixelOffsetBR:Ze,minFontScaleX:Pe,minFontScaleY:it,glyphOffset:St,isSDF:lt,sectionIndex:ot}=n[Te],et=re.vertexLength,bt=St[1];if(hf(N,w.x,w.y,ke.x,bt+ke.y,Be.x,Be.y,o,lt,Ne.x,Ne.y,Pe,it),hf(N,w.x,w.y,$e.x,bt+$e.y,Be.x+Be.w,Be.y,o,lt,Ze.x,Ne.y,Pe,it),hf(N,w.x,w.y,Ae.x,bt+Ae.y,Be.x,Be.y+Be.h,o,lt,Ne.x,Ze.y,Pe,it),hf(N,w.x,w.y,Re.x,bt+Re.y,Be.x+Be.w,Be.y+Be.h,o,lt,Ze.x,Ze.y,Pe,it),x){const kt=x.anchor,Pt=x.up;df(J,kt.x,kt.y,kt.z,Pt[0],Pt[1],Pt[2]),df(J,kt.x,kt.y,kt.z,Pt[0],Pt[1],Pt[2]),df(J,kt.x,kt.y,kt.z,Pt[0],Pt[1],Pt[2]),df(J,kt.x,kt.y,kt.z,Pt[0],Pt[1],Pt[2]),pf(e.dynamicLayoutVertexArray,kt.x,kt.y,kt.z,ce)}else pf(e.dynamicLayoutVertexArray,w.x,w.y,w.z,ce);O.emplaceBack(et,et+1,et+2),O.emplaceBack(et+1,et+2,et+3),re.vertexLength+=4,re.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(St[0]),Te!==n.length-1&&ot===n[Te+1].sectionIndex||e.programConfigurations.populatePaintArrays(N.length,f,f.index,{},P,D,oe&&oe[ot])}const Se=x?x.anchor:w;e.placedSymbolArray.emplaceBack(Se.x,Se.y,Se.z,w.x,w.y,K,this.glyphOffsetArray.length-K,te,E,M,w.segment,o?o[0]:0,o?o[1]:0,c[0],c[1],g,0,!1,0,A,0)}_commitLayoutVertex(e,n,o,c,d,f,g){e.emplaceBack(n,o,c,d,f,Math.round(g.x),Math.round(g.y))}_addCollisionDebugVertices(e,n,o,c,d,f,g){const x=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),w=x.vertexLength,E=g.tileAnchorX,M=g.tileAnchorY;for(let P=0;P<4;P++)o.collisionVertexArray.emplaceBack(0,0,0,0);o.collisionVertexArrayExt.emplaceBack(n,-e.padding,-e.padding),o.collisionVertexArrayExt.emplaceBack(n,e.padding,-e.padding),o.collisionVertexArrayExt.emplaceBack(n,e.padding,e.padding),o.collisionVertexArrayExt.emplaceBack(n,-e.padding,e.padding),this._commitLayoutVertex(o.layoutVertexArray,c,d,f,E,M,new Me(e.x1,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,c,d,f,E,M,new Me(e.x2,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,c,d,f,E,M,new Me(e.x2,e.y2)),this._commitLayoutVertex(o.layoutVertexArray,c,d,f,E,M,new Me(e.x1,e.y2)),x.vertexLength+=4;const A=o.indexArray;A.emplaceBack(w,w+1),A.emplaceBack(w+1,w+2),A.emplaceBack(w+2,w+3),A.emplaceBack(w+3,w),x.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,o,c,d,f){for(let g=c;g<d;g++){const x=o.get(g),w=this.getSymbolInstanceTextSize(e,f,n,g);this._addCollisionDebugVertices(x,w,this.textCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,f)}}_addIconDebugCollisionBoxes(e,n,o,c,d,f){for(let g=c;g<d;g++){const x=o.get(g),w=this.getSymbolInstanceIconSize(e,n,f.placedIconSymbolIndex);this._addCollisionDebugVertices(x,w,this.iconCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,f)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new W_(cn,iv.members,li),this.iconCollisionBox=new W_(cn,iv.members,li);const o=vc(this.iconSizeData,e),c=vc(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){const f=this.symbolInstances.get(d);this._addTextDebugCollisionBoxes(c,e,n,f.textBoxStartIndex,f.textBoxEndIndex,f),this._addTextDebugCollisionBoxes(c,e,n,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f),this._addIconDebugCollisionBoxes(o,e,n,f.iconBoxStartIndex,f.iconBoxEndIndex,f),this._addIconDebugCollisionBoxes(o,e,n,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex,f)}}getSymbolInstanceTextSize(e,n,o,c){const d=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:c),f=Qp(this.textSizeData,e,d)/lr;return this.tilePixelRatio*f}getSymbolInstanceIconSize(e,n,o){const c=this.icon.placedSymbolArray.get(o),d=Qp(this.iconSizeData,e,c);return this.tilePixelRatio*d}_commitDebugCollisionVertexUpdate(e,n,o){e.emplaceBack(n,-o,-o),e.emplaceBack(n,o,-o),e.emplaceBack(n,o,o),e.emplaceBack(n,-o,o)}_updateTextDebugCollisionBoxes(e,n,o,c,d,f){for(let g=c;g<d;g++){const x=o.get(g),w=this.getSymbolInstanceTextSize(e,f,n,g);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,w,x.padding)}}_updateIconDebugCollisionBoxes(e,n,o,c,d,f){for(let g=c;g<d;g++){const x=o.get(g),w=this.getSymbolInstanceIconSize(e,n,f);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,w,x.padding)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const o=vc(this.iconSizeData,e),c=vc(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){const f=this.symbolInstances.get(d);this._updateTextDebugCollisionBoxes(c,e,n,f.textBoxStartIndex,f.textBoxEndIndex,f),this._updateTextDebugCollisionBoxes(c,e,n,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f),this._updateIconDebugCollisionBoxes(o,e,n,f.iconBoxStartIndex,f.iconBoxEndIndex,f.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(o,e,n,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex,f.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,o,c,d,f,g,x,w){const E={};for(let M=n;M<o;M++){const A=e.get(M);E.textBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,padding:A.padding,projectedAnchorX:A.projectedAnchorX,projectedAnchorY:A.projectedAnchorY,projectedAnchorZ:A.projectedAnchorZ,tileAnchorX:A.tileAnchorX,tileAnchorY:A.tileAnchorY},E.textFeatureIndex=A.featureIndex;break}for(let M=c;M<d;M++){const A=e.get(M);E.verticalTextBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,padding:A.padding,projectedAnchorX:A.projectedAnchorX,projectedAnchorY:A.projectedAnchorY,projectedAnchorZ:A.projectedAnchorZ,tileAnchorX:A.tileAnchorX,tileAnchorY:A.tileAnchorY},E.verticalTextFeatureIndex=A.featureIndex;break}for(let M=f;M<g;M++){const A=e.get(M);E.iconBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,padding:A.padding,projectedAnchorX:A.projectedAnchorX,projectedAnchorY:A.projectedAnchorY,projectedAnchorZ:A.projectedAnchorZ,tileAnchorX:A.tileAnchorX,tileAnchorY:A.tileAnchorY},E.iconFeatureIndex=A.featureIndex;break}for(let M=x;M<w;M++){const A=e.get(M);E.verticalIconBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,padding:A.padding,projectedAnchorX:A.projectedAnchorX,projectedAnchorY:A.projectedAnchorY,projectedAnchorZ:A.projectedAnchorZ,tileAnchorX:A.tileAnchorX,tileAnchorY:A.tileAnchorY},E.verticalIconFeatureIndex=A.featureIndex;break}return E}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){const o=e.placedSymbolArray.get(n),c=o.vertexStartIndex+4*o.numGlyphs;for(let d=o.vertexStartIndex;d<c;d+=4)e.indexArray.emplaceBack(d,d+1,d+2),e.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),o=Math.cos(e),c=[],d=[],f=[];for(let g=0;g<this.symbolInstances.length;++g){f.push(g);const x=this.symbolInstances.get(g);c.push(0|Math.round(n*x.tileAnchorX+o*x.tileAnchorY)),d.push(x.featureIndex)}return f.sort((g,x)=>c[g]-c[x]||d[x]-d[g]),f}addToSortKeyRanges(e,n){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===n?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const o=this.symbolInstances.get(n);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((c,d,f)=>{c>=0&&f.indexOf(c)===d&&this.addIndicesForPlacedSymbol(this.text,c)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}rt(Ws,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Ws.MAX_GLYPHS=65535,Ws.addDynamicAttributes=pf;const FS=new We({"symbol-placement":new ve(ze.layout_symbol["symbol-placement"]),"symbol-spacing":new ve(ze.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ve(ze.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new pe(ze.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ve(ze.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ve(ze.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ve(ze.layout_symbol["icon-ignore-placement"]),"icon-optional":new ve(ze.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ve(ze.layout_symbol["icon-rotation-alignment"]),"icon-size":new pe(ze.layout_symbol["icon-size"]),"icon-text-fit":new ve(ze.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ve(ze.layout_symbol["icon-text-fit-padding"]),"icon-image":new pe(ze.layout_symbol["icon-image"]),"icon-rotate":new pe(ze.layout_symbol["icon-rotate"]),"icon-padding":new ve(ze.layout_symbol["icon-padding"]),"icon-keep-upright":new ve(ze.layout_symbol["icon-keep-upright"]),"icon-offset":new pe(ze.layout_symbol["icon-offset"]),"icon-anchor":new pe(ze.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ve(ze.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ve(ze.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ve(ze.layout_symbol["text-rotation-alignment"]),"text-field":new pe(ze.layout_symbol["text-field"]),"text-font":new pe(ze.layout_symbol["text-font"]),"text-size":new pe(ze.layout_symbol["text-size"]),"text-max-width":new pe(ze.layout_symbol["text-max-width"]),"text-line-height":new pe(ze.layout_symbol["text-line-height"]),"text-letter-spacing":new pe(ze.layout_symbol["text-letter-spacing"]),"text-justify":new pe(ze.layout_symbol["text-justify"]),"text-radial-offset":new pe(ze.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ve(ze.layout_symbol["text-variable-anchor"]),"text-anchor":new pe(ze.layout_symbol["text-anchor"]),"text-max-angle":new ve(ze.layout_symbol["text-max-angle"]),"text-writing-mode":new ve(ze.layout_symbol["text-writing-mode"]),"text-rotate":new pe(ze.layout_symbol["text-rotate"]),"text-padding":new ve(ze.layout_symbol["text-padding"]),"text-keep-upright":new ve(ze.layout_symbol["text-keep-upright"]),"text-transform":new pe(ze.layout_symbol["text-transform"]),"text-offset":new pe(ze.layout_symbol["text-offset"]),"text-allow-overlap":new ve(ze.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ve(ze.layout_symbol["text-ignore-placement"]),"text-optional":new ve(ze.layout_symbol["text-optional"])});var X_={paint:new We({"icon-opacity":new pe(ze.paint_symbol["icon-opacity"]),"icon-color":new pe(ze.paint_symbol["icon-color"]),"icon-halo-color":new pe(ze.paint_symbol["icon-halo-color"]),"icon-halo-width":new pe(ze.paint_symbol["icon-halo-width"]),"icon-halo-blur":new pe(ze.paint_symbol["icon-halo-blur"]),"icon-translate":new ve(ze.paint_symbol["icon-translate"]),"icon-translate-anchor":new ve(ze.paint_symbol["icon-translate-anchor"]),"text-opacity":new pe(ze.paint_symbol["text-opacity"]),"text-color":new pe(ze.paint_symbol["text-color"],{runtimeType:vi,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new pe(ze.paint_symbol["text-halo-color"]),"text-halo-width":new pe(ze.paint_symbol["text-halo-width"]),"text-halo-blur":new pe(ze.paint_symbol["text-halo-blur"]),"text-translate":new ve(ze.paint_symbol["text-translate"]),"text-translate-anchor":new ve(ze.paint_symbol["text-translate-anchor"])}),layout:FS};class qv{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Is,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}rt(qv,"FormatSectionOverride",{omit:["defaultValue"]});class ff extends Hi{constructor(e){super(e,X_)}recalculate(e,n){super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const o=this.layout.get("text-writing-mode");if(o){const c=[];for(const d of o)c.indexOf(d)<0&&c.push(d);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,n,o,c){const d=this.layout.get(e).evaluate(n,{},o,c),f=this._unevaluatedLayout._values[e];return f.isDataDriven()||Ua(f.value)||!d?d:function(g,x){return x.replace(/{([^{}]+)}/g,(w,E)=>E in g?String(g[E]):"")}(n.properties,d)}createBucket(e){return new Ws(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of X_.paint.overridableProperties){if(!ff.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),o=new qv(n),c=new Fa(o,n.property.specification);let d=null;d=n.value.kind==="constant"||n.value.kind==="source"?new Hl("source",c):new Yl("composite",c,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new Le(n.property,d,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven())&&ff.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const o=e.get("text-field"),c=X_.paint.properties[n];let d=!1;const f=g=>{for(const x of g)if(c.overrides&&c.overrides.hasOverride(x))return void(d=!0)};if(o.value.kind==="constant"&&o.value.value instanceof fr)f(o.value.value.sections);else if(o.value.kind==="source"){const g=w=>{d||(w instanceof Pa&&Fn(w.value)===ks?f(w.value.sections):w instanceof yo?f(w.sections):w.eachChild(g))},x=o.value;x._styleExpression&&g(x._styleExpression.expression)}return d}getProgramConfiguration(e){return new Gs(this,e)}}var US={paint:new We({"background-color":new ve(ze.paint_background["background-color"]),"background-pattern":new qe(ze.paint_background["background-pattern"]),"background-opacity":new ve(ze.paint_background["background-opacity"])})},NS={paint:new We({"raster-opacity":new ve(ze.paint_raster["raster-opacity"]),"raster-hue-rotate":new ve(ze.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ve(ze.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ve(ze.paint_raster["raster-brightness-max"]),"raster-saturation":new ve(ze.paint_raster["raster-saturation"]),"raster-contrast":new ve(ze.paint_raster["raster-contrast"]),"raster-resampling":new ve(ze.paint_raster["raster-resampling"]),"raster-fade-duration":new ve(ze.paint_raster["raster-fade-duration"])})};class jS extends Hi{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var VS={paint:new We({"sky-type":new ve(ze.paint_sky["sky-type"]),"sky-atmosphere-sun":new ve(ze.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ve(ze.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ve(ze.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ve(ze.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ye(ze.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ve(ze.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ve(ze.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ve(ze.paint_sky["sky-opacity"])})};function H_(t,e,n){const o=[0,0,1],c=Mx([]);return Ix(c,c,n?-mt(t)+Math.PI:mt(t)),Ax(c,c,-mt(e)),Tx(o,o,c),Mr(o,o)}const GS={circle:class extends Hi{constructor(t){super(t,$T)}createBucket(t){return new h_(t)}queryRadius(t){const e=t;return fc("circle-radius",this,e)+fc("circle-stroke-width",this,e)+Np(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,n,o,c,d,f,g){const x=_x(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),w=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return zx(t,o,d,f,g,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",x,w)}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new Gs(this,t)}},heatmap:class extends Hi{createBucket(t){return new Px(t)}constructor(t){super(t,JT),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=T_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return fc("heatmap-radius",this,t)}queryIntersectsFeature(t,e,n,o,c,d,f,g){const x=this.paint.get("heatmap-radius").evaluate(e,n);return zx(t,o,d,f,g,!0,!0,new Me(0,0),x)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new Gs(this,t)}},hillshade:class extends Hi{constructor(t){super(t,QT)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Hi{constructor(t){super(t,mE)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getProgramConfiguration(t){return new Gs(this,t)}recalculate(t,e){super.recalculate(t,e);const n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Wp(t)}queryRadius(){return Np(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,n,o,c,d){return!t.queryGeometry.isAboveHorizon&&hx(mx(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),o)}isTileClipped(){return!0}},"fill-extrusion":class extends Hi{constructor(t){super(t,kE)}createBucket(t){return new xh(t)}queryRadius(){return Np(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new Gs(this,t)}queryIntersectsFeature(t,e,n,o,c,d,f,g,x){const w=_x(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),E=this.paint.get("fill-extrusion-height").evaluate(e,n),M=this.paint.get("fill-extrusion-base").evaluate(e,n),A=[0,0],P=g&&d.elevation,D=d.elevation?d.elevation.exaggeration():1,O=t.tile.getBucket(this);if(P&&O instanceof xh){const te=O.centroidVertexArray,ce=x+1;if(ce<te.length){const oe=te.get(ce);A[0]=oe.a_centroid_pos0,A[1]=oe.a_centroid_pos1}}if(A[0]===0&&A[1]===1)return!1;d.projection.name==="globe"&&(o=Yx([o],[new Me(0,0),new Me(Et,Et)],t.tileID.canonical).map(te=>te.polygon).flat());const N=P?g:null,[J,re]=function(te,ce,oe,Se,Te,ke,$e,Ae,Re,Be,Ne){return te.projection.name==="globe"?function(Ze,Pe,it,St,lt,ot,et,bt,kt,Pt,$t){const It=[],gn=[],Lt=Ze.projection.upVectorScale($t,Ze.center.lat,Ze.worldSize).metersToTile,jt=[0,0,0,1],on=[0,0,0,1],fn=(mn,yn,Sn,Kn)=>{mn[0]=yn,mn[1]=Sn,mn[2]=Kn,mn[3]=1},hn=Hx();it>0&&(it+=hn),St+=hn;for(const mn of Pe){const yn=[],Sn=[];for(const Kn of mn){const Qt=Kn.x+lt.x,jn=Kn.y+lt.y,Ln=Ze.projection.projectTilePoint(Qt,jn,$t),Zt=Ze.projection.upVector($t,Kn.x,Kn.y);let wn=it,$n=St;if(et){const sn=ev(Qt,jn,it,St,et,bt,kt,Pt);wn+=sn.base,$n+=sn.top}it!==0?fn(jt,Ln.x+Zt[0]*Lt*wn,Ln.y+Zt[1]*Lt*wn,Ln.z+Zt[2]*Lt*wn):fn(jt,Ln.x,Ln.y,Ln.z),fn(on,Ln.x+Zt[0]*Lt*$n,Ln.y+Zt[1]*Lt*$n,Ln.z+Zt[2]*Lt*$n),Nn(jt,jt,ot),Nn(on,on,ot),yn.push(new xc(jt[0],jt[1],jt[2])),Sn.push(new xc(on[0],on[1],on[2]))}It.push(yn),gn.push(Sn)}return[It,gn]}(te,ce,oe,Se,Te,ke,$e,Ae,Re,Be,Ne):$e?function(Ze,Pe,it,St,lt,ot,et,bt,kt){const Pt=[],$t=[],It=[0,0,0,1];for(const gn of Ze){const Lt=[],jt=[];for(const on of gn){const fn=on.x+St.x,hn=on.y+St.y,mn=ev(fn,hn,Pe,it,ot,et,bt,kt);It[0]=fn,It[1]=hn,It[2]=mn.base,It[3]=1,el(It,It,lt),It[3]=Math.max(It[3],1e-5);const yn=new xc(It[0]/It[3],It[1]/It[3],It[2]/It[3]);It[0]=fn,It[1]=hn,It[2]=mn.top,It[3]=1,el(It,It,lt),It[3]=Math.max(It[3],1e-5);const Sn=new xc(It[0]/It[3],It[1]/It[3],It[2]/It[3]);Lt.push(yn),jt.push(Sn)}Pt.push(Lt),$t.push(jt)}return[Pt,$t]}(ce,oe,Se,Te,ke,$e,Ae,Re,Be):function(Ze,Pe,it,St,lt){const ot=[],et=[],bt=lt[8]*Pe,kt=lt[9]*Pe,Pt=lt[10]*Pe,$t=lt[11]*Pe,It=lt[8]*it,gn=lt[9]*it,Lt=lt[10]*it,jt=lt[11]*it;for(const on of Ze){const fn=[],hn=[];for(const mn of on){const yn=mn.x+St.x,Sn=mn.y+St.y,Kn=lt[0]*yn+lt[4]*Sn+lt[12],Qt=lt[1]*yn+lt[5]*Sn+lt[13],jn=lt[2]*yn+lt[6]*Sn+lt[14],Ln=lt[3]*yn+lt[7]*Sn+lt[15],Zt=Kn+bt,wn=Qt+kt,$n=jn+Pt,sn=Math.max(Ln+$t,1e-5),In=Kn+It,gr=Qt+gn,Jn=jn+Lt,Qn=Math.max(Ln+jt,1e-5);fn.push(new xc(Zt/sn,wn/sn,$n/sn)),hn.push(new xc(In/Qn,gr/Qn,Jn/Qn))}ot.push(fn),et.push(hn)}return[ot,et]}(ce,oe,Se,Te,ke)}(d,o,M,E,w,f,N,A,D,d.center.lat,t.tileID.canonical),K=t.queryGeometry;return function(te,ce,oe){let Se=1/0;hx(oe,ce)&&(Se=Qx(oe,ce[0]));for(let Te=0;Te<ce.length;Te++){const ke=ce[Te],$e=te[Te];for(let Ae=0;Ae<ke.length-1;Ae++){const Re=ke[Ae],Be=[Re,ke[Ae+1],$e[Ae+1],$e[Ae],Re];ux(oe,Be)&&(Se=Math.min(Se,Qx(oe,Be)))}}return Se!==1/0&&Se}(J,re,K.isPointQuery()?K.screenBounds:K.screenGeometry)}},line:class extends Hi{constructor(t){super(t,tv),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Ls,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=nv.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Jp(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(t){return new Gs(this,t)}queryRadius(t){const e=t,n=rv(fc("line-width",this,e),fc("line-gap-width",this,e)),o=fc("line-offset",this,e);return n/2+Math.abs(o)+Np(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,n,o,c,d){if(t.queryGeometry.isAboveHorizon)return!1;const f=mx(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),g=t.pixelToTileUnitsFactor/2*rv(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),x=this.paint.get("line-offset").evaluate(e,n);return x&&(o=function(w,E){const M=[],A=new Me(0,0);for(let P=0;P<w.length;P++){const D=w[P],O=[];for(let N=0;N<D.length;N++){const J=D[N-1],re=D[N],K=D[N+1],te=N===0?A:re.sub(J)._unit()._perp(),ce=N===D.length-1?A:K.sub(re)._unit()._perp(),oe=te._add(ce)._unit();oe._mult(1/(oe.x*ce.x+oe.y*ce.y)),O.push(oe._mult(E)._add(re))}M.push(O)}return M}(o,x*t.pixelToTileUnitsFactor)),function(w,E,M){for(let A=0;A<E.length;A++){const P=E[A];if(w.length>=3){for(let D=0;D<P.length;D++)if(Ja(w,P[D]))return!0}if(NT(w,P,M))return!0}return!1}(f,o,g)}isTileClipped(){return!0}},symbol:ff,background:class extends Hi{constructor(t){super(t,US)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Hi{constructor(t){super(t,NS)}getProgramIds(){return["raster"]}},sky:class extends Hi{constructor(t){super(t,VS),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=T_({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){const o=this.paint.get("sky-atmosphere-sun"),c=!o,d=t.style.light,f=d.properties.get("position");return c&&d.properties.get("anchor")==="viewport"&&Tn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?H_(f.azimuthal,90-f.polar,e):H_(o[0],90-o[1],e)}const n=this.paint.get("sky-gradient-center");return H_(n[0],90-n[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}}};class Lh{constructor(e,n,o,c){this.context=e,this.format=o,this.texture=e.gl.createTexture(),this.update(n,c)}update(e,n,o){const{width:c,height:d}=e,{context:f}=this,{gl:g}=f,{HTMLImageElement:x,HTMLCanvasElement:w,HTMLVideoElement:E,ImageData:M,ImageBitmap:A}=B;if(g.bindTexture(g.TEXTURE_2D,this.texture),f.pixelStoreUnpackFlipY.set(!1),f.pixelStoreUnpack.set(1),f.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA&&(!n||n.premultiply!==!1)),o||this.size&&this.size[0]===c&&this.size[1]===d){const{x:P,y:D}=o||{x:0,y:0};e instanceof x||e instanceof w||e instanceof E||e instanceof M||A&&e instanceof A?g.texSubImage2D(g.TEXTURE_2D,0,P,D,g.RGBA,g.UNSIGNED_BYTE,e):g.texSubImage2D(g.TEXTURE_2D,0,P,D,c,d,g.RGBA,g.UNSIGNED_BYTE,e.data)}else this.size=[c,d],e instanceof x||e instanceof w||e instanceof E||e instanceof M||A&&e instanceof A?g.texImage2D(g.TEXTURE_2D,0,this.format,this.format,g.UNSIGNED_BYTE,e):g.texImage2D(g.TEXTURE_2D,0,this.format,c,d,0,this.format,g.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(n&&n.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&g.generateMipmap(g.TEXTURE_2D)}bind(e,n){const{context:o}=this,{gl:c}=o;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.filter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,this.useMipmap?e===c.NEAREST?c.NEAREST_MIPMAP_NEAREST:c.LINEAR_MIPMAP_NEAREST:e),this.filter=e),n!==this.wrap&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,n),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class $S{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class ZS{constructor(){this.tasks={},this.taskQueue=[],dr(["process"],this),this.invoker=new $S(this.process),this.nextId=0}add(e,n){const o=this.nextId++,c=function({type:d,isSymbolTile:f,zoom:g}){return g=g||0,d==="message"?0:d!=="maybePrepare"||f?d!=="parseTile"||f?d==="parseTile"&&f?300-g:d==="maybePrepare"&&f?400-g:500:200-g:100-g}(n);if(c===0){ri();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[o]={fn:e,metadata:n,priority:c,id:o},this.taskQueue.push(o),this.invoker.trigger(),{cancel:()=>{delete this.tasks[o]}}}process(){ri();try{if(this.taskQueue=this.taskQueue.filter(o=>!!this.tasks[o]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let c=0;c<this.taskQueue.length;c++){const d=this.tasks[this.taskQueue[c]];d.priority<n&&(n=d.priority,e=c)}if(e===null)return null;const o=this.taskQueue[e];return this.taskQueue.splice(e,1),o}remove(){this.invoker.remove()}}class Wv{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const o=e[n];this._stringToNumber[o]=n,this._numberToString[n]=o}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const qS=["tile","layer","source","sourceLayer","state"];class Xv{constructor(e,n,o,c,d){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=o,this._y=c,this.properties=e.properties,this.id=d}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const n of qS)this[n]!==void 0&&(e[n]=this[n]);return e}}const ki=32,zo=33,Xs=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,n=0,o=0,c=0,d=0,f=0,g=0;for(1&e?c=d=f=ki:n=o=g=ki;(e>>=1)>1;){const w=n+c>>1,E=o+d>>1;1&e?(c=n,d=o,n=f,o=g):(n=c,o=d,c=f,d=g),f=w,g=E}const x=4*t;Xs[x+0]=n,Xs[x+1]=o,Xs[x+2]=c,Xs[x+3]=d}const ko=new Uint16Array(2178),Hs=new Uint8Array(1089),mf=new Uint16Array(1089);function Hv(t){return t===0?-.03125:t===32?.03125:0}var Yv=Xe([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Kv={type:2,extent:Et,loadGeometry:()=>[[new Me(0,0),new Me(8193,0),new Me(8193,8193),new Me(0,8193),new Me(0,0)]]};class Y_{constructor(e,n,o,c,d){this.tileID=e,this.uid=bn(),this.uses=0,this.tileSize=n,this.tileZoom=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=d,this.expiredRequestCount=0,this.state="loading",c&&c.transform&&(this.projection=c.transform.projection)}registerFadeDuration(e){const n=e+this.timeAdded;n<qt.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=rl(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,n,o){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(c,d){const f={};if(!d)return f;for(const g of c){const x=g.layerIds.map(w=>d.getLayer(w)).filter(Boolean);if(x.length!==0){g.layers=x,g.stateDependentLayerIds&&(g.stateDependentLayers=g.stateDependentLayerIds.map(w=>x.filter(E=>E.id===w)[0]));for(const w of x)f[w.id]=g}}return f}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const d=this.buckets[c];if(d instanceof Ws){if(this.hasSymbolBuckets=!0,!o)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const d=this.buckets[c];if(d instanceof Ws&&d.hasRTLText){this.hasRTLText=!0,ie.isLoading()||ie.isLoaded()||Z()!=="deferred"||ne();break}}this.queryPadding=0;for(const c in this.buckets){const d=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(c).queryRadius(d))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new i_}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const o in this.buckets){const c=this.buckets[o];c.uploadPending()&&c.upload(e)}const n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Lh(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Lh(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Lh(e,this.lineAtlas.image,n.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,n,o,c,d,f,g,x){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:c,pixelPosMatrix:g,transform:f,params:d,tileTransform:this.tileTransform},e,n,o):{}}querySourceFeatures(e,n){const o=this.latestFeatureIndex;if(!o||!o.rawTileData)return;const c=o.loadVTLayers(),d=n?n.sourceLayer:"",f=c._geojsonTileLayer||c[d];if(!f)return;const g=Jl(n&&n.filter),{z:x,x:w,y:E}=this.tileID.canonical,M={z:x,x:w,y:E};for(let A=0;A<f.length;A++){const P=f.feature(A);if(g.needGeometry){const N=Ka(P,!0);if(!g.filter(new Q(this.tileID.overscaledZ),N,this.tileID.canonical))continue}else if(!g.filter(new Q(this.tileID.overscaledZ),P))continue;const D=o.getId(P,d),O=new Xv(P,x,w,E,D);O.tile=M,e.push(O)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const n=this.expirationTime;if(e.cacheControl){const o=wa(e.cacheControl);o["max-age"]&&(this.expirationTime=Date.now()+1e3*o["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const o=Date.now();let c=!1;if(this.expirationTime>o)c=!1;else if(n)if(this.expirationTime<n)c=!0;else{const d=this.expirationTime-n;d?this.expirationTime=o+Math.max(d,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!n)return;const o=this.latestFeatureIndex.loadVTLayers(),c=n.style.listImages();for(const d in this.buckets){if(!n.style.hasLayer(d))continue;const f=this.buckets[d],g=f.layers[0].sourceLayer||"_geojsonTileLayer",x=o[g],w=e[g];if(!x||!w||Object.keys(w).length===0)continue;if(f.update(w,x,c,this.imageAtlas&&this.imageAtlas.patternPositions||{}),f instanceof Jp||f instanceof Wp){const M=n.style._getSourceCache(f.layers[0].source);n._terrain&&n._terrain.enabled&&M&&f.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(M.id,this.tileID)}const E=n&&n.style&&n.style.getLayer(d);E&&(this.queryPadding=Math.max(this.queryPadding,E.queryRadius(f)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<qt.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=qt.now()+e}setTexture(e,n){const o=n.context,c=o.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new Lh(o,e,c.RGBA,{useMipmap:!0}),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),o.extTextureFilterAnisotropic&&c.texParameterf(c.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax))}setDependencies(e,n){const o={};for(const c of n)o[c]=!0;this.dependencies[e]=o}hasDependency(e,n){for(const o of e){const c=this.dependencies[o];if(c){for(const d of n)if(c[d])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,n){if(!n||n.name==="mercator"||this._tileDebugBuffer)return;const o=Ko(Kv,this.tileID.canonical,this.tileTransform)[0],c=new Dt,d=new ih;for(let f=0;f<o.length;f++){const{x:g,y:x}=o[f];c.emplaceBack(g,x),d.emplaceBack(f)}d.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(d),this._tileDebugBuffer=e.createVertexBuffer(c,Ch.members),this._tileDebugSegments=Un.simpleSegment(0,0,c.length,d.length)}_makeTileBoundsBuffers(e,n){if(this._tileBoundsBuffer||!n||n.name==="mercator")return;const o=Ko(Kv,this.tileID.canonical,this.tileTransform)[0];let c,d;if(this.isRaster){const f=function(g,x){const w=rl(g,x),E=Math.pow(2,g.z);for(let N=0;N<zo;N++)for(let J=0;J<zo;J++){const re=ci((g.x+(J+Hv(J))/ki)/E),K=ar((g.y+(N+Hv(N))/ki)/E),te=x.project(re,K),ce=N*zo+J;ko[2*ce+0]=Math.round((te.x*w.scale-w.x)*Et),ko[2*ce+1]=Math.round((te.y*w.scale-w.y)*Et)}Hs.fill(0),mf.fill(0);for(let N=2045;N>=0;N--){const J=4*N,re=Xs[J+0],K=Xs[J+1],te=Xs[J+2],ce=Xs[J+3],oe=re+te>>1,Se=K+ce>>1,Te=oe+Se-K,ke=Se+re-oe,$e=K*zo+re,Ae=ce*zo+te,Re=Se*zo+oe,Be=Math.hypot((ko[2*$e+0]+ko[2*Ae+0])/2-ko[2*Re+0],(ko[2*$e+1]+ko[2*Ae+1])/2-ko[2*Re+1])>=16;if(Hs[Re]=Hs[Re]||(Be?1:0),N<1022){const Ne=(K+ke>>1)*zo+(re+Te>>1),Ze=(ce+ke>>1)*zo+(te+Te>>1);Hs[Re]=Hs[Re]||Hs[Ne]||Hs[Ze]}}const M=new rn,A=new _r;let P=0;function D(N,J){const re=J*zo+N;return mf[re]===0&&(M.emplaceBack(ko[2*re+0],ko[2*re+1],N*Et/ki,J*Et/ki),mf[re]=++P),mf[re]-1}function O(N,J,re,K,te,ce){const oe=N+re>>1,Se=J+K>>1;if(Math.abs(N-te)+Math.abs(J-ce)>1&&Hs[Se*zo+oe])O(te,ce,N,J,oe,Se),O(re,K,te,ce,oe,Se);else{const Te=D(N,J),ke=D(re,K),$e=D(te,ce);A.emplaceBack(Te,ke,$e)}}return O(0,0,ki,ki,ki,0),O(ki,ki,0,0,0,ki),{vertices:M,indices:A}}(this.tileID.canonical,n);c=f.vertices,d=f.indices}else{c=new rn,d=new _r;for(const{x:g,y:x}of o)c.emplaceBack(g,x,0,0);const f=dh.exports(c.int16,void 0,4);for(let g=0;g<f.length;g+=3)d.emplaceBack(f[g],f[g+1],f[g+2])}this._tileBoundsBuffer=e.createVertexBuffer(c,Yv.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(d),this._tileBoundsSegments=Un.simpleSegment(0,0,c.length,d.length)}_makeGlobeTileDebugBuffers(e,n){const o=n.projection;if(!o||o.name!=="globe"||n.freezeTileCoverage)return;const c=this.tileID.canonical,d=Ih(Lv(c,n)),f=Ic(n.zoom);let g;f>0&&(g=f_(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,c,n,d,g,f),this._makeGlobeTileDebugTextBuffer(e,c,n,d,g,f)}_globePoint(e,n,o,c,d,f,g){let x=Ah(e,n,o);if(f){const w=1<<o.z,E=Eo(c.center.lng),M=So(c.center.lat),A=(o.x+.5)/w-E;let P=0;A>.5?P=-1:A<-.5&&(P=1);let D=(e/Et+o.x)/w+P,O=(n/Et+o.y)/w;D=(D-E)*c._pixelsPerMercatorPixel+E,O=(O-M)*c._pixelsPerMercatorPixel+M;const N=[D*c.worldSize,O*c.worldSize,0];Nn(N,N,f),x=nl(x,N,g)}return Nn(x,x,d)}_makeGlobeTileDebugBorderBuffer(e,n,o,c,d,f){const g=new Dt,x=new ih,w=new nn,E=(A,P,D,O,N)=>{const J=(D-A)/(N-1),re=(O-P)/(N-1),K=g.length;for(let te=0;te<N;te++){const ce=A+te*J,oe=P+te*re;g.emplaceBack(ce,oe);const Se=this._globePoint(ce,oe,n,o,c,d,f);w.emplaceBack(Se[0],Se[1],Se[2]),x.emplaceBack(K+te)}},M=Et;E(0,0,M,0,16),E(M,0,M,M,16),E(M,M,0,M,16),E(0,M,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(x),this._tileDebugBuffer=e.createVertexBuffer(g,Ch.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(w,Pv.members),this._tileDebugSegments=Un.simpleSegment(0,0,g.length,x.length)}_makeGlobeTileDebugTextBuffer(e,n,o,c,d,f){const g=new Dt,x=new _r,w=new nn,E=25;x.reserve(32),g.reserve(E),w.reserve(E);const M=(A,P)=>E*A+P;for(let A=0;A<E;A++){const P=2048*A;for(let D=0;D<E;D++){const O=2048*D;g.emplaceBack(O,P);const N=this._globePoint(O,P,n,o,c,d,f);w.emplaceBack(N[0],N[1],N[2])}}for(let A=0;A<4;A++)for(let P=0;P<4;P++){const D=M(A,P),O=M(A,P+1),N=M(A+1,P),J=M(A+1,P+1);x.emplaceBack(D,O,N),x.emplaceBack(N,O,J)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(x),this._tileDebugTextBuffer=e.createVertexBuffer(g,Ch.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(w,Pv.members),this._tileDebugTextSegments=Un.simpleSegment(0,0,E,32)}}class WS{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,o){const c=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},_t(this.stateChanges[e][c],o),this.deletedStates[e]===null){this.deletedStates[e]={};for(const d in this.state[e])d!==c&&(this.deletedStates[e][d]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][c]===null){this.deletedStates[e][c]={};for(const d in this.state[e][c])o[d]||(this.deletedStates[e][c][d]=null)}else for(const d in o)this.deletedStates[e]&&this.deletedStates[e][c]&&this.deletedStates[e][c][d]===null&&delete this.deletedStates[e][c][d]}removeFeatureState(e,n,o){if(this.deletedStates[e]===null)return;const c=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},o&&n!==void 0)this.deletedStates[e][c]!==null&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][o]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][c])for(o in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][o]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}getState(e,n){const o=String(n),c=_t({},(this.state[e]||{})[o],(this.stateChanges[e]||{})[o]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const d=this.deletedStates[e][n];if(d===null)return{};for(const f in d)delete c[f]}return c}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){const o={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const d={};for(const f in this.stateChanges[c])this.state[c][f]||(this.state[c][f]={}),_t(this.state[c][f],this.stateChanges[c][f]),d[f]=this.state[c][f];o[c]=d}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const d={};if(this.deletedStates[c]===null)for(const f in this.state[c])d[f]={},this.state[c][f]={};else for(const f in this.deletedStates[c]){if(this.deletedStates[c][f]===null)this.state[c][f]={};else for(const g of Object.keys(this.deletedStates[c][f]))delete this.state[c][f][g];d[f]=this.state[c][f]}o[c]=o[c]||{},_t(o[c],d)}if(this.stateChanges={},this.deletedStates={},Object.keys(o).length!==0)for(const c in e)e[c].setFeatureState(o,n)}}class Jv{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){const o=this.toIdx(e,n);return{min:this.minimums[o],max:this.maximums[o]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function Qv(t,e,n,o){let c=0,d=Number.MAX_VALUE;for(let f=0;f<3;f++)if(Math.abs(o[f])<1e-15){if(n[f]<t[f]||n[f]>e[f])return null}else{const g=1/o[f];let x=(t[f]-n[f])*g,w=(e[f]-n[f])*g;if(x>w){const E=x;x=w,w=E}if(x>c&&(c=x),w<d&&(d=w),c>d)return null}return c}function e1(t,e,n,o,c,d,f,g,x,w,E){const M=o-t,A=c-e,P=d-n,D=f-t,O=g-e,N=x-n,J=E[1]*N-E[2]*O,re=E[2]*D-E[0]*N,K=E[0]*O-E[1]*D,te=M*J+A*re+P*K;if(Math.abs(te)<1e-15)return null;const ce=1/te,oe=w[0]-t,Se=w[1]-e,Te=w[2]-n,ke=(oe*J+Se*re+Te*K)*ce;if(ke<0||ke>1)return null;const $e=Se*P-Te*A,Ae=Te*M-oe*P,Re=oe*A-Se*M,Be=(E[0]*$e+E[1]*Ae+E[2]*Re)*ce;return Be<0||ke+Be>1?null:(D*$e+O*Ae+N*Re)*ce}function t1(t,e,n){return(t-e)/(n-e)}function n1(t,e,n,o,c,d,f,g,x){const w=1<<n,E=d-o,M=f-c,A=(t+1)/w*E+o,P=(e+0)/w*M+c,D=(e+1)/w*M+c;g[0]=(t+0)/w*E+o,g[1]=P,x[0]=A,x[1]=D}class r1{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=function(d){const f=Math.ceil(Math.log2(d.dim/8)),g=[];let x=Math.ceil(Math.pow(2,f));const w=1/x,E=(P,D,O,N,J)=>{const re=N?1:0,K=(P+1)*O-re,te=D*O,ce=(D+1)*O-re;J[0]=P*O,J[1]=te,J[2]=K,J[3]=ce};let M=new Jv(x);const A=[];for(let P=0;P<x*x;P++){E(P%x,Math.floor(P/x),w,!1,A);const D=Ys(A[0],A[1],d),O=Ys(A[2],A[1],d),N=Ys(A[2],A[3],d),J=Ys(A[0],A[3],d);M.minimums.push(Math.min(D,O,N,J)),M.maximums.push(Math.max(D,O,N,J)),M.leaves.push(1)}for(g.push(M),x/=2;x>=1;x/=2){const P=g[g.length-1];M=new Jv(x);for(let D=0;D<x*x;D++){E(D%x,Math.floor(D/x),2,!0,A);const O=P.getElevation(A[0],A[1]),N=P.getElevation(A[2],A[1]),J=P.getElevation(A[2],A[3]),re=P.getElevation(A[0],A[3]),K=P.isLeaf(A[0],A[1]),te=P.isLeaf(A[2],A[1]),ce=P.isLeaf(A[2],A[3]),oe=P.isLeaf(A[0],A[3]),Se=Math.min(O.min,N.min,J.min,re.min),Te=Math.max(O.max,N.max,J.max,re.max),ke=K&&te&&ce&&oe;M.maximums.push(Te),M.minimums.push(Se),M.leaves.push(Te-Se<=5&&ke?1:0)}g.push(M)}return g}(this.dem),o=n.length-1,c=n[o];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(n,0,0,o,0)}raycastRoot(e,n,o,c,d,f,g=1){return Qv([e,n,-100],[o,c,this.maximums[0]*g],d,f)}raycast(e,n,o,c,d,f,g=1){if(!this.nodeCount)return null;const x=this.raycastRoot(e,n,o,c,d,f,g);if(x==null)return null;const w=[],E=[],M=[],A=[],P=[{idx:0,t:x,nodex:0,nodey:0,depth:0}];for(;P.length>0;){const{idx:D,t:O,nodex:N,nodey:J,depth:re}=P.pop();if(this.leaves[D]){n1(N,J,re,e,n,o,c,M,A);const te=1<<re,ce=(N+0)/te,oe=(N+1)/te,Se=(J+0)/te,Te=(J+1)/te,ke=Ys(ce,Se,this.dem)*g,$e=Ys(oe,Se,this.dem)*g,Ae=Ys(oe,Te,this.dem)*g,Re=Ys(ce,Te,this.dem)*g,Be=e1(M[0],M[1],ke,A[0],M[1],$e,A[0],A[1],Ae,d,f),Ne=e1(A[0],A[1],Ae,M[0],A[1],Re,M[0],M[1],ke,d,f),Ze=Math.min(Be!==null?Be:Number.MAX_VALUE,Ne!==null?Ne:Number.MAX_VALUE);if(Ze!==Number.MAX_VALUE)return Ze;{const Pe=uh([],d,f,O);if(i1(ke,$e,Re,Ae,t1(Pe[0],M[0],A[0]),t1(Pe[1],M[1],A[1]))>=Pe[2])return O}continue}let K=0;for(let te=0;te<this._siblingOffset.length;te++){n1((N<<1)+this._siblingOffset[te][0],(J<<1)+this._siblingOffset[te][1],re+1,e,n,o,c,M,A),M[2]=-100,A[2]=this.maximums[this.childOffsets[D]+te]*g;const ce=Qv(M,A,d,f);if(ce!=null){const oe=ce;w[te]=oe;let Se=!1;for(let Te=0;Te<K&&!Se;Te++)oe>=w[E[Te]]&&(E.splice(Te,0,te),Se=!0);Se||(E[K]=te),K++}}for(let te=0;te<K;te++){const ce=E[te];P.push({idx:this.childOffsets[D]+ce,t:w[ce],nodex:(N<<1)+this._siblingOffset[ce][0],nodey:(J<<1)+this._siblingOffset[ce][1],depth:re+1})}}return null}_addNode(e,n,o){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(o),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,o,c,d){if(e[c].isLeaf(n,o)===1)return;this.childOffsets[d]||(this.childOffsets[d]=this.nodeCount);const f=c-1,g=e[f];let x=0,w=0;for(let E=0;E<this._siblingOffset.length;E++){const M=2*n+this._siblingOffset[E][0],A=2*o+this._siblingOffset[E][1],P=g.getElevation(M,A),D=g.isLeaf(M,A),O=this._addNode(P.min,P.max,D);D&&(x|=1<<E),w||(w=O)}for(let E=0;E<this._siblingOffset.length;E++)x&1<<E||this._construct(e,2*n+this._siblingOffset[E][0],2*o+this._siblingOffset[E][1],f,w+E)}}function i1(t,e,n,o,c,d){return Gt(Gt(t,n,d),Gt(e,o,d),c)}function Ys(t,e,n){const o=n.dim,c=Ot(t*o-.5,0,o-1),d=Ot(e*o-.5,0,o-1),f=Math.floor(c),g=Math.floor(d),x=Math.min(f+1,o-1),w=Math.min(g+1,o-1);return i1(n.get(f,g),n.get(x,g),n.get(f,w),n.get(x,w),c-f,d-g)}const o1={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class _f{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,o,c=!1,d=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return Tn(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const f=this.dim=n.height-2,g=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.encoding=o||"mapbox",this.borderReady=c,!c){for(let x=0;x<f;x++)g[this._idx(-1,x)]=g[this._idx(0,x)],g[this._idx(f,x)]=g[this._idx(f-1,x)],g[this._idx(x,-1)]=g[this._idx(x,0)],g[this._idx(x,f)]=g[this._idx(x,f-1)];g[this._idx(-1,-1)]=g[this._idx(0,0)],g[this._idx(f,-1)]=g[this._idx(f-1,0)],g[this._idx(-1,f)]=g[this._idx(0,f-1)],g[this._idx(f,f)]=g[this._idx(f-1,f-1)],d&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new r1(this)}get(e,n,o=!1){o&&(e=Ot(e,-1,this.dim),n=Ot(n,-1,this.dim));const c=4*this._idx(e,n);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(this.pixels[c],this.pixels[c+1],this.pixels[c+2])}static getUnpackVector(e){return o1[e]}get unpackVector(){return o1[this.encoding]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}_unpackMapbox(e,n,o){return(256*e*256+256*n+o)/10-1e4}_unpackTerrarium(e,n,o){return 256*e+n+o/256-32768}static pack(e,n){const o=[0,0,0,0],c=_f.getUnpackVector(n);let d=Math.floor((e+c[3])/c[2]);return o[2]=d%256,d=Math.floor(d/256),o[1]=d%256,d=Math.floor(d/256),o[0]=d,o}getPixels(){return new Zr({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=n*this.dim,d=n*this.dim+this.dim,f=o*this.dim,g=o*this.dim+this.dim;switch(n){case-1:c=d-1;break;case 1:d=c+1}switch(o){case-1:f=g-1;break;case 1:g=f+1}const x=-n*this.dim,w=-o*this.dim;for(let E=f;E<g;E++)for(let M=c;M<d;M++){const A=4*this._idx(M,E),P=4*this._idx(M+x,E+w);this.pixels[A+0]=e.pixels[P+0],this.pixels[A+1]=e.pixels[P+1],this.pixels[A+2]=e.pixels[P+2],this.pixels[A+3]=e.pixels[P+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}rt(_f,"DEMData"),rt(r1,"DemMinMaxQuadTree",{omit:["dem"]});class XS{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(const e in this.data)for(const n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,o){const c=e.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const d={value:n,timeout:void 0};if(o!==void 0&&(d.timeout=setTimeout(()=>{this.remove(e,d)},o)),this.data[c].push(d),this.order.push(c),this.order.length>this.max){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){const n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;const o=e.wrapped().key,c=n===void 0?0:this.data[o].indexOf(n),d=this.data[o][c];return this.data[o].splice(c,1),d.timeout&&clearTimeout(d.timeout),this.data[o].length===0&&delete this.data[o],this.onRemove(d.value),this.order.splice(this.order.indexOf(o),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){const n=[];for(const o in this.data)for(const c of this.data[o])e(c.value)||n.push(c);for(const o of n)this.remove(o.value.tileID,o)}}class kc{constructor(e,n,o){this.func=e,this.mask=n,this.range=o}}kc.ReadOnly=!1,kc.ReadWrite=!0,kc.disabled=new kc(519,kc.ReadOnly,[0,1]);const K_=7680;class J_{constructor(e,n,o,c,d,f){this.test=e,this.ref=n,this.mask=o,this.fail=c,this.depthFail=d,this.pass=f}}J_.disabled=new J_({func:519,mask:0},0,0,K_,K_,K_);class Po{constructor(e,n,o){this.blendFunction=e,this.blendColor=n,this.mask=o}}Po.Replace=[1,0],Po.disabled=new Po(Po.Replace,An.transparent,[!1,!1,!1,!1]),Po.unblended=new Po(Po.Replace,An.transparent,[!0,!0,!0,!0]),Po.alphaBlended=new Po([1,771],An.transparent,[!0,!0,!0,!0]);const Q_=1029,eg=2305;class Qi{constructor(e,n,o){this.enable=e,this.mode=n,this.frontFace=o}}Qi.disabled=new Qi(!1,Q_,eg),Qi.backCCW=new Qi(!0,Q_,eg),Qi.backCW=new Qi(!0,Q_,2304),Qi.frontCW=new Qi(!0,1028,2304),Qi.frontCCW=new Qi(!0,1028,eg);class il extends Ni{constructor(e,n,o){super(),this.id=e,this._onlySymbols=o,n.on("data",c=>{c.dataType==="source"&&c.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&c.dataType==="source"&&c.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new XS(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new WS,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const n=this._tiles[e];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,n){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,n)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const o=this._tiles[n];o.upload(e),o.prepare(this.map.style.imageManager)}}getIds(){return zt(this._tiles).map(e=>e.tileID).sort(s1).map(e=>e.key)}getRenderableIds(e){const n=[];for(const o in this._tiles)this._isIdRenderable(+o,e)&&n.push(this._tiles[o]);return e?n.sort((o,c)=>{const d=o.tileID,f=c.tileID,g=new Me(d.canonical.x,d.canonical.y)._rotate(this.transform.angle),x=new Me(f.canonical.x,f.canonical.y)._rotate(this.transform.angle);return d.overscaledZ-f.overscaledZ||x.y-g.y||x.x-g.x}).map(o=>o.tileID.key):n.map(o=>o.tileID).sort(s1).map(o=>o.key)}hasRenderableParent(e){const n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,n){const o=this._tiles[e];o&&(o.state!=="loading"&&(o.state=n),this._loadTile(o,this._tileLoaded.bind(this,o,e,n)))}_tileLoaded(e,n,o,c){if(c)if(e.state="errored",c.status!==404)this._source.fire(new _o(c,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const d=this.map.painter.terrain;this.update(this.transform,d.getScaledDemTileSize(),!0),d.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=qt.now(),o==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new tn("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const n=this.getRenderableIds();for(let c=0;c<n.length;c++){const d=n[c];if(e.neighboringTiles&&e.neighboringTiles[d]){const f=this.getTileByID(d);o(e,f),o(f,e)}}function o(c,d){if(!c.dem||c.dem.borderReady)return;c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0;let f=d.tileID.canonical.x-c.tileID.canonical.x;const g=d.tileID.canonical.y-c.tileID.canonical.y,x=Math.pow(2,c.tileID.canonical.z),w=d.tileID.key;f===0&&g===0||Math.abs(g)>1||(Math.abs(f)>1&&(Math.abs(f+x)===1?f+=x:Math.abs(f-x)===1&&(f-=x)),d.dem&&c.dem&&(c.dem.backfillBorder(d.dem,f,g),c.neighboringTiles&&c.neighboringTiles[w]&&(c.neighboringTiles[w].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,o,c){for(const d in this._tiles){let f=this._tiles[d];if(c[d]||!f.hasData()||f.tileID.overscaledZ<=n||f.tileID.overscaledZ>o)continue;let g=f.tileID;for(;f&&f.tileID.overscaledZ>n+1;){const w=f.tileID.scaledTo(f.tileID.overscaledZ-1);f=this._tiles[w.key],f&&f.hasData()&&(g=w)}let x=g;for(;x.overscaledZ>n;)if(x=x.scaledTo(x.overscaledZ-1),e[x.key]){c[g.key]=g;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){const o=this._loadedParentTiles[e.key];return o&&o.tileID.overscaledZ>=n?o:null}for(let o=e.overscaledZ-1;o>=n;o--){const c=e.scaledTo(o),d=this._getLoadedTile(c);if(d)return d}}_getLoadedTile(e){const n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,n){n=n||this._source.tileSize;const o=Math.ceil(e.width/n)+1,c=Math.ceil(e.height/n)+1,d=Math.floor(o*c*5),f=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,d):d,g=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,f):f;this._cache.setMaxSize(g)}handleWrapJump(e){const n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){const o={};for(const c in this._tiles){const d=this._tiles[c];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+n),o[d.tileID.key]=d}this._tiles=o;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(+c,this._tiles[c])}}update(e,n,o){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!o)return;let c;this.updateCacheSize(e,n),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?c=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(g=>new Ir(g.canonical.z,g.wrap,g.canonical.z,g.canonical.x,g.canonical.y)):(c=e.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!o,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(c=c.filter(g=>this._source.hasTile(g)))):c=[];const d=this._updateRetainedTiles(c);if(a1(this._source.type)&&c.length!==0){const g={},x={},w=Object.keys(d);for(const M of w){const A=d[M],P=this._tiles[M];if(!P||P.fadeEndTime&&P.fadeEndTime<=qt.now())continue;const D=this.findLoadedParent(A,Math.max(A.overscaledZ-il.maxOverzooming,this._source.minzoom));D&&(this._addTile(D.tileID),g[D.tileID.key]=D.tileID),x[M]=A}const E=c[c.length-1].overscaledZ;for(const M in this._tiles){const A=this._tiles[M];if(d[M]||!A.hasData())continue;let P=A.tileID;for(;P.overscaledZ>E;){P=P.scaledTo(P.overscaledZ-1);const D=this._tiles[P.key];if(D&&D.hasData()&&x[P.key]){d[M]=A.tileID;break}}}for(const M in g)d[M]||(this._coveredTiles[M]=!0,d[M]=g[M])}for(const g in d)this._tiles[g].clearFadeHold();const f=function(g,x){const w=[];for(const E in g)E in x||w.push(E);return w}(this._tiles,d);for(const g of f){const x=this._tiles[g];x.hasSymbolBuckets&&!x.holdingForFade()?x.setHoldDuration(this.map._fadeDuration):x.hasSymbolBuckets&&!x.symbolFadeFinished()||this._removeTile(+g)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const n={};if(e.length===0)return n;const o={},c=e.reduce((w,E)=>Math.min(w,E.overscaledZ),1/0),d=e[0].overscaledZ,f=Math.max(d-il.maxOverzooming,this._source.minzoom),g=Math.max(d+il.maxUnderzooming,this._source.minzoom),x={};for(const w of e){const E=this._addTile(w);n[w.key]=w,E.hasData()||c<this._source.maxzoom&&(x[w.key]=w)}this._retainLoadedChildren(x,c,g,n);for(const w of e){let E=this._tiles[w.key];if(E.hasData())continue;if(w.canonical.z>=this._source.maxzoom){const A=w.children(this._source.maxzoom)[0],P=this.getTile(A);if(P&&P.hasData()){n[A.key]=A;continue}}else{const A=w.children(this._source.maxzoom);if(n[A[0].key]&&n[A[1].key]&&n[A[2].key]&&n[A[3].key])continue}let M=E.wasRequested();for(let A=w.overscaledZ-1;A>=f;--A){const P=w.scaledTo(A);if(o[P.key]||(o[P.key]=!0,E=this.getTile(P),!E&&M&&(E=this._addTile(P)),E&&(n[P.key]=P,M=E.wasRequested(),E.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const n=[];let o,c=this._tiles[e].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){o=this._loadedParentTiles[c.key];break}n.push(c.key);const d=c.scaledTo(c.overscaledZ-1);if(o=this._getLoadedTile(d),o)break;c=d}for(const d of n)this._loadedParentTiles[d]=o}}_addTile(e){let n=this._tiles[e.key];if(n)return n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));const o=Boolean(n);if(!o){const c=this.map?this.map.painter:null;n=new Y_(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,c,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))}return n?(n.uses++,this._tiles[e.key]=n,o||this._source.fire(new tn("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const o=n.getExpiryTimeout();o&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},o))}_removeTile(e){const n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,n,o){const c=[],d=this.transform;if(!d)return c;const f=d.projection.name==="globe",g=Eo(d.center.lng);for(const x in this._tiles){const w=this._tiles[x];if(o&&w.clearQueryDebugViz(),w.holdingForFade())continue;let E;if(f){const M=w.tileID.canonical;if(M.z===0){const A=[Math.abs(Ot(g,...Rh(M,-1))-g),Math.abs(Ot(g,...Rh(M,1))-g)];E=[0,2*A.indexOf(Math.min(...A))-1]}else{const A=[Math.abs(Ot(g,...Rh(M,-1))-g),Math.abs(Ot(g,...Rh(M,0))-g),Math.abs(Ot(g,...Rh(M,1))-g)];E=[A.indexOf(Math.min(...A))-1]}}else E=[0];for(const M of E){const A=e.containsTile(w,d,n,M);A&&c.push(A)}}return c}getVisibleCoordinates(e){const n=this.getRenderableIds(e).map(o=>this._tiles[o].tileID);for(const o of n)o.projMatrix=this.transform.calculateProjMatrix(o.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(a1(this._source.type))for(const e in this._tiles){const n=this._tiles[e];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=qt.now())return!0}return!1}setFeatureState(e,n,o){this._state.updateState(e=e||"_geojsonTileLayer",n,o)}removeFeatureState(e,n,o){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,o)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,o){const c=this._tiles[e];c&&c.setDependencies(n,o)}reloadTilesForDependencies(e,n){for(const o in this._tiles)this._tiles[o].hasDependency(e,n)&&this._reloadTile(+o,"reloading");this._cache.filter(o=>!o.hasDependency(e,n))}_preloadTiles(e,n){const o=new Map,c=Array.isArray(e)?e:[e],d=this.map.painter.terrain,f=this.usedForTerrain&&d?d.getScaledDemTileSize():this._source.tileSize;for(const g of c){const x=g.coveringTiles({tileSize:f,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const w of x)o.set(w.key,w);this.usedForTerrain&&g.updateElevation(!1)}st(Array.from(o.values()),(g,x)=>{const w=new Y_(g,this._source.tileSize*g.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(w,E=>{this._source.type==="raster-dem"&&w.dem&&this._backfillDEM(w),x(E,w)})},n)}}function s1(t,e){const n=Math.abs(2*t.wrap)-+(t.wrap<0),o=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||o-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function a1(t){return t==="raster"||t==="image"||t==="video"||t==="custom"}function Rh(t,e){const n=1<<t.z;return[t.x/n+e,(t.x+1)/n+e]}il.maxOverzooming=10,il.maxUnderzooming=3;class gf{constructor(e,n,o){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=o}static create(e,n,o){const c=o||e.findDEMTileFor(n);if(!c||!c.dem)return;const d=c.dem,f=c.tileID,g=1<<n.canonical.z-f.canonical.z;return new gf(c,c.tileSize/Et/g,[(n.canonical.x/g-f.canonical.x)*d.dim,(n.canonical.y/g-f.canonical.y)*d.dim])}tileCoordToPixel(e,n){const o=n*this._scale+this._offset[1],c=Math.floor(e*this._scale+this._offset[0]),d=Math.floor(o);return new Me(c,d)}getElevationAt(e,n,o,c){const d=e*this._scale+this._offset[0],f=n*this._scale+this._offset[1],g=Math.floor(d),x=Math.floor(f),w=this._dem;return c=!!c,o?Gt(Gt(w.get(g,x,c),w.get(g,x+1,c),f-x),Gt(w.get(g+1,x,c),w.get(g+1,x+1,c),f-x),d-g):w.get(g,x,c)}getElevationAtPixel(e,n,o){return this._dem.get(e,n,!!o)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Ii(1,e)*this._dem.stride}}class l1{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ns(Et,16,0),this.featureIndexArray=new W0,this.promoteId=n}insert(e,n,o,c,d,f=0){const g=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,c,d,f);const x=this.grid;for(let w=0;w<n.length;w++){const E=n[w],M=[1/0,1/0,-1/0,-1/0];for(let A=0;A<E.length;A++){const P=E[A];M[0]=Math.min(M[0],P.x),M[1]=Math.min(M[1],P.y),M[2]=Math.max(M[2],P.x),M[3]=Math.max(M[3],P.y)}M[0]<Et&&M[1]<Et&&M[2]>=0&&M[3]>=0&&x.insert(g,M[0],M[1],M[2],M[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new z_(new Th(this.rawTileData)).layers,this.sourceLayerCoder=new Wv(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,o,c){this.loadVTLayers();const d=e.params||{},f=Jl(d.filter),g=e.tileResult,x=e.transform,w=g.bufferedTilespaceBounds,E=this.grid.query(w.min.x,w.min.y,w.max.x,w.max.y,(D,O,N,J)=>fx(g.bufferedTilespaceGeometry,D,O,N,J));E.sort(HS);let M=null;x.elevation&&E.length>0&&(M=gf.create(x.elevation,this.tileID));const A={};let P;for(let D=0;D<E.length;D++){const O=E[D];if(O===P)continue;P=O;const N=this.featureIndexArray.get(O);let J=null;this.loadMatchingFeature(A,N,f,d.layers,d.availableImages,n,o,c,(re,K,te,ce=0)=>(J||(J=Ko(re,this.tileID.canonical,e.tileTransform)),K.queryIntersectsFeature(g,re,te,J,this.z,e.transform,e.pixelPosMatrix,M,ce)))}return A}loadMatchingFeature(e,n,o,c,d,f,g,x,w){const{featureIndex:E,bucketIndex:M,sourceLayerIndex:A,layoutVertexArrayOffset:P}=n,D=this.bucketLayerIDs[M];if(c&&!function(re,K){for(let te=0;te<re.length;te++)if(K.indexOf(re[te])>=0)return!0;return!1}(c,D))return;const O=this.sourceLayerCoder.decode(A),N=this.vtLayers[O].feature(E);if(o.needGeometry){const re=Ka(N,!0);if(!o.filter(new Q(this.tileID.overscaledZ),re,this.tileID.canonical))return}else if(!o.filter(new Q(this.tileID.overscaledZ),N))return;const J=this.getId(N,O);for(let re=0;re<D.length;re++){const K=D[re];if(c&&c.indexOf(K)<0)continue;const te=f[K];if(!te)continue;let ce={};J!==void 0&&x&&(ce=x.getState(te.sourceLayer||"_geojsonTileLayer",J));const oe=_t({},g[K]);oe.paint=c1(oe.paint,te.paint,N,ce,d),oe.layout=c1(oe.layout,te.layout,N,ce,d);const Se=!w||w(N,te,ce,P);if(!Se)continue;const Te=new Xv(N,this.z,this.x,this.y,J);Te.layer=oe;let ke=e[K];ke===void 0&&(ke=e[K]=[]),ke.push({featureIndex:E,feature:Te,intersectionZ:Se})}}lookupSymbolFeatures(e,n,o,c,d,f,g,x){const w={};this.loadVTLayers();const E=Jl(d);for(const M of e)this.loadMatchingFeature(w,{bucketIndex:o,sourceLayerIndex:c,featureIndex:M,layoutVertexArrayOffset:0},E,f,g,x,n);return w}loadFeature(e){const{featureIndex:n,sourceLayerIndex:o}=e;this.loadVTLayers();const c=this.sourceLayerCoder.decode(o),d=this.vtFeatures[c];if(d[n])return d[n];const f=this.vtLayers[c].feature(n);return d[n]=f,f}hasLayer(e){for(const n of this.bucketLayerIDs)for(const o of n)if(e===o)return!0;return!1}getId(e,n){let o=e.id;if(this.promoteId){const c=typeof this.promoteId=="string"?this.promoteId:this.promoteId[n];c!=null&&(o=e.properties[c]),typeof o=="boolean"&&(o=Number(o))}return o}}function c1(t,e,n,o,c){return lo(t,(d,f)=>{const g=e instanceof De?e.get(f):null;return g&&g.evaluate?g.evaluate(n,o,c):g})}function HS(t,e){return e-t}rt(l1,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class u1{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new Qo({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){const o=this.getKey(e,n);return this.positions[o]}trim(){const e=this.width,n=this.height=qn(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,o){const c=[];let d=e.length%2==1?-e[e.length-1]*o:0,f=e[0]*o,g=!0;c.push({left:d,right:f,isDash:g,zeroLength:e[0]===0});let x=e[0];for(let w=1;w<e.length;w++){g=!g;const E=e[w];d=x*o,x+=E,f=x*o,c.push({left:d,right:f,isDash:g,zeroLength:E===0})}return c}addRoundDash(e,n,o){const c=n/2;for(let d=-o;d<=o;d++){const f=this.width*(this.nextRow+o+d);let g=0,x=e[g];for(let w=0;w<this.width;w++){w/x.right>1&&(x=e[++g]);const E=Math.abs(w-x.left),M=Math.abs(w-x.right),A=Math.min(E,M);let P;const D=d/o*(c+1);if(x.isDash){const O=c-Math.abs(D);P=Math.sqrt(A*A+O*O)}else P=c-Math.sqrt(A*A+D*D);this.image.data[f+w]=Math.max(0,Math.min(255,P+128))}}}addRegularDash(e,n){for(let x=e.length-1;x>=0;--x){const w=e[x],E=e[x+1];w.zeroLength?e.splice(x,1):E&&E.isDash===w.isDash&&(E.left=w.left,e.splice(x,1))}const o=e[0],c=e[e.length-1];o.isDash===c.isDash&&(o.left=c.left-this.width,c.right=o.right+this.width);const d=this.width*this.nextRow;let f=0,g=e[f];for(let x=0;x<this.width;x++){x/g.right>1&&(g=e[++f]);const w=Math.abs(x-g.left),E=Math.abs(x-g.right),M=Math.min(w,E);this.image.data[d+x]=Math.max(0,Math.min(255,(g.isDash?M:-M)+n+128))}}addDash(e,n){const o=this.getKey(e,n);if(this.positions[o])return this.positions[o];const c=n==="round",d=c?7:0,f=2*d+1;if(this.nextRow+f>this.height)return Tn("LineAtlas out of space"),null;e.length===0&&e.push(1);let g=0;for(let E=0;E<e.length;E++)e[E]<0&&(Tn("Negative value is found in line dasharray, replacing values with 0"),e[E]=0),g+=e[E];if(g!==0){const E=this.width/g,M=this.getDashRanges(e,this.width,E);c?this.addRoundDash(M,E,d):this.addRegularDash(M,n==="square"?.5*E:0)}const x=this.nextRow+d;this.nextRow+=f;const w={tl:[x,d],br:[g,0]};return this.positions[o]=w,w}}rt(u1,"LineAtlas");class h1{constructor(e){const n={},o=[];for(const g in e){const x=e[g],w=n[g]={};for(const E in x.glyphs){const M=x.glyphs[+E];if(!M||M.bitmap.width===0||M.bitmap.height===0)continue;const A=M.metrics.localGlyph?2:1,P={x:0,y:0,w:M.bitmap.width+2*A,h:M.bitmap.height+2*A};o.push(P),w[E]=P}}const{w:c,h:d}=D_(o),f=new Qo({width:c||1,height:d||1});for(const g in e){const x=e[g];for(const w in x.glyphs){const E=x.glyphs[+w];if(!E||E.bitmap.width===0||E.bitmap.height===0)continue;const M=n[g][w],A=E.metrics.localGlyph?2:1;Qo.copy(E.bitmap,f,{x:0,y:0},{x:M.x+A,y:M.y+A},E.bitmap)}}this.image=f,this.positions=n}}rt(h1,"GlyphAtlas");class YS{constructor(e){this.tileID=new Ir(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=rl(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,n,o,c,d){this.status="parsing",this.data=e,this.collisionBoxArray=new i_;const f=new Wv(Object.keys(e.layers).sort()),g=new l1(this.tileID,this.promoteId);g.bucketLayerIDs=[];const x={},w=new u1(256,256),E={featureIndex:g,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:w,availableImages:o},M=n.familiesBySource[this.source];for(const ce in M){const oe=e.layers[ce];if(!oe)continue;let Se=!1,Te=!1;for(const Ae of M[ce])Ae[0].type==="symbol"?Se=!0:Te=!0;if(this.isSymbolTile===!0&&!Se||this.isSymbolTile===!1&&!Te)continue;oe.version===1&&Tn(`Vector tile source "${this.source}" layer "${ce}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ke=f.encode(ce),$e=[];for(let Ae=0;Ae<oe.length;Ae++){const Re=oe.feature(Ae),Be=g.getId(Re,ce);$e.push({feature:Re,id:Be,index:Ae,sourceLayerIndex:ke})}for(const Ae of M[ce]){const Re=Ae[0];this.isSymbolTile!==void 0&&Re.type==="symbol"!==this.isSymbolTile||Re.minzoom&&this.zoom<Math.floor(Re.minzoom)||Re.maxzoom&&this.zoom>=Re.maxzoom||Re.visibility!=="none"&&(tg(Ae,this.zoom,o),(x[Re.id]=Re.createBucket({index:g.bucketLayerIDs.length,layers:Ae,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ke,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:o})).populate($e,E,this.tileID.canonical,this.tileTransform),g.bucketLayerIDs.push(Ae.map(Be=>Be.id)))}}let A,P,D,O;w.trim();const N={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},J=lo(E.glyphDependencies,ce=>Object.keys(ce).map(Number));Object.keys(J).length?c.send("getGlyphs",{uid:this.uid,stacks:J},(ce,oe)=>{A||(A=ce,P=oe,te.call(this))},void 0,!1,N):P={};const re=Object.keys(E.iconDependencies);re.length?c.send("getImages",{icons:re,source:this.source,tileID:this.tileID,type:"icons"},(ce,oe)=>{A||(A=ce,D=oe,te.call(this))},void 0,!1,N):D={};const K=Object.keys(E.patternDependencies);function te(){if(A)return d(A);if(P&&D&&O){const ce=new h1(P),oe=new hv(D,O);for(const Se in x){const Te=x[Se];Te instanceof Ws?(tg(Te.layers,this.zoom,o),yS(Te,P,ce.positions,D,oe.iconPositions,this.showCollisionBoxes,o,this.tileID.canonical,this.tileZoom,this.projection)):Te.hasPattern&&(Te instanceof Jp||Te instanceof Wp||Te instanceof xh)&&(tg(Te.layers,this.zoom,o),Te.addFeatures(E,this.tileID.canonical,oe.patternPositions,o,this.tileTransform))}this.status="done",d(null,{buckets:zt(x).filter(Se=>!Se.isEmpty()),featureIndex:g,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ce.image,lineAtlas:w,imageAtlas:oe,glyphMap:this.returnDependencies?P:null,iconMap:this.returnDependencies?D:null,glyphPositions:this.returnDependencies?ce.positions:null})}}K.length?c.send("getImages",{icons:K,source:this.source,tileID:this.tileID,type:"patterns"},(ce,oe)=>{A||(A=ce,O=oe,te.call(this))},void 0,!1,N):O={},te.call(this)}}function tg(t,e,n){const o=new Q(e);for(const c of t)c.recalculate(o,n)}class d1{constructor(e){this.entries={},this.scheduler=e}request(e,n,o,c){const d=this.entries[e]=this.entries[e]||{callbacks:[]};if(d.result){const[f,g]=d.result;return this.scheduler?this.scheduler.add(()=>{c(f,g)},n):c(f,g),()=>{}}return d.callbacks.push(c),d.cancel||(d.cancel=o((f,g)=>{d.result=[f,g];for(const x of d.callbacks)this.scheduler?this.scheduler.add(()=>{x(f,g)},n):x(f,g);setTimeout(()=>delete this.entries[e],3e3)})),()=>{d.result||(d.callbacks=d.callbacks.filter(f=>f!==c),d.callbacks.length||(d.cancel(),delete this.entries[e]))}}}function p1(t,e,n){const o=JSON.stringify(t.request);return t.data&&(this.deduped.entries[o]={result:[null,t.data]}),this.deduped.request(o,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},c=>{const d=fo(t.request,(f,g,x,w)=>{f?c(f):g&&c(null,{vectorTile:n?void 0:new z_(new Th(g)),rawData:g,cacheControl:x,expires:w})});return()=>{d.cancel(),c()}},e)}a.ARRAY_TYPE=$r,a.AUTH_ERR_MSG=Es,a.Aabb=Ar,a.Actor=class{constructor(t,e,n){this.target=t,this.parent=e,this.mapId=n,this.callbacks={},this.cancelCallbacks={},dr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=ri()?t:B,this.scheduler=new ZS}send(t,e,n,o,c=!1,d){const f=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=d,this.callbacks[f]=n);const g=gs(this.globalScope)?void 0:[];return this.target.postMessage({id:f,type:t,hasCallback:!!n,targetMapId:o,mustQueue:c,sourceMapId:this.mapId,data:Za(e,g)},g),{cancel:()=>{n&&delete this.callbacks[f],this.target.postMessage({id:f,type:"<cancel>",targetMapId:o,sourceMapId:this.mapId})}}}receive(t){const e=t.data,n=e.id;if(n&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const o=this.cancelCallbacks[n];delete this.cancelCallbacks[n],o&&o.cancel()}else if(e.mustQueue||ri()){const o=this.callbacks[n];this.cancelCallbacks[n]=this.scheduler.add(()=>this.processTask(n,e),o&&o.metadata||{type:"message"})}else this.processTask(n,e)}processTask(t,e){if(e.type==="<response>"){const n=this.callbacks[t];delete this.callbacks[t],n&&(e.error?n(wo(e.error)):n(null,wo(e.data)))}else{const n=gs(this.globalScope)?void 0:[],o=e.hasCallback?(d,f)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:d?Za(d):null,data:Za(f,n)},n)}:d=>{},c=wo(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,c,o);else if(this.parent.getWorkerSource){const d=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,d[0],c.source)[d[1]](c,o)}else o(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},a.CanonicalTileID=Kp,a.Color=An,a.ColorMode=Po,a.CullFaceMode=Qi,a.DEMData=_f,a.DataConstantProperty=ve,a.DedupedRequest=d1,a.DepthMode=kc,a.EXTENT=Et,a.Elevation=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const n=e.getSource().maxzoom,o=1<<n,c=Math.floor(t.x),d=Math.floor((t.x-c)*o),f=Math.floor(t.y*o),g=this.findDEMTileFor(new Ir(n,c,n,d,f));return!(!g||!g.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,n=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const o=this._source();if(!o||t.y<0||t.y>1)return e;const c=o.getSource().maxzoom,d=1<<c,f=Math.floor(t.x),g=t.x-f,x=new Ir(c,f,c,Math.floor(g*d),Math.floor(t.y*d)),w=this.findDEMTileFor(x);if(!w||!w.dem)return e;const E=w.dem,M=1<<w.tileID.canonical.z,A=(g*M-w.tileID.canonical.x)*E.dim,P=(t.y*M-w.tileID.canonical.y)*E.dim,D=Math.floor(A),O=Math.floor(P);return(n?this.exaggeration():1)*Gt(Gt(E.get(D,O),E.get(D,O+1),P-O),Gt(E.get(D+1,O),E.get(D+1,O+1),P-O),A-D)}getAtTileOffset(t,e,n){const o=1<<t.canonical.z;return this.getAtPointOrZero(new pc(t.wrap+(t.canonical.x+e/Et)/o,(t.canonical.y+n/Et)/o))}getAtTileOffsetFunc(t,e,n,o){return c=>{const d=this.getAtTileOffset(t,c.x,c.y),f=o.upVector(t.canonical,c.x,c.y);return ui(f,f,d*o.upVectorScale(t.canonical,e,n).metersToTile),f}}getForTilePoints(t,e,n,o){if(this.isUsingMockSource())return!1;const c=gf.create(this,t,o);return!!c&&(e.forEach(d=>{d[2]=this.exaggeration()*c.getElevationAt(d[0],d[1],n)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const n=e.dem.tree,o=e.tileID,c=1<<t.canonical.z-o.canonical.z;let d=t.canonical.x/c-o.canonical.x,f=t.canonical.y/c-o.canonical.y,g=0;for(let x=0;x<t.canonical.z-o.canonical.z&&!n.leaves[g];x++){d*=2,f*=2;const w=2*Math.floor(f)+Math.floor(d);g=n.childOffsets[g]+w,d%=1,f%=1}return{min:this.exaggeration()*n.minimums[g],max:this.exaggeration()*n.maximums[g]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},a.ErrorEvent=_o,a.EvaluationParameters=Q,a.Event=tn,a.Evented=Ni,a.FillExtrusionBucket=xh,a.Frustum=w_,a.FrustumCorners=v_,a.GLOBE_METERS_TO_ECEF=V_,a.GLOBE_RADIUS=ns,a.GLOBE_SCALE_MATCH_LATITUDE=45,a.GLOBE_ZOOM_THRESHOLD_MAX=6,a.GLOBE_ZOOM_THRESHOLD_MIN=5,a.GlobeSharedBuffers=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const t of this._wireframeSegments)t.destroy()}}_createGrid(t){const e=new Dt,n=new _r,o=65;for(let c=0;c<o;c++)for(let d=0;d<o;d++)e.emplaceBack(d,c);this._gridSegments=[];for(let c=0,d=0;c<Mc.length;c++){const f=Mc[c];for(let x=0;x<f;x++)for(let w=0;w<64;w++){const E=x*o+w;n.emplaceBack(E+1,E,E+o),n.emplaceBack(E+o,E+o+1,E+1)}const g=64*f*2;this._gridSegments.push(Un.simpleSegment(0,d,(f+1)*o,g)),d+=g}this._gridBuffer=t.createVertexBuffer(e,Ch.members),this._gridIndexBuffer=t.createIndexBuffer(n,!0)}_createPoles(t){const e=new _r;for(let c=0;c<=Cc;c++)e.emplaceBack(0,c+1,c+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const n=new Ai,o=new Ai;this._poleSegments=[];for(let c=0,d=0;c<5;c++){const f=360/(1<<c);n.emplaceBack(0,-ns,0,.5,0),o.emplaceBack(0,-ns,0,.5,1);for(let g=0;g<=Cc;g++){const x=g/Cc,w=Gt(0,f,x),[E,M,A]=Ac(SS,CS,w,ns);n.emplaceBack(E,M,A,x,0),o.emplaceBack(E,M,A,x,1)}this._poleSegments.push(Un.simpleSegment(d,0,66,64)),d+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(n,kv,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(o,kv,!1)}getGridBuffers(t){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[t]]}getPoleBuffers(t){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}getWirefameBuffers(t,e){if(!this._wireframeSegments){const n=new li,o=Cc,c=o+1;this._wireframeSegments=[];for(let d=0,f=0;d<Mc.length;d++){const g=Mc[d];for(let w=0;w<g;w++)for(let E=0;E<o;E++){const M=w*c+E;n.emplaceBack(M,M+1),n.emplaceBack(M,M+c),n.emplaceBack(M,M+c+1)}const x=g*o*3;this._wireframeSegments.push(Un.simpleSegment(0,f,(g+1)*c,x)),f+=x}this._wireframeIndexBuffer=t.createIndexBuffer(n)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},a.GlyphManager=Ec,a.ImagePosition=L_,a.LivePerformanceUtils=Oe,a.LngLat=Ht,a.LngLatBounds=$s,a.LocalGlyphMode=F_,a.MAX_MERCATOR_LATITUDE=Co,a.MercatorCoordinate=pc,a.ONE_EM=lr,a.OverscaledTileID=Ir,a.PerformanceMarkers=we,a.Properties=We,a.RGBAImage=Zr,a.Ray=x_,a.RequestManager=class{constructor(t,e,n){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let n=0;n<10;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",de,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!ii(t))return t;const n=Tr(t);return n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!ii(t))return t;const n=Tr(t);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(t,e,n,o){if(!ii(t))return t;const c=Tr(t);return c.path=`/v4/${c.authority}.json`,c.params.push("secure"),n&&c.params.push(`language=${n}`),o&&c.params.push(`worldview=${o}`),this._makeAPIURL(c,this._customAccessToken||e)}normalizeSpriteURL(t,e,n,o){const c=Tr(t);return ii(t)?(c.path=`/styles/v1${c.path}/sprite${e}${n}`,this._makeAPIURL(c,this._customAccessToken||o)):(c.path+=`${e}${n}`,Uo(c))}normalizeTileURL(t,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!ii(t))return t;const o=Tr(t);o.path=o.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&o.authority!=="raster"&&n===512?"@2x":""}${ye.supported?".webp":"$1"}`),o.authority==="raster"?o.path=`/${le.RASTER_URL_PREFIX}${o.path}`:(o.path=o.path.replace(/^.+\/v4\//,"/"),o.path=`/${le.TILE_URL_VERSION}${o.path}`);const c=this._customAccessToken||function(d){for(const f of d){const g=f.match(/^access_token=(.*)$/);if(g)return g[1]}return null}(o.params)||le.ACCESS_TOKEN;return le.REQUIRE_ACCESS_TOKEN&&c&&this._skuToken&&o.params.push(`sku=${this._skuToken}`),this._makeAPIURL(o,c)}canonicalizeTileURL(t,e){const n=Tr(t);if(!n.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!n.path.match(/\.[\w]+$/))return t;let o="mapbox://";n.path.match(/^\/raster\/v1\//)?o+=`raster/${n.path.replace(`/${le.RASTER_URL_PREFIX}/`,"")}`:o+=`tiles/${n.path.replace(`/${le.TILE_URL_VERSION}/`,"")}`;let c=n.params;return e&&(c=c.filter(d=>!d.match(/^access_token=/))),c.length&&(o+=`?${c.join("&")}`),o}canonicalizeTileset(t,e){const n=!!e&&ii(e),o=[];for(const c of t.tiles||[])Ss(c)?o.push(this.canonicalizeTileURL(c,n)):o.push(c);return o}_makeAPIURL(t,e){const n="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",o=Tr(le.API_URL);if(t.protocol=o.protocol,t.authority=o.authority,t.protocol==="http"){const c=t.params.indexOf("secure");c>=0&&t.params.splice(c,1)}if(o.path!=="/"&&(t.path=`${o.path}${t.path}`),!le.REQUIRE_ACCESS_TOKEN)return Uo(t);if(e=e||le.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return t.params=t.params.filter(c=>c.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),Uo(t)}},a.ResourceType=Br,a.SegmentVector=Un,a.SourceCache=il,a.StencilMode=J_,a.StructArrayLayout1ui2=ih,a.StructArrayLayout2f1f2i16=Cr,a.StructArrayLayout2i4=Dt,a.StructArrayLayout2ui4=li,a.StructArrayLayout3f12=ai,a.StructArrayLayout3ui6=_r,a.StructArrayLayout4i8=rn,a.StructArrayLayout5f20=Ai,a.Texture=Lh,a.Tile=Y_,a.Transitionable=Ce,a.Uniform1f=Rp,a.Uniform1i=class extends Ho{constructor(t){super(t),this.current=0}set(t,e,n){this.fetchUniformLocation(t,e)&&this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},a.Uniform2f=class extends Ho{constructor(t){super(t),this.current=[0,0]}set(t,e,n){this.fetchUniformLocation(t,e)&&(n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1])))}},a.Uniform3f=class extends Ho{constructor(t){super(t),this.current=[0,0,0]}set(t,e,n){this.fetchUniformLocation(t,e)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2])))}},a.Uniform4f=nx,a.UniformColor=rx,a.UniformMatrix2f=class extends Ho{constructor(t){super(t),this.current=zT}set(t,e,n){if(this.fetchUniformLocation(t,e)){for(let o=0;o<4;o++)if(n[o]!==this.current[o]){this.current=n,this.gl.uniformMatrix2fv(this.location,!1,n);break}}}},a.UniformMatrix3f=class extends Ho{constructor(t){super(t),this.current=IT}set(t,e,n){if(this.fetchUniformLocation(t,e)){for(let o=0;o<9;o++)if(n[o]!==this.current[o]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}},a.UniformMatrix4f=class extends Ho{constructor(t){super(t),this.current=AT}set(t,e,n){if(this.fetchUniformLocation(t,e)){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let o=1;o<16;o++)if(n[o]!==this.current[o]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}}},a.UnwrappedTileID=Jx,a.ValidationError=nt,a.VectorTileFeature=Hp,a.VectorTileWorkerSource=class extends Ni{constructor(t,e,n,o,c){super(),this.actor=t,this.layerIndex=e,this.availableImages=n,this.loadVectorData=c||p1,this.loading={},this.loaded={},this.deduped=new d1(t.scheduler),this.isSpriteLoaded=o,this.scheduler=t.scheduler}loadTile(t,e){const n=t.uid,o=t&&t.request,c=o&&o.collectResourceTiming,d=this.loading[n]=new YS(t);d.abort=this.loadVectorData(t,(f,g)=>{const x=!this.loading[n];if(delete this.loading[n],x||f||!g)return d.status="done",x||(this.loaded[n]=d),e(f);const w=g.rawData,E={};g.expires&&(E.expires=g.expires),g.cacheControl&&(E.cacheControl=g.cacheControl),d.vectorTile=g.vectorTile||new z_(new Th(w));const M=()=>{d.parse(d.vectorTile,this.layerIndex,this.availableImages,this.actor,(A,P)=>{if(A||!P)return e(A);const D={};if(c){const O=gt(o);O.length>0&&(D.resourceTiming=JSON.parse(JSON.stringify(O)))}e(null,_t({rawTileData:w.slice(0)},P,E,D))})};this.isSpriteLoaded?M():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(M,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):M()}),this.loaded=this.loaded||{},this.loaded[n]=d})}reloadTile(t,e){const n=this.loaded,o=t.uid,c=this;if(n&&n[o]){const d=n[o];d.showCollisionBoxes=t.showCollisionBoxes,d.enableTerrain=!!t.enableTerrain,d.projection=t.projection,d.tileTransform=rl(t.tileID.canonical,t.projection);const f=(g,x)=>{const w=d.reloadCallback;w&&(delete d.reloadCallback,d.parse(d.vectorTile,c.layerIndex,this.availableImages,c.actor,w)),e(g,x)};d.status==="parsing"?d.reloadCallback=f:d.status==="done"&&(d.vectorTile?d.parse(d.vectorTile,this.layerIndex,this.availableImages,this.actor,f):f())}}abortTile(t,e){const n=t.uid,o=this.loading[n];o&&(o.abort&&o.abort(),delete this.loading[n]),e()}removeTile(t,e){const n=this.loaded,o=t.uid;n&&n[o]&&delete n[o],e()}},a.WritingMode=hi,a.ZoomHistory=vp,a.add=Jo,a.addDynamicAttributes=pf,a.adjoint=function(t,e){var n=e[0],o=e[1],c=e[2],d=e[3],f=e[4],g=e[5],x=e[6],w=e[7],E=e[8];return t[0]=f*E-g*w,t[1]=c*w-o*E,t[2]=o*g-c*f,t[3]=g*x-d*E,t[4]=n*E-c*x,t[5]=c*d-n*g,t[6]=d*w-f*x,t[7]=o*x-n*w,t[8]=n*f-o*d,t},a.asyncAll=st,a.bezier=Qr,a.bindAll=dr,a.boundsAttributes=Yv,a.bufferConvexPolygon=function(t,e){const n=[];for(let o=0;o<t.length;o++){const c=ei(o-1,-1,t.length-1),d=ei(o+1,-1,t.length-1),f=t[o],g=t[d],x=t[c].sub(f).unit(),w=g.sub(f).unit(),E=w.angleWithSep(x.x,x.y),M=x.add(w).unit().mult(-1*e/Math.sin(E/2));n.push(f.add(M))}return n},a.cacheEntryPossiblyAdded=function(t){vs++,vs>Ta&&(t.getActor().send("enforceCacheSizeLimit",ys),vs=0)},a.calculateGlobeLabelMatrix=function(t,e){const{x:n,y:o}=t.point,c=Ov(n,o,t.worldSize/t._pixelsPerMercatorPixel,0,0);return mc(c,c,Z_(Io(e)))},a.calculateGlobeMatrix=function(t){const{x:e,y:n}=t.point,{lng:o,lat:c}=t._center;return Ov(e,n,t.worldSize,o,c)},a.calculateGlobeMercatorMatrix=function(t){const e=t.pixelsPerMeter,n=e/Ii(1,t.center.lat),o=Mo(new Float64Array(16));return sh(o,o,[t.point.x,t.point.y,0]),Qa(o,o,[n,n,e]),Float32Array.from(o)},a.circumferenceAtLatitude=a_,a.clamp=Ot,a.clearTileCache=function(t){if(!xs())return;const e=B.caches.delete(El);t&&e.catch(t).then(()=>t())},a.clipLine=Tv,a.clone=function(t){var e=new $r(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},a.clone$1=Rr,a.collisionCircleLayout=$E,a.config=le,a.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},a.create=function(){var t=new $r(16);return $r!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},a.create$1=gx,a.createExpression=qo,a.createLayout=Xe,a.createStyleLayer=function(t){return t.type==="custom"?new jS(t):new GS[t.type](t)},a.cross=y_,a.degToRad=mt,a.distance=function(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])},a.div=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t},a.dot=zi,a.earthRadius=Op,a.ease=ao,a.easeCubicInOut=yi,a.ecefToLatLng=function([t,e,n]){const o=Math.hypot(t,e,n),c=Math.atan2(t,n),d=.5*Math.PI-Math.acos(-e/o);return new Ht(Ct(c),Ct(d))},a.emitValidationErrors=Ju,a.endsWith=Xn,a.enforceCacheSizeLimit=function(t){ho(),pr&&pr.then(e=>{e.keys().then(n=>{for(let o=0;o<n.length-t;o++)e.delete(n[o])})})},a.evaluateSizeForFeature=Qp,a.evaluateSizeForZoom=vc,a.evaluateVariableOffset=Av,a.evented=H,a.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},a.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},a.exported=qt,a.exported$1=ye,a.extend=_t,a.extend$1=ji,a.fillExtrusionHeightLift=Hx,a.filterObject=va,a.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},a.fromQuat=function(t,e){var n=e[0],o=e[1],c=e[2],d=e[3],f=n+n,g=o+o,x=c+c,w=n*f,E=o*f,M=o*g,A=c*f,P=c*g,D=c*x,O=d*f,N=d*g,J=d*x;return t[0]=1-M-D,t[1]=E+J,t[2]=A-N,t[3]=0,t[4]=E-J,t[5]=1-w-D,t[6]=P+O,t[7]=0,t[8]=A+N,t[9]=P-O,t[10]=1-w-M,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},a.fromRotation=function(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=n,t[2]=0,t[3]=-n,t[4]=o,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},a.fromScaling=xx,a.furthestTileCorner=function(t){const e=Math.round((t+45+360)%360/90)%4;return hr[e]},a.getAABBPointSquareDist=function(t,e,n){let o=0;for(let c=0;c<2;++c){const d=n?n[c]:0;t[c]>d&&(o+=(t[c]-d)*(t[c]-d)),e[c]<d&&(o+=(d-e[c])*(d-e[c]))}return o},a.getAnchorAlignment=O_,a.getAnchorJustification=N_,a.getBounds=function(t){let e=1/0,n=1/0,o=-1/0,c=-1/0;for(const d of t)e=Math.min(e,d.x),n=Math.min(n,d.y),o=Math.max(o,d.x),c=Math.max(c,d.y);return{min:new Me(e,n),max:new Me(o,c)}},a.getColumn=co,a.getGridMatrix=function(t,e,n,o){const c=e.getNorth(),d=e.getSouth(),f=e.getWest(),g=e.getEast(),x=1<<t.z,w=g-f,E=c-d,M=w/Cc,A=-E/Mc[n],P=[0,M,0,A,0,0,c,f,0];if(t.z>0){const D=180/o;yx(P,P,[D/w+1,0,0,0,D/E+1,0,-.5*D/M,.5*D/A,1])}return P[2]=x,P[5]=t.x,P[8]=t.y,P},a.getImage=Ts,a.getJSON=function(t,e){return po(_t(t,{type:"json"}),e)},a.getLatitudinalLod=function(t){const e=80.051129;t=Ot(t,-80.051129,e)/e*90;const n=Math.pow(Math.abs(Math.sin(mt(t))),3);return Math.round(n*(Mc.length-1))},a.getMapSessionAPI=_e,a.getPerformanceMeasurement=gt,a.getProjection=Zv,a.getRTLTextPluginStatus=Z,a.getReferrer=ws,a.getTilePoint=function(t,{x:e,y:n},o=0){return new Me(((e-o)*t.scale-t.x)*Et,(n*t.scale-t.y)*Et)},a.getTileVec3=function(t,e,n=0){return _c(((e.x-n)*t.scale-t.x)*Et,(e.y*t.scale-t.y)*Et,sx(e.z,e.y))},a.getVideo=function(t,e){const n=B.document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let o=0;o<t.length;o++){const c=B.document.createElement("source");Ca(t[o])||(n.crossOrigin="Anonymous"),c.src=t[o],n.appendChild(c)}return{cancel:()=>{}}},a.globeCenterToScreenPoint=function(t){const e=[0,0,0],n=Mo(new Float64Array(16));return mc(n,t.pixelMatrix,t.globeMatrix),Nn(e,e,n),new Me(e[0],e[1])},a.globeDenormalizeECEF=Z_,a.globeECEFOrigin=function(t,e){const n=[0,0,0];return Nn(n,n,Ih(Io(e.canonical))),Nn(n,n,t),n},a.globeNormalizeECEF=Ih,a.globePixelsToTileUnits=function(t,e){return Et/(512*Math.pow(2,t))*lf(Io(e))},a.globePoleMatrixForTile=function(t,e,n){const o=Mo(new Float64Array(16)),c=(e/(1<<t)-.5)*Math.PI*2;return Vp(o,n.globeMatrix,c),Float32Array.from(o)},a.globeTileBounds=Io,a.globeTiltAtLngLat=Fv,a.globeToMercatorTransition=Ic,a.globeUseCustomAntiAliasing=function(t,e,n){const o=Ic(n.zoom),c=t.style.map._antialias,d=!!e.extStandardDerivatives,f=e.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return o===0&&!c&&!f&&d},a.identity=Mo,a.identity$1=Mx,a.invert=f_,a.isFullscreen=function(){return!!B.document.fullscreenElement||!!B.document.webkitFullscreenElement},a.isLngLatBehindGlobe=function(t,e){return Fv(t,e)>Math.PI/2*1.01},a.isMapAuthenticated=function(t){return ue.has(t)},a.isMapboxURL=ii,a.isSafariWithAntialiasingBug=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!gs(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},a.latFromMercatorY=ar,a.latLngToECEF=Mh,a.len=WT,a.length=ah,a.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},a.lngFromMercatorX=ci,a.loadVectorTile=p1,a.makeRequest=po,a.mapValue=function(t,e,n,o,c){return Ot((t-e)/(n-e)*(c-o)+o,o,c)},a.mercatorScale=ax,a.mercatorXfromLng=Eo,a.mercatorYfromLat=So,a.mercatorZfromAltitude=Ii,a.mul=ZT,a.mul$1=qT,a.multiply=mc,a.multiply$1=yx,a.multiply$2=bx,a.nextPowerOfTwo=qn,a.normalize=Mr,a.normalize$1=XT,a.normalize$2=Sx,a.number=Gt,a.ortho=function(t,e,n,o,c,d,f){var g=1/(e-n),x=1/(o-c),w=1/(d-f);return t[0]=-2*g,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*x,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*w,t[11]=0,t[12]=(e+n)*g,t[13]=(c+o)*x,t[14]=(f+d)*w,t[15]=1,t},a.pbf=Th,a.perspective=function(t,e,n,o,c){var d,f=1/Math.tan(e/2);return t[0]=f/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=f,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,c!=null&&c!==1/0?(t[10]=(c+o)*(d=1/(o-c)),t[14]=2*c*o*d):(t[10]=-1,t[14]=-2*o),t},a.pick=function(t,e){const n={};for(let o=0;o<e.length;o++){const c=e[o];c in t&&(n[c]=t[c])}return n},a.plugin=ie,a.pointGeometry=Me,a.polygonContainsPoint=Ja,a.polygonIntersectsBox=fx,a.polygonIntersectsPolygon=ux,a.polygonizeBounds=function(t,e,n=0,o=!0){const c=new Me(n,n),d=t.sub(c),f=e.add(c),g=[d,new Me(f.x,d.y),f,new Me(d.x,f.y)];return o&&g.push(d.clone()),g},a.posAttributes=Ch,a.postMapLoadEvent=X,a.postPerformanceEvent=ae,a.postTurnstileEvent=L,a.potpack=D_,a.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},a.radToDeg=Ct,a.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.registerForPluginStateChange=function(t){return t({pluginStatus:V,pluginURL:W}),H.on("pluginStateChange",t),t},a.removeAuthState=function(t){ue.delete(t)},a.renderColorRamp=T_,a.resample=lx,a.rotateX=m_,a.rotateX$1=Ax,a.rotateY=Vp,a.rotateY$1=Ix,a.rotateZ=function(t,e,n){var o=Math.sin(n),c=Math.cos(n),d=e[0],f=e[1],g=e[2],x=e[3],w=e[4],E=e[5],M=e[6],A=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=d*c+w*o,t[1]=f*c+E*o,t[2]=g*c+M*o,t[3]=x*c+A*o,t[4]=w*c-d*o,t[5]=E*c-f*o,t[6]=M*c-g*o,t[7]=A*c-x*o,t},a.rotateZ$1=function(t,e,n){n*=.5;var o=e[0],c=e[1],d=e[2],f=e[3],g=Math.sin(n),x=Math.cos(n);return t[0]=o*x+c*g,t[1]=c*x-o*g,t[2]=d*x+f*g,t[3]=f*x-d*g,t},a.scale=Qa,a.scale$1=Ex,a.scale$2=ui,a.scaleAndAdd=uh,a.set=function(t,e,n,o){return t[0]=e,t[1]=n,t[2]=o,t},a.setCacheLimits=function(t,e){ys=t,Ta=e},a.setColumn=function(t,e,n){t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]},a.setRTLTextPlugin=function(t,e,n=!1){if(V===k||V===R||V===U)throw new Error("setRTLTextPlugin cannot be called multiple times.");W=qt.resolveURL(t),V=k,q=e,j(),n||ne()},a.smoothstep=Fi,a.spec=ze,a.squaredLength=function(t){var e=t[0],n=t[1],o=t[2];return e*e+n*n+o*o},a.storeAuthState=function(t,e){e?ue.add(t):ue.delete(t)},a.sub=Yi,a.subtract=g_,a.symbolSize=ZE,a.tileAABB=function(t,e,n,o,c,d,f,g,x){if(x.name==="globe")return ES(t,e,new Kp(n,o,c));const w=rl({z:n,x:o,y:c},x);return new Ar([(d+w.x/w.scale)*e,e*(w.y/w.scale),f],[(d+w.x2/w.scale)*e,e*(w.y2/w.scale),g])},a.tileCornersToBounds=af,a.tileTransform=rl,a.transformMat3=function(t,e,n){var o=e[0],c=e[1],d=e[2];return t[0]=o*n[0]+c*n[3]+d*n[6],t[1]=o*n[1]+c*n[4]+d*n[7],t[2]=o*n[2]+c*n[5]+d*n[8],t},a.transformMat4=Nn,a.transformMat4$1=el,a.transformQuat=Tx,a.transitionTileAABBinECEF=Lv,a.translate=sh,a.transpose=function(t,e){if(t===e){var n=e[1],o=e[2],c=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=o,t[7]=c}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},a.triggerPluginCompletionEvent=$,a.uniqueId=bn,a.updateGlobeVertexNormal=function(t,e,n,o,c){const d=5*e+2;t.float32[d+0]=n,t.float32[d+1]=o,t.float32[d+2]=c},a.validateCustomStyleLayer=function(t){const e=[],n=t.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},a.validateFilter=t=>Wi(Ga(t)),a.validateFog=t=>Wi(_p(t)),a.validateLayer=t=>Wi(Xu(t)),a.validateLight=t=>Wi($a(t)),a.validateSource=t=>Wi(ic(t)),a.validateStyle=gp,a.validateTerrain=t=>Wi(Hu(t)),a.values=zt,a.vectorTile=Xp,a.version=G,a.warnOnce=Tn,a.window=B,a.wrap=ei}),T(["./shared"],function(a){function B(Y){if(typeof Y=="number"||typeof Y=="boolean"||typeof Y=="string"||Y==null)return JSON.stringify(Y);if(Array.isArray(Y)){let F="[";for(const X of Y)F+=`${B(X)},`;return`${F}]`}let L="{";for(const F of Object.keys(Y).sort())L+=`${F}:${B(Y[F])},`;return`${L}}`}function G(Y){let L="";for(const F of a.refProperties)L+=`/${B(Y[F])}`;return L}class he{constructor(L){this.keyCache={},L&&this.replace(L)}replace(L){this._layerConfigs={},this._layers={},this.update(L,[])}update(L,F){for(const ee of L)this._layerConfigs[ee.id]=ee,(this._layers[ee.id]=a.createStyleLayer(ee)).compileFilter(),this.keyCache[ee.id]&&delete this.keyCache[ee.id];for(const ee of F)delete this.keyCache[ee],delete this._layerConfigs[ee],delete this._layers[ee];this.familiesBySource={};const X=function(ee,ae){const ge={};for(let ue=0;ue<ee.length;ue++){const we=ae&&ae[ee[ue].id]||G(ee[ue]);ae&&(ae[ee[ue].id]=we);let Oe=ge[we];Oe||(Oe=ge[we]=[]),Oe.push(ee[ue])}const _e=[];for(const ue in ge)_e.push(ge[ue]);return _e}(a.values(this._layerConfigs),this.keyCache);for(const ee of X){const ae=ee.map(tt=>this._layers[tt.id]),ge=ae[0];if(ge.visibility==="none")continue;const _e=ge.source||"";let ue=this.familiesBySource[_e];ue||(ue=this.familiesBySource[_e]={});const we=ge.sourceLayer||"_geojsonTileLayer";let Oe=ue[we];Oe||(Oe=ue[we]=[]),Oe.push(ae)}}}class le{loadTile(L,F){const{uid:X,encoding:ee,rawImageData:ae,padding:ge,buildQuadTree:_e}=L,ue=a.window.ImageBitmap&&ae instanceof a.window.ImageBitmap?this.getImageData(ae,ge):ae;F(null,new a.DEMData(X,ue,ee,ge<1,_e))}getImageData(L,F){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(L.width,L.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=L.width,this.offscreenCanvas.height=L.height,this.offscreenCanvasContext.drawImage(L,0,0,L.width,L.height);const X=this.offscreenCanvasContext.getImageData(-F,-F,L.width+2*F,L.height+2*F);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),X}}var ye=function Y(L,F){var X,ee=L&&L.type;if(ee==="FeatureCollection")for(X=0;X<L.features.length;X++)Y(L.features[X],F);else if(ee==="GeometryCollection")for(X=0;X<L.geometries.length;X++)Y(L.geometries[X],F);else if(ee==="Feature")Y(L.geometry,F);else if(ee==="Polygon")Fe(L.coordinates,F);else if(ee==="MultiPolygon")for(X=0;X<L.coordinates.length;X++)Fe(L.coordinates[X],F);return L};function Fe(Y,L){if(Y.length!==0){Ie(Y[0],L);for(var F=1;F<Y.length;F++)Ie(Y[F],!L)}}function Ie(Y,L){for(var F=0,X=0,ee=0,ae=Y.length,ge=ae-1;ee<ae;ge=ee++){var _e=(Y[ee][0]-Y[ge][0])*(Y[ge][1]+Y[ee][1]),ue=F+_e;X+=Math.abs(F)>=Math.abs(_e)?F-ue+_e:_e-ue+F,F=ue}F+X>=0!=!!L&&Y.reverse()}const Ue=a.VectorTileFeature.prototype.toGeoJSON;class Ft{constructor(L){this._feature=L,this.extent=a.EXTENT,this.type=L.type,this.properties=L.tags,"id"in L&&!isNaN(L.id)&&(this.id=parseInt(L.id,10))}loadGeometry(){if(this._feature.type===1){const L=[];for(const F of this._feature.geometry)L.push([new a.pointGeometry(F[0],F[1])]);return L}{const L=[];for(const F of this._feature.geometry){const X=[];for(const ee of F)X.push(new a.pointGeometry(ee[0],ee[1]));L.push(X)}return L}}toGeoJSON(L,F,X){return Ue.call(this,L,F,X)}}class me{constructor(L){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.EXTENT,this.length=L.length,this._features=L}feature(L){return new Ft(this._features[L])}}var de={exports:{}},be=a.pointGeometry,He=a.vectorTile.VectorTileFeature,Me=ct;function ct(Y,L){this.options=L||{},this.features=Y,this.length=Y.length}function dt(Y,L){this.id=typeof Y.id=="number"?Y.id:void 0,this.type=Y.type,this.rawGeometry=Y.type===1?[Y.geometry]:Y.geometry,this.properties=Y.tags,this.extent=L||4096}ct.prototype.feature=function(Y){return new dt(this.features[Y],this.options.extent)},dt.prototype.loadGeometry=function(){var Y=this.rawGeometry;this.geometry=[];for(var L=0;L<Y.length;L++){for(var F=Y[L],X=[],ee=0;ee<F.length;ee++)X.push(new be(F[ee][0],F[ee][1]));this.geometry.push(X)}return this.geometry},dt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Y=this.geometry,L=1/0,F=-1/0,X=1/0,ee=-1/0,ae=0;ae<Y.length;ae++)for(var ge=Y[ae],_e=0;_e<ge.length;_e++){var ue=ge[_e];L=Math.min(L,ue.x),F=Math.max(F,ue.x),X=Math.min(X,ue.y),ee=Math.max(ee,ue.y)}return[L,X,F,ee]},dt.prototype.toGeoJSON=He.prototype.toGeoJSON;var vt=a.pbf,mt=Me;function Ct(Y){var L=new vt;return function(F,X){for(var ee in F.layers)X.writeMessage(3,hr,F.layers[ee])}(Y,L),L.finish()}function hr(Y,L){var F;L.writeVarintField(15,Y.version||1),L.writeStringField(1,Y.name||""),L.writeVarintField(5,Y.extent||4096);var X={keys:[],values:[],keycache:{},valuecache:{}};for(F=0;F<Y.length;F++)X.feature=Y.feature(F),L.writeMessage(2,yi,X);var ee=X.keys;for(F=0;F<ee.length;F++)L.writeStringField(3,ee[F]);var ae=X.values;for(F=0;F<ae.length;F++)L.writeMessage(4,ei,ae[F])}function yi(Y,L){var F=Y.feature;F.id!==void 0&&L.writeVarintField(1,F.id),L.writeMessage(2,Qr,Y),L.writeVarintField(3,F.type),L.writeMessage(4,Fi,F)}function Qr(Y,L){var F=Y.feature,X=Y.keys,ee=Y.values,ae=Y.keycache,ge=Y.valuecache;for(var _e in F.properties){var ue=F.properties[_e],we=ae[_e];if(ue!==null){we===void 0&&(X.push(_e),ae[_e]=we=X.length-1),L.writeVarint(we);var Oe=typeof ue;Oe!=="string"&&Oe!=="boolean"&&Oe!=="number"&&(ue=JSON.stringify(ue));var tt=Oe+":"+ue,Ve=ge[tt];Ve===void 0&&(ee.push(ue),ge[tt]=Ve=ee.length-1),L.writeVarint(Ve)}}}function ao(Y,L){return(L<<3)+(7&Y)}function Ot(Y){return Y<<1^Y>>31}function Fi(Y,L){for(var F=Y.loadGeometry(),X=Y.type,ee=0,ae=0,ge=F.length,_e=0;_e<ge;_e++){var ue=F[_e],we=1;X===1&&(we=ue.length),L.writeVarint(ao(1,we));for(var Oe=X===3?ue.length-1:ue.length,tt=0;tt<Oe;tt++){tt===1&&X!==1&&L.writeVarint(ao(2,Oe-1));var Ve=ue[tt].x-ee,gt=ue[tt].y-ae;L.writeVarint(Ot(Ve)),L.writeVarint(Ot(gt)),ee+=Ve,ae+=gt}X===3&&L.writeVarint(ao(7,1))}}function ei(Y,L){var F=typeof Y;F==="string"?L.writeStringField(1,Y):F==="boolean"?L.writeBooleanField(7,Y):F==="number"&&(Y%1!=0?L.writeDoubleField(3,Y):Y<0?L.writeSVarintField(6,Y):L.writeVarintField(5,Y))}function st(Y,L,F,X,ee,ae){if(ee-X<=F)return;const ge=X+ee>>1;zt(Y,L,ge,X,ee,ae%2),st(Y,L,F,X,ge-1,ae+1),st(Y,L,F,ge+1,ee,ae+1)}function zt(Y,L,F,X,ee,ae){for(;ee>X;){if(ee-X>600){const we=ee-X+1,Oe=F-X+1,tt=Math.log(we),Ve=.5*Math.exp(2*tt/3),gt=.5*Math.sqrt(tt*Ve*(we-Ve)/we)*(Oe-we/2<0?-1:1);zt(Y,L,F,Math.max(X,Math.floor(F-Oe*Ve/we+gt)),Math.min(ee,Math.floor(F+(we-Oe)*Ve/we+gt)),ae)}const ge=L[2*F+ae];let _e=X,ue=ee;for(_t(Y,L,X,F),L[2*ee+ae]>ge&&_t(Y,L,X,ee);_e<ue;){for(_t(Y,L,_e,ue),_e++,ue--;L[2*_e+ae]<ge;)_e++;for(;L[2*ue+ae]>ge;)ue--}L[2*X+ae]===ge?_t(Y,L,X,ue):(ue++,_t(Y,L,ue,ee)),ue<=F&&(X=ue+1),F<=ue&&(ee=ue-1)}}function _t(Y,L,F,X){dn(Y,F,X),dn(L,2*F,2*X),dn(L,2*F+1,2*X+1)}function dn(Y,L,F){const X=Y[L];Y[L]=Y[F],Y[F]=X}function bn(Y,L,F,X){const ee=Y-F,ae=L-X;return ee*ee+ae*ae}de.exports=Ct,de.exports.fromVectorTileJs=Ct,de.exports.fromGeojsonVt=function(Y,L){L=L||{};var F={};for(var X in Y)F[X]=new mt(Y[X].features,L),F[X].name=X,F[X].version=L.version,F[X].extent=L.extent;return Ct({layers:F})},de.exports.GeoJSONWrapper=mt;const br=Y=>Y[0],qn=Y=>Y[1];class ti{constructor(L,F=br,X=qn,ee=64,ae=Float64Array){this.nodeSize=ee,this.points=L;const ge=L.length<65536?Uint16Array:Uint32Array,_e=this.ids=new ge(L.length),ue=this.coords=new ae(2*L.length);for(let we=0;we<L.length;we++)_e[we]=we,ue[2*we]=F(L[we]),ue[2*we+1]=X(L[we]);st(_e,ue,ee,0,_e.length-1,0)}range(L,F,X,ee){return function(ae,ge,_e,ue,we,Oe,tt){const Ve=[0,ae.length-1,0],gt=[];let pt,ht;for(;Ve.length;){const Tt=Ve.pop(),Rt=Ve.pop(),qt=Ve.pop();if(Rt-qt<=tt){for(let tn=qt;tn<=Rt;tn++)pt=ge[2*tn],ht=ge[2*tn+1],pt>=_e&&pt<=we&&ht>=ue&&ht<=Oe&&gt.push(ae[tn]);continue}const xt=Math.floor((qt+Rt)/2);pt=ge[2*xt],ht=ge[2*xt+1],pt>=_e&&pt<=we&&ht>=ue&&ht<=Oe&&gt.push(ae[xt]);const en=(Tt+1)%2;(Tt===0?_e<=pt:ue<=ht)&&(Ve.push(qt),Ve.push(xt-1),Ve.push(en)),(Tt===0?we>=pt:Oe>=ht)&&(Ve.push(xt+1),Ve.push(Rt),Ve.push(en))}return gt}(this.ids,this.coords,L,F,X,ee,this.nodeSize)}within(L,F,X){return function(ee,ae,ge,_e,ue,we){const Oe=[0,ee.length-1,0],tt=[],Ve=ue*ue;for(;Oe.length;){const gt=Oe.pop(),pt=Oe.pop(),ht=Oe.pop();if(pt-ht<=we){for(let en=ht;en<=pt;en++)bn(ae[2*en],ae[2*en+1],ge,_e)<=Ve&&tt.push(ee[en]);continue}const Tt=Math.floor((ht+pt)/2),Rt=ae[2*Tt],qt=ae[2*Tt+1];bn(Rt,qt,ge,_e)<=Ve&&tt.push(ee[Tt]);const xt=(gt+1)%2;(gt===0?ge-ue<=Rt:_e-ue<=qt)&&(Oe.push(ht),Oe.push(Tt-1),Oe.push(xt)),(gt===0?ge+ue>=Rt:_e+ue>=qt)&&(Oe.push(Tt+1),Oe.push(pt),Oe.push(xt))}return tt}(this.ids,this.coords,L,F,X,this.nodeSize)}}const dr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Y=>Y},Xn=Math.fround||(lo=new Float32Array(1),Y=>(lo[0]=+Y,lo[0]));var lo;class va{constructor(L){this.options=Ui(Object.create(dr),L),this.trees=new Array(this.options.maxZoom+1)}load(L){const{log:F,minZoom:X,maxZoom:ee,nodeSize:ae}=this.options;F&&console.time("total time");const ge=`prepare ${L.length} points`;F&&console.time(ge),this.points=L;let _e=[];for(let ue=0;ue<L.length;ue++)L[ue].geometry&&_e.push(Tl(L[ue],ue));this.trees[ee+1]=new ti(_e,gs,ba,ae,Float32Array),F&&console.timeEnd(ge);for(let ue=ee;ue>=X;ue--){const we=+Date.now();_e=this._cluster(_e,ue),this.trees[ue]=new ti(_e,gs,ba,ae,Float32Array),F&&console.log("z%d: %d clusters in %dms",ue,_e.length,+Date.now()-we)}return F&&console.timeEnd("total time"),this}getClusters(L,F){let X=((L[0]+180)%360+360)%360-180;const ee=Math.max(-90,Math.min(90,L[1]));let ae=L[2]===180?180:((L[2]+180)%360+360)%360-180;const ge=Math.max(-90,Math.min(90,L[3]));if(L[2]-L[0]>=360)X=-180,ae=180;else if(X>ae){const Oe=this.getClusters([X,ee,180,ge],F),tt=this.getClusters([-180,ee,ae,ge],F);return Oe.concat(tt)}const _e=this.trees[this._limitZoom(F)],ue=_e.range(Vt(X),ri(ge),Vt(ae),ri(ee)),we=[];for(const Oe of ue){const tt=_e.points[Oe];we.push(tt.numPoints?Tn(tt):this.points[tt.index])}return we}getChildren(L){const F=this._getOriginId(L),X=this._getOriginZoom(L),ee="No cluster with the specified id.",ae=this.trees[X];if(!ae)throw new Error(ee);const ge=ae.points[F];if(!ge)throw new Error(ee);const _e=this.options.radius/(this.options.extent*Math.pow(2,X-1)),ue=ae.within(ge.x,ge.y,_e),we=[];for(const Oe of ue){const tt=ae.points[Oe];tt.parentId===L&&we.push(tt.numPoints?Tn(tt):this.points[tt.index])}if(we.length===0)throw new Error(ee);return we}getLeaves(L,F,X){const ee=[];return this._appendLeaves(ee,L,F=F||10,X=X||0,0),ee}getTile(L,F,X){const ee=this.trees[this._limitZoom(L)],ae=Math.pow(2,L),{extent:ge,radius:_e}=this.options,ue=_e/ge,we=(X-ue)/ae,Oe=(X+1+ue)/ae,tt={features:[]};return this._addTileFeatures(ee.range((F-ue)/ae,we,(F+1+ue)/ae,Oe),ee.points,F,X,ae,tt),F===0&&this._addTileFeatures(ee.range(1-ue/ae,we,1,Oe),ee.points,ae,X,ae,tt),F===ae-1&&this._addTileFeatures(ee.range(0,we,ue/ae,Oe),ee.points,-1,X,ae,tt),tt.features.length?tt:null}getClusterExpansionZoom(L){let F=this._getOriginZoom(L)-1;for(;F<=this.options.maxZoom;){const X=this.getChildren(L);if(F++,X.length!==1)break;L=X[0].properties.cluster_id}return F}_appendLeaves(L,F,X,ee,ae){const ge=this.getChildren(F);for(const _e of ge){const ue=_e.properties;if(ue&&ue.cluster?ae+ue.point_count<=ee?ae+=ue.point_count:ae=this._appendLeaves(L,ue.cluster_id,X,ee,ae):ae<ee?ae++:L.push(_e),L.length===X)break}return ae}_addTileFeatures(L,F,X,ee,ae,ge){for(const _e of L){const ue=F[_e],we=ue.numPoints;let Oe,tt,Ve;if(we)Oe=ni(ue),tt=ue.x,Ve=ue.y;else{const ht=this.points[ue.index];Oe=ht.properties,tt=Vt(ht.geometry.coordinates[0]),Ve=ri(ht.geometry.coordinates[1])}const gt={type:1,geometry:[[Math.round(this.options.extent*(tt*ae-X)),Math.round(this.options.extent*(Ve*ae-ee))]],tags:Oe};let pt;we?pt=ue.id:this.options.generateId?pt=ue.index:this.points[ue.index].id&&(pt=this.points[ue.index].id),pt!==void 0&&(gt.id=pt),ge.features.push(gt)}}_limitZoom(L){return Math.max(this.options.minZoom,Math.min(Math.floor(+L),this.options.maxZoom+1))}_cluster(L,F){const X=[],{radius:ee,extent:ae,reduce:ge,minPoints:_e}=this.options,ue=ee/(ae*Math.pow(2,F));for(let we=0;we<L.length;we++){const Oe=L[we];if(Oe.zoom<=F)continue;Oe.zoom=F;const tt=this.trees[F+1],Ve=tt.within(Oe.x,Oe.y,ue),gt=Oe.numPoints||1;let pt=gt;for(const ht of Ve){const Tt=tt.points[ht];Tt.zoom>F&&(pt+=Tt.numPoints||1)}if(pt>gt&&pt>=_e){let ht=Oe.x*gt,Tt=Oe.y*gt,Rt=ge&&gt>1?this._map(Oe,!0):null;const qt=(we<<5)+(F+1)+this.points.length;for(const xt of Ve){const en=tt.points[xt];if(en.zoom<=F)continue;en.zoom=F;const tn=en.numPoints||1;ht+=en.x*tn,Tt+=en.y*tn,en.parentId=qt,ge&&(Rt||(Rt=this._map(Oe,!0)),ge(Rt,this._map(en)))}Oe.parentId=qt,X.push(Rr(ht/pt,Tt/pt,qt,pt,Rt))}else if(X.push(Oe),pt>1)for(const ht of Ve){const Tt=tt.points[ht];Tt.zoom<=F||(Tt.zoom=F,X.push(Tt))}}return X}_getOriginId(L){return L-this.points.length>>5}_getOriginZoom(L){return(L-this.points.length)%32}_map(L,F){if(L.numPoints)return F?Ui({},L.properties):L.properties;const X=this.points[L.index].properties,ee=this.options.map(X);return F&&ee===X?Ui({},ee):ee}}function Rr(Y,L,F,X,ee){return{x:Xn(Y),y:Xn(L),zoom:1/0,id:F,parentId:-1,numPoints:X,properties:ee}}function Tl(Y,L){const[F,X]=Y.geometry.coordinates;return{x:Xn(Vt(F)),y:Xn(ri(X)),zoom:1/0,index:L,parentId:-1}}function Tn(Y){return{type:"Feature",id:Y.id,properties:ni(Y),geometry:{type:"Point",coordinates:[(L=Y.x,360*(L-.5)),wa(Y.y)]}};var L}function ni(Y){const L=Y.numPoints,F=L>=1e4?`${Math.round(L/1e3)}k`:L>=1e3?Math.round(L/100)/10+"k":L;return Ui(Ui({},Y.properties),{cluster:!0,cluster_id:Y.id,point_count:L,point_count_abbreviated:F})}function Vt(Y){return Y/360+.5}function ri(Y){const L=Math.sin(Y*Math.PI/180),F=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return F<0?0:F>1?1:F}function wa(Y){const L=(180-360*Y)*Math.PI/180;return 360*Math.atan(Math.exp(L))/Math.PI-90}function Ui(Y,L){for(const F in L)Y[F]=L[F];return Y}function gs(Y){return Y.x}function ba(Y){return Y.y}function co(Y,L,F,X){for(var ee,ae=X,ge=F-L>>1,_e=F-L,ue=Y[L],we=Y[L+1],Oe=Y[F],tt=Y[F+1],Ve=L+3;Ve<F;Ve+=3){var gt=El(Y[Ve],Y[Ve+1],ue,we,Oe,tt);if(gt>ae)ee=Ve,ae=gt;else if(gt===ae){var pt=Math.abs(Ve-ge);pt<_e&&(ee=Ve,_e=pt)}}ae>X&&(ee-L>3&&co(Y,L,ee,X),Y[ee+2]=ae,F-ee>3&&co(Y,ee,F,X))}function El(Y,L,F,X,ee,ae){var ge=ee-F,_e=ae-X;if(ge!==0||_e!==0){var ue=((Y-F)*ge+(L-X)*_e)/(ge*ge+_e*_e);ue>1?(F=ee,X=ae):ue>0&&(F+=ge*ue,X+=_e*ue)}return(ge=Y-F)*ge+(_e=L-X)*_e}function pr(Y,L,F,X){var ee={id:Y===void 0?null:Y,type:L,geometry:F,tags:X,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ae){var ge=ae.geometry,_e=ae.type;if(_e==="Point"||_e==="MultiPoint"||_e==="LineString")uo(ae,ge);else if(_e==="Polygon"||_e==="MultiLineString")for(var ue=0;ue<ge.length;ue++)uo(ae,ge[ue]);else if(_e==="MultiPolygon")for(ue=0;ue<ge.length;ue++)for(var we=0;we<ge[ue].length;we++)uo(ae,ge[ue][we])}(ee),ee}function uo(Y,L){for(var F=0;F<L.length;F+=3)Y.minX=Math.min(Y.minX,L[F]),Y.minY=Math.min(Y.minY,L[F+1]),Y.maxX=Math.max(Y.maxX,L[F]),Y.maxY=Math.max(Y.maxY,L[F+1])}function ys(Y,L,F,X){if(L.geometry){var ee=L.geometry.coordinates,ae=L.geometry.type,ge=Math.pow(F.tolerance/((1<<F.maxZoom)*F.extent),2),_e=[],ue=L.id;if(F.promoteId?ue=L.properties[F.promoteId]:F.generateId&&(ue=X||0),ae==="Point")Ta(ee,_e);else if(ae==="MultiPoint")for(var we=0;we<ee.length;we++)Ta(ee[we],_e);else if(ae==="LineString")xs(ee,_e,ge,!1);else if(ae==="MultiLineString"){if(F.lineMetrics){for(we=0;we<ee.length;we++)xs(ee[we],_e=[],ge,!1),Y.push(pr(ue,"LineString",_e,L.properties));return}ho(ee,_e,ge,!1)}else if(ae==="Polygon")ho(ee,_e,ge,!0);else{if(ae!=="MultiPolygon"){if(ae==="GeometryCollection"){for(we=0;we<L.geometry.geometries.length;we++)ys(Y,{id:ue,geometry:L.geometry.geometries[we],properties:L.properties},F,X);return}throw new Error("Input data is not a valid GeoJSON object.")}for(we=0;we<ee.length;we++){var Oe=[];ho(ee[we],Oe,ge,!0),_e.push(Oe)}}Y.push(pr(ue,ae,_e,L.properties))}}function Ta(Y,L){L.push(Ea(Y[0])),L.push(vs(Y[1])),L.push(0)}function xs(Y,L,F,X){for(var ee,ae,ge=0,_e=0;_e<Y.length;_e++){var ue=Ea(Y[_e][0]),we=vs(Y[_e][1]);L.push(ue),L.push(we),L.push(0),_e>0&&(ge+=X?(ee*we-ue*ae)/2:Math.sqrt(Math.pow(ue-ee,2)+Math.pow(we-ae,2))),ee=ue,ae=we}var Oe=L.length-3;L[2]=1,co(L,0,Oe,F),L[Oe+2]=1,L.size=Math.abs(ge),L.start=0,L.end=L.size}function ho(Y,L,F,X){for(var ee=0;ee<Y.length;ee++){var ae=[];xs(Y[ee],ae,F,X),L.push(ae)}}function Ea(Y){return Y/360+.5}function vs(Y){var L=Math.sin(Y*Math.PI/180),F=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return F<0?0:F>1?1:F}function Br(Y,L,F,X,ee,ae,ge,_e){if(X/=L,ae>=(F/=L)&&ge<X)return Y;if(ge<F||ae>=X)return null;for(var ue=[],we=0;we<Y.length;we++){var Oe=Y[we],tt=Oe.geometry,Ve=Oe.type,gt=ee===0?Oe.minX:Oe.minY,pt=ee===0?Oe.maxX:Oe.maxY;if(gt>=F&&pt<X)ue.push(Oe);else if(!(pt<F||gt>=X)){var ht=[];if(Ve==="Point"||Ve==="MultiPoint")Sa(tt,ht,F,X,ee);else if(Ve==="LineString")ws(tt,ht,F,X,ee,!1,_e.lineMetrics);else if(Ve==="MultiLineString")fo(tt,ht,F,X,ee,!1);else if(Ve==="Polygon")fo(tt,ht,F,X,ee,!0);else if(Ve==="MultiPolygon")for(var Tt=0;Tt<tt.length;Tt++){var Rt=[];fo(tt[Tt],Rt,F,X,ee,!0),Rt.length&&ht.push(Rt)}if(ht.length){if(_e.lineMetrics&&Ve==="LineString"){for(Tt=0;Tt<ht.length;Tt++)ue.push(pr(Oe.id,Ve,ht[Tt],Oe.tags));continue}Ve!=="LineString"&&Ve!=="MultiLineString"||(ht.length===1?(Ve="LineString",ht=ht[0]):Ve="MultiLineString"),Ve!=="Point"&&Ve!=="MultiPoint"||(Ve=ht.length===3?"Point":"MultiPoint"),ue.push(pr(Oe.id,Ve,ht,Oe.tags))}}}return ue.length?ue:null}function Sa(Y,L,F,X,ee){for(var ae=0;ae<Y.length;ae+=3){var ge=Y[ae+ee];ge>=F&&ge<=X&&(L.push(Y[ae]),L.push(Y[ae+1]),L.push(Y[ae+2]))}}function ws(Y,L,F,X,ee,ae,ge){for(var _e,ue,we=po(Y),Oe=ee===0?Sl:bs,tt=Y.start,Ve=0;Ve<Y.length-3;Ve+=3){var gt=Y[Ve],pt=Y[Ve+1],ht=Y[Ve+2],Tt=Y[Ve+3],Rt=Y[Ve+4],qt=ee===0?gt:pt,xt=ee===0?Tt:Rt,en=!1;ge&&(_e=Math.sqrt(Math.pow(gt-Tt,2)+Math.pow(pt-Rt,2))),qt<F?xt>F&&(ue=Oe(we,gt,pt,Tt,Rt,F),ge&&(we.start=tt+_e*ue)):qt>X?xt<X&&(ue=Oe(we,gt,pt,Tt,Rt,X),ge&&(we.start=tt+_e*ue)):Ca(we,gt,pt,ht),xt<F&&qt>=F&&(ue=Oe(we,gt,pt,Tt,Rt,F),en=!0),xt>X&&qt<=X&&(ue=Oe(we,gt,pt,Tt,Rt,X),en=!0),!ae&&en&&(ge&&(we.end=tt+_e*ue),L.push(we),we=po(Y)),ge&&(tt+=_e)}var tn=Y.length-3;gt=Y[tn],pt=Y[tn+1],ht=Y[tn+2],(qt=ee===0?gt:pt)>=F&&qt<=X&&Ca(we,gt,pt,ht),tn=we.length-3,ae&&tn>=3&&(we[tn]!==we[0]||we[tn+1]!==we[1])&&Ca(we,we[0],we[1],we[2]),we.length&&L.push(we)}function po(Y){var L=[];return L.size=Y.size,L.start=Y.start,L.end=Y.end,L}function fo(Y,L,F,X,ee,ae){for(var ge=0;ge<Y.length;ge++)ws(Y[ge],L,F,X,ee,ae,!1)}function Ca(Y,L,F,X){Y.push(L),Y.push(F),Y.push(X)}function Sl(Y,L,F,X,ee,ae){var ge=(ae-L)/(X-L);return Y.push(ae),Y.push(F+(ee-F)*ge),Y.push(1),ge}function bs(Y,L,F,X,ee,ae){var ge=(ae-F)/(ee-F);return Y.push(L+(X-L)*ge),Y.push(ae),Y.push(1),ge}function mo(Y,L){for(var F=[],X=0;X<Y.length;X++){var ee,ae=Y[X],ge=ae.type;if(ge==="Point"||ge==="MultiPoint"||ge==="LineString")ee=Ts(ae.geometry,L);else if(ge==="MultiLineString"||ge==="Polygon"){ee=[];for(var _e=0;_e<ae.geometry.length;_e++)ee.push(Ts(ae.geometry[_e],L))}else if(ge==="MultiPolygon")for(ee=[],_e=0;_e<ae.geometry.length;_e++){for(var ue=[],we=0;we<ae.geometry[_e].length;we++)ue.push(Ts(ae.geometry[_e][we],L));ee.push(ue)}F.push(pr(ae.id,ge,ee,ae.tags))}return F}function Ts(Y,L){var F=[];F.size=Y.size,Y.start!==void 0&&(F.start=Y.start,F.end=Y.end);for(var X=0;X<Y.length;X+=3)F.push(Y[X]+L,Y[X+1],Y[X+2]);return F}function Es(Y,L){if(Y.transformed)return Y;var F,X,ee,ae=1<<Y.z,ge=Y.x,_e=Y.y;for(F=0;F<Y.features.length;F++){var ue=Y.features[F],we=ue.geometry,Oe=ue.type;if(ue.geometry=[],Oe===1)for(X=0;X<we.length;X+=2)ue.geometry.push(ii(we[X],we[X+1],L,ae,ge,_e));else for(X=0;X<we.length;X++){var tt=[];for(ee=0;ee<we[X].length;ee+=2)tt.push(ii(we[X][ee],we[X][ee+1],L,ae,ge,_e));ue.geometry.push(tt)}}return Y.transformed=!0,Y}function ii(Y,L,F,X,ee,ae){return[Math.round(F*(Y*X-ee)),Math.round(F*(L*X-ae))]}function Ss(Y,L,F,X,ee){for(var ae=L===ee.maxZoom?0:ee.tolerance/((1<<L)*ee.extent),ge={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:F,y:X,z:L,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},_e=0;_e<Y.length;_e++){ge.numFeatures++,Cl(ge,Y[_e],ae,ee);var ue=Y[_e].minX,we=Y[_e].minY,Oe=Y[_e].maxX,tt=Y[_e].maxY;ue<ge.minX&&(ge.minX=ue),we<ge.minY&&(ge.minY=we),Oe>ge.maxX&&(ge.maxX=Oe),tt>ge.maxY&&(ge.maxY=tt)}return ge}function Cl(Y,L,F,X){var ee=L.geometry,ae=L.type,ge=[];if(ae==="Point"||ae==="MultiPoint")for(var _e=0;_e<ee.length;_e+=3)ge.push(ee[_e]),ge.push(ee[_e+1]),Y.numPoints++,Y.numSimplified++;else if(ae==="LineString")Cs(ge,ee,Y,F,!1,!1);else if(ae==="MultiLineString"||ae==="Polygon")for(_e=0;_e<ee.length;_e++)Cs(ge,ee[_e],Y,F,ae==="Polygon",_e===0);else if(ae==="MultiPolygon")for(var ue=0;ue<ee.length;ue++){var we=ee[ue];for(_e=0;_e<we.length;_e++)Cs(ge,we[_e],Y,F,!0,_e===0)}if(ge.length){var Oe=L.tags||null;if(ae==="LineString"&&X.lineMetrics){for(var tt in Oe={},L.tags)Oe[tt]=L.tags[tt];Oe.mapbox_clip_start=ee.start/ee.size,Oe.mapbox_clip_end=ee.end/ee.size}var Ve={geometry:ge,type:ae==="Polygon"||ae==="MultiPolygon"?3:ae==="LineString"||ae==="MultiLineString"?2:1,tags:Oe};L.id!==null&&(Ve.id=L.id),Y.features.push(Ve)}}function Cs(Y,L,F,X,ee,ae){var ge=X*X;if(X>0&&L.size<(ee?ge:X))F.numPoints+=L.length/3;else{for(var _e=[],ue=0;ue<L.length;ue+=3)(X===0||L[ue+2]>ge)&&(F.numSimplified++,_e.push(L[ue]),_e.push(L[ue+1])),F.numPoints++;ee&&function(we,Oe){for(var tt=0,Ve=0,gt=we.length,pt=gt-2;Ve<gt;pt=Ve,Ve+=2)tt+=(we[Ve]-we[pt])*(we[Ve+1]+we[pt+1]);if(tt>0===Oe)for(Ve=0,gt=we.length;Ve<gt/2;Ve+=2){var ht=we[Ve],Tt=we[Ve+1];we[Ve]=we[gt-2-Ve],we[Ve+1]=we[gt-1-Ve],we[gt-2-Ve]=ht,we[gt-1-Ve]=Tt}}(_e,ae),Y.push(_e)}}function Ms(Y,L){var F=(L=this.options=function(ee,ae){for(var ge in ae)ee[ge]=ae[ge];return ee}(Object.create(this.options),L)).debug;if(F&&console.time("preprocess data"),L.maxZoom<0||L.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(L.promoteId&&L.generateId)throw new Error("promoteId and generateId cannot be used together.");var X=function(ee,ae){var ge=[];if(ee.type==="FeatureCollection")for(var _e=0;_e<ee.features.length;_e++)ys(ge,ee.features[_e],ae,_e);else ys(ge,ee.type==="Feature"?ee:{geometry:ee},ae);return ge}(Y,L);this.tiles={},this.tileCoords=[],F&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",L.indexMaxZoom,L.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),X=function(ee,ae){var ge=ae.buffer/ae.extent,_e=ee,ue=Br(ee,1,-1-ge,ge,0,-1,2,ae),we=Br(ee,1,1-ge,2+ge,0,-1,2,ae);return(ue||we)&&(_e=Br(ee,1,-ge,1+ge,0,-1,2,ae)||[],ue&&(_e=mo(ue,1).concat(_e)),we&&(_e=_e.concat(mo(we,-1)))),_e}(X,L),X.length&&this.splitTile(X,0,0,0),F&&(X.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Tr(Y,L,F){return 32*((1<<Y)*F+L)+Y}function Uo(Y,L){const F=Y.tileID.canonical;if(!this._geoJSONIndex)return L(null,null);const X=this._geoJSONIndex.getTile(F.z,F.x,F.y);if(!X)return L(null,null);const ee=new me(X.features);let ae=de.exports(ee);ae.byteOffset===0&&ae.byteLength===ae.buffer.byteLength||(ae=new Uint8Array(ae)),L(null,{vectorTile:ee,rawData:ae.buffer})}Ms.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ms.prototype.splitTile=function(Y,L,F,X,ee,ae,ge){for(var _e=[Y,L,F,X],ue=this.options,we=ue.debug;_e.length;){X=_e.pop(),F=_e.pop(),L=_e.pop(),Y=_e.pop();var Oe=1<<L,tt=Tr(L,F,X),Ve=this.tiles[tt];if(!Ve&&(we>1&&console.time("creation"),Ve=this.tiles[tt]=Ss(Y,L,F,X,ue),this.tileCoords.push({z:L,x:F,y:X}),we)){we>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",L,F,X,Ve.numFeatures,Ve.numPoints,Ve.numSimplified),console.timeEnd("creation"));var gt="z"+L;this.stats[gt]=(this.stats[gt]||0)+1,this.total++}if(Ve.source=Y,ee){if(L===ue.maxZoom||L===ee)continue;var pt=1<<ee-L;if(F!==Math.floor(ae/pt)||X!==Math.floor(ge/pt))continue}else if(L===ue.indexMaxZoom||Ve.numPoints<=ue.indexMaxPoints)continue;if(Ve.source=null,Y.length!==0){we>1&&console.time("clipping");var ht,Tt,Rt,qt,xt,en,tn=.5*ue.buffer/ue.extent,_o=.5-tn,Ni=.5+tn,ze=1+tn;ht=Tt=Rt=qt=null,xt=Br(Y,Oe,F-tn,F+Ni,0,Ve.minX,Ve.maxX,ue),en=Br(Y,Oe,F+_o,F+ze,0,Ve.minX,Ve.maxX,ue),Y=null,xt&&(ht=Br(xt,Oe,X-tn,X+Ni,1,Ve.minY,Ve.maxY,ue),Tt=Br(xt,Oe,X+_o,X+ze,1,Ve.minY,Ve.maxY,ue),xt=null),en&&(Rt=Br(en,Oe,X-tn,X+Ni,1,Ve.minY,Ve.maxY,ue),qt=Br(en,Oe,X+_o,X+ze,1,Ve.minY,Ve.maxY,ue),en=null),we>1&&console.timeEnd("clipping"),_e.push(ht||[],L+1,2*F,2*X),_e.push(Tt||[],L+1,2*F,2*X+1),_e.push(Rt||[],L+1,2*F+1,2*X),_e.push(qt||[],L+1,2*F+1,2*X+1)}}},Ms.prototype.getTile=function(Y,L,F){var X=this.options,ee=X.extent,ae=X.debug;if(Y<0||Y>24)return null;var ge=1<<Y,_e=Tr(Y,L=(L%ge+ge)%ge,F);if(this.tiles[_e])return Es(this.tiles[_e],ee);ae>1&&console.log("drilling down to z%d-%d-%d",Y,L,F);for(var ue,we=Y,Oe=L,tt=F;!ue&&we>0;)we--,Oe=Math.floor(Oe/2),tt=Math.floor(tt/2),ue=this.tiles[Tr(we,Oe,tt)];return ue&&ue.source?(ae>1&&console.log("found parent tile z%d-%d-%d",we,Oe,tt),ae>1&&console.time("drilling down"),this.splitTile(ue.source,we,Oe,tt,Y,L,F),ae>1&&console.timeEnd("drilling down"),this.tiles[_e]?Es(this.tiles[_e],ee):null):null};class Ma extends a.VectorTileWorkerSource{constructor(L,F,X,ee,ae){super(L,F,X,ee,Uo),ae&&(this.loadGeoJSON=ae)}loadData(L,F){const X=L&&L.request,ee=X&&X.collectResourceTiming;this.loadGeoJSON(L,(ae,ge)=>{if(ae||!ge)return F(ae);if(typeof ge!="object")return F(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`));{ye(ge,!0);try{if(L.filter){const ue=a.createExpression(L.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ue.result==="error")throw new Error(ue.value.map(Oe=>`${Oe.key}: ${Oe.message}`).join(", "));ge={type:"FeatureCollection",features:ge.features.filter(Oe=>ue.value.evaluate({zoom:0},Oe))}}this._geoJSONIndex=L.cluster?new va(function({superclusterOptions:ue,clusterProperties:we}){if(!we||!ue)return ue;const Oe={},tt={},Ve={accumulated:null,zoom:0},gt={properties:null},pt=Object.keys(we);for(const ht of pt){const[Tt,Rt]=we[ht],qt=a.createExpression(Rt),xt=a.createExpression(typeof Tt=="string"?[Tt,["accumulated"],["get",ht]]:Tt);Oe[ht]=qt.value,tt[ht]=xt.value}return ue.map=ht=>{gt.properties=ht;const Tt={};for(const Rt of pt)Tt[Rt]=Oe[Rt].evaluate(Ve,gt);return Tt},ue.reduce=(ht,Tt)=>{gt.properties=Tt;for(const Rt of pt)Ve.accumulated=ht[Rt],ht[Rt]=tt[Rt].evaluate(Ve,gt)},ue}(L)).load(ge.features):function(ue,we){return new Ms(ue,we)}(ge,L.geojsonVtOptions)}catch(ue){return F(ue)}this.loaded={};const _e={};if(ee){const ue=a.getPerformanceMeasurement(X);ue&&(_e.resourceTiming={},_e.resourceTiming[L.source]=JSON.parse(JSON.stringify(ue)))}F(null,_e)}})}reloadTile(L,F){const X=this.loaded;return X&&X[L.uid]?super.reloadTile(L,F):this.loadTile(L,F)}loadGeoJSON(L,F){if(L.request)a.getJSON(L.request,F);else{if(typeof L.data!="string")return F(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`));try{return F(null,JSON.parse(L.data))}catch{return F(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(L,F){try{F(null,this._geoJSONIndex.getClusterExpansionZoom(L.clusterId))}catch(X){F(X)}}getClusterChildren(L,F){try{F(null,this._geoJSONIndex.getChildren(L.clusterId))}catch(X){F(X)}}getClusterLeaves(L,F){try{F(null,this._geoJSONIndex.getLeaves(L.clusterId,L.limit,L.offset))}catch(X){F(X)}}}class No{constructor(L){this.self=L,this.actor=new a.Actor(L,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=a.getProjection({name:"mercator"}),this.workerSourceTypes={vector:a.VectorTileWorkerSource,geojson:Ma},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(F,X)=>{if(this.workerSourceTypes[F])throw new Error(`Worker source with name "${F}" already registered.`);this.workerSourceTypes[F]=X},this.self.registerRTLTextPlugin=F=>{if(a.plugin.isParsed())throw new Error("RTL text plugin already registered.");a.plugin.applyArabicShaping=F.applyArabicShaping,a.plugin.processBidirectionalText=F.processBidirectionalText,a.plugin.processStyledBidirectionalText=F.processStyledBidirectionalText}}clearCaches(L,F,X){delete this.layerIndexes[L],delete this.availableImages[L],delete this.workerSources[L],delete this.demWorkerSources[L],X()}checkIfReady(L,F,X){X()}setReferrer(L,F){this.referrer=F}spriteLoaded(L,F){this.isSpriteLoaded[L]=F;for(const X in this.workerSources[L]){const ee=this.workerSources[L][X];for(const ae in ee)ee[ae]instanceof a.VectorTileWorkerSource&&(ee[ae].isSpriteLoaded=F,ee[ae].fire(new a.Event("isSpriteLoaded")))}}setImages(L,F,X){this.availableImages[L]=F;for(const ee in this.workerSources[L]){const ae=this.workerSources[L][ee];for(const ge in ae)ae[ge].availableImages=F}X()}enableTerrain(L,F,X){this.terrain=F,X()}setProjection(L,F){this.projections[L]=a.getProjection(F)}setLayers(L,F,X){this.getLayerIndex(L).replace(F),X()}updateLayers(L,F,X){this.getLayerIndex(L).update(F.layers,F.removedIds),X()}loadTile(L,F,X){const ee=this.enableTerrain?a.extend({enableTerrain:this.terrain},F):F;ee.projection=this.projections[L]||this.defaultProjection,this.getWorkerSource(L,F.type,F.source).loadTile(ee,X)}loadDEMTile(L,F,X){const ee=this.enableTerrain?a.extend({buildQuadTree:this.terrain},F):F;this.getDEMWorkerSource(L,F.source).loadTile(ee,X)}reloadTile(L,F,X){const ee=this.enableTerrain?a.extend({enableTerrain:this.terrain},F):F;ee.projection=this.projections[L]||this.defaultProjection,this.getWorkerSource(L,F.type,F.source).reloadTile(ee,X)}abortTile(L,F,X){this.getWorkerSource(L,F.type,F.source).abortTile(F,X)}removeTile(L,F,X){this.getWorkerSource(L,F.type,F.source).removeTile(F,X)}removeSource(L,F,X){if(!this.workerSources[L]||!this.workerSources[L][F.type]||!this.workerSources[L][F.type][F.source])return;const ee=this.workerSources[L][F.type][F.source];delete this.workerSources[L][F.type][F.source],ee.removeSource!==void 0?ee.removeSource(F,X):X()}loadWorkerSource(L,F,X){try{this.self.importScripts(F.url),X()}catch(ee){X(ee.toString())}}syncRTLPluginState(L,F,X){try{a.plugin.setState(F);const ee=a.plugin.getPluginURL();if(a.plugin.isLoaded()&&!a.plugin.isParsed()&&ee!=null){this.self.importScripts(ee);const ae=a.plugin.isParsed();X(ae?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ee}`),ae)}}catch(ee){X(ee.toString())}}getAvailableImages(L){let F=this.availableImages[L];return F||(F=[]),F}getLayerIndex(L){let F=this.layerIndexes[L];return F||(F=this.layerIndexes[L]=new he),F}getWorkerSource(L,F,X){if(this.workerSources[L]||(this.workerSources[L]={}),this.workerSources[L][F]||(this.workerSources[L][F]={}),!this.workerSources[L][F][X]){const ee={send:(ae,ge,_e,ue,we,Oe)=>{this.actor.send(ae,ge,_e,L,we,Oe)},scheduler:this.actor.scheduler};this.workerSources[L][F][X]=new this.workerSourceTypes[F](ee,this.getLayerIndex(L),this.getAvailableImages(L),this.isSpriteLoaded[L])}return this.workerSources[L][F][X]}getDEMWorkerSource(L,F){return this.demWorkerSources[L]||(this.demWorkerSources[L]={}),this.demWorkerSources[L][F]||(this.demWorkerSources[L][F]=new le),this.demWorkerSources[L][F]}enforceCacheSizeLimit(L,F){a.enforceCacheSizeLimit(F)}getWorkerPerformanceMetrics(L,F,X){X(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new No(self)),No}),T(["./shared"],function(a){function B(u,r){if(Array.isArray(u)){if(!Array.isArray(r)||u.length!==r.length)return!1;for(let l=0;l<u.length;l++)if(!B(u[l],r[l]))return!1;return!0}if(typeof u=="object"&&u!==null&&r!==null){if(typeof r!="object"||Object.keys(u).length!==Object.keys(r).length)return!1;for(const l in u)if(!B(u[l],r[l]))return!1;return!0}return u===r}var G=he;function he(u){return!function(r){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,_,y=new Blob([""],{type:"text/javascript"}),b=URL.createObjectURL(y);try{_=new Worker(b),p=!0}catch{p=!1}return _&&_.terminate(),URL.revokeObjectURL(b),p}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var p=document.createElement("canvas");p.width=p.height=1;var _=p.getContext("2d");if(!_)return!1;var y=_.getImageData(0,0,1,1);return y&&y.width===p.width}()?(le[l=r&&r.failIfMajorPerformanceCaveat]===void 0&&(le[l]=function(p){var _,y=function(b){var S=document.createElement("canvas"),C=Object.create(he.webGLContextAttributes);return C.failIfMajorPerformanceCaveat=b,S.getContext("webgl",C)||S.getContext("experimental-webgl",C)}(p);if(!y)return!1;try{_=y.createShader(y.VERTEX_SHADER)}catch{return!1}return!(!_||y.isContextLost())&&(y.shaderSource(_,"void main() {}"),y.compileShader(_),y.getShaderParameter(_,y.COMPILE_STATUS)===!0)}(l)),le[l]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var l}(u)}var le={};function ye(u,r,l){const p=a.window.document.createElement(u);return r!==void 0&&(p.className=r),l&&l.appendChild(p),p}function Fe(u,r,l){const p=a.window.document.createElementNS("http://www.w3.org/2000/svg",u);for(const _ of Object.keys(r))p.setAttributeNS(null,_,r[_]);return l&&l.appendChild(p),p}he.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Ie=a.window.document&&a.window.document.documentElement.style,Ue=Ie&&Ie.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Ft;function me(){Ie&&Ue&&(Ft=Ie[Ue],Ie[Ue]="none")}function de(){Ie&&Ue&&(Ie[Ue]=Ft)}function be(u){u.preventDefault(),u.stopPropagation(),a.window.removeEventListener("click",be,!0)}function He(){a.window.addEventListener("click",be,!0),a.window.setTimeout(()=>{a.window.removeEventListener("click",be,!0)},0)}function Me(u,r){const l=u.getBoundingClientRect();return vt(u,l,r)}function ct(u,r){const l=u.getBoundingClientRect(),p=[];for(let _=0;_<r.length;_++)p.push(vt(u,l,r[_]));return p}function dt(u){return a.window.InstallTrigger!==void 0&&u.button===2&&u.ctrlKey&&a.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:u.button}function vt(u,r,l){const p=u.offsetWidth===r.width?1:u.offsetWidth/r.width;return new a.pointGeometry((l.clientX-r.left)*p,(l.clientY-r.top)*p)}function mt(u,r){var l=r[0],p=r[1],_=r[2],y=r[3],b=l*y-_*p;return b?(u[0]=y*(b=1/b),u[1]=-p*b,u[2]=-_*b,u[3]=l*b,u):null}function Ct(u){const{userImage:r}=u;return!!(r&&r.render&&r.render())&&(u.data.replace(new Uint8Array(r.data.buffer)),!0)}class hr extends a.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:l,callback:p}of this.requestors)this._notify(l,p);this.requestors=[]}}hasImage(r){return!!this.getImage(r)}getImage(r){return this.images[r]}addImage(r,l){this._validate(r,l)&&(this.images[r]=l)}_validate(r,l){let p=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new a.ErrorEvent(new Error(`Image "${r}" has invalid "stretchX" value`))),p=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new a.ErrorEvent(new Error(`Image "${r}" has invalid "stretchY" value`))),p=!1),this._validateContent(l.content,l)||(this.fire(new a.ErrorEvent(new Error(`Image "${r}" has invalid "content" value`))),p=!1),p}_validateStretch(r,l){if(!r)return!0;let p=0;for(const _ of r){if(_[0]<p||_[1]<_[0]||l<_[1])return!1;p=_[1]}return!0}_validateContent(r,l){return!(r&&(r.length!==4||r[0]<0||l.data.width<r[0]||r[1]<0||l.data.height<r[1]||r[2]<0||l.data.width<r[2]||r[3]<0||l.data.height<r[3]||r[2]<r[0]||r[3]<r[1]))}updateImage(r,l){l.version=this.images[r].version+1,this.images[r]=l,this.updatedImages[r]=!0}removeImage(r){const l=this.images[r];delete this.images[r],delete this.patterns[r],l.userImage&&l.userImage.onRemove&&l.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r,l){let p=!0;if(!this.isLoaded())for(const _ of r)this.images[_]||(p=!1);this.isLoaded()||p?this._notify(r,l):this.requestors.push({ids:r,callback:l})}_notify(r,l){const p={};for(const _ of r){this.images[_]||this.fire(new a.Event("styleimagemissing",{id:_}));const y=this.images[_];y?p[_]={data:y.data.clone(),pixelRatio:y.pixelRatio,sdf:y.sdf,version:y.version,stretchX:y.stretchX,stretchY:y.stretchY,content:y.content,hasRenderCallback:Boolean(y.userImage&&y.userImage.render)}:a.warnOnce(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}l(null,p)}getPixelSize(){const{width:r,height:l}=this.atlasImage;return{width:r,height:l}}getPattern(r){const l=this.patterns[r],p=this.getImage(r);if(!p)return null;if(l&&l.position.version===p.version)return l.position;if(l)l.position.version=p.version;else{const _={w:p.data.width+2,h:p.data.height+2,x:0,y:0},y=new a.ImagePosition(_,p);this.patterns[r]={bin:_,position:y}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const l=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new a.Texture(r,this.atlasImage,l.RGBA),this.atlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const y in this.patterns)r.push(this.patterns[y].bin);const{w:l,h:p}=a.potpack(r),_=this.atlasImage;_.resize({width:l||1,height:p||1});for(const y in this.patterns){const{bin:b}=this.patterns[y],S=b.x+1,C=b.y+1,z=this.images[y].data,k=z.width,R=z.height;a.RGBAImage.copy(z,_,{x:0,y:0},{x:S,y:C},{width:k,height:R}),a.RGBAImage.copy(z,_,{x:0,y:R-1},{x:S,y:C-1},{width:k,height:1}),a.RGBAImage.copy(z,_,{x:0,y:0},{x:S,y:C+R},{width:k,height:1}),a.RGBAImage.copy(z,_,{x:k-1,y:0},{x:S-1,y:C},{width:1,height:R}),a.RGBAImage.copy(z,_,{x:0,y:0},{x:S+k,y:C},{width:1,height:R})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const l of r){if(this.callbackDispatchedThisFrame[l])continue;this.callbackDispatchedThisFrame[l]=!0;const p=this.images[l];Ct(p)&&this.updateImage(l,p)}}}const yi=new a.Properties({anchor:new a.DataConstantProperty(a.spec.light.anchor),position:new class{constructor(){this.specification=a.spec.light.position}possiblyEvaluate(u,r){return function([l,p,_]){const y=a.degToRad(p+90),b=a.degToRad(_);return{x:l*Math.cos(y)*Math.sin(b),y:l*Math.sin(y)*Math.sin(b),z:l*Math.cos(b),azimuthal:p,polar:_}}(u.expression.evaluate(r))}interpolate(u,r,l){return{x:a.number(u.x,r.x,l),y:a.number(u.y,r.y,l),z:a.number(u.z,r.z,l),azimuthal:a.number(u.azimuthal,r.azimuthal,l),polar:a.number(u.polar,r.polar,l)}}},color:new a.DataConstantProperty(a.spec.light.color),intensity:new a.DataConstantProperty(a.spec.light.intensity)}),Qr="-transition";class ao extends a.Evented{constructor(r){super(),this._transitionable=new a.Transitionable(yi),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,l={}){if(!this._validate(a.validateLight,r,l))for(const p in r){const _=r[p];a.endsWith(p,Qr)?this._transitionable.setTransition(p.slice(0,-Qr.length),_):this._transitionable.setValue(p,_)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,l,p){return(!p||p.validate!==!1)&&a.emitValidationErrors(this,r.call(a.validateStyle,a.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}const Ot=new a.Properties({source:new a.DataConstantProperty(a.spec.terrain.source),exaggeration:new a.DataConstantProperty(a.spec.terrain.exaggeration)}),Fi="-transition";class ei extends a.Evented{constructor(r,l){super(),this._transitionable=new a.Transitionable(Ot),this.set(r),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=l}get(){return this._transitionable.serialize()}set(r){for(const l in r){const p=r[l];a.endsWith(l,Fi)?this._transitionable.setTransition(l.slice(0,-Fi.length),p):this._transitionable.setValue(l,p)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}}function st(u,r,l,p){const _=a.smoothstep(45,65,l),[y,b]=zt(u,p),S=a.length(r);let C=1-Math.min(1,Math.exp((S-y)/(b-y)*-6));return C*=C*C,C=Math.min(1,1.00747*C),C*_*u.alpha}function zt(u,r){const l=.5/Math.tan(.5*r);return[u.range[0]+l,u.range[1]+l]}const _t=new a.Properties({range:new a.DataConstantProperty(a.spec.fog.range),color:new a.DataConstantProperty(a.spec.fog.color),"high-color":new a.DataConstantProperty(a.spec.fog["high-color"]),"space-color":new a.DataConstantProperty(a.spec.fog["space-color"]),"horizon-blend":new a.DataConstantProperty(a.spec.fog["horizon-blend"]),"star-intensity":new a.DataConstantProperty(a.spec.fog["star-intensity"])}),dn="-transition";class bn extends a.Evented{constructor(r,l){super(),this._transitionable=new a.Transitionable(_t),this.set(r),this._transitioning=this._transitionable.untransitioned(),this._transform=l}get state(){const r=this._transform,l=r.projection.name==="globe",p=a.globeToMercatorTransition(r.zoom),_=this.properties.get("range"),y=[.5,3];return{range:l?[a.number(y[0],_[0],p),a.number(y[1],_[1],p)]:_,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,l={}){if(!this._validate(a.validateFog,r,l)){for(const p of Object.keys(a.spec.fog))r&&r[p]===void 0&&(r[p]=a.spec.fog[p].default);for(const p in r){const _=r[p];a.endsWith(p,dn)?this._transitionable.setTransition(p.slice(0,-dn.length),_):this._transitionable.setValue(p,_)}}}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const l=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:a.smoothstep(45,65,r))*l.a}getOpacityAtLatLng(r,l){return this._transform.projection.supportsFog?function(p,_,y){const b=a.MercatorCoordinate.fromLngLat(_),S=y.elevation?y.elevation.getAtPointOrZero(b):0,C=[b.x,b.y,S];return a.transformMat4(C,C,y.mercatorFogMatrix),st(p,C,y.pitch,y._fov)}(this.state,r,l):0}getFovAdjustedRange(r){return this._transform.projection.supportsFog?zt(this.state,r):[0,1]}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,l,p){return(!p||p.validate!==!1)&&a.emitValidationErrors(this,r.call(a.validateStyle,a.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}class br{constructor(r,l){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=a.uniqueId();const p=this.workerPool.acquire(this.id);for(let _=0;_<p.length;_++){const y=new br.Actor(p[_],l,this.id);y.name=`Worker ${_}`,this.actors.push(y)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,l,p){a.asyncAll(this.actors,(_,y)=>{_.send(r,l,y)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}function qn(u,r,l){return r*(a.EXTENT/(u.tileSize*Math.pow(2,l-u.tileID.overscaledZ)))}br.Actor=a.Actor;class ti{constructor(r,l,p,_){this.screenBounds=r,this.cameraPoint=l,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,_)}static createFromScreenPoints(r,l){let p,_;if(r instanceof a.pointGeometry||typeof r[0]=="number"){const y=a.pointGeometry.convert(r);p=[y],_=l.isPointAboveHorizon(y)}else{const y=a.pointGeometry.convert(r[0]),b=a.pointGeometry.convert(r[1]);p=[y,b],_=a.polygonizeBounds(y,b).every(S=>l.isPointAboveHorizon(S))}return new ti(p,l.getCameraPoint(),_,l)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(r){return a.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const l=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new a.pointGeometry(1,1)):this.screenBounds[1],_=a.polygonizeBounds(l,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<p.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?_[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(_[3]=this.cameraPoint)),a.bufferConvexPolygon(_,r)}bufferedCameraGeometryGlobe(r){const l=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new a.pointGeometry(1,1)):this.screenBounds[1],_=a.polygonizeBounds(l,p,r),y=this.cameraPoint.clone();switch(3*((y.y>l.y)+(y.y>p.y))+((y.x>l.x)+(y.x>p.x))){case 0:_[0]=y,_[4]=y.clone();break;case 1:_.splice(1,0,y);break;case 2:_[1]=y;break;case 3:_.splice(4,0,y);break;case 5:_.splice(2,0,y);break;case 6:_[3]=y;break;case 7:_.splice(3,0,y);break;case 8:_[2]=y}return _}containsTile(r,l,p,_=0){const y=r.queryPadding/l._pixelsPerMercatorPixel+1,b=p?this._bufferedCameraMercator(y,l):this._bufferedScreenMercator(y,l);let S=r.tileID.wrap+(b.unwrapped?_:0);const C=b.polygon.map($=>a.getTilePoint(r.tileTransform,$,S));if(!a.polygonIntersectsBox(C,0,0,a.EXTENT,a.EXTENT))return;S=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?_:0);const z=this.screenGeometryMercator.polygon.map($=>a.getTileVec3(r.tileTransform,$,S)),k=z.map($=>new a.pointGeometry($[0],$[1])),R=l.getFreeCameraOptions().position||new a.MercatorCoordinate(0,0,0),U=a.getTileVec3(r.tileTransform,R,S),q=z.map($=>{const j=a.sub($,$,U);return a.normalize(j,j),new a.Ray(U,j)}),V=qn(r,1,l.zoom)*l._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:k,tilespaceRays:q,bufferedTilespaceGeometry:C,bufferedTilespaceBounds:(W=a.getBounds(C),W.min.x=a.clamp(W.min.x,0,a.EXTENT),W.min.y=a.clamp(W.min.y,0,a.EXTENT),W.max.x=a.clamp(W.max.x,0,a.EXTENT),W.max.y=a.clamp(W.max.y,0,a.EXTENT),W),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:V};var W}_bufferedScreenMercator(r,l){const p=lo(r);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let _;return _=l.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(r),l):{polygon:this.bufferedScreenGeometry(r).map(y=>l.pointCoordinate3D(y)),unwrapped:!0},this._screenRaycastCache[p]=_,_}}_bufferedCameraMercator(r,l){const p=lo(r);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let _;return _=l.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),l):{polygon:this.bufferedCameraGeometry(r).map(y=>l.pointCoordinate3D(y)),unwrapped:!0},this._cameraRaycastCache[p]=_,_}}_projectAndResample(r,l){const p=function(y,b){const S=a.multiply([],b.pixelMatrix,b.globeMatrix),C=[0,-a.GLOBE_RADIUS,0,1],z=[0,a.GLOBE_RADIUS,0,1],k=[0,0,0,1];a.transformMat4$1(C,C,S),a.transformMat4$1(z,z,S),a.transformMat4$1(k,k,S);const R=new a.pointGeometry(C[0]/C[3],C[1]/C[3]),U=new a.pointGeometry(z[0]/z[3],z[1]/z[3]),q=a.polygonContainsPoint(y,R)&&C[3]<k[3],V=a.polygonContainsPoint(y,U)&&z[3]<k[3];if(!q&&!V)return null;const W=function(se,xe,Ce){for(let Ee=1;Ee<se.length;Ee++){const Ge=Xn(xe.pointCoordinate3D(se[Ee-1]).x),fe=Xn(xe.pointCoordinate3D(se[Ee]).x);if(Ce<0){if(Ge<fe)return{idx:Ee,t:-Ge/(fe-1-Ge)}}else if(fe<Ge)return{idx:Ee,t:(1-Ge)/(fe+1-Ge)}}return null}(y,b,q?-1:1);if(!W)return null;const{idx:$,t:j}=W;let H=$>1?dr(y.slice(0,$),b):[],Z=$<y.length?dr(y.slice($),b):[];H=H.map(se=>new a.pointGeometry(Xn(se.x),se.y)),Z=Z.map(se=>new a.pointGeometry(Xn(se.x),se.y));const ne=[...H];ne.length===0&&ne.push(Z[Z.length-1]);const ie=a.number(ne[ne.length-1].y,(Z.length===0?H[0]:Z[0]).y,j);let Q;return Q=q?[new a.pointGeometry(0,ie),new a.pointGeometry(0,0),new a.pointGeometry(1,0),new a.pointGeometry(1,ie)]:[new a.pointGeometry(1,ie),new a.pointGeometry(1,1),new a.pointGeometry(0,1),new a.pointGeometry(0,ie)],ne.push(...Q),Z.length===0?ne.push(H[0]):ne.push(...Z),{polygon:ne.map(se=>new a.MercatorCoordinate(se.x,se.y)),unwrapped:!1}}(r,l);if(p)return p;const _=function(y,b){let S=!1,C=-1/0,z=0;for(let R=0;R<y.length-1;R++)y[R].x>C&&(C=y[R].x,z=R);for(let R=0;R<y.length-1;R++){const U=(z+R)%(y.length-1),q=y[U],V=y[U+1];Math.abs(q.x-V.x)>.5&&(q.x<V.x?(q.x+=1,U===0&&(y[y.length-1].x+=1)):(V.x+=1,U+1===y.length-1&&(y[0].x+=1)),S=!0)}const k=a.mercatorXfromLng(b.center.lng);return S&&k<Math.abs(k-1)&&y.forEach(R=>{R.x-=1}),{polygon:y,unwrapped:S}}(dr(r,l).map(y=>new a.pointGeometry(Xn(y.x),y.y)),l);return{polygon:_.polygon.map(y=>new a.MercatorCoordinate(y.x,y.y)),unwrapped:_.unwrapped}}}function dr(u,r){return a.resample(u,l=>{const p=r.pointCoordinate3D(l);l.x=p.x,l.y=p.y},1/256)}function Xn(u){return u<0?1+u%1:u%1}function lo(u){return 100*u|0}function va(u,r,l,p,_){const y=function(b,S){if(b)return _(b);if(S){u.url&&S.tiles&&u.tiles&&delete u.tiles;const C=a.pick(a.extend(S,u),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);S.vector_layers&&(C.vectorLayers=S.vector_layers,C.vectorLayerIds=C.vectorLayers.map(z=>z.id)),C.tiles=r.canonicalizeTileset(C,u.url),_(null,C)}};return u.url?a.getJSON(r.transformRequest(r.normalizeSourceURL(u.url,null,l,p),a.ResourceType.Source),y):a.exported.frame(()=>y(null,u))}class Rr{constructor(r,l,p){this.bounds=a.LngLatBounds.convert(this.validateBounds(r)),this.minzoom=l||0,this.maxzoom=p||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const l=Math.pow(2,r.z),p=Math.floor(a.mercatorXfromLng(this.bounds.getWest())*l),_=Math.floor(a.mercatorYfromLat(this.bounds.getNorth())*l),y=Math.ceil(a.mercatorXfromLng(this.bounds.getEast())*l),b=Math.ceil(a.mercatorYfromLat(this.bounds.getSouth())*l);return r.x>=p&&r.x<y&&r.y>=_&&r.y<b}}class Tl{constructor(r,l,p){this.context=r;const _=r.gl;this.buffer=_.createBuffer(),this.dynamicDraw=Boolean(p),this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||l.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const l=this.context.gl;this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Tn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ni{constructor(r,l,p,_){this.length=l.length,this.attributes=p,this.itemSize=l.bytesPerElement,this.dynamicDraw=_,this.context=r;const y=r.gl;this.buffer=y.createBuffer(),r.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||l.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,l){for(let p=0;p<this.attributes.length;p++){const _=l.attributes[this.attributes[p].name];_!==void 0&&r.enableVertexAttribArray(_)}}setVertexAttribPointers(r,l,p){for(let _=0;_<this.attributes.length;_++){const y=this.attributes[_],b=l.attributes[y.name];b!==void 0&&r.vertexAttribPointer(b,y.components,r[Tn[y.type]],!1,this.itemSize,y.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Vt{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ri extends Vt{getDefault(){return a.Color.transparent}set(r){const l=this.current;(r.r!==l.r||r.g!==l.g||r.b!==l.b||r.a!==l.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class wa extends Vt{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class Ui extends Vt{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class gs extends Vt{getDefault(){return[!0,!0,!0,!0]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class ba extends Vt{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class co extends Vt{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class El extends Vt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const l=this.current;(r.func!==l.func||r.ref!==l.ref||r.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class pr extends Vt{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class uo extends Vt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=r,this.dirty=!1}}class ys extends Vt{getDefault(){return[0,1]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class Ta extends Vt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=r,this.dirty=!1}}class xs extends Vt{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class ho extends Vt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.BLEND):l.disable(l.BLEND),this.current=r,this.dirty=!1}}class Ea extends Vt{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class vs extends Vt{getDefault(){return a.Color.transparent}set(r){const l=this.current;(r.r!==l.r||r.g!==l.g||r.b!==l.b||r.a!==l.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Br extends Vt{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class Sa extends Vt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=r,this.dirty=!1}}class ws extends Vt{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class po extends Vt{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}class fo extends Vt{getDefault(){return null}set(r){(r!==this.current||this.dirty)&&(this.gl.useProgram(r),this.current=r,this.dirty=!1)}}class Ca extends Vt{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class Sl extends Vt{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class bs extends Vt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class mo extends Vt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Ts extends Vt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class Es extends Vt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class ii extends Vt{getDefault(){return null}set(r){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Ss extends Vt{constructor(r){super(r),this.vao=r.extVertexArrayObject}getDefault(){return null}set(r){this.vao&&(r!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(r),this.current=r,this.dirty=!1)}}class Cl extends Vt{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class Cs extends Vt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class Ms extends Vt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Tr extends Vt{constructor(r,l){super(r),this.context=r,this.parent=l}getDefault(){return null}}class Uo extends Tr{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class Ma extends Tr{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class No extends Ma{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Y{constructor(r,l,p,_){this.context=r,this.width=l,this.height=p;const y=this.framebuffer=r.gl.createFramebuffer();this.colorAttachment=new Uo(r,y),_&&(this.depthAttachment=new Ma(r,y))}destroy(){const r=this.context.gl,l=this.colorAttachment.get();if(l&&r.deleteTexture(l),this.depthAttachment){const p=this.depthAttachment.get();p&&r.deleteRenderbuffer(p)}r.deleteFramebuffer(this.framebuffer)}}class L{constructor(r){this.gl=r,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ri(this),this.clearDepth=new wa(this),this.clearStencil=new Ui(this),this.colorMask=new gs(this),this.depthMask=new ba(this),this.stencilMask=new co(this),this.stencilFunc=new El(this),this.stencilOp=new pr(this),this.stencilTest=new uo(this),this.depthRange=new ys(this),this.depthTest=new Ta(this),this.depthFunc=new xs(this),this.blend=new ho(this),this.blendFunc=new Ea(this),this.blendColor=new vs(this),this.blendEquation=new Br(this),this.cullFace=new Sa(this),this.cullFaceSide=new ws(this),this.frontFace=new po(this),this.program=new fo(this),this.activeTexture=new Ca(this),this.viewport=new Sl(this),this.bindFramebuffer=new bs(this),this.bindRenderbuffer=new mo(this),this.bindTexture=new Ts(this),this.bindVertexBuffer=new Es(this),this.bindElementBuffer=new ii(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Ss(this),this.pixelStoreUnpack=new Cl(this),this.pixelStoreUnpackPremultiplyAlpha=new Cs(this),this.pixelStoreUnpackFlipY=new Ms(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=r.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=r.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=r.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.extTextureHalfFloat=r.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(r.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=r.getExtension("OES_standard_derivatives"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,l){return new Tl(this,r,l)}createVertexBuffer(r,l,p){return new ni(this,r,l,p)}createRenderbuffer(r,l,p){const _=this.gl,y=_.createRenderbuffer();return this.bindRenderbuffer.set(y),_.renderbufferStorage(_.RENDERBUFFER,r,l,p),this.bindRenderbuffer.set(null),y}createFramebuffer(r,l,p){return new Y(this,r,l,p)}clear({color:r,depth:l,stencil:p}){const _=this.gl;let y=0;r&&(y|=_.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),l!==void 0&&(y|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),p!==void 0&&(y|=_.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),_.clear(y)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){B(r.blendFunction,a.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class F extends a.Evented{constructor(r,l,p,_){super(),this.id=r,this.dispatcher=p,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.extend({type:"raster"},l),a.extend(this,a.pick(l,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=va(this._options,this.map._requestManager,null,null,(r,l)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new a.ErrorEvent(r)):l&&(a.extend(this,l),l.bounds&&(this.tileBounds=new Rr(l.bounds,this.minzoom,this.maxzoom)),a.postTurnstileEvent(l.tiles),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return a.extend({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,l){const p=a.exported.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);r.request=a.getImage(this.map._requestManager.transformRequest(_,a.ResourceType.Tile),(y,b,S,C)=>(delete r.request,r.aborted?(r.state="unloaded",l(null)):y?(r.state="errored",l(y)):b?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:S,expires:C}),r.setTexture(b,this.map.painter),r.state="loaded",a.cacheEntryPossiblyAdded(this.dispatcher),void l(null)):l(null)))}static loadTileData(r,l,p){r.setTexture(l,p)}static unloadTileData(r,l){r.texture&&l.saveTileTexture(r.texture)}abortTile(r,l){r.request&&(r.request.cancel(),delete r.request),l()}unloadTile(r,l){r.texture&&this.map.painter.saveTileTexture(r.texture),l()}hasTransition(){return!1}}let X;function ee(u,r,l,p,_,y,b,S){const C=[u,l,_,r,p,y,1,1,1],z=[b,S,1],k=a.adjoint([],C),[R,U,q]=a.transformMat3(z,z,a.transpose(k,k));return a.multiply$1(C,[R,0,0,0,U,0,0,0,q],C)}class ae extends a.Evented{constructor(r,l,p,_){super(),this.id=r,this.dispatcher=p,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_),this.options=l,this._dirty=!1}load(r,l){this._loaded=l||!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=a.getImage(this.map._requestManager.transformRequest(this.url,a.ResourceType.Image),(p,_)=>{if(this._imageRequest=null,this._loaded=!0,p)this.fire(new a.ErrorEvent(p));else if(_){const{HTMLImageElement:y}=a.window;this.image=_ instanceof y?a.exported.getImageData(_):_,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,r&&(this.coordinates=r),this._finishLoading()}})}loaded(){return this._loaded}updateImage(r){return this.image&&r.url?(this._imageRequest&&r.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=r.url,this.load(r.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(r){this.coordinates=r,this._boundsArray=void 0;const l=r.map(a.MercatorCoordinate.fromLngLat);return this.tileID=function(p){let _=1/0,y=1/0,b=-1/0,S=-1/0;for(const R of p)_=Math.min(_,R.x),y=Math.min(y,R.y),b=Math.max(b,R.x),S=Math.max(S,R.y);const C=Math.max(b-_,S-y),z=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),k=Math.pow(2,z);return new a.CanonicalTileID(z,Math.floor((_+b)/2*k),Math.floor((y+S)/2*k))}(l),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(r){for(const C in this.tiles){const z=this.tiles[C];z.state!=="loaded"&&(z.state="loaded",z.texture=this.texture)}if(this._boundsArray)return;const l=a.tileTransform(this.tileID,this.map.transform.projection),[p,_,y,b]=this.coordinates.map(C=>{const z=l.projection.project(C[0],C[1]);return a.getTilePoint(l,z)._round()});this.perspectiveTransform=function(C,z,k,R,U,q,V,W,$,j){const H=ee(0,0,C,0,0,z,C,z),Z=ee(k,R,U,q,V,W,$,j);return a.multiply$1(Z,a.adjoint(H,H),Z),[Z[6]/Z[8]*C/a.EXTENT,Z[7]/Z[8]*z/a.EXTENT]}(this.width,this.height,p.x,p.y,_.x,_.y,b.x,b.y,y.x,y.y);const S=this._boundsArray=new a.StructArrayLayout4i8;S.emplaceBack(p.x,p.y,0,0),S.emplaceBack(_.x,_.y,a.EXTENT,0),S.emplaceBack(b.x,b.y,0,a.EXTENT),S.emplaceBack(y.x,y.y,a.EXTENT,a.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=r.createVertexBuffer(S,a.boundsAttributes.members),this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const r=this.map.painter.context,l=r.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new a.Texture(r,this.image,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(r)}loadTile(r,l){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},l(null)):(r.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const ge={vector:class extends a.Evented{constructor(u,r,l,p){if(super(),this.id=u,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.extend(this,a.pick(r,["url","scheme","tileSize","promoteId"])),this._options=a.extend({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p),this._tileWorkers={},this._deduped=new a.DedupedRequest}load(u){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,l=this.map._worldview;this._tileJSONRequest=va(this._options,this.map._requestManager,r,l,(p,_)=>{this._tileJSONRequest=null,this._loaded=!0,p?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),l&&l.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${l}`),this.fire(new a.ErrorEvent(p))):_&&(a.extend(this,_),_.bounds&&(this.tileBounds=new Rr(_.bounds,this.minzoom,this.maxzoom)),a.postTurnstileEvent(_.tiles,this.map._requestManager._customAccessToken),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))),u&&u(p)})}loaded(){return this._loaded}hasTile(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)}onAdd(u){this.map=u,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>{const u=this.map.style._getSourceCaches(this.id);for(const r of u)r.clearTiles()})}setSourceProperty(u){u(),this.reload()}setTiles(u){return this._options.tiles=u,this.reload(),this}setUrl(u){return this.url=u,this._options.url=u,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return a.extend({},this._options)}loadTile(u,r){const l=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(l,a.ResourceType.Tile),data:void 0,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,tileSize:this.tileSize*u.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:a.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:u.isSymbolTile};if(p.request.collectResourceTiming=this._collectResourceTiming,u.actor&&u.state!=="expired")u.state==="loading"?u.reloadCallback=r:u.request=u.actor.send("reloadTile",p,_.bind(this));else if(u.actor=this._tileWorkers[l]=this._tileWorkers[l]||this.dispatcher.getActor(),this.dispatcher.ready)u.request=u.actor.send("loadTile",p,_.bind(this),void 0,!0);else{const y=a.loadVectorTile.call({deduped:this._deduped},p,(b,S)=>{b||!S?_.call(this,b):(p.data={cacheControl:S.cacheControl,expires:S.expires,rawData:S.rawData.slice(0)},u.actor&&u.actor.send("loadTile",p,_.bind(this),void 0,!0))},!0);u.request={cancel:y}}function _(y,b){return delete u.request,u.aborted?r(null):y&&y.status!==404?r(y):(b&&b.resourceTiming&&(u.resourceTiming=b.resourceTiming),this.map._refreshExpiredTiles&&b&&u.setExpiryData(b),u.loadVectorData(b,this.map.painter),a.cacheEntryPossiblyAdded(this.dispatcher),r(null),void(u.reloadCallback&&(this.loadTile(u,u.reloadCallback),u.reloadCallback=null)))}}abortTile(u){u.request&&(u.request.cancel(),delete u.request),u.actor&&u.actor.send("abortTile",{uid:u.uid,type:this.type,source:this.id})}unloadTile(u){u.unloadVectorData(),u.actor&&u.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}},raster:F,"raster-dem":class extends F{constructor(u,r,l,p){super(u,r,l,p),this.type="raster-dem",this.maxzoom=22,this._options=a.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(u,r){const l=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(_,y){_&&(u.state="errored",r(_)),y&&(u.dem=y,u.dem.onDeserialize(),u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0,u.state="loaded",r(null))}u.request=a.getImage(this.map._requestManager.transformRequest(l,a.ResourceType.Tile),function(_,y,b,S){if(delete u.request,u.aborted)u.state="unloaded",r(null);else if(_)u.state="errored",r(_);else if(y){this.map._refreshExpiredTiles&&u.setExpiryData({cacheControl:b,expires:S});const C=a.window.ImageBitmap&&y instanceof a.window.ImageBitmap&&(X==null&&(X=a.window.OffscreenCanvas&&new a.window.OffscreenCanvas(1,1).getContext("2d")&&typeof a.window.createImageBitmap=="function"),X),z=1-(y.width-a.prevPowerOfTwo(y.width))/2;z<1||u.neighboringTiles||(u.neighboringTiles=this._getNeighboringTiles(u.tileID));const k=C?y:a.exported.getImageData(y,z),R={uid:u.uid,coord:u.tileID,source:this.id,rawImageData:k,encoding:this.encoding,padding:z};u.actor&&u.state!=="expired"||(u.actor=this.dispatcher.getActor(),u.actor.send("loadDEMTile",R,p.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(u){const r=u.canonical,l=Math.pow(2,r.z),p=(r.x-1+l)%l,_=r.x===0?u.wrap-1:u.wrap,y=(r.x+1+l)%l,b=r.x+1===l?u.wrap+1:u.wrap,S={};return S[new a.OverscaledTileID(u.overscaledZ,_,r.z,p,r.y).key]={backfilled:!1},S[new a.OverscaledTileID(u.overscaledZ,b,r.z,y,r.y).key]={backfilled:!1},r.y>0&&(S[new a.OverscaledTileID(u.overscaledZ,_,r.z,p,r.y-1).key]={backfilled:!1},S[new a.OverscaledTileID(u.overscaledZ,u.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},S[new a.OverscaledTileID(u.overscaledZ,b,r.z,y,r.y-1).key]={backfilled:!1}),r.y+1<l&&(S[new a.OverscaledTileID(u.overscaledZ,_,r.z,p,r.y+1).key]={backfilled:!1},S[new a.OverscaledTileID(u.overscaledZ,u.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},S[new a.OverscaledTileID(u.overscaledZ,b,r.z,y,r.y+1).key]={backfilled:!1}),S}unloadTile(u){u.demTexture&&this.map.painter.saveTileTexture(u.demTexture),u.fbo&&(u.fbo.destroy(),delete u.fbo),u.dem&&delete u.dem,delete u.neighboringTiles,u.state="unloaded"}},geojson:class extends a.Evented{constructor(u,r,l,p){super(),this.id=u,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(p),this._data=r.data,this._options=a.extend({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const _=a.EXTENT/this.tileSize;this.workerOptions=a.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*_,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*_,extent:a.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:a.EXTENT,radius:(r.clusterRadius!==void 0?r.clusterRadius:50)*_,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}onAdd(u){this.map=u,this.setData(this._data)}setData(u){return this._data=u,this._updateWorkerData(),this}getClusterExpansionZoom(u,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:u,source:this.id},r),this}getClusterChildren(u,r){return this.actor.send("geojson.getClusterChildren",{clusterId:u,source:this.id},r),this}getClusterLeaves(u,r,l,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:u,limit:r,offset:l},p),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new a.Event("dataloading",{dataType:"source"})),this._loaded=!1;const u=a.extend({},this.workerOptions),r=this._data;typeof r=="string"?(u.request=this.map._requestManager.transformRequest(a.exported.resolveURL(r),a.ResourceType.Source),u.request.collectResourceTiming=this._collectResourceTiming):u.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,u,(l,p)=>{if(this._loaded=!0,this._pendingLoad=null,l)this.fire(new a.ErrorEvent(l));else{const _={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&p&&p.resourceTiming&&p.resourceTiming[this.id]&&(_.resourceTiming=p.resourceTiming[this.id]),this.fire(new a.Event("data",_)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(u,r){const l=u.actor?"reloadTile":"loadTile";u.actor=this.actor,u.request=this.actor.send(l,{type:this.type,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:a.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(p,_)=>(delete u.request,u.unloadVectorData(),u.aborted?r(null):p?r(p):(u.loadVectorData(_,this.map.painter,l==="reloadTile"),r(null))),void 0,l==="loadTile")}abortTile(u){u.request&&(u.request.cancel(),delete u.request),u.aborted=!0}unloadTile(u){u.unloadVectorData(),this.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return a.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends ae{constructor(u,r,l,p){super(u,r,l,p),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const u=this.options;this.urls=[];for(const r of u.urls)this.urls.push(this.map._requestManager.transformRequest(r,a.ResourceType.Source).url);a.getVideo(this.urls,(r,l)=>{this._loaded=!0,r?this.fire(new a.ErrorEvent(r)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(u){if(this.video){const r=this.video.seekable;u<r.start(0)||u>r.end(0)?this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=u}}getVideo(){return this.video}onAdd(u){this.map||(this.map=u,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const u=this.map.painter.context,r=u.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new a.Texture(u,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(u)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:ae,canvas:class extends ae{constructor(u,r,l,p){super(u,r,l,p),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(y=>typeof y!="number"))||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${u}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${u}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${u}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof a.window.HTMLCanvasElement||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${u}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${u}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof a.window.HTMLCanvasElement?this.options.canvas:a.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(u){this.map=u,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let u=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,u=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,u=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context;this.texture?(u||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.Texture(r,this.canvas,r.gl.RGBA,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const u of[this.canvas.width,this.canvas.height])if(isNaN(u)||u<=0)return!0;return!1}},custom:class extends a.Evented{constructor(u,r,l,p){super(),this.id=u,this.type="custom",this._dataType="raster",this._dispatcher=l,this._implementation=r,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new a.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new a.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Rr(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),a.extend(this,a.pick(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return a.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(u){this._map=u,this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(u),this.load()}onRemove(u){this._implementation.onRemove&&this._implementation.onRemove(u)}hasTile(u){if(this._implementation.hasTile){const{x:r,y:l,z:p}=u.canonical;return this._implementation.hasTile({x:r,y:l,z:p})}return!this.tileBounds||this.tileBounds.contains(u.canonical)}loadTile(u,r){const{x:l,y:p,z:_}=u.tileID.canonical,y=new a.window.AbortController;u.request=Promise.resolve(this._implementation.loadTile({x:l,y:p,z:_},{signal:y.signal})).then(function(b){return delete u.request,u.aborted?(u.state="unloaded",r(null)):b===void 0?(u.state="errored",r(null)):b===null?(this.loadTileData(u,{width:this.tileSize,height:this.tileSize,data:null}),u.state="loaded",r(null)):function(S){return S instanceof a.window.ImageData||S instanceof a.window.HTMLCanvasElement||S instanceof a.window.ImageBitmap||S instanceof a.window.HTMLImageElement}(b)?(this.loadTileData(u,b),u.state="loaded",void r(null)):(u.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(b=>{b.code!==20&&(u.state="errored",r(b))}),u.request.cancel=()=>y.abort()}loadTileData(u,r){F.loadTileData(u,r,this._map.painter)}unloadTileData(u){F.unloadTileData(u,this._map.painter)}unloadTile(u,r){if(this.unloadTileData(u),this._implementation.unloadTile){const{x:l,y:p,z:_}=u.tileID.canonical;this._implementation.unloadTile({x:l,y:p,z:_})}r()}abortTile(u,r){u.request&&u.request.cancel&&(u.request.cancel(),delete u.request),r()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(u=>({x:u.canonical.x,y:u.canonical.y,z:u.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))}}},_e=function(u,r,l,p){const _=new ge[r.type](u,r,l,p);if(_.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${_.id}`);return a.bindAll(["load","abort","unload","serialize","prepare"],_),_};function ue(u,r){const l=a.identity([]);return a.scale(l,l,[.5*u.width,.5*-u.height,1]),a.translate(l,l,[1,-1,0]),a.multiply(l,l,u.calculateProjMatrix(r.toUnwrapped())),Float32Array.from(l)}function we(u,r,l,p,_,y,b,S=!1){const C=u.tilesIn(p,b,S);C.sort(tt);const z=[];for(const R of C)z.push({wrappedTileID:R.tile.tileID.wrapped().key,queryResults:R.tile.queryRenderedFeatures(r,l,u._state,R,_,y,ue(u.transform,R.tile.tileID),S)});const k=function(R){const U={},q={};for(const V of R){const W=V.queryResults,$=V.wrappedTileID,j=q[$]=q[$]||{};for(const H in W){const Z=W[H],ne=j[H]=j[H]||{},ie=U[H]=U[H]||[];for(const Q of Z)ne[Q.featureIndex]||(ne[Q.featureIndex]=!0,ie.push(Q))}}return U}(z);for(const R in k)k[R].forEach(U=>{const q=U.feature,V=q.layer;V&&V.type!=="background"&&V.type!=="sky"&&(q.source=V.source,V["source-layer"]&&(q.sourceLayer=V["source-layer"]),q.state=q.id!==void 0?u.getFeatureState(V["source-layer"],q.id):{})});return k}function Oe(u,r){const l=u.getRenderableIds().map(y=>u.getTileByID(y)),p=[],_={};for(let y=0;y<l.length;y++){const b=l[y],S=b.tileID.canonical.key;_[S]||(_[S]=!0,b.querySourceFeatures(p,r))}return p}function tt(u,r){const l=u.tileID,p=r.tileID;return l.overscaledZ-p.overscaledZ||l.canonical.y-p.canonical.y||l.wrap-p.wrap||l.canonical.x-p.canonical.x}function Ve(){return Ha.workerClass!=null?new Ha.workerClass:new a.window.Worker(Ha.workerUrl)}const gt="mapboxgl_preloaded_worker_pool";class pt{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<pt.workerCount;)this.workers.push(new Ve);return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.numActive()===0&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[gt]}numActive(){return Object.keys(this.active).length}}let ht;function Tt(){return ht||(ht=new pt),ht}function Rt(u,r){const l={};for(const p in u)p!=="ref"&&(l[p]=u[p]);return a.refProperties.forEach(p=>{p in r&&(l[p]=r[p])}),l}function qt(u){u=u.slice();const r=Object.create(null);for(let l=0;l<u.length;l++)r[u[l].id]=u[l];for(let l=0;l<u.length;l++)"ref"in u[l]&&(u[l]=Rt(u[l],r[u[l].ref]));return u}pt.workerCount=2;const xt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function en(u,r,l){l.push({command:xt.addSource,args:[u,r[u]]})}function tn(u,r,l){r.push({command:xt.removeSource,args:[u]}),l[u]=!0}function _o(u,r,l,p){tn(u,l,p),en(u,r,l)}function Ni(u,r,l){let p;for(p in u[l])if(u[l].hasOwnProperty(p)&&p!=="data"&&!B(u[l][p],r[l][p]))return!1;for(p in r[l])if(r[l].hasOwnProperty(p)&&p!=="data"&&!B(u[l][p],r[l][p]))return!1;return!0}function ze(u,r,l,p,_,y){let b;for(b in r=r||{},u=u||{})u.hasOwnProperty(b)&&(B(u[b],r[b])||l.push({command:y,args:[p,b,r[b],_]}));for(b in r)r.hasOwnProperty(b)&&!u.hasOwnProperty(b)&&(B(u[b],r[b])||l.push({command:y,args:[p,b,r[b],_]}))}function ji(u){return u.id}function kn(u,r){return u[r.id]=r,u}class go{constructor(r,l){this.reset(r,l)}reset(r,l){this.points=r||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=a.clamp(r,0,1);let l=1,p=this._distances[l];const _=r*this.paddedLength+this.padding;for(;p<_&&l<this._distances.length;)p=this._distances[++l];const y=l-1,b=this._distances[y],S=p-b,C=S>0?(_-b)/S:0;return this.points[y].mult(1-C).add(this.points[l].mult(C))}}class Rd{constructor(r,l,p){const _=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(r/p),this.yCellCount=Math.ceil(l/p);for(let b=0;b<this.xCellCount*this.yCellCount;b++)_.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=l,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,l,p,_,y){this._forEachCell(l,p,_,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(y)}insertCircle(r,l,p,_){this._forEachCell(l-_,p-_,l+_,p+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(l),this.circles.push(p),this.circles.push(_)}_insertBoxCell(r,l,p,_,y,b){this.boxCells[y].push(b)}_insertCircleCell(r,l,p,_,y,b){this.circleCells[y].push(b)}_query(r,l,p,_,y,b){if(p<0||r>this.width||_<0||l>this.height)return!y&&[];const S=[];if(r<=0&&l<=0&&this.width<=p&&this.height<=_){if(y)return!0;for(let C=0;C<this.boxKeys.length;C++)S.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const z=this.circles[3*C],k=this.circles[3*C+1],R=this.circles[3*C+2];S.push({key:this.circleKeys[C],x1:z-R,y1:k-R,x2:z+R,y2:k+R})}return b?S.filter(b):S}return this._forEachCell(r,l,p,_,this._queryCell,S,{hitTest:y,seenUids:{box:{},circle:{}}},b),y?S.length>0:S}_queryCircle(r,l,p,_,y){const b=r-p,S=r+p,C=l-p,z=l+p;if(S<0||b>this.width||z<0||C>this.height)return!_&&[];const k=[];return this._forEachCell(b,C,S,z,this._queryCellCircle,k,{hitTest:_,circle:{x:r,y:l,radius:p},seenUids:{box:{},circle:{}}},y),_?k.length>0:k}query(r,l,p,_,y){return this._query(r,l,p,_,!1,y)}hitTest(r,l,p,_,y){return this._query(r,l,p,_,!0,y)}hitTestCircle(r,l,p,_){return this._queryCircle(r,l,p,!0,_)}_queryCell(r,l,p,_,y,b,S,C){const z=S.seenUids,k=this.boxCells[y];if(k!==null){const U=this.bboxes;for(const q of k)if(!z.box[q]){z.box[q]=!0;const V=4*q;if(r<=U[V+2]&&l<=U[V+3]&&p>=U[V+0]&&_>=U[V+1]&&(!C||C(this.boxKeys[q]))){if(S.hitTest)return b.push(!0),!0;b.push({key:this.boxKeys[q],x1:U[V],y1:U[V+1],x2:U[V+2],y2:U[V+3]})}}}const R=this.circleCells[y];if(R!==null){const U=this.circles;for(const q of R)if(!z.circle[q]){z.circle[q]=!0;const V=3*q;if(this._circleAndRectCollide(U[V],U[V+1],U[V+2],r,l,p,_)&&(!C||C(this.circleKeys[q]))){if(S.hitTest)return b.push(!0),!0;{const W=U[V],$=U[V+1],j=U[V+2];b.push({key:this.circleKeys[q],x1:W-j,y1:$-j,x2:W+j,y2:$+j})}}}}}_queryCellCircle(r,l,p,_,y,b,S,C){const z=S.circle,k=S.seenUids,R=this.boxCells[y];if(R!==null){const q=this.bboxes;for(const V of R)if(!k.box[V]){k.box[V]=!0;const W=4*V;if(this._circleAndRectCollide(z.x,z.y,z.radius,q[W+0],q[W+1],q[W+2],q[W+3])&&(!C||C(this.boxKeys[V])))return b.push(!0),!0}}const U=this.circleCells[y];if(U!==null){const q=this.circles;for(const V of U)if(!k.circle[V]){k.circle[V]=!0;const W=3*V;if(this._circlesCollide(q[W],q[W+1],q[W+2],z.x,z.y,z.radius)&&(!C||C(this.circleKeys[V])))return b.push(!0),!0}}}_forEachCell(r,l,p,_,y,b,S,C){const z=this._convertToXCellCoord(r),k=this._convertToYCellCoord(l),R=this._convertToXCellCoord(p),U=this._convertToYCellCoord(_);for(let q=z;q<=R;q++)for(let V=k;V<=U;V++)if(y.call(this,r,l,p,_,this.xCellCount*V+q,b,S,C))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,l,p,_,y,b){const S=_-r,C=y-l,z=p+b;return z*z>S*S+C*C}_circleAndRectCollide(r,l,p,_,y,b,S){const C=(b-_)/2,z=Math.abs(r-(_+C));if(z>C+p)return!1;const k=(S-y)/2,R=Math.abs(l-(y+k));if(R>k+p)return!1;if(z<=C||R<=k)return!0;const U=z-C,q=R-k;return U*U+q*q<=p*p}}const xi=Math.tan(85*Math.PI/180);function As(u,r,l,p,_,y,b){const S=a.create();if(l)if(y.name==="globe"){const C=a.calculateGlobeLabelMatrix(_,r);a.multiply(S,S,C)}else{const C=mt([],b);S[0]=C[0],S[1]=C[1],S[4]=C[2],S[5]=C[3],p||a.rotateZ(S,S,_.angle)}else a.multiply(S,_.labelPlaneMatrix,u);return S}function Bd(u,r,l,p,_,y,b){const S=As(u,r,l,p,_,y,b);return y.name==="globe"&&l||(S[2]=S[6]=S[10]=S[14]=0),S}function Is(u,r,l,p,_,y,b){if(l){if(y.name==="globe"){const S=As(u,r,l,p,_,y,b);return a.invert(S,S),a.multiply(S,u,S),S}{const S=a.clone(u),C=a.identity([]);return C[0]=b[0],C[1]=b[1],C[4]=b[2],C[5]=b[3],a.multiply(S,S,C),p||a.rotateZ(S,S,-_.angle),S}}return _.glCoordMatrix}function Qe(u,r,l=0){const p=[u.x,u.y,l,1];l?a.transformMat4$1(p,p,r):Ml(p,p,r);const _=p[3];return{point:[p[0]/_,p[1]/_,p[2]/_],signedDistanceFromCamera:_}}function Bt(u,r){const l=[u[0],u[1],u[2],1];a.transformMat4$1(l,l,r);const p=l[3];return{point:[l[0]/p,l[1]/p,l[2]/p],signedDistanceFromCamera:p}}function Ut(u,r){return Math.min(.5+u/r*.5,1.5)}function vi(u,r){const l=u[0]/u[3],p=u[1]/u[3];return l>=-r[0]&&l<=r[0]&&p>=-r[1]&&p<=r[1]}function zs(u,r,l,p,_,y,b,S,C,z){const k=l.transform,R=p?u.textSizeData:u.iconSizeData,U=a.evaluateSizeForZoom(R,l.transform.zoom),q=k.projection.name==="globe",V=[256/l.width*2+1,256/l.height*2+1],W=p?u.text.dynamicLayoutVertexArray:u.icon.dynamicLayoutVertexArray;W.clear();let $=null;q&&($=p?u.text.globeExtVertexArray:u.icon.globeExtVertexArray);const j=u.lineVertexArray,H=p?u.text.placedSymbolArray:u.icon.placedSymbolArray,Z=l.transform.width/l.transform.height;let ne=!1;for(let ie=0;ie<H.length;ie++){const Q=H.get(ie);if(Q.writingMode!==a.WritingMode.vertical||ne||ie!==0&&H.get(ie-1).writingMode===a.WritingMode.horizontal||(ne=!0),(Q.hidden||Q.writingMode===a.WritingMode.vertical)&&!ne){oi(Q.numGlyphs,W);continue}ne=!1;const se=new a.pointGeometry(Q.tileAnchorX,Q.tileAnchorY),xe=C?C(se):[0,0,0],Ce=k.projection.projectTilePoint(se.x,se.y,z.canonical),Ee=[Ce.x+xe[0],Ce.y+xe[1],Ce.z+xe[2]],Ge=[...Ee,1];if(a.transformMat4$1(Ge,Ge,r),!vi(Ge,V)){oi(Q.numGlyphs,W);continue}const fe=Ut(l.transform.cameraToCenterDistance,Ge[3]),Le=a.evaluateSizeForFeature(R,U,Q),De=b?Le/fe:Le*fe,ve=Qe(new a.pointGeometry(Ee[0],Ee[1]),_,Ee[2]);if(ve.signedDistanceFromCamera<=0){oi(Q.numGlyphs,W);continue}let pe={};const Ke=b?null:C,qe=ks(Q,De,!1,S,r,_,y,u.glyphOffsetArray,j,W,$,ve.point,se,pe,Z,Ke,k.projection,z,b);ne=qe.useVertical,Ke&&qe.needsFlipping&&(pe={}),(qe.notEnoughRoom||ne||qe.needsFlipping&&ks(Q,De,!0,S,r,_,y,u.glyphOffsetArray,j,W,$,ve.point,se,pe,Z,Ke,k.projection,z,b).notEnoughRoom)&&oi(Q.numGlyphs,W)}p?(u.text.dynamicLayoutVertexBuffer.updateData(W),$&&u.text.globeExtVertexBuffer.updateData($)):(u.icon.dynamicLayoutVertexBuffer.updateData(W),$&&u.icon.globeExtVertexBuffer.updateData($))}function Nt(u,r,l,p,_,y,b,S,C,z,k,R,U,q,V,W){const $=S.glyphStartIndex+S.numGlyphs,j=S.lineStartIndex,H=S.lineStartIndex+S.lineLength,Z=r.getoffsetX(S.glyphStartIndex),ne=r.getoffsetX($-1),ie=_n(u*Z,l,p,_,y,b,S.segment,j,H,C,z,k,R,U,!0,q,V,W);if(!ie)return null;const Q=_n(u*ne,l,p,_,y,b,S.segment,j,H,C,z,k,R,U,!0,q,V,W);return Q?{first:ie,last:Q}:null}function Aa(u,r,l,p){return u.writingMode===a.WritingMode.horizontal&&Math.abs(l.y-r.y)>Math.abs(l.x-r.x)*p?{useVertical:!0}:u.writingMode===a.WritingMode.vertical?r.y<l.y?{needsFlipping:!0}:null:u.flipState!==0&&function(_,y,b){const S=(y.x-_.x)*b;return S===0||Math.abs((y.y-_.y)/S)>xi}(r,l,p)?u.flipState===1?{needsFlipping:!0}:null:r.x>l.x?{needsFlipping:!0}:null}function ks(u,r,l,p,_,y,b,S,C,z,k,R,U,q,V,W,$,j,H){const Z=r/24,ne=u.lineOffsetX*Z,ie=u.lineOffsetY*Z;let Q=[];if(u.numGlyphs>1){const se=u.glyphStartIndex+u.numGlyphs,xe=u.lineStartIndex,Ce=u.lineStartIndex+u.lineLength,Ee=Nt(Z,S,ne,ie,l,R,U,u,C,y,q,W,!1,$,j,H);if(!Ee)return{notEnoughRoom:!0};const Ge=Bt(Ee.first.point,b).point,fe=Bt(Ee.last.point,b).point,Le=new a.pointGeometry(Ge[0],Ge[1]),De=new a.pointGeometry(fe[0],fe[1]);if(p&&!l){const ve=Aa(u,Le,De,V);if(u.flipState=ve&&ve.needsFlipping?1:2,ve)return ve}Q=[Ee.first];for(let ve=u.glyphStartIndex+1;ve<se-1;ve++){const pe=_n(Z*S.getoffsetX(ve),ne,ie,l,R,U,u.segment,xe,Ce,C,y,q,W,!1,!1,$,j,H);if(!pe)return{notEnoughRoom:!0};Q.push(pe)}Q.push(Ee.last)}else{if(p&&!l){const xe=Qe(U,_).point,Ce=u.lineStartIndex+u.segment+1,Ee=new a.pointGeometry(C.getx(Ce),C.gety(Ce)),Ge=Qe(Ee,_),fe=Ge.signedDistanceFromCamera>0?Ge.point:Or(U,Ee,xe,1,_,void 0,$,j.canonical),Le=Aa(u,new a.pointGeometry(xe[0],xe[1]),new a.pointGeometry(fe[0],fe[1]),V);if(u.flipState=Le&&Le.needsFlipping?1:2,Le)return Le}const se=_n(Z*S.getoffsetX(u.glyphStartIndex),ne,ie,l,R,U,u.segment,u.lineStartIndex,u.lineStartIndex+u.lineLength,C,y,q,W,!1,!1,$,j,H);if(!se)return{notEnoughRoom:!0};Q=[se]}if(k)for(const se of Q)a.updateGlobeVertexNormal(k,z.length+0,se.up[0],se.up[1],se.up[2]),a.updateGlobeVertexNormal(k,z.length+1,se.up[0],se.up[1],se.up[2]),a.updateGlobeVertexNormal(k,z.length+2,se.up[0],se.up[1],se.up[2]),a.updateGlobeVertexNormal(k,z.length+3,se.up[0],se.up[1],se.up[2]),a.addDynamicAttributes(z,se.point[0],se.point[1],se.point[2],se.angle);else for(const se of Q)a.addDynamicAttributes(z,se.point[0],se.point[1],se.point[2],se.angle);return{}}function Ps(u,r,l,p,_){const y=p.projectTilePoint(u.x,u.y,r);if(!_)return Qe(y,l,y.z);const b=_(u);return Qe(new a.pointGeometry(y.x+b[0],y.y+b[1]),l,y.z+b[2])}function Or(u,r,l,p,_,y,b,S){const C=Ps(u.add(u.sub(r)._unit()),S,_,b,y).point,z=a.sub([],l,C);return a.scaleAndAdd([],l,z,p/a.length(z))}function _n(u,r,l,p,_,y,b,S,C,z,k,R,U,q,V,W,$,j){const H=p?u-r:u+r;let Z=H>0?1:-1,ne=0;p&&(Z*=-1,ne=Math.PI),Z<0&&(ne+=Math.PI);let ie=Z>0?S+b:S+b+1,Q=_,se=_,xe=0,Ce=0;const Ee=Math.abs(H),Ge=[],fe=[];let Le=y;const De=()=>{const Xe=ie-Z;return xe===0?y:new a.pointGeometry(z.getx(Xe),z.gety(Xe))},ve=()=>{const Xe=De();return Or(Xe,Le||Xe,se,Ee-xe+1,k,U,W,$.canonical)};for(;xe+Ce<=Ee;){if(ie+=Z,ie<S||ie>=C)return null;if(se=Q,Ge.push(Q),q&&fe.push(Le||De()),Q=R[ie],Q===void 0){Le=new a.pointGeometry(z.getx(ie),z.gety(ie));const Xe=Ps(Le,$.canonical,k,W,U);Q=Xe.signedDistanceFromCamera>0?R[ie]=Xe.point:ve()}else Le=null;xe+=Ce,Ce=a.distance(se,Q)}Le=Le||new a.pointGeometry(z.getx(ie),z.gety(ie));const pe=De();V&&U&&(R[ie]=Q=R[ie]===void 0?Q:ve(),Ce=a.distance(se,Q));const Ke=(Ee-xe)/Ce,qe=Le.sub(pe).mult(Ke)._add(pe),Ye=a.sub([],Q,se),We=a.scaleAndAdd([],se,Ye,Ke);let at=[0,0,1],wt=Ye[0],yt=Ye[1];if(j&&(at=W.upVector($.canonical,qe.x,qe.y),at[0]!==0||at[1]!==0||at[2]!==1)){const Xe=[1,0,0],Mt=[0,1,0];Xe[0]=at[2],Xe[1]=0,Xe[2]=-at[0],a.cross(Mt,at,Xe),a.normalize(Xe,Xe),a.normalize(Mt,Mt),wt=a.dot(Ye,Xe),yt=a.dot(Ye,Mt)}if(l){const Xe=a.cross([],at,Ye);a.normalize(Xe,Xe),a.scaleAndAdd(We,We,Xe,l*Z)}const ut=ne+Math.atan2(yt,wt);return Ge.push(We),q&&fe.push(qe),{point:We,angle:ut,path:Ge,tilePath:fe,up:at}}const Zm=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function oi(u,r){for(let l=0;l<u;l++){const p=r.length;r.resize(p+4),r.float32.set(Zm,4*p)}}function Ml(u,r,l){const p=r[0],_=r[1];return u[0]=l[0]*p+l[4]*_+l[12],u[1]=l[1]*p+l[5]*_+l[13],u[3]=l[3]*p+l[7]*_+l[15],u}const Er=100;class uu{constructor(r,l,p=new Rd(r.width+200,r.height+200,25),_=new Rd(r.width+200,r.height+200,25)){this.transform=r,this.grid=p,this.ignoredGrid=_,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+Er,this.screenBottomBoundary=r.height+Er,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=l}placeCollisionBox(r,l,p,_,y,b,S,C){let z=p.projectedAnchorX,k=p.projectedAnchorY,R=p.projectedAnchorZ;const U=p.elevation,q=p.tileID;if(U&&q){const ie=r.getProjection().upVector(q.canonical,p.tileAnchorX,p.tileAnchorY),Q=r.getProjection().upVectorScale(q.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;z+=ie[0]*U*Q,k+=ie[1]*U*Q,R+=ie[2]*U*Q}const V=this.projectAndGetPerspectiveRatio(S,[z,k,R],p.tileID,r.projection.name==="globe"||!!U||this.transform.pitch>0,r.getProjection()),W=b*V.perspectiveRatio,$=(p.x1*l+_.x-p.padding)*W+V.point.x,j=(p.y1*l+_.y-p.padding)*W+V.point.y,H=(p.x2*l+_.x+p.padding)*W+V.point.x,Z=(p.y2*l+_.y+p.padding)*W+V.point.y,ne=V.perspectiveRatio<=.55||V.occluded;return!this.isInsideGrid($,j,H,Z)||!y&&this.grid.hitTest($,j,H,Z,C)||ne?{box:[],offscreen:!1,occluded:V.occluded}:{box:[$,j,H,Z],offscreen:this.isOffscreen($,j,H,Z),occluded:!1}}placeCollisionCircles(r,l,p,_,y,b,S,C,z,k,R,U,q,V,W){const $=[],j=this.transform.elevation,H=j?j.getAtTileOffsetFunc(W,this.transform.center.lat,this.transform.worldSize,r.getProjection()):pe=>[0,0,0],Z=new a.pointGeometry(p.tileAnchorX,p.tileAnchorY),ne=r.getProjection().projectTilePoint(p.tileAnchorX,p.tileAnchorY,W.canonical),ie=H(Z),Q=[ne.x+ie[0],ne.y+ie[1],ne.z+ie[2]],se=r.projection.name==="globe",xe=this.projectAndGetPerspectiveRatio(S,[Q[0],Q[1],Q[2]],W,se||!!j||this.transform.pitch>0,r.getProjection()),{perspectiveRatio:Ce}=xe,Ee=(R?b/Ce:b*Ce)/a.ONE_EM,Ge=Qe(new a.pointGeometry(Q[0],Q[1]),C,Q[2]).point,fe=xe.signedDistanceFromCamera>0?Nt(Ee,y,p.lineOffsetX*Ee,p.lineOffsetY*Ee,!1,Ge,Z,p,_,C,{},j&&!R?H:null,R&&!!j,r.getProjection(),W,R):null;let Le=!1,De=!1,ve=!0;if(fe&&!xe.occluded){const pe=.5*q*Ce+V,Ke=new a.pointGeometry(-100,-100),qe=new a.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Ye=new go,We=fe.first,at=fe.last;let wt=[];for(let Xe=We.path.length-1;Xe>=1;Xe--)wt.push(We.path[Xe]);for(let Xe=1;Xe<at.path.length;Xe++)wt.push(at.path[Xe]);const yt=2.5*pe;if(z){const Xe=wt.map(j&&!se?(Mt,Dt)=>{const nn=H(Dt<We.path.length-1?We.tilePath[We.path.length-1-Dt]:at.tilePath[Dt-We.path.length+2]);return Mt[2]=nn[2],Bt(Mt,z)}:Mt=>Bt(Mt,z));wt=Xe.some(Mt=>Mt.signedDistanceFromCamera<=0)?[]:Xe.map(Mt=>Mt.point)}let ut=[];if(wt.length>0){const Xe=wt.map(Jt=>new a.pointGeometry(Jt[0],Jt[1]));let Mt=1/0,Dt=-1/0,nn=1/0,rn=-1/0;for(let Jt=0;Jt<Xe.length;Jt++)Mt=Math.min(Mt,Xe[Jt].x),nn=Math.min(nn,Xe[Jt].y),Dt=Math.max(Dt,Xe[Jt].x),rn=Math.max(rn,Xe[Jt].y);ut=Mt>=Ke.x&&Dt<=qe.x&&nn>=Ke.y&&rn<=qe.y?[Xe]:Dt<Ke.x||Mt>qe.x||rn<Ke.y||nn>qe.y?[]:a.clipLine([Xe],Ke.x,Ke.y,qe.x,qe.y)}for(const Xe of ut){Ye.reset(Xe,.25*pe);let Mt=0;Mt=Ye.length<=.5*pe?1:Math.ceil(Ye.paddedLength/yt)+1;for(let Dt=0;Dt<Mt;Dt++){const nn=Dt/Math.max(Mt-1,1),rn=Ye.lerp(nn),Jt=rn.x+Er,Gn=rn.y+Er;$.push(Jt,Gn,pe,0);const mr=Jt-pe,Mi=Gn-pe,pn=Jt+pe,vn=Gn+pe;if(ve=ve&&this.isOffscreen(mr,Mi,pn,vn),De=De||this.isInsideGrid(mr,Mi,pn,vn),!l&&this.grid.hitTestCircle(Jt,Gn,pe,U)&&(Le=!0,!k))return{circles:[],offscreen:!1,collisionDetected:Le,occluded:!1}}}}return{circles:!k&&Le||!De?[]:$,offscreen:ve,collisionDetected:Le,occluded:xe.occluded}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const l=[];let p=1/0,_=1/0,y=-1/0,b=-1/0;for(const k of r){const R=new a.pointGeometry(k.x+Er,k.y+Er);p=Math.min(p,R.x),_=Math.min(_,R.y),y=Math.max(y,R.x),b=Math.max(b,R.y),l.push(R)}const S=this.grid.query(p,_,y,b).concat(this.ignoredGrid.query(p,_,y,b)),C={},z={};for(const k of S){const R=k.key;if(C[R.bucketInstanceId]===void 0&&(C[R.bucketInstanceId]={}),C[R.bucketInstanceId][R.featureIndex])continue;const U=[new a.pointGeometry(k.x1,k.y1),new a.pointGeometry(k.x2,k.y1),new a.pointGeometry(k.x2,k.y2),new a.pointGeometry(k.x1,k.y2)];a.polygonIntersectsPolygon(l,U)&&(C[R.bucketInstanceId][R.featureIndex]=!0,z[R.bucketInstanceId]===void 0&&(z[R.bucketInstanceId]=[]),z[R.bucketInstanceId].push(R.featureIndex))}return z}insertCollisionBox(r,l,p,_,y){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:_,collisionGroupID:y},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,l,p,_,y){const b=l?this.ignoredGrid:this.grid,S={bucketInstanceId:p,featureIndex:_,collisionGroupID:y};for(let C=0;C<r.length;C+=4)b.insertCircle(S,r[C],r[C+1],r[C+2])}projectAndGetPerspectiveRatio(r,l,p,_,y){const b=[l[0],l[1],l[2],1];let S=!1;if(l[2]||this.transform.pitch>0){a.transformMat4$1(b,b,r);const C=y.name==="globe";this.fogState&&p&&!C&&(S=function(z,k,R,U,q,V){const W=V.calculateFogTileMatrix(q),$=[k,R,U];return a.transformMat4($,$,W),st(z,$,V.pitch,V._fov)}(this.fogState,l[0],l[1],l[2],p.toUnwrapped(),this.transform)>.9)}else Ml(b,b,r);return{point:new a.pointGeometry((b[0]/b[3]+1)/2*this.transform.width+Er,(-b[1]/b[3]+1)/2*this.transform.height+Er),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(y)/b[3]*.5,1.5),signedDistanceFromCamera:b[3],occluded:_&&b[2]>b[3]||S}}isOffscreen(r,l,p,_){return p<Er||r>=this.screenRightBoundary||_<Er||l>this.screenBottomBoundary}isInsideGrid(r,l,p,_){return p>=0&&r<this.gridRightBoundary&&_>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const r=a.identity([]);return a.translate(r,r,[-100,-100,0]),r}}function Al(u,r,l){const p=r.createTileMatrix(u,u.worldSize,l.toUnwrapped());return a.multiply(new Float32Array(16),u.projMatrix,p)}function Il(u,r,l){if(r.projection.name===l.projection.name)return u.projMatrix;const p=l.clone();return p.setProjection(r.projection),Al(p,r.getProjection(),u)}function Ia(u,r,l){return r.name===l.projection.name?u.projMatrix:Al(l,r,u)}class za{constructor(r,l,p,_){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?l:-l))):_&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class jo{constructor(r,l,p,_,y,b=!1){this.text=new za(r?r.text:null,l,p,y),this.icon=new za(r?r.icon:null,l,_,y),this.clipped=b}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ir{constructor(r,l,p,_=!1){this.text=r,this.icon=l,this.skipFade=p,this.clipped=_}}class An{constructor(){this.invProjMatrix=a.create(),this.viewportMatrix=a.create(),this.circles=[]}}class hu{constructor(r,l,p,_,y){this.bucketInstanceId=r,this.featureIndex=l,this.sourceLayerIndex=p,this.bucketIndex=_,this.tileID=y}}class du{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const l=++this.maxGroupID;this.collisionGroups[r]={ID:l,predicate:p=>p.collisionGroupID===l}}return this.collisionGroups[r]}}function fr(u,r,l,p,_){const{horizontalAlign:y,verticalAlign:b}=a.getAnchorAlignment(u),S=-(y-.5)*r,C=-(b-.5)*l,z=a.evaluateVariableOffset(u,p);return new a.pointGeometry(S+z[0]*_,C+z[1]*_)}function Sr(u,r,l,p,_){const y=new a.pointGeometry(u,r);return l&&y._rotate(p?_:-_),y}class Od{constructor(r,l,p,_,y){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new uu(this.transform,y),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new du(p),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,l,p,_){const y=p.getBucket(l),b=p.latestFeatureIndex;if(!y||!b||l.id!==y.layerIds[0])return;const S=y.layers[0].layout,C=p.collisionBoxArray,z=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),k=p.tileSize/a.EXTENT,R=p.tileID.toUnwrapped();this.transform.setProjection(y.projection);const U=(q=p.tileID,V=y.getProjection(),W=this.transform,V.name===this.projection?W.calculateProjMatrix(q.toUnwrapped()):Al(W,V,q));var q,V,W;const $=S.get("text-pitch-alignment")==="map",j=S.get("text-rotation-alignment")==="map";l.compileFilter();const H=l.dynamicFilter(),Z=l.dynamicFilterNeedsFeature(),ne=this.transform.calculatePixelsToTileUnitsMatrix(p),ie=Bd(U,p.tileID.canonical,$,j,this.transform,y.getProjection(),ne);let Q=null;if($){const Ce=Is(U,p.tileID.canonical,$,j,this.transform,y.getProjection(),ne);Q=a.multiply([],this.transform.labelPlaneMatrix,Ce)}let se=null;H&&p.latestFeatureIndex&&(se={unwrappedTileID:R,dynamicFilter:H,dynamicFilterNeedsFeature:Z,featureIndex:p.latestFeatureIndex}),this.retainedQueryData[y.bucketInstanceId]=new hu(y.bucketInstanceId,b,y.sourceLayerIndex,y.index,p.tileID);const xe={bucket:y,layout:S,posMatrix:U,textLabelPlaneMatrix:ie,labelToScreenMatrix:Q,clippingData:se,scale:z,textPixelRatio:k,holdingForFade:p.holdingForFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:a.evaluateSizeForZoom(y.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:a.evaluateSizeForZoom(y.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(_)for(const Ce of y.sortKeyRanges){const{sortKey:Ee,symbolInstanceStart:Ge,symbolInstanceEnd:fe}=Ce;r.push({sortKey:Ee,symbolInstanceStart:Ge,symbolInstanceEnd:fe,parameters:xe})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:xe})}attemptAnchorPlacement(r,l,p,_,y,b,S,C,z,k,R,U,q,V,W,$,j,H){const Z=[U.textOffset0,U.textOffset1],ne=fr(r,p,_,Z,y),ie=this.collisionIndex.placeCollisionBox(V,y,l,Sr(ne.x,ne.y,b,S,this.transform.angle),R,C,z,k.predicate);if($){const Q=V.getSymbolInstanceIconSize(H,this.transform.zoom,U.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(V,Q,$,Sr(ne.x,ne.y,b,S,this.transform.angle),R,C,z,k.predicate).box.length===0)return}if(ie.box.length>0){let Q;return this.prevPlacement&&this.prevPlacement.variableOffsets[U.crossTileID]&&this.prevPlacement.placements[U.crossTileID]&&this.prevPlacement.placements[U.crossTileID].text&&(Q=this.prevPlacement.variableOffsets[U.crossTileID].anchor),this.variableOffsets[U.crossTileID]={textOffset:Z,width:p,height:_,anchor:r,textScale:y,prevAnchor:Q},this.markUsedJustification(V,r,U,W),V.allowVerticalPlacement&&(this.markUsedOrientation(V,W,U),this.placedOrientations[U.crossTileID]=W),{shift:ne,placedGlyphBoxes:ie}}}placeLayerBucketPart(r,l,p,_){const{bucket:y,layout:b,posMatrix:S,textLabelPlaneMatrix:C,labelToScreenMatrix:z,clippingData:k,textPixelRatio:R,holdingForFade:U,collisionBoxArray:q,partiallyEvaluatedTextSize:V,partiallyEvaluatedIconSize:W,collisionGroup:$}=r.parameters,j=b.get("text-optional"),H=b.get("icon-optional"),Z=b.get("text-allow-overlap"),ne=b.get("icon-allow-overlap"),ie=b.get("text-rotation-alignment")==="map",Q=b.get("text-pitch-alignment")==="map",se=b.get("icon-text-fit")!=="none",xe=b.get("symbol-z-order")==="viewport-y";this.transform.setProjection(y.projection);let Ce=Z&&(ne||!y.hasIconData()||H),Ee=ne&&(Z||!y.hasTextData()||j);!y.collisionArrays&&q&&y.deserializeCollisionBoxes(q),p&&_&&y.updateCollisionDebugBuffers(this.transform.zoom,q);const Ge=(fe,Le,De)=>{if(k){const pn={zoom:this.transform.zoom,pitch:this.transform.pitch};let vn=null;if(k.dynamicFilterNeedsFeature){const Yt=this.retainedQueryData[y.bucketInstanceId];vn=k.featureIndex.loadFeature({featureIndex:fe.featureIndex,bucketIndex:Yt.bucketIndex,sourceLayerIndex:Yt.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,k.dynamicFilter)(pn,vn,this.retainedQueryData[y.bucketInstanceId].tileID.canonical,new a.pointGeometry(fe.tileAnchorX,fe.tileAnchorY),this.transform.calculateDistanceTileData(k.unwrappedTileID)))return this.placements[fe.crossTileID]=new ir(!1,!1,!1,!0),void(l[fe.crossTileID]=!0)}if(l[fe.crossTileID])return;if(U)return void(this.placements[fe.crossTileID]=new ir(!1,!1,!1));let ve=!1,pe=!1,Ke=!0,qe=!1,Ye=!1,We=null,at={box:null,offscreen:null,occluded:null},wt={box:null,offscreen:null,occluded:null},yt=null,ut=null,Xe=null,Mt=0,Dt=0,nn=0;De.textFeatureIndex?Mt=De.textFeatureIndex:fe.useRuntimeCollisionCircles&&(Mt=fe.featureIndex),De.verticalTextFeatureIndex&&(Dt=De.verticalTextFeatureIndex);const rn=pn=>{pn.tileID=this.retainedQueryData[y.bucketInstanceId].tileID,(this.transform.elevation||pn.elevation)&&(pn.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[y.bucketInstanceId].tileID,pn.tileAnchorX,pn.tileAnchorY):0)},Jt=De.textBox;if(Jt){rn(Jt);const pn=Yt=>{let Pn=a.WritingMode.horizontal;if(y.allowVerticalPlacement&&!Yt&&this.prevPlacement){const sr=this.prevPlacement.placedOrientations[fe.crossTileID];sr&&(this.placedOrientations[fe.crossTileID]=sr,Pn=sr,this.markUsedOrientation(y,Pn,fe))}return Pn},vn=(Yt,Pn)=>{if(y.allowVerticalPlacement&&fe.numVerticalGlyphVertices>0&&De.verticalTextBox){for(const sr of y.writingModes)if(sr===a.WritingMode.vertical?(at=Pn(),wt=at):at=Yt(),at&&at.box&&at.box.length)break}else at=Yt()};if(b.get("text-variable-anchor")){let Yt=b.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[fe.crossTileID]){const cn=this.prevPlacement.variableOffsets[fe.crossTileID];Yt.indexOf(cn.anchor)>0&&(Yt=Yt.filter(Cr=>Cr!==cn.anchor),Yt.unshift(cn.anchor))}const Pn=(cn,Cr,Xo)=>{const ai=y.getSymbolInstanceTextSize(V,fe,this.transform.zoom,Le),_r=(cn.x2-cn.x1)*ai+2*cn.padding,js=(cn.y2-cn.y1)*ai+2*cn.padding,bo=se&&!ne?Cr:null;bo&&rn(bo);let Yn={box:[],offscreen:!1,occluded:!1};const Ai=Z?2*Yt.length:Yt.length;for(let To=0;To<Ai;++To){const li=this.attemptAnchorPlacement(Yt[To%Yt.length],cn,_r,js,ai,ie,Q,R,S,$,To>=Yt.length,fe,Le,y,Xo,bo,V,W);if(li&&(Yn=li.placedGlyphBoxes,Yn&&Yn.box&&Yn.box.length)){ve=!0,We=li.shift;break}}return Yn};vn(()=>Pn(Jt,De.iconBox,a.WritingMode.horizontal),()=>{const cn=De.verticalTextBox;return cn&&rn(cn),y.allowVerticalPlacement&&!(at&&at.box&&at.box.length)&&fe.numVerticalGlyphVertices>0&&cn?Pn(cn,De.verticalIconBox,a.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),at&&(ve=at.box,Ke=at.offscreen,qe=at.occluded);const sr=pn(at&&at.box);if(!ve&&this.prevPlacement){const cn=this.prevPlacement.variableOffsets[fe.crossTileID];cn&&(this.variableOffsets[fe.crossTileID]=cn,this.markUsedJustification(y,cn.anchor,fe,sr))}}else{const Yt=(Pn,sr)=>{const cn=y.getSymbolInstanceTextSize(V,fe,this.transform.zoom,Le),Cr=this.collisionIndex.placeCollisionBox(y,cn,Pn,new a.pointGeometry(0,0),Z,R,S,$.predicate);return Cr&&Cr.box&&Cr.box.length&&(this.markUsedOrientation(y,sr,fe),this.placedOrientations[fe.crossTileID]=sr),Cr};vn(()=>Yt(Jt,a.WritingMode.horizontal),()=>{const Pn=De.verticalTextBox;return y.allowVerticalPlacement&&fe.numVerticalGlyphVertices>0&&Pn?(rn(Pn),Yt(Pn,a.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),pn(at&&at.box&&at.box.length)}}if(yt=at,ve=yt&&yt.box&&yt.box.length>0,Ke=yt&&yt.offscreen,qe=yt&&yt.occluded,fe.useRuntimeCollisionCircles){const pn=y.text.placedSymbolArray.get(fe.centerJustifiedTextSymbolIndex>=0?fe.centerJustifiedTextSymbolIndex:fe.verticalPlacedTextSymbolIndex),vn=a.evaluateSizeForFeature(y.textSizeData,V,pn),Yt=b.get("text-padding");ut=this.collisionIndex.placeCollisionCircles(y,Z,pn,y.lineVertexArray,y.glyphOffsetArray,vn,S,C,z,p,Q,$.predicate,fe.collisionCircleDiameter*vn/a.ONE_EM,Yt,this.retainedQueryData[y.bucketInstanceId].tileID),ve=Z||ut.circles.length>0&&!ut.collisionDetected,Ke=Ke&&ut.offscreen,qe=ut.occluded}if(De.iconFeatureIndex&&(nn=De.iconFeatureIndex),De.iconBox){const pn=vn=>{rn(vn);const Yt=se&&We?Sr(We.x,We.y,ie,Q,this.transform.angle):new a.pointGeometry(0,0),Pn=y.getSymbolInstanceIconSize(W,this.transform.zoom,fe.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(y,Pn,vn,Yt,ne,R,S,$.predicate)};wt&&wt.box&&wt.box.length&&De.verticalIconBox?(Xe=pn(De.verticalIconBox),pe=Xe.box.length>0):(Xe=pn(De.iconBox),pe=Xe.box.length>0),Ke=Ke&&Xe.offscreen,Ye=Xe.occluded}const Gn=j||fe.numHorizontalGlyphVertices===0&&fe.numVerticalGlyphVertices===0,mr=H||fe.numIconVertices===0;if(Gn||mr?mr?Gn||(pe=pe&&ve):ve=pe&&ve:pe=ve=pe&&ve,ve&&yt&&yt.box&&this.collisionIndex.insertCollisionBox(yt.box,b.get("text-ignore-placement"),y.bucketInstanceId,wt&&wt.box&&Dt?Dt:Mt,$.ID),pe&&Xe&&this.collisionIndex.insertCollisionBox(Xe.box,b.get("icon-ignore-placement"),y.bucketInstanceId,nn,$.ID),ut&&(ve&&this.collisionIndex.insertCollisionCircles(ut.circles,b.get("text-ignore-placement"),y.bucketInstanceId,Mt,$.ID),p)){const pn=y.bucketInstanceId;let vn=this.collisionCircleArrays[pn];vn===void 0&&(vn=this.collisionCircleArrays[pn]=new An);for(let Yt=0;Yt<ut.circles.length;Yt+=4)vn.circles.push(ut.circles[Yt+0]),vn.circles.push(ut.circles[Yt+1]),vn.circles.push(ut.circles[Yt+2]),vn.circles.push(ut.collisionDetected?1:0)}const Mi=y.projection.name!=="globe";Ce=Ce&&(Mi||!qe),Ee=Ee&&(Mi||!Ye),this.placements[fe.crossTileID]=new ir(ve||Ce,pe||Ee,Ke||y.justReloaded),l[fe.crossTileID]=!0};if(xe){const fe=y.getSortedSymbolIndexes(this.transform.angle);for(let Le=fe.length-1;Le>=0;--Le){const De=fe[Le];Ge(y.symbolInstances.get(De),De,y.collisionArrays[De])}}else for(let fe=r.symbolInstanceStart;fe<r.symbolInstanceEnd;fe++)Ge(y.symbolInstances.get(fe),fe,y.collisionArrays[fe]);if(p&&y.bucketInstanceId in this.collisionCircleArrays){const fe=this.collisionCircleArrays[y.bucketInstanceId];a.invert(fe.invProjMatrix,S),fe.viewportMatrix=this.collisionIndex.getViewportMatrix()}y.justReloaded=!1}markUsedJustification(r,l,p,_){let y;y=_===a.WritingMode.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[a.getAnchorJustification(l)];const b=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const S of b)S>=0&&(r.text.placedSymbolArray.get(S).crossTileID=y>=0&&S!==y?0:p.crossTileID)}markUsedOrientation(r,l,p){const _=l===a.WritingMode.horizontal||l===a.WritingMode.horizontalOnly?l:0,y=l===a.WritingMode.vertical?l:0,b=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex].filter(S=>S!==-1);for(const S of b)r.text.placedSymbolArray.get(S).placedOrientation=_;p.verticalPlacedTextSymbolIndex!==-1&&(r.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=y)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let p=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const _=l?l.symbolFadeChange(r):1,y=l?l.opacities:{},b=l?l.variableOffsets:{},S=l?l.placedOrientations:{};for(const C in this.placements){const z=this.placements[C],k=y[C];k?(this.opacities[C]=new jo(k,_,z.text,z.icon,null,z.clipped),p=p||z.text!==k.text.placed||z.icon!==k.icon.placed):(this.opacities[C]=new jo(null,_,z.text,z.icon,z.skipFade,z.clipped),p=p||z.text||z.icon)}for(const C in y){const z=y[C];if(!this.opacities[C]){const k=new jo(z,_,!1,!1);k.isHidden()||(this.opacities[C]=k,p=p||z.text.placed||z.icon.placed)}}for(const C in b)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=b[C]);for(const C in S)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=S[C]);p?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:r)}updateLayerOpacities(r,l){const p={};for(const _ of l){const y=_.getBucket(r);y&&_.latestFeatureIndex&&r.id===y.layerIds[0]&&this.updateBucketOpacities(y,p,_.collisionBoxArray)}}updateBucketOpacities(r,l,p){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const _=r.layers[0].layout,y=!!r.layers[0].dynamicFilter(),b=new jo(null,0,!1,!1,!0),S=_.get("text-allow-overlap"),C=_.get("icon-allow-overlap"),z=_.get("text-variable-anchor"),k=_.get("text-rotation-alignment")==="map",R=_.get("text-pitch-alignment")==="map",U=_.get("icon-text-fit")!=="none",q=new jo(null,0,S&&(C||!r.hasIconData()||_.get("icon-optional")),C&&(S||!r.hasTextData()||_.get("text-optional")),!0);!r.collisionArrays&&p&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(p);const V=($,j,H)=>{for(let Z=0;Z<j/4;Z++)$.opacityVertexArray.emplaceBack(H)};let W=0;for(let $=0;$<r.symbolInstances.length;$++){const j=r.symbolInstances.get($),{numHorizontalGlyphVertices:H,numVerticalGlyphVertices:Z,crossTileID:ne}=j;let ie=this.opacities[ne];l[ne]?ie=b:ie||(ie=q,this.opacities[ne]=ie),l[ne]=!0;const Q=H>0||Z>0,se=j.numIconVertices>0,xe=this.placedOrientations[j.crossTileID],Ce=xe===a.WritingMode.vertical,Ee=xe===a.WritingMode.horizontal||xe===a.WritingMode.horizontalOnly;if(!Q&&!se||ie.isHidden()||W++,Q){const Ge=wi(ie.text);V(r.text,H,Ce?yo:Ge),V(r.text,Z,Ee?yo:Ge);const fe=ie.text.isHidden();[j.rightJustifiedTextSymbolIndex,j.centerJustifiedTextSymbolIndex,j.leftJustifiedTextSymbolIndex].forEach(ve=>{ve>=0&&(r.text.placedSymbolArray.get(ve).hidden=fe||Ce?1:0)}),j.verticalPlacedTextSymbolIndex>=0&&(r.text.placedSymbolArray.get(j.verticalPlacedTextSymbolIndex).hidden=fe||Ee?1:0);const Le=this.variableOffsets[j.crossTileID];Le&&this.markUsedJustification(r,Le.anchor,j,xe);const De=this.placedOrientations[j.crossTileID];De&&(this.markUsedJustification(r,"left",j,De),this.markUsedOrientation(r,De,j))}if(se){const Ge=wi(ie.icon);j.placedIconSymbolIndex>=0&&(V(r.icon,j.numIconVertices,Ce?yo:Ge),r.icon.placedSymbolArray.get(j.placedIconSymbolIndex).hidden=ie.icon.isHidden()),j.verticalPlacedIconSymbolIndex>=0&&(V(r.icon,j.numVerticalIconVertices,Ee?yo:Ge),r.icon.placedSymbolArray.get(j.verticalPlacedIconSymbolIndex).hidden=ie.icon.isHidden())}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const Ge=r.collisionArrays[$];if(Ge){let fe=new a.pointGeometry(0,0),Le=!0;if(Ge.textBox||Ge.verticalTextBox){if(z){const ve=this.variableOffsets[ne];ve?(fe=fr(ve.anchor,ve.width,ve.height,ve.textOffset,ve.textScale),k&&fe._rotate(R?this.transform.angle:-this.transform.angle)):Le=!1}y&&(Le=!ie.clipped),Ge.textBox&&Vo(r.textCollisionBox.collisionVertexArray,ie.text.placed,!Le||Ce,fe.x,fe.y),Ge.verticalTextBox&&Vo(r.textCollisionBox.collisionVertexArray,ie.text.placed,!Le||Ee,fe.x,fe.y)}const De=Le&&Boolean(!Ee&&Ge.verticalIconBox);Ge.iconBox&&Vo(r.iconCollisionBox.collisionVertexArray,ie.icon.placed,De,U?fe.x:0,U?fe.y:0),Ge.verticalIconBox&&Vo(r.iconCollisionBox.collisionVertexArray,ie.icon.placed,!De,U?fe.x:0,U?fe.y:0)}}}if(r.fullyClipped=W===0,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const $=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=$.invProjMatrix,r.placementViewportMatrix=$.viewportMatrix,r.collisionCircleArray=$.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,l){const p=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*p>r}setStale(){this.stale=!0}}function Vo(u,r,l,p,_){u.emplaceBack(r?1:0,l?1:0,p||0,_||0),u.emplaceBack(r?1:0,l?1:0,p||0,_||0),u.emplaceBack(r?1:0,l?1:0,p||0,_||0),u.emplaceBack(r?1:0,l?1:0,p||0,_||0)}const Fn=Math.pow(2,25),ka=Math.pow(2,24),pu=Math.pow(2,17),Pa=Math.pow(2,16),Hn=Math.pow(2,9),fu=Math.pow(2,8),mu=Math.pow(2,1);function wi(u){if(u.opacity===0&&!u.placed)return 0;if(u.opacity===1&&u.placed)return 4294967295;const r=u.placed?1:0,l=Math.floor(127*u.opacity);return l*Fn+r*ka+l*pu+r*Pa+l*Hn+r*fu+l*mu+r}const yo=0;class zl{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&r.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(r,l,p,_,y){const b=this._bucketParts;for(;this._currentTileIndex<r.length;)if(l.getBucketParts(b,_,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort((S,C)=>S.sortKey-C.sortKey));this._currentPartIndex<b.length;){const S=b[this._currentPartIndex];if(l.placeLayerBucketPart(S,this._seenCrossTileIDs,p,S.symbolInstanceStart===0),this._currentPartIndex++,y())return!0}return!1}}class qm{constructor(r,l,p,_,y,b,S,C){this.placement=new Od(r,y,b,S,C),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(r,l,p){const _=a.exported.now(),y=()=>{const b=a.exported.now()-_;return!this._forceFullPlacement&&b>2};for(;this._currentPlacementIndex>=0;){const b=l[r[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(b.type==="symbol"&&(!b.minzoom||b.minzoom<=S)&&(!b.maxzoom||b.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new zl(b)),this._inProgressLayer.continuePlacement(p[b.source],this.placement,this._showCollisionBoxes,b,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const _u=512/a.EXTENT/2;class Ds{constructor(r,l,p){this.tileID=r,this.indexedSymbolInstances={},this.bucketInstanceId=p;for(let _=0;_<l.length;_++){const y=l.get(_),b=y.key;this.indexedSymbolInstances[b]||(this.indexedSymbolInstances[b]=[]),this.indexedSymbolInstances[b].push({crossTileID:y.crossTileID,coord:this.getScaledCoordinates(y,r)})}}getScaledCoordinates(r,l){const p=_u/Math.pow(2,l.canonical.z-this.tileID.canonical.z);return{x:Math.floor((l.canonical.x*a.EXTENT+r.tileAnchorX)*p),y:Math.floor((l.canonical.y*a.EXTENT+r.tileAnchorY)*p)}}findMatches(r,l,p){const _=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z);for(let y=0;y<r.length;y++){const b=r.get(y);if(b.crossTileID)continue;const S=this.indexedSymbolInstances[b.key];if(!S)continue;const C=this.getScaledCoordinates(b,l);for(const z of S)if(Math.abs(z.coord.x-C.x)<=_&&Math.abs(z.coord.y-C.y)<=_&&!p[z.crossTileID]){p[z.crossTileID]=!0,b.crossTileID=z.crossTileID;break}}}}class Wm{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Fd{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const l=Math.round((r-this.lng)/360);if(l!==0)for(const p in this.indexes){const _=this.indexes[p],y={};for(const b in _){const S=_[b];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+l),y[S.tileID.key]=S}this.indexes[p]=y}this.lng=r}addBucket(r,l,p){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let y=0;y<l.symbolInstances.length;y++)l.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]={});const _=this.usedCrossTileIDs[r.overscaledZ];for(const y in this.indexes){const b=this.indexes[y];if(Number(y)>r.overscaledZ)for(const S in b){const C=b[S];C.tileID.isChildOf(r)&&C.findMatches(l.symbolInstances,r,_)}else{const S=b[r.scaledTo(Number(y)).key];S&&S.findMatches(l.symbolInstances,r,_)}}for(let y=0;y<l.symbolInstances.length;y++){const b=l.symbolInstances.get(y);b.crossTileID||(b.crossTileID=p.generate(),_[b.crossTileID]=!0)}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new Ds(r,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(r,l){for(const p in l.indexedSymbolInstances)for(const _ of l.indexedSymbolInstances[p])delete this.usedCrossTileIDs[r][_.crossTileID]}removeStaleBuckets(r){let l=!1;for(const p in this.indexes){const _=this.indexes[p];for(const y in _)r[_[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,_[y]),delete _[y],l=!0)}return l}}class Go{constructor(){this.layerIndexes={},this.crossTileIDs=new Wm,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,l,p,_){let y=this.layerIndexes[r.id];y===void 0&&(y=this.layerIndexes[r.id]=new Fd);let b=!1;const S={};_.name!=="globe"&&y.handleWrapJump(p);for(const C of l){const z=C.getBucket(r);z&&r.id===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(C.tileID,z,this.crossTileIDs)&&(b=!0),S[z.bucketInstanceId]=!0)}return y.removeStaleBuckets(S)&&(b=!0),b}pruneUnusedLayers(r){const l={};r.forEach(p=>{l[p]=!0});for(const p in this.layerIndexes)l[p]||delete this.layerIndexes[p]}}const si=(u,r)=>a.emitValidationErrors(u,r&&r.filter(l=>l.identifier!=="source.canvas")),kl=a.pick(xt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),xo=a.pick(xt,["setCenter","setZoom","setBearing","setPitch"]),gu={version:8,layers:[],sources:{}},Pl={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class bi extends a.Evented{constructor(r,l={}){super(),this.map=r,this.dispatcher=new br(Tt(),this),this.imageManager=new hr,this.imageManager.setEventedParent(this),this.glyphManager=new a.GlyphManager(r._requestManager,l.localFontFamily?a.LocalGlyphMode.all:l.localIdeographFontFamily?a.LocalGlyphMode.ideographs:a.LocalGlyphMode.none,l.localFontFamily||l.localIdeographFontFamily),this.crossTileSymbolIndex=new Go,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new a.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",a.getReferrer());const p=this;this._rtlTextPluginCallback=bi.registerForPluginStateChange(_=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(y,b)=>{if(a.triggerPluginCompletionEvent(y),b&&b.every(S=>S))for(const S in p._sourceCaches){const C=p._sourceCaches[S],z=C.getSource().type;z!=="vector"&&z!=="geojson"||C.reload()}})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const y=this.getSource(_.sourceId);if(y&&y.vectorLayerIds)for(const b in this._layers){const S=this._layers[b];S.source===y.id&&this._validateLayer(S)}})}loadURL(r,l={}){this.fire(new a.Event("dataloading",{dataType:"style"}));const p=typeof l.validate=="boolean"?l.validate:!a.isMapboxURL(r);r=this.map._requestManager.normalizeStyleURL(r,l.accessToken);const _=this.map._requestManager.transformRequest(r,a.ResourceType.Style);this._request=a.getJSON(_,(y,b)=>{this._request=null,y?this.fire(new a.ErrorEvent(y)):b&&this._load(b,p)})}loadJSON(r,l={}){this.fire(new a.Event("dataloading",{dataType:"style"})),this._request=a.exported.frame(()=>{this._request=null,this._load(r,l.validate!==!1)})}loadEmpty(){this.fire(new a.Event("dataloading",{dataType:"style"})),this._load(gu,!1)}_updateLayerCount(r,l){const p=l?1:-1;r.is3D()&&(this._num3DLayers+=p),r.type==="circle"&&(this._numCircleLayers+=p),r.type==="symbol"&&(this._numSymbolLayers+=p)}_load(r,l){if(l&&si(this,a.validateStyle(r)))return;this._loaded=!0,this.stylesheet=a.clone$1(r),this._updateMapProjection();for(const _ in r.sources)this.addSource(_,r.sources[_],{validate:!1});this._changed=!1,r.sprite?this._loadSprite(r.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(r.glyphs);const p=qt(this.stylesheet.layers);this._order=p.map(_=>_.id),this._layers={},this._serializedLayers={};for(let _ of p)_=a.createStyleLayer(_),_.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=_,this._serializedLayers[_.id]=_.serialize(),this._updateLayerCount(_,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new ao(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new a.Event("data",{dataType:"style"})),this.fire(new a.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(r){this._spriteRequest=function(l,p,_){let y,b,S;const C=a.exported.devicePixelRatio>1?"@2x":"";let z=a.getJSON(p.transformRequest(p.normalizeSpriteURL(l,C,".json"),a.ResourceType.SpriteJSON),(U,q)=>{z=null,S||(S=U,y=q,R())}),k=a.getImage(p.transformRequest(p.normalizeSpriteURL(l,C,".png"),a.ResourceType.SpriteImage),(U,q)=>{k=null,S||(S=U,b=q,R())});function R(){if(S)_(S);else if(y&&b){const U=a.exported.getImageData(b),q={};for(const V in y){const{width:W,height:$,x:j,y:H,sdf:Z,pixelRatio:ne,stretchX:ie,stretchY:Q,content:se}=y[V],xe=new a.RGBAImage({width:W,height:$});a.RGBAImage.copy(U,xe,{x:j,y:H},{x:0,y:0},{width:W,height:$}),q[V]={data:xe,pixelRatio:ne,sdf:Z,stretchX:ie,stretchY:Q,content:se}}_(null,q)}}return{cancel(){z&&(z.cancel(),z=null),k&&(k.cancel(),k=null)}}}(r,this.map._requestManager,(l,p)=>{if(this._spriteRequest=null,l)this.fire(new a.ErrorEvent(l));else if(p)for(const _ in p)this.imageManager.addImage(_,p[_]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new a.Event("data",{dataType:"style"}))})}_validateLayer(r){const l=this.getSource(r.source);if(!l)return;const p=r.sourceLayer;p&&(l.type==="geojson"||l.vectorLayerIds&&l.vectorLayerIds.indexOf(p)===-1)&&this.fire(new a.ErrorEvent(new Error(`Source layer "${p}" does not exist on source "${l.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(r){const l=[];for(const p of r){const _=this._layers[p];_.type!=="custom"&&l.push(_.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(r){return!!this.terrain&&Pl[r.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(r){if(!this._loaded)return;const l=this._changed;if(this._changed){const _=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(_.length||y.length)&&this._updateWorkerLayers(_,y);for(const b in this._updatedSources){const S=this._updatedSources[b];S==="reload"?this._reloadSource(b):S==="clear"&&this._clearSource(b)}this._updateTilesForChangedImages();for(const b in this._updatedPaintProps)this._layers[b].updateTransitions(r);this.light.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this._resetUpdates()}const p={};for(const _ in this._sourceCaches){const y=this._sourceCaches[_];p[_]=y.used,y.used=!1}for(const _ of this._order){const y=this._layers[_];if(y.recalculate(r,this._availableImages),!y.isHidden(r.zoom)){const S=this._getLayerSourceCache(y);S&&(S.used=!0)}const b=this.map.painter;if(b){const S=y.getProgramIds();if(!S)continue;const C=y.getProgramConfiguration(r.zoom);for(const z of S)b.useProgram(z,C)}}for(const _ in p){const y=this._sourceCaches[_];p[_]!==y.used&&y.getSource().fire(new a.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:y.getSource().id}))}this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),l&&this.fire(new a.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const l in this._sourceCaches)this._sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateWorkerLayers(r,l){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(r),removedIds:l})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(r){if(this._checkLoaded(),si(this,a.validateStyle(r)))return!1;(r=a.clone$1(r)).layers=qt(r.layers);const l=function(_,y){if(!_)return[{command:xt.setStyle,args:[y]}];let b=[];try{if(!B(_.version,y.version))return[{command:xt.setStyle,args:[y]}];B(_.center,y.center)||b.push({command:xt.setCenter,args:[y.center]}),B(_.zoom,y.zoom)||b.push({command:xt.setZoom,args:[y.zoom]}),B(_.bearing,y.bearing)||b.push({command:xt.setBearing,args:[y.bearing]}),B(_.pitch,y.pitch)||b.push({command:xt.setPitch,args:[y.pitch]}),B(_.sprite,y.sprite)||b.push({command:xt.setSprite,args:[y.sprite]}),B(_.glyphs,y.glyphs)||b.push({command:xt.setGlyphs,args:[y.glyphs]}),B(_.transition,y.transition)||b.push({command:xt.setTransition,args:[y.transition]}),B(_.light,y.light)||b.push({command:xt.setLight,args:[y.light]}),B(_.fog,y.fog)||b.push({command:xt.setFog,args:[y.fog]}),B(_.projection,y.projection)||b.push({command:xt.setProjection,args:[y.projection]});const S={},C=[];(function(R,U,q,V){let W;for(W in U=U||{},R=R||{})R.hasOwnProperty(W)&&(U.hasOwnProperty(W)||tn(W,q,V));for(W in U)U.hasOwnProperty(W)&&(R.hasOwnProperty(W)?B(R[W],U[W])||(R[W].type==="geojson"&&U[W].type==="geojson"&&Ni(R,U,W)?q.push({command:xt.setGeoJSONSourceData,args:[W,U[W].data]}):_o(W,U,q,V)):en(W,U,q))})(_.sources,y.sources,C,S);const z=[];_.layers&&_.layers.forEach(R=>{R.source&&S[R.source]?b.push({command:xt.removeLayer,args:[R.id]}):z.push(R)});let k=_.terrain;k&&S[k.source]&&(b.push({command:xt.setTerrain,args:[void 0]}),k=void 0),b=b.concat(C),B(k,y.terrain)||b.push({command:xt.setTerrain,args:[y.terrain]}),function(R,U,q){U=U||[];const V=(R=R||[]).map(ji),W=U.map(ji),$=R.reduce(kn,{}),j=U.reduce(kn,{}),H=V.slice(),Z=Object.create(null);let ne,ie,Q,se,xe,Ce,Ee;for(ne=0,ie=0;ne<V.length;ne++)Q=V[ne],j.hasOwnProperty(Q)?ie++:(q.push({command:xt.removeLayer,args:[Q]}),H.splice(H.indexOf(Q,ie),1));for(ne=0,ie=0;ne<W.length;ne++)Q=W[W.length-1-ne],H[H.length-1-ne]!==Q&&($.hasOwnProperty(Q)?(q.push({command:xt.removeLayer,args:[Q]}),H.splice(H.lastIndexOf(Q,H.length-ie),1)):ie++,Ce=H[H.length-ne],q.push({command:xt.addLayer,args:[j[Q],Ce]}),H.splice(H.length-ne,0,Q),Z[Q]=!0);for(ne=0;ne<W.length;ne++)if(Q=W[ne],se=$[Q],xe=j[Q],!Z[Q]&&!B(se,xe))if(B(se.source,xe.source)&&B(se["source-layer"],xe["source-layer"])&&B(se.type,xe.type)){for(Ee in ze(se.layout,xe.layout,q,Q,null,xt.setLayoutProperty),ze(se.paint,xe.paint,q,Q,null,xt.setPaintProperty),B(se.filter,xe.filter)||q.push({command:xt.setFilter,args:[Q,xe.filter]}),B(se.minzoom,xe.minzoom)&&B(se.maxzoom,xe.maxzoom)||q.push({command:xt.setLayerZoomRange,args:[Q,xe.minzoom,xe.maxzoom]}),se)se.hasOwnProperty(Ee)&&Ee!=="layout"&&Ee!=="paint"&&Ee!=="filter"&&Ee!=="metadata"&&Ee!=="minzoom"&&Ee!=="maxzoom"&&(Ee.indexOf("paint.")===0?ze(se[Ee],xe[Ee],q,Q,Ee.slice(6),xt.setPaintProperty):B(se[Ee],xe[Ee])||q.push({command:xt.setLayerProperty,args:[Q,Ee,xe[Ee]]}));for(Ee in xe)xe.hasOwnProperty(Ee)&&!se.hasOwnProperty(Ee)&&Ee!=="layout"&&Ee!=="paint"&&Ee!=="filter"&&Ee!=="metadata"&&Ee!=="minzoom"&&Ee!=="maxzoom"&&(Ee.indexOf("paint.")===0?ze(se[Ee],xe[Ee],q,Q,Ee.slice(6),xt.setPaintProperty):B(se[Ee],xe[Ee])||q.push({command:xt.setLayerProperty,args:[Q,Ee,xe[Ee]]}))}else q.push({command:xt.removeLayer,args:[Q]}),Ce=H[H.lastIndexOf(Q)+1],q.push({command:xt.addLayer,args:[xe,Ce]})}(z,y.layers,b)}catch(S){console.warn("Unable to compute style diff:",S),b=[{command:xt.setStyle,args:[y]}]}return b}(this.serialize(),r).filter(_=>!(_.command in xo));if(l.length===0)return!1;const p=l.filter(_=>!(_.command in kl));if(p.length>0)throw new Error(`Unimplemented: ${p.map(_=>_.command).join(", ")}.`);return l.forEach(_=>{_.command!=="setTransition"&&_.command!=="setProjection"&&this[_.command].apply(this,_.args)}),this.stylesheet=r,this._updateMapProjection(),!0}addImage(r,l){return this.getImage(r)?this.fire(new a.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(r,l),this._afterImageUpdated(r),this)}updateImage(r,l){this.imageManager.updateImage(r,l)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r),this._afterImageUpdated(r),this):this.fire(new a.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(r,l,p={}){if(this._checkLoaded(),this.getSource(r)!==void 0)throw new Error("There is already a source with this ID");if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(a.validateSource,`sources.${r}`,l,null,p))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const _=_e(r,l,this.dispatcher,this);_.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(r),source:_.serialize(),sourceId:r}));const y=b=>{const S=(b?"symbol:":"other:")+r,C=this._sourceCaches[S]=new a.SourceCache(S,_,b);(b?this._symbolSourceCaches:this._otherSourceCaches)[r]=C,C.style=this,C.onAdd(this.map)};y(!1),l.type!=="vector"&&l.type!=="geojson"||y(!0),_.onAdd&&_.onAdd(this.map),this._changed=!0}removeSource(r){this._checkLoaded();const l=this.getSource(r);if(!l)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===r)return this.fire(new a.ErrorEvent(new Error(`Source "${r}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.get().source===r)return this.fire(new a.ErrorEvent(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));const p=this._getSourceCaches(r);for(const _ of p)delete this._sourceCaches[_.id],delete this._updatedSources[_.id],_.fire(new a.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles();return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(r,l){this._checkLoaded(),this.getSource(r).setData(l),this._changed=!0}getSource(r){const l=this._getSourceCache(r);return l&&l.getSource()}_getSources(){const r=[];for(const l in this._otherSourceCaches){const p=this._getSourceCache(l);p&&r.push(p.getSource())}return r}addLayer(r,l,p={}){this._checkLoaded();const _=r.id;if(this.getLayer(_))return void this.fire(new a.ErrorEvent(new Error(`Layer with id "${_}" already exists on this map`)));let y;if(r.type==="custom"){if(si(this,a.validateCustomStyleLayer(r)))return;y=a.createStyleLayer(r)}else{if(typeof r.source=="object"&&(this.addSource(_,r.source),r=a.clone$1(r),r=a.extend(r,{source:_})),this._validate(a.validateLayer,`layers.${_}`,r,{arrayIndex:-1},p))return;y=a.createStyleLayer(r),this._validateLayer(y),y.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[y.id]=y.serialize(),this._updateLayerCount(y,!0)}const b=l?this._order.indexOf(l):this._order.length;if(l&&b===-1)return void this.fire(new a.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`)));this._order.splice(b,0,_),this._layerOrderChanged=!0,this._layers[_]=y;const S=this._getLayerSourceCache(y);if(this._removedLayers[_]&&y.source&&S&&y.type!=="custom"){const C=this._removedLayers[_];delete this._removedLayers[_],C.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",S.pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(r,l){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new a.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===l)return;const p=this._order.indexOf(r);this._order.splice(p,1);const _=l?this._order.indexOf(l):this._order.length;l&&_===-1?this.fire(new a.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`))):(this._order.splice(_,0,r),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(r){this._checkLoaded();const l=this._layers[r];if(!l)return void this.fire(new a.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be removed.`)));l.setEventedParent(null),this._updateLayerCount(l,!1);const p=this._order.indexOf(r);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=l,delete this._layers[r],delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],l.onRemove&&l.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(r){return this._layers[r]}hasLayer(r){return r in this._layers}hasLayerType(r){for(const l in this._layers)if(this._layers[l].type===r)return!0;return!1}setLayerZoomRange(r,l,p){this._checkLoaded();const _=this.getLayer(r);_?_.minzoom===l&&_.maxzoom===p||(l!=null&&(_.minzoom=l),p!=null&&(_.maxzoom=p),this._updateLayer(_)):this.fire(new a.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(r,l,p={}){this._checkLoaded();const _=this.getLayer(r);if(_){if(!B(_.filter,l))return l==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(a.validateFilter,`layers.${_.id}.filter`,l,{layerType:_.type},p)||(_.filter=a.clone$1(l),this._updateLayer(_)))}else this.fire(new a.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be filtered.`)))}getFilter(r){const l=this.getLayer(r);return l&&a.clone$1(l.filter)}setLayoutProperty(r,l,p,_={}){this._checkLoaded();const y=this.getLayer(r);y?B(y.getLayoutProperty(l),p)||(y.setLayoutProperty(l,p,_),this._updateLayer(y)):this.fire(new a.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(r,l){const p=this.getLayer(r);if(p)return p.getLayoutProperty(l);this.fire(new a.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style.`)))}setPaintProperty(r,l,p,_={}){this._checkLoaded();const y=this.getLayer(r);y?B(y.getPaintProperty(l),p)||(y.setPaintProperty(l,p,_)&&this._updateLayer(y),this._changed=!0,this._updatedPaintProps[r]=!0):this.fire(new a.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(r,l){const p=this.getLayer(r);return p&&p.getPaintProperty(l)}setFeatureState(r,l){this._checkLoaded();const p=r.source,_=r.sourceLayer,y=this.getSource(p);if(!y)return void this.fire(new a.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const b=y.type;if(b==="geojson"&&_)return void this.fire(new a.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(b==="vector"&&!_)return void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));r.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided.")));const S=this._getSourceCaches(p);for(const C of S)C.setFeatureState(_,r.id,l)}removeFeatureState(r,l){this._checkLoaded();const p=r.source,_=this.getSource(p);if(!_)return void this.fire(new a.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const y=_.type,b=y==="vector"?r.sourceLayer:void 0;if(y==="vector"&&!b)return void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&typeof r.id!="string"&&typeof r.id!="number")return void this.fire(new a.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const S=this._getSourceCaches(p);for(const C of S)C.removeFeatureState(b,r.id,l)}getFeatureState(r){this._checkLoaded();const l=r.source,p=r.sourceLayer,_=this.getSource(l);if(_){if(_.type!=="vector"||p)return r.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(l)[0].getFeatureState(p,r.id);this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new a.ErrorEvent(new Error(`The source '${l}' does not exist in the map's style.`)))}getTransition(){return a.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const r={};for(const l in this._sourceCaches){const p=this._sourceCaches[l].getSource();r[p.id]||(r[p.id]=p.serialize())}return a.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:r,layers:this._serializeLayers(this._order)},l=>l!==void 0)}_updateLayer(r){this._updatedLayers[r.id]=!0;const l=this._getLayerSourceCache(r);r.source&&!this._updatedSources[r.source]&&l&&l.getSource().type!=="raster"&&(this._updatedSources[r.source]="reload",l.pause()),this._changed=!0,r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const l=b=>this._layers[b].type==="fill-extrusion",p={},_=[];for(let b=this._order.length-1;b>=0;b--){const S=this._order[b];if(l(S)){p[S]=b;for(const C of r){const z=C[S];if(z)for(const k of z)_.push(k)}}}_.sort((b,S)=>S.intersectionZ-b.intersectionZ);const y=[];for(let b=this._order.length-1;b>=0;b--){const S=this._order[b];if(l(S))for(let C=_.length-1;C>=0;C--){const z=_[C].feature;if(p[z.layer.id]<b)break;y.push(z),_.pop()}else for(const C of r){const z=C[S];if(z)for(const k of z)y.push(k.feature)}}return y}queryRenderedFeatures(r,l,p){l&&l.filter&&this._validate(a.validateFilter,"queryRenderedFeatures.filter",l.filter,null,l);const _={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new a.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const C of l.layers){const z=this._layers[C];if(!z)return this.fire(new a.ErrorEvent(new Error(`The layer '${C}' does not exist in the map's style and cannot be queried for features.`))),[];_[z.source]=!0}}const y=[];l.availableImages=this._availableImages;const b=l&&l.layers?l.layers.some(C=>{const z=this.getLayer(C);return z&&z.is3D()}):this.has3DLayers(),S=ti.createFromScreenPoints(r,p);for(const C in this._sourceCaches){const z=this._sourceCaches[C].getSource().id;l.layers&&!_[z]||y.push(we(this._sourceCaches[C],this._layers,this._serializedLayers,S,l,p,b,!!this.map._showQueryGeometry))}return this.placement&&y.push(function(C,z,k,R,U,q,V){const W={},$=q.queryRenderedSymbols(R),j=[];for(const H of Object.keys($).map(Number))j.push(V[H]);j.sort(tt);for(const H of j){const Z=H.featureIndex.lookupSymbolFeatures($[H.bucketInstanceId],z,H.bucketIndex,H.sourceLayerIndex,U.filter,U.layers,U.availableImages,C);for(const ne in Z){const ie=W[ne]=W[ne]||[],Q=Z[ne];Q.sort((se,xe)=>{const Ce=H.featureSortOrder;if(Ce){const Ee=Ce.indexOf(se.featureIndex);return Ce.indexOf(xe.featureIndex)-Ee}return xe.featureIndex-se.featureIndex});for(const se of Q)ie.push(se)}}for(const H in W)W[H].forEach(Z=>{const ne=Z.feature,ie=k(C[H]).getFeatureState(ne.layer["source-layer"],ne.id);ne.source=ne.layer.source,ne.layer["source-layer"]&&(ne.sourceLayer=ne.layer["source-layer"]),ne.state=ie});return W}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),S.screenGeometry,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(r,l){l&&l.filter&&this._validate(a.validateFilter,"querySourceFeatures.filter",l.filter,null,l);const p=this._getSourceCaches(r);let _=[];for(const y of p)_=_.concat(Oe(y,l));return _}addSourceType(r,l,p){return bi.getSourceType(r)?p(new Error(`A source type called "${r}" already exists.`)):(bi.setSourceType(r,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:l.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(r,l={}){this._checkLoaded();const p=this.light.getLight();let _=!1;for(const b in r)if(!B(r[b],p[b])){_=!0;break}if(!_)return;const y=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(r,l),this.light.updateTransitions(y)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(r,l=1){if(this._checkLoaded(),!r)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(l===1){if(typeof r.source=="object"){const p="terrain-dem-src";this.addSource(p,r.source),r=a.clone$1(r),r=a.extend(r,{source:p})}if(this._validate(a.validateTerrain,"terrain",r))return}if(!this.terrain||this.terrain&&l!==this.terrain.drapeRenderMode)this._createTerrain(r,l);else{const p=this.terrain,_=p.get();for(const y of Object.keys(a.spec.terrain))!r.hasOwnProperty(y)&&a.spec.terrain[y].default&&(r[y]=a.spec.terrain[y].default);for(const y in r)if(!B(r[y],_[y])){p.set(r),this.stylesheet.terrain=r;const b=this._setTransitionParameters({duration:0});p.updateTransitions(b);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const l=this.fog=new bn(r,this.map.transform);this.stylesheet.fog=r;const p=this._setTransitionParameters({duration:0});l.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const l=this.fog,p=l.get();Object.keys(r).length===0&&l.set(r);for(const _ in r)if(!B(r[_],p[_])){l.set(r),this.stylesheet.fog=r;const y=this._setTransitionParameters({duration:0});l.updateTransitions(y);break}}else this._createFog(r);this._markersNeedUpdate=!0}_setTransitionParameters(r){return{now:a.exported.now(),transition:a.extend(r,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const r=this._order.filter(p=>this.isLayerDraped(this._layers[p])),l=this._order.filter(p=>!this.isLayerDraped(this._layers[p]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...l)}_createTerrain(r,l){const p=this.terrain=new ei(r,l);this.stylesheet.terrain=r,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const _=this._setTransitionParameters({duration:0});p.updateTransitions(_)}_force3DLayerUpdate(){for(const r in this._layers){const l=this._layers[r];l.type==="fill-extrusion"&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const l=this._layers[r];l.type==="symbol"&&this._updateLayer(l)}}_validate(r,l,p,_,y={}){return(!y||y.validate!==!1)&&si(this,r.call(a.validateStyle,a.extend({key:l,style:this.serialize(),value:p,styleSpec:a.spec},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this._sourceCaches)this._sourceCaches[r].clearTiles(),this._sourceCaches[r].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(r){const l=this._getSourceCaches(r);for(const p of l)p.clearTiles()}_reloadSource(r){const l=this._getSourceCaches(r);for(const p of l)p.resume(),p.reload()}_reloadSources(){for(const r of this._getSources())r.reload&&r.reload()}_updateSources(r){for(const l in this._sourceCaches)this._sourceCaches[l].update(r)}_generateCollisionBoxes(){for(const r in this._sourceCaches){const l=this._sourceCaches[r];l.resume(),l.reload()}}_updatePlacement(r,l,p,_,y=!1){let b=!1,S=!1;const C={};for(const z of this._order){const k=this._layers[z];if(k.type!=="symbol")continue;if(!C[k.source]){const U=this._getLayerSourceCache(k);if(!U)continue;C[k.source]=U.getRenderableIds(!0).map(q=>U.getTileByID(q)).sort((q,V)=>V.tileID.overscaledZ-q.tileID.overscaledZ||(q.tileID.isLessThan(V.tileID)?-1:1))}const R=this.crossTileSymbolIndex.addLayer(k,C[k.source],r.center.lng,r.projection);b=b||R}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),y=y||this._layerOrderChanged||p===0,this._layerOrderChanged&&this.fire(new a.Event("neworder")),(y||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.exported.now(),r.zoom))&&(this.pauseablePlacement=new qm(r,this._order,y,l,p,_,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,C),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.exported.now()),S=!0),b&&this.pauseablePlacement.placement.setStale()),S||b)for(const z of this._order){const k=this._layers[z];k.type==="symbol"&&this.placement.updateLayerOpacities(k,C[k.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.exported.now())}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,l,p){this.imageManager.getImages(l.icons,p),this._updateTilesForChangedImages();const _=y=>{y&&y.setDependencies(l.tileID.key,l.type,l.icons)};_(this._otherSourceCaches[l.source]),_(this._symbolSourceCaches[l.source])}getGlyphs(r,l,p){this.glyphManager.getGlyphs(l.stacks,p)}getResource(r,l,p){return a.makeRequest(l,p)}_getSourceCache(r){return this._otherSourceCaches[r]}_getLayerSourceCache(r){return r.type==="symbol"?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}_getSourceCaches(r){const l=[];return this._otherSourceCaches[r]&&l.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&l.push(this._symbolSourceCaches[r]),l}_isSourceCacheLoaded(r){const l=this._getSourceCaches(r);return l.length===0?(this.fire(new a.ErrorEvent(new Error(`There is no source with ID '${r}'`))),!1):l.every(p=>p.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}bi.getSourceType=function(u){return ge[u]},bi.setSourceType=function(u,r){ge[u]=r},bi.registerForPluginStateChange=a.registerForPluginStateChange;var Ud=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,Dl="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Nd=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,yu=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,jd=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let xu={},vu={};const $o=[];Ti(Ud,$o),Ti(Nd,$o),Ti(yu,$o),Ti(jd,$o),xu=Wt("",Nd),vu=Wt(jd,yu);const wu=Wt(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),bu=Ud,Ll=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var Tu={background:Wt(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Wt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Wt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Wt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Wt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Wt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Wt("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Wt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Wt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Wt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Wt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Wt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Wt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Wt(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);float roof_radiance=clamp(u_lightpos.z,0.0,1.0);roof_radiance=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roof_radiance);v_roof_color.rgb+=clamp(color.rgb*roof_radiance*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Wt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Wt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Wt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Wt(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
#ifdef RENDER_LINE_GRADIENT
highp vec4 out_color=texture2D(u_gradient_image,v_uv.xy);
#else
vec4 out_color=color;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Wt(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Wt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Wt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:Wt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:Wt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:Wt(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:Wt(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Wt(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Dl),skyboxGradient:Wt(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Dl),skyboxCapture:Wt(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Wt(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;
#ifdef GLOBE_POLES
vec3 up_vector=normalize(globe_pos)*u_tile_up_scale;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Wt(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function Ti(u,r){const l=u.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let p of l)if(p=p.trim(),p[0]==="#"&&p.includes("if")&&!p.includes("endif")){p=p.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const _=p.split(" ");for(const y of _)r.includes(y)||r.push(y)}}function Wt(u,r){const l=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=r.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),_={},y=[...$o];return Ti(u,y),Ti(r,y),{fragmentSource:u=u.replace(l,(b,S,C,z,k)=>(_[k]=!0,S==="define"?`
#ifndef HAS_UNIFORM_u_${k}
varying ${C} ${z} ${k};
#else
uniform ${C} ${z} u_${k};
#endif
`:`
#ifdef HAS_UNIFORM_u_${k}
    ${C} ${z} ${k} = u_${k};
#endif
`)),vertexSource:r=r.replace(l,(b,S,C,z,k)=>{const R=z==="float"?"vec2":"vec4",U=k.match(/color/)?"color":R;return _[k]?S==="define"?`
#ifndef HAS_UNIFORM_u_${k}
uniform lowp float u_${k}_t;
attribute ${C} ${R} a_${k};
varying ${C} ${z} ${k};
#else
uniform ${C} ${z} u_${k};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${k}
    ${k} = a_${k};
#else
    ${C} ${z} ${k} = u_${k};
#endif
`:`
#ifndef HAS_UNIFORM_u_${k}
    ${k} = unpack_mix_${U}(a_${k}, u_${k}_t);
#else
    ${C} ${z} ${k} = u_${k};
#endif
`:S==="define"?`
#ifndef HAS_UNIFORM_u_${k}
uniform lowp float u_${k}_t;
attribute ${C} ${R} a_${k};
#else
uniform ${C} ${z} u_${k};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${k}
    ${C} ${z} ${k} = a_${k};
#else
    ${C} ${z} ${k} = u_${k};
#endif
`:`
#ifndef HAS_UNIFORM_u_${k}
    ${C} ${z} ${k} = unpack_mix_${U}(a_${k}, u_${k}_t);
#else
    ${C} ${z} ${k} = u_${k};
#endif
`}),staticAttributes:p,usedDefines:y}}class Da{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,l,p,_,y,b,S){this.context=r;let C=this.boundPaintVertexBuffers.length!==_.length;for(let k=0;!C&&k<_.length;k++)this.boundPaintVertexBuffers[k]!==_[k]&&(C=!0);let z=this.boundDynamicVertexBuffers.length!==S.length;for(let k=0;!z&&k<S.length;k++)this.boundDynamicVertexBuffers[k]!==S[k]&&(z=!0);if(!r.extVertexArrayObject||!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==p||C||z||this.boundIndexBuffer!==y||this.boundVertexOffset!==b)this.freshBind(l,p,_,y,b,S);else{r.bindVertexArrayOES.set(this.vao);for(const k of S)k&&k.bind();y&&y.dynamicDraw&&y.bind()}}freshBind(r,l,p,_,y,b){let S;const C=r.numAttributes,z=this.context,k=z.gl;if(z.extVertexArrayObject)this.vao&&this.destroy(),this.vao=z.extVertexArrayObject.createVertexArrayOES(),z.bindVertexArrayOES.set(this.vao),S=0,this.boundProgram=r,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=_,this.boundVertexOffset=y,this.boundDynamicVertexBuffers=b;else{S=z.currentNumAttributes||0;for(let R=C;R<S;R++)k.disableVertexAttribArray(R)}l.enableAttributes(k,r),l.bind(),l.setVertexAttribPointers(k,r,y);for(const R of p)R.enableAttributes(k,r),R.bind(),R.setVertexAttribPointers(k,r,y);for(const R of b)R&&(R.enableAttributes(k,r),R.bind(),R.setVertexAttribPointers(k,r,y));_&&_.bind(),z.currentNumAttributes=C}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Rl(u,r){const l=Math.pow(2,r.canonical.z),p=r.canonical.y;return[new a.MercatorCoordinate(0,p/l).toLngLat().lat,new a.MercatorCoordinate(0,(p+1)/l).toLngLat().lat]}function Bl(u,r,l,p,_,y,b){const S=u.context,C=S.gl,z=l.fbo;if(!z)return;u.prepareDrawTile();const k=u.useProgram("hillshade");S.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,z.colorAttachment.get());const R=((W,$,j,H)=>{const Z=j.paint.get("hillshade-shadow-color"),ne=j.paint.get("hillshade-highlight-color"),ie=j.paint.get("hillshade-accent-color");let Q=j.paint.get("hillshade-illumination-direction")*(Math.PI/180);j.paint.get("hillshade-illumination-anchor")==="viewport"&&(Q-=W.transform.angle);const se=!W.options.moving;return{u_matrix:H||W.transform.calculateProjMatrix($.tileID.toUnwrapped(),se),u_image:0,u_latrange:Rl(0,$.tileID),u_light:[j.paint.get("hillshade-exaggeration"),Q],u_shadow:Z,u_highlight:ne,u_accent:ie}})(u,l,p,u.terrain?r.projMatrix:null);u.prepareDrawProgram(S,k,r.toUnwrapped());const{tileBoundsBuffer:U,tileBoundsIndexBuffer:q,tileBoundsSegments:V}=u.getTileBoundsBuffers(l);k.draw(S,C.TRIANGLES,_,y,b,a.CullFaceMode.disabled,R,p.id,U,q,V)}function Ol(u,r,l){if(!r.needsDEMTextureUpload)return;const p=u.context,_=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||u.getTileTexture(l.stride);const y=l.getPixels();r.demTexture?r.demTexture.update(y,{premultiply:!1}):r.demTexture=new a.Texture(p,y,_.RGBA,{premultiply:!1}),r.needsDEMTextureUpload=!1}function Vd(u,r,l,p,_,y){const b=u.context,S=b.gl;if(!r.dem)return;const C=r.dem;if(b.activeTexture.set(S.TEXTURE1),Ol(u,r,C),!r.demTexture)return;r.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);const z=C.dim;b.activeTexture.set(S.TEXTURE0);let k=r.fbo;if(!k){const V=new a.Texture(b,{width:z,height:z,data:null},S.RGBA);V.bind(S.LINEAR,S.CLAMP_TO_EDGE),k=r.fbo=b.createFramebuffer(z,z,!0),k.colorAttachment.set(V.texture)}b.bindFramebuffer.set(k.framebuffer),b.viewport.set([0,0,z,z]);const{tileBoundsBuffer:R,tileBoundsIndexBuffer:U,tileBoundsSegments:q}=u.getMercatorTileBoundsBuffers();u.useProgram("hillshadePrepare").draw(b,S.TRIANGLES,p,_,y,a.CullFaceMode.disabled,((V,W)=>{const $=W.stride,j=a.create();return a.ortho(j,0,a.EXTENT,-a.EXTENT,0,0,1),a.translate(j,j,[0,-a.EXTENT,0]),{u_matrix:j,u_image:1,u_dimension:[$,$],u_zoom:V.overscaledZ,u_unpack:W.unpackVector}})(r.tileID,C),l.id,R,U,q),r.needsHillshadePrepare=!1}const Fl=u=>({u_matrix:new a.UniformMatrix4f(u),u_image0:new a.Uniform1i(u),u_skirt_height:new a.Uniform1f(u)}),Eu=(u,r)=>({u_matrix:u,u_image0:0,u_skirt_height:r}),Ul=(u,r,l,p,_,y,b,S,C,z,k,R,U,q)=>({u_proj_matrix:Float32Array.from(u),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:l,u_zoom_transition:_,u_merc_center:y,u_image0:0,u_frustum_tl:b,u_frustum_tr:S,u_frustum_br:C,u_frustum_bl:z,u_globe_pos:k,u_globe_radius:R,u_viewport:U,u_grid_matrix:q?Float32Array.from(q):new Float32Array(9)});function La(u,r){return u!=null&&r!=null&&!(!u.hasData()||!r.hasData())&&u.demTexture!=null&&r.demTexture!=null&&u.tileID.key!==r.tileID.key}const vo=new class{constructor(){this.operations={}}newMorphing(u,r,l,p,_){if(u in this.operations){const y=this.operations[u];y.to.tileID.key!==l.tileID.key&&(y.queued=l)}else this.operations[u]={startTime:p,phase:0,duration:_,from:r,to:l,queued:null}}getMorphValuesForProxy(u){if(!(u in this.operations))return null;const r=this.operations[u];return{from:r.from,to:r.to,phase:r.phase}}update(u){for(const r in this.operations){const l=this.operations[r];for(l.phase=(u-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,u)){delete this.operations[r];break}}}_nextOp(u,r){return!!u.queued&&(u.from=u.to,u.to=u.queued,u.queued=null,u.phase=0,u.startTime=r,!0)}_validOp(u){return u.from.hasData()&&u.to.hasData()}},Ls={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Gt(u,r){const l=1<<u.z;return!r&&(u.x===0||u.x===l-1)||u.y===0||u.y===l-1}const Rs=u=>({u_matrix:u});function Su(u,r,l,p,_){if(_>0){const y=a.exported.now(),b=(y-u.timeAdded)/_,S=r?(y-r.timeAdded)/_:-1,C=l.getSource(),z=p.coveringZoomLevel({tileSize:C.tileSize,roundZoom:C.roundZoom}),k=!r||Math.abs(r.tileID.overscaledZ-z)>Math.abs(u.tileID.overscaledZ-z),R=k&&u.refreshedUponExpiration?1:a.clamp(k?b:1-S,0,1);return u.refreshedUponExpiration&&b>=1&&(u.refreshedUponExpiration=!1),r?{opacity:1,mix:1-R}:{opacity:R,mix:0}}return{opacity:1,mix:0}}class Gd extends a.SourceCache{constructor(r){const l={type:"raster-dem",maxzoom:r.transform.maxZoom},p=new br(Tt(),null),_=_e("mock-dem",l,p,r.style);super("mock-dem",_,!1),_.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,l){r.state="loaded",l(null)}}class $d extends a.SourceCache{constructor(r){const l=_e("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new br(Tt(),null),r.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,l,p){if(r.freezeTileCoverage)return;this.transform=r;const _=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((y,b)=>{if(y[b.key]="",!this._tiles[b.key]){const S=new a.Tile(b,this._source.tileSize*b.overscaleFactor(),r.tileZoom);S.state="loaded",this._tiles[b.key]=S}return y},{});for(const y in this._tiles)y in _||(this.freeFBO(y),this._tiles[y].unloadVectorData(),delete this._tiles[y])}freeFBO(r){const l=this.proxyCachedFBO[r];if(l!==void 0){const p=Object.values(l);this.renderCachePool.push(...p),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Nl extends a.OverscaledTileID{constructor(r,l,p){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=l,this.projMatrix=p}}class Zd extends a.Elevation{constructor(r,l){super(),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,_,y]=function(C){const z=new a.StructArrayLayout4i8,k=new a.StructArrayLayout3ui6,R=131;z.reserve(17161),k.reserve(33800);const U=a.EXTENT/128,q=a.EXTENT+U/2,V=q+U;for(let $=-U;$<V;$+=U)for(let j=-U;j<V;j+=U){const H=j<0||j>q||$<0||$>q?24575:0,Z=a.clamp(Math.round(j),0,a.EXTENT),ne=a.clamp(Math.round($),0,a.EXTENT);z.emplaceBack(Z+H,ne,Z,ne)}const W=($,j)=>{const H=j*R+$;k.emplaceBack(H+1,H,H+R),k.emplaceBack(H+R,H+R+1,H+1)};for(let $=1;$<129;$++)for(let j=1;j<129;j++)W(j,$);return[0,129].forEach($=>{for(let j=0;j<130;j++)W(j,$),W($,j)}),[z,k,32768]}(),b=r.context;this.gridBuffer=b.createVertexBuffer(p,a.boundsAttributes.members),this.gridIndexBuffer=b.createIndexBuffer(_),this.gridSegments=a.SegmentVector.simpleSegment(0,0,p.length,_.length),this.gridNoSkirtSegments=a.SegmentVector.simpleSegment(0,0,p.length,y),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new $d(l.map),this.orthoMatrix=a.create(),a.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,a.EXTENT,0,a.EXTENT,0,1);const S=b.gl;this._overlapStencilMode=new a.StencilMode({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Gd(l.map)}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),r.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=r,this._checkRenderCacheEfficiency()}update(r,l,p){if(r&&r.terrain){this._style!==r&&(this.style=r),this.enabled=!0;const _=r.terrain.properties;this.sourceCache=r.terrain.drapeRenderMode===0?this._mockSourceCache:r._getSourceCache(_.get("source")),this._exaggeration=_.get("exaggeration");const y=()=>{this.sourceCache.used&&a.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const b=this.getScaledDemTileSize();this.sourceCache.update(l,b,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,y(),this._initializing=!0),y(),l.updateElevation(!p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const r=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||r.efficiency!==100&&a.warnOnce(`Terrain render cache efficiency is not optimal (${r.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${r.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(r){r.coord&&r.dataType==="source"?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):r.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._sourceCaches)this._style._sourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const l=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const _=this.proxyCoords=l.getIds().map(C=>{const z=l.getTileByID(C).tileID;return z.projMatrix=p.calculateProjMatrix(z.toUnwrapped()),z});(function(C,z){const k=z.transform.pointCoordinate(z.transform.getCameraPoint()),R=new a.pointGeometry(k.x,k.y);C.sort((U,q)=>{if(q.overscaledZ-U.overscaledZ)return q.overscaledZ-U.overscaledZ;const V=new a.pointGeometry(U.canonical.x+(1<<U.canonical.z)*U.wrap,U.canonical.y),W=new a.pointGeometry(q.canonical.x+(1<<q.canonical.z)*q.wrap,q.canonical.y),$=R.mult(1<<U.canonical.z);return $.x-=.5,$.y-=.5,$.distSqr(V)-$.distSqr(W)})})(_,this.painter),this._previousZoom=p.zoom;const y=this.proxyToSource||{};this.proxyToSource={},_.forEach(C=>{this.proxyToSource[C.key]={}}),this.terrainTileForTile={};const b=this._style._sourceCaches;for(const C in b){const z=b[C];if(!z.used||(z!==this.sourceCache&&this.resetTileLookupCache(z.id),this._setupProxiedCoordsForOrtho(z,r[C],y),z.usedForTerrain))continue;const k=r[C];z.getSource().reparseOverscaled&&this._assignTerrainTiles(k)}this.proxiedCoords[l.id]=_.map(C=>new Nl(C,C.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(y),this.renderingToTexture=!1,this._updateTimestamp=a.exported.now();const S={};this._visibleDemTiles=[];for(const C of this.proxyCoords){const z=this.terrainTileForTile[C.key];if(!z)continue;const k=z.tileID.key;k in S||(this._visibleDemTiles.push(z),S[k]=k)}}_assignTerrainTiles(r){this._initializing||r.forEach(l=>{if(this.terrainTileForTile[l.key])return;const p=this._findTileCoveringTileID(l,this.sourceCache);p&&(this.terrainTileForTile[l.key]=p)})}_prepareDEMTextures(){const r=this.painter.context,l=r.gl;for(const p in this.terrainTileForTile){const _=this.terrainTileForTile[p],y=_.dem;!y||_.demTexture&&!_.needsDEMTextureUpload||(r.activeTexture.set(l.TEXTURE1),Ol(this.painter,_,y))}}_prepareDemTileUniforms(r,l,p,_){if(!l||l.demTexture==null)return!1;const y=r.tileID.canonical,b=Math.pow(2,l.tileID.canonical.z-y.z),S=_||"";return p[`u_dem_tl${S}`]=[y.x*b%1,y.y*b%1],p[`u_dem_scale${S}`]=b,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const r=this.painter.context,l=r.gl;if(!this._emptyDepthBufferTexture){const p=new a.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new a.Texture(r,p,l.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let r=0;const l=this._visibleDemTiles.reduce((p,_)=>{if(!_.dem)return p;const y=_.dem.tree.minimums[0];return y>0&&r++,p+y},0);return r?l/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,l=r.gl;r.activeTexture.set(l.TEXTURE2);const p=this._getLoadedAreaMinimum(),_=new a.RGBAImage({width:1,height:1},new Uint8Array(a.DEMData.pack(p,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let y=this._emptyDEMTexture;return y?y.update(_,{premultiply:!1}):y=this._emptyDEMTexture=new a.Texture(r,_,l.RGBA,{premultiply:!1}),y}setupElevationDraw(r,l,p){const _=this.painter.context,y=_.gl,b=(S=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:a.DEMData.getUnpackVector(S),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var S;b.u_dem_size=this.sourceCache.getSource().tileSize,b.u_exaggeration=this.exaggeration();let C=null,z=null,k=1;if(p&&p.morphing&&this._useVertexMorphing){const R=p.morphing.srcDemTile,U=p.morphing.dstDemTile;k=p.morphing.phase,R&&U&&(this._prepareDemTileUniforms(r,R,b,"_prev")&&(z=R),this._prepareDemTileUniforms(r,U,b)&&(C=U))}if(z&&C?(_.activeTexture.set(y.TEXTURE2),C.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE,y.NEAREST),_.activeTexture.set(y.TEXTURE4),z.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE,y.NEAREST),b.u_dem_lerp=k):(C=this.terrainTileForTile[r.tileID.key],_.activeTexture.set(y.TEXTURE2),(this._prepareDemTileUniforms(r,C,b)?C.demTexture:this.emptyDEMTexture).bind(y.NEAREST,y.CLAMP_TO_EDGE)),_.activeTexture.set(y.TEXTURE3),p&&p.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),this._depthFBO&&(b.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),b.u_depth_size_inv=[1,1]),p&&p.useMeterToDem&&C){const R=(1<<C.tileID.canonical.z)*a.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;b.u_meter_to_dem=R}if(p&&p.labelPlaneMatrixInv&&(b.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),l.setTerrainUniformValues(_,b),this.painter.transform.projection.name==="globe"){const R=this.globeUniformValues(this.painter.transform,r.tileID.canonical,p&&p.useDenormalizedUpVectorScale);l.setGlobeUniformValues(_,R)}}globeUniformValues(r,l,p){const _=r.projection;return{u_tile_tl_up:_.upVector(l,0,0),u_tile_tr_up:_.upVector(l,a.EXTENT,0),u_tile_br_up:_.upVector(l,a.EXTENT,a.EXTENT),u_tile_bl_up:_.upVector(l,0,a.EXTENT),u_tile_up_scale:p?a.GLOBE_METERS_TO_ECEF:_.upVectorScale(l,r.center.lat,r.worldSize).metersToTile}}renderToBackBuffer(r){const l=this.painter,p=this.painter.context;r.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),l.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(_,y,b,S,C){if(_.transform.projection.name==="globe")(function(z,k,R,U,q){const V=z.context,W=V.gl;let $,j;const H=z.options.showTerrainWireframe?2:0,Z=z.transform,ne=a.globeUseCustomAntiAliasing(z,V,Z),ie=(ve,pe)=>{if(j===ve)return;const Ke=[Ls[ve],"PROJECTION_GLOBE_VIEW"];ne&&Ke.push("CUSTOM_ANTIALIASING"),pe&&Ke.push(Ls[H]),$=z.useProgram("globeRaster",null,Ke),j=ve},Q=z.colorModeForRenderPass(),se=new a.DepthMode(W.LEQUAL,a.DepthMode.ReadWrite,z.depthRangeFor3D);vo.update(q);const xe=a.calculateGlobeMercatorMatrix(Z),Ce=[a.mercatorXfromLng(Z.center.lng),a.mercatorYfromLat(Z.center.lat)],Ee=H?[!1,!0]:[!1],Ge=z.globeSharedBuffers,fe=[Z.width*a.exported.devicePixelRatio,Z.height*a.exported.devicePixelRatio],Le=Float32Array.from(Z.globeMatrix),De={useDenormalizedUpVectorScale:!0};if(Ee.forEach(ve=>{j=-1;const pe=ve?W.LINES:W.TRIANGLES;for(const Ke of U){const qe=R.getTile(Ke),Ye=a.StencilMode.disabled,We=k.prevTerrainTileForTile[Ke.key],at=k.terrainTileForTile[Ke.key];La(We,at)&&vo.newMorphing(Ke.key,We,at,q,250),V.activeTexture.set(W.TEXTURE0),qe.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE);const wt=vo.getMorphValuesForProxy(Ke.key),yt=wt?1:0;wt&&a.extend$1(De,{morphing:{srcDemTile:wt.from,dstDemTile:wt.to,phase:a.easeCubicInOut(wt.phase)}});const ut=a.tileCornersToBounds(Ke.canonical),Xe=a.getLatitudinalLod(ut.getCenter().lat),Mt=a.getGridMatrix(Ke.canonical,ut,Xe,Z.worldSize/Z._pixelsPerMercatorPixel),Dt=a.globeNormalizeECEF(a.globeTileBounds(Ke.canonical)),nn=Ul(Z.projMatrix,Le,xe,Dt,a.globeToMercatorTransition(Z.zoom),Ce,Z.frustumCorners.TL,Z.frustumCorners.TR,Z.frustumCorners.BR,Z.frustumCorners.BL,Z.globeCenterInViewSpace,Z.globeRadius,fe,Mt);if(ie(yt,ve),k.setupElevationDraw(qe,$,De),z.prepareDrawProgram(V,$,Ke.toUnwrapped()),Ge){const[rn,Jt,Gn]=ve?Ge.getWirefameBuffers(z.context,Xe):Ge.getGridBuffers(Xe);$.draw(V,pe,se,Ye,Q,a.CullFaceMode.backCCW,nn,"globe_raster",rn,Jt,Gn)}}}),Ge){const ve=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ne&&ve.push("CUSTOM_ANTIALIASING"),$=z.useProgram("globeRaster",null,ve);for(const pe of U){const{x:Ke,y:qe,z:Ye}=pe.canonical,We=qe===0,at=qe===(1<<Ye)-1,[wt,yt,ut,Xe]=Ge.getPoleBuffers(Ye);if(Xe&&(We||at)){const Mt=R.getTile(pe);V.activeTexture.set(W.TEXTURE0),Mt.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE);let Dt=a.globePoleMatrixForTile(Ye,Ke,Z);const nn=a.globeNormalizeECEF(a.globeTileBounds(pe.canonical)),rn=(Jt,Gn)=>Jt.draw(V,W.TRIANGLES,se,a.StencilMode.disabled,Q,a.CullFaceMode.disabled,Ul(Z.projMatrix,Dt,Dt,nn,0,Ce,Z.frustumCorners.TL,Z.frustumCorners.TR,Z.frustumCorners.BR,Z.frustumCorners.BL,Z.globeCenterInViewSpace,Z.globeRadius,fe),"globe_pole_raster",Gn,ut,Xe);k.setupElevationDraw(Mt,$,De),z.prepareDrawProgram(V,$,pe.toUnwrapped()),We&&rn($,wt),at&&(Dt=a.scale(a.create(),Dt,[1,-1,1]),rn($,yt))}}}})(_,y,b,S,C);else{const z=_.context,k=z.gl;let R,U;const q=_.options.showTerrainWireframe?2:0,V=(Z,ne)=>{if(U===Z)return;const ie=[Ls[Z]];ne&&ie.push(Ls[q]),R=_.useProgram("terrainRaster",null,ie),U=Z},W=_.colorModeForRenderPass(),$=new a.DepthMode(k.LEQUAL,a.DepthMode.ReadWrite,_.depthRangeFor3D);vo.update(C);const j=_.transform,H=6*Math.pow(1.5,22-j.zoom)*y.exaggeration();(q?[!1,!0]:[!1]).forEach(Z=>{U=-1;const ne=Z?k.LINES:k.TRIANGLES,[ie,Q]=Z?y.getWirefameBuffer():[y.gridIndexBuffer,y.gridSegments];for(const se of S){const xe=b.getTile(se),Ce=a.StencilMode.disabled,Ee=y.prevTerrainTileForTile[se.key],Ge=y.terrainTileForTile[se.key];La(Ee,Ge)&&vo.newMorphing(se.key,Ee,Ge,C,250),z.activeTexture.set(k.TEXTURE0),xe.texture.bind(k.LINEAR,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST);const fe=vo.getMorphValuesForProxy(se.key),Le=fe?1:0;let De;fe&&(De={morphing:{srcDemTile:fe.from,dstDemTile:fe.to,phase:a.easeCubicInOut(fe.phase)}});const ve=Eu(se.projMatrix,Gt(se.canonical,j.renderWorldCopies)?H/10:H);V(Le,Z),y.setupElevationDraw(xe,R,De),_.prepareDrawProgram(z,R,se.toUnwrapped()),R.draw(z,ne,$,Ce,W,a.CullFaceMode.backCCW,ve,"terrain_raster",y.gridBuffer,ie,Q)}})}}(l,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,l.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(this._drapedRenderBatches.length===0)return r+1;this.renderingToTexture=!0;const l=this.painter,p=this.painter.context,_=this.proxySourceCache,y=this.proxiedCoords[_.id],b=this._drapedRenderBatches.shift(),S=[],C=l.style.order;let z=0;for(const k of y){const R=_.getTileByID(k.proxyTileKey),U=_.proxyCachedFBO[k.key]?_.proxyCachedFBO[k.key][r]:void 0,q=U!==void 0?_.renderCache[U]:this.pool[z++],V=U!==void 0;if(R.texture=q.tex,V&&!q.dirty){S.push(R.tileID);continue}let W;p.bindFramebuffer.set(q.fb.framebuffer),this.renderedToTile=!1,q.dirty&&(p.clear({color:a.Color.transparent,stencil:0}),q.dirty=!1);for(let $=b.start;$<=b.end;++$){const j=l.style._layers[C[$]];if(j.isHidden(l.transform.zoom))continue;const H=l.style._getLayerSourceCache(j),Z=H?this.proxyToSource[k.key][H.id]:[k];if(!Z)continue;const ne=Z;p.viewport.set([0,0,q.fb.width,q.fb.height]),W!==(H?H.id:null)&&(this._setupStencil(q,Z,j,H),W=H?H.id:null),l.renderLayer(l,H,j,ne)}this.renderedToTile?(q.dirty=!0,S.push(R.tileID)):V||--z,z===5&&(z=0,this.renderToBackBuffer(S))}return this.renderToBackBuffer(S),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),b.end+1}postRender(){}renderCacheEfficiency(r){const l=r.order.length;if(l===0)return{efficiency:100};let p,_=0,y=0,b=!1;for(let S=0;S<l;++S){const C=r._layers[r.order[S]];this._style.isLayerDraped(C)?(b&&++_,++y):b||(b=!0,p=C.id)}return y===0?{efficiency:100}:{efficiency:100*(1-_/y),firstUndrapedLayer:p}}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{r=Math.min(r,l.dem.tree.minimums[0])}),r===0?r:(r-30)*this._exaggeration}raycast(r,l,p){if(!this._visibleDemTiles)return null;const _=this._visibleDemTiles.filter(y=>y.dem).map(y=>{const b=y.tileID,S=1<<b.overscaledZ,{x:C,y:z}=b.canonical,k=C/S,R=(C+1)/S,U=z/S,q=(z+1)/S;return{minx:k,miny:U,maxx:R,maxy:q,t:y.dem.tree.raycastRoot(k,U,R,q,r,l,p),tile:y}});_.sort((y,b)=>(y.t!==null?y.t:Number.MAX_VALUE)-(b.t!==null?b.t:Number.MAX_VALUE));for(const y of _){if(y.t==null)return null;const b=y.tile.dem.tree.raycast(y.minx,y.miny,y.maxx,y.maxy,r,l,p);if(b!=null)return b}return null}_createFBO(){const r=this.painter.context,l=r.gl,p=this.drapeBufferSize;r.activeTexture.set(l.TEXTURE0);const _=new a.Texture(r,{width:p[0],height:p[1],data:null},l.RGBA);_.bind(l.LINEAR,l.CLAMP_TO_EDGE);const y=r.createFramebuffer(p[0],p[1],!1);return y.colorAttachment.set(_.texture),y.depthAttachment=new No(r,y.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,y.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):y.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&!r.extTextureFilterAnisotropicForceOff&&l.texParameterf(l.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:y,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const r in this._style._sourceCaches)if(this._style._sourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const l=this._style._layers[r],p=l.isHidden(this.painter.transform.zoom),_=l.getCrossfadeParameters(),y=!!_&&_.t!==1,b=l.hasTransition();return l.type!=="custom"&&!p&&(y||b)})}_clearRasterFadeFromRenderCache(){let r=!1;for(const l in this._style._sourceCaches)if(this._style._sourceCaches[l]._source instanceof F){r=!0;break}if(r)for(let l=0;l<this._style.order.length;++l){const p=this._style._layers[this._style.order[l]],_=p.isHidden(this.painter.transform.zoom),y=this._style._getLayerSourceCache(p);if(p.type!=="raster"||_||!y)continue;const b=p.paint.get("raster-fade-duration");for(const S of this.proxyCoords){const C=this.proxyToSource[S.key][y.id];if(C)for(const z of C){const k=Su(y.getTile(z),y.findLoadedParent(z,0),y,this.painter.transform,b);(k.opacity!==1||k.mix!==0)&&this._clearRenderCacheForTile(y.id,z)}}}}_setupDrapedRenderBatches(){const r=this._style.order,l=r.length;if(l===0)return;const p=[];let _,y=0,b=this._style._layers[r[y]];for(;!this._style.isLayerDraped(b)&&b.isHidden(this.painter.transform.zoom)&&++y<l;)b=this._style._layers[r[y]];for(;y<l;++y){const S=this._style._layers[r[y]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?_===void 0&&(_=y):_!==void 0&&(p.push({start:_,end:y-1}),_=void 0))}_!==void 0&&p.push({start:_,end:y-1}),this._drapedRenderBatches=p}_setupRenderCache(r){const l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){const b=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let S=0;S<b.length;++S){const C=Object.values(b[S]);l.renderCachePool.push(...C)}}return}this._clearRasterFadeFromRenderCache();const p=this.proxyCoords,_=this._tilesDirty;for(let b=p.length-1;b>=0;b--){const S=p[b];if(l.getTileByID(S.key),l.proxyCachedFBO[S.key]!==void 0){const C=r[S.key],z=this.proxyToSource[S.key];let k=0;for(const R in z){const U=z[R],q=C[R];if(!q||q.length!==U.length||U.some((V,W)=>V!==q[W]||_[R]&&_[R].hasOwnProperty(V.key))){k=-1;break}++k}for(const R in l.proxyCachedFBO[S.key])l.renderCache[l.proxyCachedFBO[S.key][R]].dirty=k<0||k!==Object.values(C).length}}const y=[...this._drapedRenderBatches];y.sort((b,S)=>S.end-S.start-(b.end-b.start));for(const b of y)for(const S of p){if(l.proxyCachedFBO[S.key])continue;let C=l.renderCachePool.pop();C===void 0&&l.renderCache.length<50&&(C=l.renderCache.length,l.renderCache.push(this._createFBO())),C!==void 0&&(l.proxyCachedFBO[S.key]={},l.proxyCachedFBO[S.key][b.start]=C,l.renderCache[C].dirty=!0)}this._tilesDirty={}}_setupStencil(r,l,p,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const y=this.painter.context,b=y.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let S;if(p.isTileClipped())S=l.length,this._overlapStencilMode.test={func:b.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:b.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(y.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):a.StencilMode.disabled}_renderTileClippingMasks(r,l){const p=this.painter,_=this.painter.context,y=_.gl;p._tileClippingMaskIDs={},_.setColorMode(a.ColorMode.disabled),_.setDepthMode(a.DepthMode.disabled);const b=p.useProgram("clippingMask");for(const S of r){const C=p._tileClippingMaskIDs[S.key]=--l;b.draw(_,y.TRIANGLES,a.DepthMode.disabled,new a.StencilMode({func:y.ALWAYS,mask:0},C,255,y.KEEP,y.KEEP,y.REPLACE),a.ColorMode.disabled,a.CullFaceMode.disabled,Rs(S.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(r){const l=this.painter.transform;if(r.x<0||r.x>l.width||r.y<0||r.y>l.height)return null;const p=[r.x,r.y,1,1];a.transformMat4$1(p,p,l.pixelMatrixInverse),a.scale$1(p,p,1/p[3]),p[0]/=l.worldSize,p[1]/=l.worldSize;const _=l._camera.position,y=a.mercatorZfromAltitude(1,l.center.lat),b=[_[0],_[1],_[2]/y,0],S=a.subtract([],p.slice(0,3),b);a.normalize(S,S);const C=this.raycast(b,S,this._exaggeration);return C!==null&&C?(a.scaleAndAdd(b,b,S,C),b[3]=b[2],b[2]*=y,b):null}drawDepth(){const r=this.painter,l=r.context,p=this.proxySourceCache,_=Math.ceil(r.width),y=Math.ceil(r.height);if(!this._depthFBO||this._depthFBO.width===_&&this._depthFBO.height===y||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const b=l.gl,S=l.createFramebuffer(_,y,!0);l.activeTexture.set(b.TEXTURE0);const C=new a.Texture(l,{width:_,height:y,data:null},b.RGBA);C.bind(b.NEAREST,b.CLAMP_TO_EDGE),S.colorAttachment.set(C.texture);const z=l.createRenderbuffer(l.gl.DEPTH_COMPONENT16,_,y);S.depthAttachment.set(z),this._depthFBO=S,this._depthTexture=C}l.bindFramebuffer.set(this._depthFBO.framebuffer),l.viewport.set([0,0,_,y]),function(b,S,C,z){if(b.transform.projection.name==="globe")return;const k=b.context,R=k.gl;k.clear({depth:1});const U=b.useProgram("terrainDepth"),q=new a.DepthMode(R.LESS,a.DepthMode.ReadWrite,b.depthRangeFor3D);for(const V of z){const W=C.getTile(V),$=Eu(V.projMatrix,0);S.setupElevationDraw(W,U),U.draw(k,R.TRIANGLES,q,a.StencilMode.disabled,a.ColorMode.unblended,a.CullFaceMode.backCCW,$,"terrain_depth",S.gridBuffer,S.gridIndexBuffer,S.gridNoSkirtSegments)}}(r,this,p,this.proxyCoords)}_setupProxiedCoordsForOrtho(r,l,p){if(r.getSource()instanceof ae)return this._setupProxiedCoordsForImageSource(r,l,p);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const _=this.proxiedCoords[r.id]=[],y=this.proxyCoords;for(let S=0;S<y.length;S++){const C=y[S],z=this._findTileCoveringTileID(C,r);if(z){const k=this._createProxiedId(C,z,p[C.key]&&p[C.key][r.id]);_.push(k),this.proxyToSource[C.key][r.id]=[k]}}let b=!1;for(let S=0;S<l.length;S++){const C=r.getTile(l[S]);if(!C||!C.hasData())continue;const z=this._findTileCoveringTileID(C.tileID,this.proxySourceCache);if(z&&z.tileID.canonical.z!==C.tileID.canonical.z){const k=this.proxyToSource[z.tileID.key][r.id],R=this._createProxiedId(z.tileID,C,p[z.tileID.key]&&p[z.tileID.key][r.id]);k?k.splice(k.length-1,0,R):this.proxyToSource[z.tileID.key][r.id]=[R],_.push(R),b=!0}}this._sourceTilesOverlap[r.id]=b}_setupProxiedCoordsForImageSource(r,l,p){if(!r.getSource().loaded())return;const _=this.proxiedCoords[r.id]=[],y=this.proxyCoords,b=r.getSource(),S=new a.pointGeometry(b.tileID.x,b.tileID.y)._div(1<<b.tileID.z),C=b.coordinates.map(a.MercatorCoordinate.fromLngLat).reduce((k,R)=>(k.min.x=Math.min(k.min.x,R.x-S.x),k.min.y=Math.min(k.min.y,R.y-S.y),k.max.x=Math.max(k.max.x,R.x-S.x),k.max.y=Math.max(k.max.y,R.y-S.y),k),{min:new a.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new a.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),z=(k,R)=>{const U=k.wrap+k.canonical.x/(1<<k.canonical.z),q=k.canonical.y/(1<<k.canonical.z),V=a.EXTENT/(1<<k.canonical.z),W=R.wrap+R.canonical.x/(1<<R.canonical.z),$=R.canonical.y/(1<<R.canonical.z);return U+V<W+C.min.x||U>W+C.max.x||q+V<$+C.min.y||q>$+C.max.y};for(let k=0;k<y.length;k++){const R=y[k];for(let U=0;U<l.length;U++){const q=r.getTile(l[U]);if(!q||!q.hasData()||z(R,q.tileID))continue;const V=this._createProxiedId(R,q,p[R.key]&&p[R.key][r.id]),W=this.proxyToSource[R.key][r.id];W?W.push(V):this.proxyToSource[R.key][r.id]=[V],_.push(V)}}}_createProxiedId(r,l,p){let _=this.orthoMatrix;if(p){const y=p.find(b=>b.key===l.tileID.key);if(y)return y}if(l.tileID.key!==r.key){const y=r.canonical.z-l.tileID.canonical.z;let b,S,C;_=a.create();const z=l.tileID.wrap-r.wrap<<r.overscaledZ;y>0?(b=a.EXTENT>>y,S=b*((l.tileID.canonical.x<<y)-r.canonical.x+z),C=b*((l.tileID.canonical.y<<y)-r.canonical.y)):(b=a.EXTENT<<-y,S=a.EXTENT*(l.tileID.canonical.x-(r.canonical.x+z<<-y)),C=a.EXTENT*(l.tileID.canonical.y-(r.canonical.y<<-y))),a.ortho(_,0,b,0,b,0,1),a.translate(_,_,[S,C,0])}return new Nl(l.tileID,r.key,_)}_findTileCoveringTileID(r,l){let p=l.getTile(r);if(p&&p.hasData())return p;const _=this._findCoveringTileCache[l.id],y=_[r.key];if(p=y?l.getTileByID(y):null,p&&p.hasData()||y===null)return p;let b=p?p.tileID:r,S=b.overscaledZ;const C=l.getSource().minzoom,z=[];if(!y){const R=l.getSource().maxzoom;if(r.canonical.z>=R){const U=r.canonical.z-R;l.getSource().reparseOverscaled?(S=Math.max(r.canonical.z+2,l.transform.tileZoom),b=new a.OverscaledTileID(S,r.wrap,R,r.canonical.x>>U,r.canonical.y>>U)):U!==0&&(S=R,b=new a.OverscaledTileID(S,r.wrap,R,r.canonical.x>>U,r.canonical.y>>U))}b.key!==r.key&&(z.push(b.key),p=l.getTile(b))}const k=R=>{z.forEach(U=>{_[U]=R}),z.length=0};for(S-=1;S>=C&&(!p||!p.hasData());S--){p&&k(p.tileID.key);const R=b.calculateScaledKey(S);if(p=l.getTileByID(R),p&&p.hasData())break;const U=_[R];if(U===null)break;U===void 0?z.push(R):p=l.getTileByID(U)}return k(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,l){let p=this._tilesDirty[r];p||(p=this._tilesDirty[r]={}),p[l.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const r=function(l){let p=0;const _=new a.StructArrayLayout2ui4,y=131;for(let b=1;b<129;b++){for(let S=1;S<129;S++)p=b*y+S,_.emplaceBack(p,p+1),_.emplaceBack(p,p+y),_.emplaceBack(p+1,p+y),b===128&&_.emplaceBack(p+y,p+y+1);_.emplaceBack(p+1,p+1+y)}return _}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(r),this.wireframeSegments=a.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,r.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class qd{static cacheKey(r,l,p,_){let y=`${l}${_?_.cacheKey:""}`;for(const b of p)r.usedDefines.includes(b)&&(y+=`/${b}`);return y}constructor(r,l,p,_,y,b){const S=r.gl;this.program=S.createProgram();const C=function($){const j=[];for(let H=0;H<$.length;H++){if($[H]===null)continue;const Z=$[H].split(" ");j.push(Z.pop())}return j}(p.staticAttributes),z=_?_.getBinderAttributes():[],k=C.concat(z);let R=_?_.defines():[];R=R.concat(b.map($=>`#define ${$}`));const U=R.concat(r.extStandardDerivatives?`#extension GL_OES_standard_derivatives : enable
`.concat(Ll):Ll,Ll,bu,wu.fragmentSource,vu.fragmentSource,p.fragmentSource).join(`
`),q=R.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,bu,wu.vertexSource,vu.vertexSource,xu.vertexSource,p.vertexSource).join(`
`),V=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(V,U),S.compileShader(V),S.attachShader(this.program,V);const W=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())this.failedToCreate=!0;else{S.shaderSource(W,q),S.compileShader(W),S.attachShader(this.program,W),this.attributes={},this.numAttributes=k.length;for(let $=0;$<this.numAttributes;$++)k[$]&&(S.bindAttribLocation(this.program,$,k[$]),this.attributes[k[$]]=$);S.linkProgram(this.program),S.deleteShader(W),S.deleteShader(V),this.fixedUniforms=y(r),this.binderUniforms=_?_.getUniforms(r):[],b.includes("TERRAIN")&&(this.terrainUniforms=($=>({u_dem:new a.Uniform1i($),u_dem_prev:new a.Uniform1i($),u_dem_unpack:new a.Uniform4f($),u_dem_tl:new a.Uniform2f($),u_dem_scale:new a.Uniform1f($),u_dem_tl_prev:new a.Uniform2f($),u_dem_scale_prev:new a.Uniform1f($),u_dem_size:new a.Uniform1f($),u_dem_lerp:new a.Uniform1f($),u_exaggeration:new a.Uniform1f($),u_depth:new a.Uniform1i($),u_depth_size_inv:new a.Uniform2f($),u_meter_to_dem:new a.Uniform1f($),u_label_plane_matrix_inv:new a.UniformMatrix4f($)}))(r)),b.includes("GLOBE")&&(this.globeUniforms=($=>({u_tile_tl_up:new a.Uniform3f($),u_tile_tr_up:new a.Uniform3f($),u_tile_br_up:new a.Uniform3f($),u_tile_bl_up:new a.Uniform3f($),u_tile_up_scale:new a.Uniform1f($)}))(r)),b.includes("FOG")&&(this.fogUniforms=($=>({u_fog_matrix:new a.UniformMatrix4f($),u_fog_range:new a.Uniform2f($),u_fog_color:new a.Uniform4f($),u_fog_horizon_blend:new a.Uniform1f($),u_fog_temporal_offset:new a.Uniform1f($),u_frustum_tl:new a.Uniform3f($),u_frustum_tr:new a.Uniform3f($),u_frustum_br:new a.Uniform3f($),u_frustum_bl:new a.Uniform3f($),u_globe_pos:new a.Uniform3f($),u_globe_radius:new a.Uniform1f($),u_globe_transition:new a.Uniform1f($),u_is_globe:new a.Uniform1i($),u_viewport:new a.Uniform2f($)}))(r))}}setTerrainUniformValues(r,l){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in l)p[_]&&p[_].set(this.program,_,l[_])}}setGlobeUniformValues(r,l){if(!this.globeUniforms)return;const p=this.globeUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in l)p[_]&&p[_].set(this.program,_,l[_])}}setFogUniformValues(r,l){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in l)p[_].set(this.program,_,l[_])}}draw(r,l,p,_,y,b,S,C,z,k,R,U,q,V,W){const $=r.gl;if(this.failedToCreate)return;r.program.set(this.program),r.setDepthMode(p),r.setStencilMode(_),r.setColorMode(y),r.setCullFace(b);for(const H of Object.keys(this.fixedUniforms))this.fixedUniforms[H].set(this.program,H,S[H]);V&&V.setUniforms(this.program,r,this.binderUniforms,U,{zoom:q});const j={[$.LINES]:2,[$.TRIANGLES]:3,[$.LINE_STRIP]:1}[l];for(const H of R.get()){const Z=H.vaos||(H.vaos={});(Z[C]||(Z[C]=new Da)).bind(r,this,z,V?V.getPaintVertexBuffers():[],k,H.vertexOffset,W||[]),$.drawElements(l,H.primitiveLength*j,$.UNSIGNED_SHORT,H.primitiveOffset*j*2)}}}function Wd(u,r,l){const p=1/qn(l,1,r.transform.tileZoom),_=Math.pow(2,l.tileID.overscaledZ),y=l.tileSize*Math.pow(2,r.transform.tileZoom)/_,b=y*(l.tileID.canonical.x+l.tileID.wrap*_),S=y*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture.size,u_scale:[p,u.fromScale,u.toScale],u_fade:u.t,u_pixel_coord_upper:[b>>16,S>>16],u_pixel_coord_lower:[65535&b,65535&S]}}const Cu=a.create(),jl=(u,r,l,p,_,y,b,S,C,z,k)=>{const R=r.style.light,U=R.properties.get("position"),q=[U.x,U.y,U.z],V=a.create$1();R.properties.get("anchor")==="viewport"&&(a.fromRotation(V,-r.transform.angle),a.transformMat3(q,q,V));const W=R.properties.get("color"),$=r.transform,j={u_matrix:u,u_lightpos:q,u_lightintensity:R.properties.get("intensity"),u_lightcolor:[W.r,W.g,W.b],u_vertical_gradient:+l,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Cu,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:_,u_edge_radius:y};return $.projection.name==="globe"&&(j.u_tile_id=[b.canonical.x,b.canonical.y,1<<b.canonical.z],j.u_zoom_transition=C,j.u_inv_rot_matrix=k,j.u_merc_center=z,j.u_up_dir=$.projection.upVector(new a.CanonicalTileID(0,0,0),z[0]*a.EXTENT,z[1]*a.EXTENT),j.u_height_lift=S),j},Mu=(u,r,l,p,_,y,b,S,C,z,k,R,U)=>{const q=jl(u,r,l,p,_,y,b,z,k,R,U),V={u_height_factor:-Math.pow(2,b.overscaledZ)/C.tileSize/8};return a.extend(q,Wd(S,r,C),V)},Vl=u=>({u_matrix:u}),Au=(u,r,l,p)=>a.extend(Vl(u),Wd(l,r,p)),Xd=(u,r)=>({u_matrix:u,u_world:r}),Xm=(u,r,l,p,_)=>a.extend(Au(u,r,l,p),{u_world:_}),Ra=a.create(),Ba=(u,r,l,p,_,y)=>{const b=u.transform,S=b.projection.name==="globe";let C;if(y.paint.get("circle-pitch-alignment")==="map")if(S){const k=a.globePixelsToTileUnits(b.zoom,r.canonical)*b._pixelsPerMercatorPixel;C=Float32Array.from([k,0,0,k])}else C=b.calculatePixelsToTileUnitsMatrix(l);else C=new Float32Array([b.pixelsToGLUnits[0],0,0,b.pixelsToGLUnits[1]]);const z={u_camera_to_center_distance:b.cameraToCenterDistance,u_matrix:u.translatePosMatrix(r.projMatrix,l,y.paint.get("circle-translate"),y.paint.get("circle-translate-anchor")),u_device_pixel_ratio:a.exported.devicePixelRatio,u_extrude_scale:C,u_inv_rot_matrix:Ra,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(S){z.u_inv_rot_matrix=p,z.u_merc_center=_,z.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],z.u_zoom_transition=a.globeToMercatorTransition(b.zoom);const k=_[0]*a.EXTENT,R=_[1]*a.EXTENT;z.u_up_dir=b.projection.upVector(new a.CanonicalTileID(0,0,0),k,R)}return z},Hd=u=>{const r=[];return u.paint.get("circle-pitch-alignment")==="map"&&r.push("PITCH_WITH_MAP"),u.paint.get("circle-pitch-scale")==="map"&&r.push("SCALE_WITH_MAP"),r},Gl=(u,r,l,p)=>{const _=a.EXTENT/l.tileSize;return{u_matrix:u,u_camera_to_center_distance:r.getCameraToCenterDistance(p),u_extrude_scale:[r.pixelsToGLUnits[0]/_,r.pixelsToGLUnits[1]/_]}},$l=(u,r,l=1)=>({u_matrix:u,u_color:r,u_overlay:0,u_overlay_scale:l}),Ei=a.create(),Iu=(u,r,l,p,_,y,b)=>{const S=u.transform,C=S.projection.name==="globe",z=C?a.globePixelsToTileUnits(S.zoom,r.canonical)*S._pixelsPerMercatorPixel:qn(l,1,y),k={u_matrix:r.projMatrix,u_extrude_scale:z,u_intensity:b,u_inv_rot_matrix:Ei,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(C){k.u_inv_rot_matrix=p,k.u_merc_center=_,k.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],k.u_zoom_transition=a.globeToMercatorTransition(S.zoom);const R=_[0]*a.EXTENT,U=_[1]*a.EXTENT;k.u_up_dir=S.projection.upVector(new a.CanonicalTileID(0,0,0),R,U)}return k},Yd=(u,r,l,p,_,y,b,S)=>{const C=u.transform,z=C.calculatePixelsToTileUnitsMatrix(r),k={u_matrix:Zl(u,r,l,_),u_pixels_to_tile_units:z,u_device_pixel_ratio:b,u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:y,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:S};if(Kd(l)){const R=ku(r,u.transform);k.u_texsize=r.lineAtlasTexture.size,k.u_scale=[R,p.fromScale,p.toScale],k.u_mix=p.t}return k},zu=(u,r,l,p,_,y)=>{const b=u.transform,S=ku(r,b);return{u_matrix:Zl(u,r,l,_),u_texsize:r.imageAtlasTexture.size,u_pixels_to_tile_units:b.calculatePixelsToTileUnitsMatrix(r),u_device_pixel_ratio:y,u_image:0,u_scale:[S,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function ku(u,r){return 1/qn(u,1,r.tileZoom)}function Zl(u,r,l,p){return u.translatePosMatrix(p||r.tileID.projMatrix,r,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}function Kd(u){const r=u.paint.get("line-dasharray").value;return r.value||r.kind!=="constant"}const Pu=(u,r,l,p,_,y)=>{return{u_matrix:u,u_tl_parent:r,u_scale_parent:l,u_fade_t:p.mix,u_opacity:p.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(S=_.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(b=_.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:Hm(_.paint.get("raster-hue-rotate")),u_perspective_transform:y};var b,S};function Hm(u){u*=Math.PI/180;const r=Math.sin(u),l=Math.cos(u);return[(2*l+1)/3,(-Math.sqrt(3)*r-l+1)/3,(Math.sqrt(3)*r-l+1)/3]}const Oa=a.create(),Jd=(u,r,l,p,_,y,b,S,C,z,k,R,U,q,V,W)=>{const $=_.transform,j={u_is_size_zoom_constant:+(u==="constant"||u==="source"),u_is_size_feature_constant:+(u==="constant"||u==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:$.cameraToCenterDistance,u_rotate_symbol:+l,u_aspect_ratio:$.width/$.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:b,u_coord_matrix:S,u_is_text:+C,u_pitch_with_map:+p,u_texsize:z,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Oa,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Oa,u_up_vector:[0,-1,0]};return W.name==="globe"&&(j.u_tile_id=[k.canonical.x,k.canonical.y,1<<k.canonical.z],j.u_zoom_transition=R,j.u_inv_rot_matrix=q,j.u_merc_center=U,j.u_camera_forward=$._camera.forward(),j.u_ecef_origin=a.globeECEFOrigin($.globeMatrix,k.toUnwrapped()),j.u_tile_matrix=Float32Array.from($.globeMatrix),j.u_up_vector=V),j},ql=(u,r,l,p,_,y,b,S,C,z,k,R,U,q,V,W,$)=>a.extend(Jd(u,r,l,p,_,y,b,S,C,z,R,U,q,V,W,$),{u_gamma_scale:p?_.transform.cameraToCenterDistance*Math.cos(_.terrain?0:_.transform._pitch):1,u_device_pixel_ratio:a.exported.devicePixelRatio,u_is_halo:+k}),Ym=(u,r,l,p,_,y,b,S,C,z,k,R,U,q,V,W)=>a.extend(ql(u,r,l,p,_,y,b,S,!0,C,!0,k,R,U,q,V,W),{u_texsize_icon:z,u_texture_icon:1}),Du=(u,r,l)=>({u_matrix:u,u_opacity:r,u_color:l}),Km=(u,r,l,p,_,y)=>a.extend(function(b,S,C,z){const k=C.imageManager.getPattern(b.from.toString()),R=C.imageManager.getPattern(b.to.toString()),{width:U,height:q}=C.imageManager.getPixelSize(),V=Math.pow(2,z.tileID.overscaledZ),W=z.tileSize*Math.pow(2,C.transform.tileZoom)/V,$=W*(z.tileID.canonical.x+z.tileID.wrap*V),j=W*z.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:k.tl,u_pattern_br_a:k.br,u_pattern_tl_b:R.tl,u_pattern_br_b:R.br,u_texsize:[U,q],u_mix:S.t,u_pattern_size_a:k.displaySize,u_pattern_size_b:R.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/qn(z,1,C.transform.tileZoom),u_pixel_coord_upper:[$>>16,j>>16],u_pixel_coord_lower:[65535&$,65535&j]}}(p,y,l,_),{u_matrix:u,u_opacity:r}),Wl={fillExtrusion:u=>({u_matrix:new a.UniformMatrix4f(u),u_lightpos:new a.Uniform3f(u),u_lightintensity:new a.Uniform1f(u),u_lightcolor:new a.Uniform3f(u),u_vertical_gradient:new a.Uniform1f(u),u_opacity:new a.Uniform1f(u),u_edge_radius:new a.Uniform1f(u),u_ao:new a.Uniform2f(u),u_tile_id:new a.Uniform3f(u),u_zoom_transition:new a.Uniform1f(u),u_inv_rot_matrix:new a.UniformMatrix4f(u),u_merc_center:new a.Uniform2f(u),u_up_dir:new a.Uniform3f(u),u_height_lift:new a.Uniform1f(u)}),fillExtrusionPattern:u=>({u_matrix:new a.UniformMatrix4f(u),u_lightpos:new a.Uniform3f(u),u_lightintensity:new a.Uniform1f(u),u_lightcolor:new a.Uniform3f(u),u_vertical_gradient:new a.Uniform1f(u),u_height_factor:new a.Uniform1f(u),u_edge_radius:new a.Uniform1f(u),u_ao:new a.Uniform2f(u),u_tile_id:new a.Uniform3f(u),u_zoom_transition:new a.Uniform1f(u),u_inv_rot_matrix:new a.UniformMatrix4f(u),u_merc_center:new a.Uniform2f(u),u_up_dir:new a.Uniform3f(u),u_height_lift:new a.Uniform1f(u),u_image:new a.Uniform1i(u),u_texsize:new a.Uniform2f(u),u_pixel_coord_upper:new a.Uniform2f(u),u_pixel_coord_lower:new a.Uniform2f(u),u_scale:new a.Uniform3f(u),u_fade:new a.Uniform1f(u),u_opacity:new a.Uniform1f(u)}),fill:u=>({u_matrix:new a.UniformMatrix4f(u)}),fillPattern:u=>({u_matrix:new a.UniformMatrix4f(u),u_image:new a.Uniform1i(u),u_texsize:new a.Uniform2f(u),u_pixel_coord_upper:new a.Uniform2f(u),u_pixel_coord_lower:new a.Uniform2f(u),u_scale:new a.Uniform3f(u),u_fade:new a.Uniform1f(u)}),fillOutline:u=>({u_matrix:new a.UniformMatrix4f(u),u_world:new a.Uniform2f(u)}),fillOutlinePattern:u=>({u_matrix:new a.UniformMatrix4f(u),u_world:new a.Uniform2f(u),u_image:new a.Uniform1i(u),u_texsize:new a.Uniform2f(u),u_pixel_coord_upper:new a.Uniform2f(u),u_pixel_coord_lower:new a.Uniform2f(u),u_scale:new a.Uniform3f(u),u_fade:new a.Uniform1f(u)}),circle:u=>({u_camera_to_center_distance:new a.Uniform1f(u),u_extrude_scale:new a.UniformMatrix2f(u),u_device_pixel_ratio:new a.Uniform1f(u),u_matrix:new a.UniformMatrix4f(u),u_inv_rot_matrix:new a.UniformMatrix4f(u),u_merc_center:new a.Uniform2f(u),u_tile_id:new a.Uniform3f(u),u_zoom_transition:new a.Uniform1f(u),u_up_dir:new a.Uniform3f(u)}),collisionBox:u=>({u_matrix:new a.UniformMatrix4f(u),u_camera_to_center_distance:new a.Uniform1f(u),u_extrude_scale:new a.Uniform2f(u)}),collisionCircle:u=>({u_matrix:new a.UniformMatrix4f(u),u_inv_matrix:new a.UniformMatrix4f(u),u_camera_to_center_distance:new a.Uniform1f(u),u_viewport_size:new a.Uniform2f(u)}),debug:u=>({u_color:new a.UniformColor(u),u_matrix:new a.UniformMatrix4f(u),u_overlay:new a.Uniform1i(u),u_overlay_scale:new a.Uniform1f(u)}),clippingMask:u=>({u_matrix:new a.UniformMatrix4f(u)}),heatmap:u=>({u_extrude_scale:new a.Uniform1f(u),u_intensity:new a.Uniform1f(u),u_matrix:new a.UniformMatrix4f(u),u_inv_rot_matrix:new a.UniformMatrix4f(u),u_merc_center:new a.Uniform2f(u),u_tile_id:new a.Uniform3f(u),u_zoom_transition:new a.Uniform1f(u),u_up_dir:new a.Uniform3f(u)}),heatmapTexture:u=>({u_image:new a.Uniform1i(u),u_color_ramp:new a.Uniform1i(u),u_opacity:new a.Uniform1f(u)}),hillshade:u=>({u_matrix:new a.UniformMatrix4f(u),u_image:new a.Uniform1i(u),u_latrange:new a.Uniform2f(u),u_light:new a.Uniform2f(u),u_shadow:new a.UniformColor(u),u_highlight:new a.UniformColor(u),u_accent:new a.UniformColor(u)}),hillshadePrepare:u=>({u_matrix:new a.UniformMatrix4f(u),u_image:new a.Uniform1i(u),u_dimension:new a.Uniform2f(u),u_zoom:new a.Uniform1f(u),u_unpack:new a.Uniform4f(u)}),line:u=>({u_matrix:new a.UniformMatrix4f(u),u_pixels_to_tile_units:new a.UniformMatrix2f(u),u_device_pixel_ratio:new a.Uniform1f(u),u_units_to_pixels:new a.Uniform2f(u),u_dash_image:new a.Uniform1i(u),u_gradient_image:new a.Uniform1i(u),u_image_height:new a.Uniform1f(u),u_texsize:new a.Uniform2f(u),u_scale:new a.Uniform3f(u),u_mix:new a.Uniform1f(u),u_alpha_discard_threshold:new a.Uniform1f(u),u_trim_offset:new a.Uniform2f(u)}),linePattern:u=>({u_matrix:new a.UniformMatrix4f(u),u_texsize:new a.Uniform2f(u),u_pixels_to_tile_units:new a.UniformMatrix2f(u),u_device_pixel_ratio:new a.Uniform1f(u),u_image:new a.Uniform1i(u),u_units_to_pixels:new a.Uniform2f(u),u_scale:new a.Uniform3f(u),u_fade:new a.Uniform1f(u),u_alpha_discard_threshold:new a.Uniform1f(u)}),raster:u=>({u_matrix:new a.UniformMatrix4f(u),u_tl_parent:new a.Uniform2f(u),u_scale_parent:new a.Uniform1f(u),u_fade_t:new a.Uniform1f(u),u_opacity:new a.Uniform1f(u),u_image0:new a.Uniform1i(u),u_image1:new a.Uniform1i(u),u_brightness_low:new a.Uniform1f(u),u_brightness_high:new a.Uniform1f(u),u_saturation_factor:new a.Uniform1f(u),u_contrast_factor:new a.Uniform1f(u),u_spin_weights:new a.Uniform3f(u),u_perspective_transform:new a.Uniform2f(u)}),symbolIcon:u=>({u_is_size_zoom_constant:new a.Uniform1i(u),u_is_size_feature_constant:new a.Uniform1i(u),u_size_t:new a.Uniform1f(u),u_size:new a.Uniform1f(u),u_camera_to_center_distance:new a.Uniform1f(u),u_rotate_symbol:new a.Uniform1i(u),u_aspect_ratio:new a.Uniform1f(u),u_fade_change:new a.Uniform1f(u),u_matrix:new a.UniformMatrix4f(u),u_label_plane_matrix:new a.UniformMatrix4f(u),u_coord_matrix:new a.UniformMatrix4f(u),u_is_text:new a.Uniform1i(u),u_pitch_with_map:new a.Uniform1i(u),u_texsize:new a.Uniform2f(u),u_tile_id:new a.Uniform3f(u),u_zoom_transition:new a.Uniform1f(u),u_inv_rot_matrix:new a.UniformMatrix4f(u),u_merc_center:new a.Uniform2f(u),u_camera_forward:new a.Uniform3f(u),u_tile_matrix:new a.UniformMatrix4f(u),u_up_vector:new a.Uniform3f(u),u_ecef_origin:new a.Uniform3f(u),u_texture:new a.Uniform1i(u)}),symbolSDF:u=>({u_is_size_zoom_constant:new a.Uniform1i(u),u_is_size_feature_constant:new a.Uniform1i(u),u_size_t:new a.Uniform1f(u),u_size:new a.Uniform1f(u),u_camera_to_center_distance:new a.Uniform1f(u),u_rotate_symbol:new a.Uniform1i(u),u_aspect_ratio:new a.Uniform1f(u),u_fade_change:new a.Uniform1f(u),u_matrix:new a.UniformMatrix4f(u),u_label_plane_matrix:new a.UniformMatrix4f(u),u_coord_matrix:new a.UniformMatrix4f(u),u_is_text:new a.Uniform1i(u),u_pitch_with_map:new a.Uniform1i(u),u_texsize:new a.Uniform2f(u),u_texture:new a.Uniform1i(u),u_gamma_scale:new a.Uniform1f(u),u_device_pixel_ratio:new a.Uniform1f(u),u_tile_id:new a.Uniform3f(u),u_zoom_transition:new a.Uniform1f(u),u_inv_rot_matrix:new a.UniformMatrix4f(u),u_merc_center:new a.Uniform2f(u),u_camera_forward:new a.Uniform3f(u),u_tile_matrix:new a.UniformMatrix4f(u),u_up_vector:new a.Uniform3f(u),u_ecef_origin:new a.Uniform3f(u),u_is_halo:new a.Uniform1i(u)}),symbolTextAndIcon:u=>({u_is_size_zoom_constant:new a.Uniform1i(u),u_is_size_feature_constant:new a.Uniform1i(u),u_size_t:new a.Uniform1f(u),u_size:new a.Uniform1f(u),u_camera_to_center_distance:new a.Uniform1f(u),u_rotate_symbol:new a.Uniform1i(u),u_aspect_ratio:new a.Uniform1f(u),u_fade_change:new a.Uniform1f(u),u_matrix:new a.UniformMatrix4f(u),u_label_plane_matrix:new a.UniformMatrix4f(u),u_coord_matrix:new a.UniformMatrix4f(u),u_is_text:new a.Uniform1i(u),u_pitch_with_map:new a.Uniform1i(u),u_texsize:new a.Uniform2f(u),u_texsize_icon:new a.Uniform2f(u),u_texture:new a.Uniform1i(u),u_texture_icon:new a.Uniform1i(u),u_gamma_scale:new a.Uniform1f(u),u_device_pixel_ratio:new a.Uniform1f(u),u_is_halo:new a.Uniform1i(u)}),background:u=>({u_matrix:new a.UniformMatrix4f(u),u_opacity:new a.Uniform1f(u),u_color:new a.UniformColor(u)}),backgroundPattern:u=>({u_matrix:new a.UniformMatrix4f(u),u_opacity:new a.Uniform1f(u),u_image:new a.Uniform1i(u),u_pattern_tl_a:new a.Uniform2f(u),u_pattern_br_a:new a.Uniform2f(u),u_pattern_tl_b:new a.Uniform2f(u),u_pattern_br_b:new a.Uniform2f(u),u_texsize:new a.Uniform2f(u),u_mix:new a.Uniform1f(u),u_pattern_size_a:new a.Uniform2f(u),u_pattern_size_b:new a.Uniform2f(u),u_scale_a:new a.Uniform1f(u),u_scale_b:new a.Uniform1f(u),u_pixel_coord_upper:new a.Uniform2f(u),u_pixel_coord_lower:new a.Uniform2f(u),u_tile_units_to_pixels:new a.Uniform1f(u)}),terrainRaster:Fl,terrainDepth:Fl,skybox:u=>({u_matrix:new a.UniformMatrix4f(u),u_sun_direction:new a.Uniform3f(u),u_cubemap:new a.Uniform1i(u),u_opacity:new a.Uniform1f(u),u_temporal_offset:new a.Uniform1f(u)}),skyboxGradient:u=>({u_matrix:new a.UniformMatrix4f(u),u_color_ramp:new a.Uniform1i(u),u_center_direction:new a.Uniform3f(u),u_radius:new a.Uniform1f(u),u_opacity:new a.Uniform1f(u),u_temporal_offset:new a.Uniform1f(u)}),skyboxCapture:u=>({u_matrix_3f:new a.UniformMatrix3f(u),u_sun_direction:new a.Uniform3f(u),u_sun_intensity:new a.Uniform1f(u),u_color_tint_r:new a.Uniform4f(u),u_color_tint_m:new a.Uniform4f(u),u_luminance:new a.Uniform1f(u)}),globeRaster:u=>({u_proj_matrix:new a.UniformMatrix4f(u),u_globe_matrix:new a.UniformMatrix4f(u),u_normalize_matrix:new a.UniformMatrix4f(u),u_merc_matrix:new a.UniformMatrix4f(u),u_zoom_transition:new a.Uniform1f(u),u_merc_center:new a.Uniform2f(u),u_image0:new a.Uniform1i(u),u_grid_matrix:new a.UniformMatrix3f(u),u_frustum_tl:new a.Uniform3f(u),u_frustum_tr:new a.Uniform3f(u),u_frustum_br:new a.Uniform3f(u),u_frustum_bl:new a.Uniform3f(u),u_globe_pos:new a.Uniform3f(u),u_globe_radius:new a.Uniform1f(u),u_viewport:new a.Uniform2f(u)}),globeAtmosphere:u=>({u_frustum_tl:new a.Uniform3f(u),u_frustum_tr:new a.Uniform3f(u),u_frustum_br:new a.Uniform3f(u),u_frustum_bl:new a.Uniform3f(u),u_horizon:new a.Uniform1f(u),u_transition:new a.Uniform1f(u),u_fadeout_range:new a.Uniform1f(u),u_color:new a.Uniform4f(u),u_high_color:new a.Uniform4f(u),u_space_color:new a.Uniform4f(u),u_star_intensity:new a.Uniform1f(u),u_star_density:new a.Uniform1f(u),u_star_size:new a.Uniform1f(u),u_temporal_offset:new a.Uniform1f(u),u_horizon_angle:new a.Uniform1f(u),u_rotation_matrix:new a.UniformMatrix4f(u)})};let Xl;function Lu(u,r,l,p,_,y,b){const S=u.context,C=S.gl,z=u.transform,k=u.useProgram("collisionBox"),R=[];let U=0,q=0;for(let ne=0;ne<p.length;ne++){const ie=p[ne],Q=r.getTile(ie),se=Q.getBucket(l);if(!se)continue;const xe=Il(ie,se,z);let Ce=xe;_[0]===0&&_[1]===0||(Ce=u.translatePosMatrix(xe,Q,_,y));const Ee=b?se.textCollisionBox:se.iconCollisionBox,Ge=se.collisionCircleArray;if(Ge.length>0){const fe=a.create(),Le=Ce;a.mul(fe,se.placementInvProjMatrix,z.glCoordMatrix),a.mul(fe,fe,se.placementViewportMatrix),R.push({circleArray:Ge,circleOffset:q,transform:Le,invTransform:fe,projection:se.getProjection()}),U+=Ge.length/4,q=U}Ee&&(u.terrain&&u.terrain.setupElevationDraw(Q,k),k.draw(S,C.LINES,a.DepthMode.disabled,a.StencilMode.disabled,u.colorModeForRenderPass(),a.CullFaceMode.disabled,Gl(Ce,z,Q,se.getProjection()),l.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,null,z.zoom,null,[Ee.collisionVertexBuffer,Ee.collisionVertexBufferExt]))}if(!b||!R.length)return;const V=u.useProgram("collisionCircle"),W=new a.StructArrayLayout2f1f2i16;W.resize(4*U),W._trim();let $=0;for(const ne of R)for(let ie=0;ie<ne.circleArray.length/4;ie++){const Q=4*ie,se=ne.circleArray[Q+0],xe=ne.circleArray[Q+1],Ce=ne.circleArray[Q+2],Ee=ne.circleArray[Q+3];W.emplace($++,se,xe,Ce,Ee,0),W.emplace($++,se,xe,Ce,Ee,1),W.emplace($++,se,xe,Ce,Ee,2),W.emplace($++,se,xe,Ce,Ee,3)}(!Xl||Xl.length<2*U)&&(Xl=function(ne){const ie=2*ne,Q=new a.StructArrayLayout3ui6;Q.resize(ie),Q._trim();for(let se=0;se<ie;se++){const xe=6*se;Q.uint16[xe+0]=4*se+0,Q.uint16[xe+1]=4*se+1,Q.uint16[xe+2]=4*se+2,Q.uint16[xe+3]=4*se+2,Q.uint16[xe+4]=4*se+3,Q.uint16[xe+5]=4*se+0}return Q}(U));const j=S.createIndexBuffer(Xl,!0),H=S.createVertexBuffer(W,a.collisionCircleLayout.members,!0);for(const ne of R){const ie={u_matrix:ne.transform,u_inv_matrix:ne.invTransform,u_camera_to_center_distance:(Z=z).getCameraToCenterDistance(ne.projection),u_viewport_size:[Z.width,Z.height]};V.draw(S,C.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,u.colorModeForRenderPass(),a.CullFaceMode.disabled,ie,l.id,H,j,a.SegmentVector.simpleSegment(0,2*ne.circleOffset,ne.circleArray.length,ne.circleArray.length/2),null,z.zoom)}var Z;H.destroy(),j.destroy()}const Ru=a.create();function Bs(u,r,l,p,_,y){const{horizontalAlign:b,verticalAlign:S}=a.getAnchorAlignment(u),C=-(b-.5)*r,z=-(S-.5)*l,k=a.evaluateVariableOffset(u,p);return new a.pointGeometry((C/_+k[0])*y,(z/_+k[1])*y)}function Jm(u,r,l,p,_,y,b,S,C,z,k){const R=u.text.placedSymbolArray,U=u.text.dynamicLayoutVertexArray,q=u.icon.dynamicLayoutVertexArray,V={},W=Ia(S,u.getProjection(),y),$=y.elevation,j=u.getProjection().upVectorScale(S.canonical,y.center.lat,y.worldSize);U.clear();for(let H=0;H<R.length;H++){const Z=R.get(H),ne=u.allowVerticalPlacement&&!Z.placedOrientation,ie=Z.hidden||!Z.crossTileID||ne?null:p[Z.crossTileID];if(ie){const Q=new a.pointGeometry(Z.tileAnchorX,Z.tileAnchorY),se=u.getProjection().upVector(S.canonical,Q.x,Q.y),xe=$?$.getAtTileOffset(S,Q.x,Q.y):0,Ce=Bt([Z.projectedAnchorX+xe*se[0]*j.metersToTile,Z.projectedAnchorY+xe*se[1]*j.metersToTile,Z.projectedAnchorZ+xe*se[2]*j.metersToTile],l?W:b),Ee=Ut(y.getCameraToCenterDistance(u.getProjection()),Ce.signedDistanceFromCamera);let Ge=_.evaluateSizeForFeature(u.textSizeData,z,Z)*Ee/a.ONE_EM;l&&(Ge*=u.tilePixelRatio/C);const{width:fe,height:Le,anchor:De,textOffset:ve,textScale:pe}=ie,Ke=Bs(De,fe,Le,ve,pe,Ge);let qe;if(l){const We=Q.add(Ke),{x:at,y:wt,z:yt}=u.getProjection().projectTilePoint(We.x,We.y,S.canonical);qe=Bt([at+xe*se[0]*j.metersToTile,wt+xe*se[1]*j.metersToTile,yt+xe*se[2]*j.metersToTile],b).point}else{const We=r?Ke.rotate(-y.angle):Ke;qe=[Ce.point[0]+We.x,Ce.point[1]+We.y,0]}const Ye=u.allowVerticalPlacement&&Z.placedOrientation===a.WritingMode.vertical?Math.PI/2:0;for(let We=0;We<Z.numGlyphs;We++)a.addDynamicAttributes(U,qe[0],qe[1],qe[2],Ye);k&&Z.associatedIconIndex>=0&&(V[Z.associatedIconIndex]={shiftedAnchor:qe,angle:Ye})}else oi(Z.numGlyphs,U)}if(k){q.clear();const H=u.icon.placedSymbolArray;for(let Z=0;Z<H.length;Z++){const ne=H.get(Z);if(ne.hidden)oi(ne.numGlyphs,q);else{const ie=V[Z];if(ie)for(let Q=0;Q<ne.numGlyphs;Q++)a.addDynamicAttributes(q,ie.shiftedAnchor[0],ie.shiftedAnchor[1],ie.shiftedAnchor[2],ie.angle);else oi(ne.numGlyphs,q)}}u.icon.dynamicLayoutVertexBuffer.updateData(q)}u.text.dynamicLayoutVertexBuffer.updateData(U)}function Qm(u,r,l){return l.iconsInText&&r?"symbolTextAndIcon":u?"symbolSDF":"symbolIcon"}function Qd(u,r,l,p,_,y,b,S,C,z,k,R){const U=u.context,q=U.gl,V=u.transform,W=S==="map",$=C==="map",j=W&&l.layout.get("symbol-placement")!=="point",H=W&&!$&&!j,Z=l.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ne=!1;const ie=u.depthModeForSublayer(0,a.DepthMode.ReadOnly),Q=[a.mercatorXfromLng(V.center.lng),a.mercatorYfromLat(V.center.lat)],se=l.layout.get("text-variable-anchor"),xe=V.projection.name==="globe",Ce=[],Ee=[0,-1,0];let Ge=Ee;!xe&&!V.mercatorFromTransition||W||(Ge=function(fe){const Le=fe._camera.getWorldToCamera(fe.worldSize,1),De=a.multiply([],Le,fe.globeMatrix);a.invert(De,De);const ve=[0,0,0],pe=[0,1,0,0];return a.transformMat4$1(pe,pe,De),ve[0]=pe[0],ve[1]=pe[1],ve[2]=pe[2],a.normalize(ve,ve),ve}(V));for(const fe of p){const Le=r.getTile(fe),De=Le.getBucket(l);if(!De||De.projection.name==="mercator"&&xe)continue;const ve=_?De.text:De.icon;if(!ve||De.fullyClipped||!ve.segments.get().length)continue;const pe=ve.programConfigurations.get(l.id),Ke=_||De.sdfIcons,qe=_?De.textSizeData:De.iconSizeData,Ye=$||V.pitch!==0,We=a.evaluateSizeForZoom(qe,V.zoom);let at,wt,yt,ut,Xe=[0,0],Mt=null;if(_){if(wt=Le.glyphAtlasTexture,yt=q.LINEAR,at=Le.glyphAtlasTexture.size,De.iconsInText){Xe=Le.imageAtlasTexture.size,Mt=Le.imageAtlasTexture;const Yn=qe.kind==="composite"||qe.kind==="camera";ut=Ye||u.options.rotating||u.options.zooming||Yn?q.LINEAR:q.NEAREST}}else{const Yn=l.layout.get("icon-size").constantOr(0)!==1||De.iconsNeedLinear;wt=Le.imageAtlasTexture,yt=Ke||u.options.rotating||u.options.zooming||Yn||Ye?q.LINEAR:q.NEAREST,at=Le.imageAtlasTexture.size}const Dt=De.projection.name==="globe",nn=Dt?Ge:Ee,rn=Dt?a.globeToMercatorTransition(V.zoom):0,Jt=Ia(fe,De.getProjection(),V),Gn=V.calculatePixelsToTileUnitsMatrix(Le),mr=As(Jt,Le.tileID.canonical,$,W,V,De.getProjection(),Gn),Mi=u.terrain&&$&&j?a.invert(a.create(),mr):Ru,pn=Is(Jt,Le.tileID.canonical,$,W,V,De.getProjection(),Gn),vn=se&&De.hasTextData(),Yt=l.layout.get("icon-text-fit")!=="none"&&vn&&De.hasIconData();if(j){const Yn=V.elevation,Ai=Yn?Yn.getAtTileOffsetFunc(fe,V.center.lat,V.worldSize,De.getProjection()):li=>[0,0,0],To=Bd(Jt,Le.tileID.canonical,$,W,V,De.getProjection(),Gn);zs(De,Jt,u,_,To,pn,$,z,Ai,fe)}const Pn=j||_&&se||Yt,sr=u.translatePosMatrix(Jt,Le,y,b),cn=Pn?Ru:mr,Cr=u.translatePosMatrix(pn,Le,y,b,!0),Xo=De.getProjection().createInversionMatrix(V,fe.canonical),ai=[];u.terrainRenderModeElevated()&&$&&ai.push("PITCH_WITH_MAP_TERRAIN"),Dt&&ai.push("PROJECTION_GLOBE_VIEW"),Pn&&ai.push("PROJECTED_POS_ON_VIEWPORT");const _r=Ke&&l.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let js;js=Ke?De.iconsInText?Ym(qe.kind,We,H,$,u,sr,cn,Cr,at,Xe,fe,rn,Q,Xo,nn,De.getProjection()):ql(qe.kind,We,H,$,u,sr,cn,Cr,_,at,!0,fe,rn,Q,Xo,nn,De.getProjection()):Jd(qe.kind,We,H,$,u,sr,cn,Cr,_,at,fe,rn,Q,Xo,nn,De.getProjection());const bo={program:u.useProgram(Qm(Ke,_,De),pe,ai),buffers:ve,uniformValues:js,atlasTexture:wt,atlasTextureIcon:Mt,atlasInterpolation:yt,atlasInterpolationIcon:ut,isSDF:Ke,hasHalo:_r,tile:Le,labelPlaneMatrixInv:Mi};if(Z&&De.canOverlap){ne=!0;const Yn=ve.segments.get();for(const Ai of Yn)Ce.push({segments:new a.SegmentVector([Ai]),sortKey:Ai.sortKey,state:bo})}else Ce.push({segments:ve.segments,sortKey:0,state:bo})}ne&&Ce.sort((fe,Le)=>fe.sortKey-Le.sortKey);for(const fe of Ce){const Le=fe.state;if(u.terrain&&u.terrain.setupElevationDraw(Le.tile,Le.program,{useDepthForOcclusion:!xe,labelPlaneMatrixInv:Le.labelPlaneMatrixInv}),U.activeTexture.set(q.TEXTURE0),Le.atlasTexture.bind(Le.atlasInterpolation,q.CLAMP_TO_EDGE),Le.atlasTextureIcon&&(U.activeTexture.set(q.TEXTURE1),Le.atlasTextureIcon&&Le.atlasTextureIcon.bind(Le.atlasInterpolationIcon,q.CLAMP_TO_EDGE)),Le.isSDF){const De=Le.uniformValues;Le.hasHalo&&(De.u_is_halo=1,ep(Le.buffers,fe.segments,l,u,Le.program,ie,k,R,De)),De.u_is_halo=0}ep(Le.buffers,fe.segments,l,u,Le.program,ie,k,R,Le.uniformValues)}}function ep(u,r,l,p,_,y,b,S,C){const z=p.context,k=[u.dynamicLayoutVertexBuffer,u.opacityVertexBuffer,u.globeExtVertexBuffer];_.draw(z,z.gl.TRIANGLES,y,b,S,a.CullFaceMode.disabled,C,l.id,u.layoutVertexBuffer,u.indexBuffer,r,l.paint,p.transform.zoom,u.programConfigurations.get(l.id),k)}function tp(u,r,l,p,_,y,b){const S=u.context.gl,C=l.paint.get("fill-pattern"),z=C&&C.constantOr(1),k=l.getCrossfadeParameters();let R,U,q,V,W;b?(U=z&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R=S.LINES):(U=z?"fillPattern":"fill",R=S.TRIANGLES);for(const $ of p){const j=r.getTile($);if(z&&!j.patternsLoaded())continue;const H=j.getBucket(l);if(!H)continue;u.prepareDrawTile();const Z=H.programConfigurations.get(l.id),ne=u.useProgram(U,Z);z&&(u.context.activeTexture.set(S.TEXTURE0),j.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),Z.updatePaintBuffers(k));const ie=C.constantOr(null);if(ie&&j.imageAtlas){const se=j.imageAtlas,xe=se.patternPositions[ie.to.toString()],Ce=se.patternPositions[ie.from.toString()];xe&&Ce&&Z.setConstantPatternPositions(xe,Ce)}const Q=u.translatePosMatrix($.projMatrix,j,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));if(b){V=H.indexBuffer2,W=H.segments2;const se=u.terrain&&u.terrain.renderingToTexture?u.terrain.drapeBufferSize:[S.drawingBufferWidth,S.drawingBufferHeight];q=U==="fillOutlinePattern"&&z?Xm(Q,u,k,j,se):Xd(Q,se)}else V=H.indexBuffer,W=H.segments,q=z?Au(Q,u,k,j):Vl(Q);u.prepareDrawProgram(u.context,ne,$.toUnwrapped()),ne.draw(u.context,R,_,u.stencilModeForClipping($),y,a.CullFaceMode.disabled,q,l.id,H.layoutVertexBuffer,V,W,l.paint,u.transform.zoom,Z)}}function Bu(u,r,l,p,_,y,b){const S=u.context,C=S.gl,z=u.transform,k=l.paint.get("fill-extrusion-pattern"),R=k.constantOr(1),U=l.getCrossfadeParameters(),q=l.paint.get("fill-extrusion-opacity"),V=[l.paint.get("fill-extrusion-ambient-occlusion-intensity"),l.paint.get("fill-extrusion-ambient-occlusion-radius")],W=l.layout.get("fill-extrusion-edge-radius"),$=z.projection.name==="globe"?a.fillExtrusionHeightLift():0,j=z.projection.name==="globe",H=j?a.globeToMercatorTransition(z.zoom):0,Z=[a.mercatorXfromLng(z.center.lng),a.mercatorYfromLat(z.center.lat)],ne=[];j&&(ne.push("PROJECTION_GLOBE_VIEW"),u.style.terrainSetForDrapingOnly()&&ne.push("TERRAIN")),V[0]>0&&ne.push("FAUX_AO");for(const ie of p){const Q=r.getTile(ie),se=Q.getBucket(l);if(!se||se.projection.name!==z.projection.name)continue;const xe=se.programConfigurations.get(l.id),Ce=u.useProgram(R?"fillExtrusionPattern":"fillExtrusion",xe,ne);if(u.terrain){const pe=u.terrain;if(u.style.terrainSetForDrapingOnly())pe.setupElevationDraw(Q,Ce,{useMeterToDem:!0});else{if(!se.enableTerrain)continue;if(pe.setupElevationDraw(Q,Ce,{useMeterToDem:!0}),Ou(S,r,ie,se,l,pe),!se.centroidVertexBuffer){const Ke=Ce.attributes.a_centroid_pos;Ke!==void 0&&C.vertexAttrib2f(Ke,0,0)}}}R&&(u.context.activeTexture.set(C.TEXTURE0),Q.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),xe.updatePaintBuffers(U));const Ee=k.constantOr(null);if(Ee&&Q.imageAtlas){const pe=Q.imageAtlas,Ke=pe.patternPositions[Ee.to.toString()],qe=pe.patternPositions[Ee.from.toString()];Ke&&qe&&xe.setConstantPatternPositions(Ke,qe)}const Ge=u.translatePosMatrix(ie.projMatrix,Q,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),fe=z.projection.createInversionMatrix(z,ie.canonical),Le=l.paint.get("fill-extrusion-vertical-gradient"),De=R?Mu(Ge,u,Le,q,V,W,ie,U,Q,$,H,Z,fe):jl(Ge,u,Le,q,V,W,ie,$,H,Z,fe);u.prepareDrawProgram(S,Ce,ie.toUnwrapped());const ve=[];u.terrain&&ve.push(se.centroidVertexBuffer),j&&ve.push(se.layoutVertexExtBuffer),Ce.draw(S,S.gl.TRIANGLES,_,y,b,a.CullFaceMode.backCCW,De,l.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,l.paint,u.transform.zoom,xe,ve)}}function Ou(u,r,l,p,_,y){const b=[j=>{let H=j.canonical.x-1,Z=j.wrap;return H<0&&(H=(1<<j.canonical.z)-1,Z--),new a.OverscaledTileID(j.overscaledZ,Z,j.canonical.z,H,j.canonical.y)},j=>{let H=j.canonical.x+1,Z=j.wrap;return H===1<<j.canonical.z&&(H=0,Z++),new a.OverscaledTileID(j.overscaledZ,Z,j.canonical.z,H,j.canonical.y)},j=>new a.OverscaledTileID(j.overscaledZ,j.wrap,j.canonical.z,j.canonical.x,(j.canonical.y===0?1<<j.canonical.z:j.canonical.y)-1),j=>new a.OverscaledTileID(j.overscaledZ,j.wrap,j.canonical.z,j.canonical.x,j.canonical.y===(1<<j.canonical.z)-1?0:j.canonical.y+1)],S=j=>{const H=r.getSource().minzoom,Z=ie=>{const Q=r.getTileByID(ie);if(Q&&Q.hasData())return Q.getBucket(_)},ne=[0,-1,1];for(const ie of ne){if(j.overscaledZ+ie<H)continue;const Q=Z(j.calculateScaledKey(j.overscaledZ+ie));if(Q)return Q}},C=[0,0,0],z=(j,H)=>(C[0]=Math.min(j.min.y,H.min.y),C[1]=Math.max(j.max.y,H.max.y),C[2]=a.EXTENT-H.min.x>j.max.x?H.min.x-a.EXTENT:j.max.x,C),k=(j,H)=>(C[0]=Math.min(j.min.x,H.min.x),C[1]=Math.max(j.max.x,H.max.x),C[2]=a.EXTENT-H.min.y>j.max.y?H.min.y-a.EXTENT:j.max.y,C),R=[(j,H)=>z(j,H),(j,H)=>z(H,j),(j,H)=>k(j,H),(j,H)=>k(H,j)],U=new a.pointGeometry(0,0);let q,V,W;const $=(j,H,Z,ne,ie)=>{const Q=[[ne?Z:j,ne?j:Z,0],[ne?Z:H,ne?H:Z,0]],se=ie<0?a.EXTENT+ie:ie,xe=[ne?se:(j+H)/2,ne?(j+H)/2:se,0];return Z===0&&ie<0||Z!==0&&ie>0?y.getForTilePoints(W,[xe],!0,V):Q.push(xe),y.getForTilePoints(l,Q,!0,q),Math.max(Q[0][2],Q[1][2],xe[2])/y.exaggeration()};for(let j=0;j<4;j++){const H=(j<2?1:5)-j,Z=p.borders[j];if(Z.length===0)continue;const ne=W=b[j](l),ie=S(ne);if(!(ie&&ie instanceof a.FillExtrusionBucket&&ie.enableTerrain)||p.borderDoneWithNeighborZ[j]===ie.canonical.z&&ie.borderDoneWithNeighborZ[H]===p.canonical.z||(V=y.findDEMTileFor(ne),!V||!V.dem))continue;if(!q){const Ce=y.findDEMTileFor(l);if(!Ce||!Ce.dem)return;q=Ce}const Q=ie.borders[H];let se=0;const xe=ie.borderDoneWithNeighborZ[H]!==p.canonical.z;if(p.canonical.z===ie.canonical.z){for(let Ce=0;Ce<Z.length;Ce++){const Ee=p.featuresOnBorder[Z[Ce]],Ge=Ee.borders[j];let fe;for(;se<Q.length&&(fe=ie.featuresOnBorder[Q[se]],!(fe.borders[H][1]>Ge[0]+3));)xe&&ie.encodeCentroid(void 0,fe,!1),se++;if(fe&&se<Q.length){const Le=se;let De=0;for(;!(fe.borders[H][0]>Ge[1]-3)&&(De++,++se!==Q.length);)fe=ie.featuresOnBorder[Q[se]];if(fe=ie.featuresOnBorder[Q[Le]],Ee.intersectsCount()>1||fe.intersectsCount()>1||De!==1){De!==1&&(se=Le),p.encodeCentroid(void 0,Ee,!1),xe&&ie.encodeCentroid(void 0,fe,!1);continue}const ve=R[j](Ee,fe),pe=j%2?a.EXTENT-1:0;U.x=$(ve[0],Math.min(a.EXTENT-1,ve[1]),pe,j<2,ve[2]),U.y=0,p.encodeCentroid(U,Ee,!1),xe&&ie.encodeCentroid(U,fe,!1)}else p.encodeCentroid(void 0,Ee,!1)}p.borderDoneWithNeighborZ[j]=ie.canonical.z,p.needsCentroidUpdate=!0,xe&&(ie.borderDoneWithNeighborZ[H]=p.canonical.z,ie.needsCentroidUpdate=!0)}else{for(const Ce of Z)p.encodeCentroid(void 0,p.featuresOnBorder[Ce],!1);if(xe){for(const Ce of Q)ie.encodeCentroid(void 0,ie.featuresOnBorder[Ce],!1);ie.borderDoneWithNeighborZ[H]=p.canonical.z,ie.needsCentroidUpdate=!0}p.borderDoneWithNeighborZ[j]=ie.canonical.z,p.needsCentroidUpdate=!0}}(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(u)}const Fu=new a.Color(1,0,0,1),np=new a.Color(0,1,0,1),rp=new a.Color(0,0,1,1),ip=new a.Color(1,0,1,1),Uu=new a.Color(0,1,1,1);function Zo(u,r,l){const p=u.context,_=u.transform,y=p.gl,b=_.projection.name==="globe",S=b?["PROJECTION_GLOBE_VIEW"]:null;let C=l.projMatrix;if(b&&a.globeToMercatorTransition(_.zoom)>0){const Ee=a.transitionTileAABBinECEF(l.canonical,_),Ge=a.globeDenormalizeECEF(Ee);C=a.multiply(new Float32Array(16),_.globeMatrix,Ge),a.multiply(C,_.projMatrix,C)}const z=u.useProgram("debug",null,S),k=r.getTileByID(l.key);u.terrain&&u.terrain.setupElevationDraw(k,z);const R=a.DepthMode.disabled,U=a.StencilMode.disabled,q=u.colorModeForRenderPass(),V="$debug";p.activeTexture.set(y.TEXTURE0),u.emptyTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),b?k._makeGlobeTileDebugBuffers(u.context,_):k._makeDebugTileBoundsBuffers(u.context,_.projection);const W=k._tileDebugBuffer||u.debugBuffer,$=k._tileDebugIndexBuffer||u.debugIndexBuffer,j=k._tileDebugSegments||u.debugSegments;z.draw(p,y.LINE_STRIP,R,U,q,a.CullFaceMode.disabled,$l(C,a.Color.red),V,W,$,j,null,null,null,[k._globeTileDebugBorderBuffer]);const H=k.latestRawTileData,Z=Math.floor((H&&H.byteLength||0)/1024),ne=r.getTile(l).tileSize,ie=512/Math.min(ne,512)*(l.overscaledZ/_.zoom)*.5;let Q=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(Q+=` => ${l.overscaledZ}`),Q+=` ${Z}kb`,function(Ee,Ge){Ee.initDebugOverlayCanvas();const fe=Ee.debugOverlayCanvas,Le=Ee.context.gl,De=Ee.debugOverlayCanvas.getContext("2d");De.clearRect(0,0,fe.width,fe.height),De.shadowColor="white",De.shadowBlur=2,De.lineWidth=1.5,De.strokeStyle="white",De.textBaseline="top",De.font="bold 36px Open Sans, sans-serif",De.fillText(Ge,5,5),De.strokeText(Ge,5,5),Ee.debugOverlayTexture.update(fe),Ee.debugOverlayTexture.bind(Le.LINEAR,Le.CLAMP_TO_EDGE)}(u,Q);const se=k._tileDebugTextBuffer||u.debugBuffer,xe=k._tileDebugTextIndexBuffer||u.quadTriangleIndexBuffer,Ce=k._tileDebugTextSegments||u.debugSegments;z.draw(p,y.TRIANGLES,R,U,a.ColorMode.alphaBlended,a.CullFaceMode.disabled,$l(C,a.Color.transparent,ie),V,se,xe,Ce,null,null,null,[k._globeTileDebugTextBuffer])}function Os(u,r,l,p){Vi(u,0,r+l/2,u.transform.width,l,p)}function Nu(u,r,l,p){Vi(u,r-l/2,0,l,u.transform.height,p)}function Vi(u,r,l,p,_,y){const b=u.context,S=b.gl;S.enable(S.SCISSOR_TEST),S.scissor(r*a.exported.devicePixelRatio,l*a.exported.devicePixelRatio,p*a.exported.devicePixelRatio,_*a.exported.devicePixelRatio),b.clear({color:y}),S.disable(S.SCISSOR_TEST)}const Fs=a.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:op}=Fs;function Si(u,r,l,p){u.emplaceBack(r,l,p)}class Xt{constructor(r){this.vertexArray=new a.StructArrayLayout3f12,this.indices=new a.StructArrayLayout3ui6,Si(this.vertexArray,-1,-1,1),Si(this.vertexArray,1,-1,1),Si(this.vertexArray,-1,1,1),Si(this.vertexArray,1,1,1),Si(this.vertexArray,-1,-1,-1),Si(this.vertexArray,1,-1,-1),Si(this.vertexArray,-1,1,-1),Si(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,op),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=a.SegmentVector.simpleSegment(0,0,36,12)}}function Gi(u,r,l,p,_,y){const b=u.gl,S=r.paint.get("sky-atmosphere-color"),C=r.paint.get("sky-atmosphere-halo-color"),z=r.paint.get("sky-atmosphere-sun-intensity"),k=((R,U,q,V,W)=>({u_matrix_3f:R,u_sun_direction:U,u_sun_intensity:q,u_color_tint_r:[V.r,V.g,V.b,V.a],u_color_tint_m:[W.r,W.g,W.b,W.a],u_luminance:5e-5}))(a.fromMat4(a.create$1(),p),_,z,S,C);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_CUBE_MAP_POSITIVE_X+y,r.skyboxTexture,0),l.draw(u,b.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,a.ColorMode.unblended,a.CullFaceMode.frontCW,k,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const e_=a.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class sp{constructor(r){const l=new a.StructArrayLayout5f20;l.emplaceBack(-1,1,1,0,0),l.emplaceBack(1,1,1,1,0),l.emplaceBack(1,-1,1,1,1),l.emplaceBack(-1,-1,1,0,1);const p=new a.StructArrayLayout3ui6;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(l,e_.members),this.indexBuffer=r.createIndexBuffer(p),this.segments=a.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Us={symbol:function(u,r,l,p,_){if(u.renderPass!=="translucent")return;const y=a.StencilMode.disabled,b=u.colorModeForRenderPass();l.layout.get("text-variable-anchor")&&function(S,C,z,k,R,U,q){const V=C.transform,W=R==="map",$=U==="map";for(const j of S){const H=k.getTile(j),Z=H.getBucket(z);if(!Z||!Z.text||!Z.text.segments.get().length)continue;const ne=a.evaluateSizeForZoom(Z.textSizeData,V.zoom),ie=Ia(j,Z.getProjection(),V),Q=V.calculatePixelsToTileUnitsMatrix(H),se=As(ie,H.tileID.canonical,$,W,V,Z.getProjection(),Q),xe=z.layout.get("icon-text-fit")!=="none"&&Z.hasIconData();if(ne){const Ce=Math.pow(2,V.zoom-H.tileID.overscaledZ);Jm(Z,W,$,q,a.symbolSize,V,se,j,Ce,ne,xe)}}}(p,u,l,r,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),_),l.paint.get("icon-opacity").constantOr(1)!==0&&Qd(u,r,l,p,!1,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),l.layout.get("icon-rotation-alignment"),l.layout.get("icon-pitch-alignment"),l.layout.get("icon-keep-upright"),y,b),l.paint.get("text-opacity").constantOr(1)!==0&&Qd(u,r,l,p,!0,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),l.layout.get("text-keep-upright"),y,b),r.map.showCollisionBoxes&&(Lu(u,r,l,p,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),Lu(u,r,l,p,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(u,r,l,p){if(u.renderPass!=="translucent")return;const _=l.paint.get("circle-opacity"),y=l.paint.get("circle-stroke-width"),b=l.paint.get("circle-stroke-opacity"),S=l.layout.get("circle-sort-key").constantOr(1)!==void 0;if(_.constantOr(1)===0&&(y.constantOr(1)===0||b.constantOr(1)===0))return;const C=u.context,z=C.gl,k=u.transform,R=u.depthModeForSublayer(0,a.DepthMode.ReadOnly),U=a.StencilMode.disabled,q=u.colorModeForRenderPass(),V=k.projection.name==="globe",W=[a.mercatorXfromLng(k.center.lng),a.mercatorYfromLat(k.center.lat)],$=[];for(let H=0;H<p.length;H++){const Z=p[H],ne=r.getTile(Z),ie=ne.getBucket(l);if(!ie||ie.projection.name!==k.projection.name)continue;const Q=ie.programConfigurations.get(l.id),se=Hd(l);V&&se.push("PROJECTION_GLOBE_VIEW");const xe=u.useProgram("circle",Q,se),Ce=ie.layoutVertexBuffer,Ee=ie.globeExtVertexBuffer,Ge=ie.indexBuffer,fe=k.projection.createInversionMatrix(k,Z.canonical),Le={programConfiguration:Q,program:xe,layoutVertexBuffer:Ce,globeExtVertexBuffer:Ee,indexBuffer:Ge,uniformValues:Ba(u,Z,ne,fe,W,l),tile:ne};if(S){const De=ie.segments.get();for(const ve of De)$.push({segments:new a.SegmentVector([ve]),sortKey:ve.sortKey,state:Le})}else $.push({segments:ie.segments,sortKey:0,state:Le})}S&&$.sort((H,Z)=>H.sortKey-Z.sortKey);const j={useDepthForOcclusion:!V};for(const H of $){const{programConfiguration:Z,program:ne,layoutVertexBuffer:ie,globeExtVertexBuffer:Q,indexBuffer:se,uniformValues:xe,tile:Ce}=H.state,Ee=H.segments;u.terrain&&u.terrain.setupElevationDraw(Ce,ne,j),u.prepareDrawProgram(C,ne,Ce.tileID.toUnwrapped()),ne.draw(C,z.TRIANGLES,R,U,q,a.CullFaceMode.disabled,xe,l.id,ie,se,Ee,l.paint,k.zoom,Z,[Q])}},heatmap:function(u,r,l,p){if(l.paint.get("heatmap-opacity")!==0)if(u.renderPass==="offscreen"){const _=u.context,y=_.gl,b=a.StencilMode.disabled,S=new a.ColorMode([y.ONE,y.ONE],a.Color.transparent,[!0,!0,!0,!0]);(function(q,V,W,$){const j=q.gl,H=V.width*$,Z=V.height*$;q.activeTexture.set(j.TEXTURE1),q.viewport.set([0,0,H,Z]);let ne=W.heatmapFbo;if(!ne||ne&&(ne.width!==H||ne.height!==Z)){ne&&ne.destroy();const ie=j.createTexture();j.bindTexture(j.TEXTURE_2D,ie),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MAG_FILTER,j.LINEAR),ne=W.heatmapFbo=q.createFramebuffer(H,Z,!1),function(Q,se,xe,Ce,Ee,Ge){const fe=Q.gl;fe.texImage2D(fe.TEXTURE_2D,0,fe.RGBA,Ee,Ge,0,fe.RGBA,Q.extRenderToTextureHalfFloat?Q.extTextureHalfFloat.HALF_FLOAT_OES:fe.UNSIGNED_BYTE,null),Ce.colorAttachment.set(xe)}(q,0,ie,ne,H,Z)}else j.bindTexture(j.TEXTURE_2D,ne.colorAttachment.get()),q.bindFramebuffer.set(ne.framebuffer)})(_,u,l,u.transform.projection.name==="globe"?.5:.25),_.clear({color:a.Color.transparent});const C=u.transform,z=C.projection.name==="globe",k=z?["PROJECTION_GLOBE_VIEW"]:null,R=z?a.CullFaceMode.frontCCW:a.CullFaceMode.disabled,U=[a.mercatorXfromLng(C.center.lng),a.mercatorYfromLat(C.center.lat)];for(let q=0;q<p.length;q++){const V=p[q];if(r.hasRenderableParent(V))continue;const W=r.getTile(V),$=W.getBucket(l);if(!$||$.projection.name!==C.projection.name)continue;const j=$.programConfigurations.get(l.id),H=u.useProgram("heatmap",j,k),{zoom:Z}=u.transform;u.terrain&&u.terrain.setupElevationDraw(W,H),u.prepareDrawProgram(_,H,V.toUnwrapped());const ne=C.projection.createInversionMatrix(C,V.canonical);H.draw(_,y.TRIANGLES,a.DepthMode.disabled,b,S,R,Iu(u,V,W,ne,U,Z,l.paint.get("heatmap-intensity")),l.id,$.layoutVertexBuffer,$.indexBuffer,$.segments,l.paint,u.transform.zoom,j,z?[$.globeExtVertexBuffer]:null)}_.viewport.set([0,0,u.width,u.height])}else u.renderPass==="translucent"&&(u.context.setColorMode(u.colorModeForRenderPass()),function(_,y){const b=_.context,S=b.gl,C=y.heatmapFbo;if(!C)return;b.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,C.colorAttachment.get()),b.activeTexture.set(S.TEXTURE1);let z=y.colorRampTexture;z||(z=y.colorRampTexture=new a.Texture(b,y.colorRamp,S.RGBA)),z.bind(S.LINEAR,S.CLAMP_TO_EDGE),_.useProgram("heatmapTexture").draw(b,S.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,_.colorModeForRenderPass(),a.CullFaceMode.disabled,((k,R,U,q)=>({u_image:0,u_color_ramp:1,u_opacity:R.paint.get("heatmap-opacity")}))(0,y),y.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,y.paint,_.transform.zoom)}(u,l))},line:function(u,r,l,p){if(u.renderPass!=="translucent")return;const _=l.paint.get("line-opacity"),y=l.paint.get("line-width");if(_.constantOr(1)===0||y.constantOr(1)===0)return;const b=u.depthModeForSublayer(0,a.DepthMode.ReadOnly),S=u.colorModeForRenderPass(),C=u.terrain&&u.terrain.renderingToTexture?1:a.exported.devicePixelRatio,z=l.paint.get("line-dasharray"),k=z.constantOr(1),R=l.layout.get("line-cap"),U=l.paint.get("line-pattern"),q=U.constantOr(1),V=l.paint.get("line-gradient"),W=l.getCrossfadeParameters(),$=q?"linePattern":"line",j=u.context,H=j.gl,Z=(ie=>{const Q=[];Kd(ie)&&Q.push("RENDER_LINE_DASH"),ie.paint.get("line-gradient")&&Q.push("RENDER_LINE_GRADIENT");const se=ie.paint.get("line-trim-offset");se[0]===0&&se[1]===0||Q.push("RENDER_LINE_TRIM_OFFSET");const xe=ie.paint.get("line-pattern").constantOr(1),Ce=ie.paint.get("line-opacity").constantOr(1)!==1;return!xe&&Ce&&Q.push("RENDER_LINE_ALPHA_DISCARD"),Q})(l);let ne=Z.includes("RENDER_LINE_ALPHA_DISCARD");u.terrain&&u.terrain.clipOrMaskOverlapStencilType()&&(ne=!1);for(const ie of p){const Q=r.getTile(ie);if(q&&!Q.patternsLoaded())continue;const se=Q.getBucket(l);if(!se)continue;u.prepareDrawTile();const xe=se.programConfigurations.get(l.id),Ce=u.useProgram($,xe,Z),Ee=U.constantOr(null);if(Ee&&Q.imageAtlas){const qe=Q.imageAtlas,Ye=qe.patternPositions[Ee.to.toString()],We=qe.patternPositions[Ee.from.toString()];Ye&&We&&xe.setConstantPatternPositions(Ye,We)}const Ge=z.constantOr(null),fe=R.constantOr(null);if(!q&&Ge&&fe&&Q.lineAtlas){const qe=Q.lineAtlas,Ye=qe.getDash(Ge.to,fe),We=qe.getDash(Ge.from,fe);Ye&&We&&xe.setConstantPatternPositions(Ye,We)}let[Le,De]=l.paint.get("line-trim-offset");(fe==="round"||fe==="square")&&Le!==De&&(Le===0&&(Le-=1),De===1&&(De+=1));const ve=u.terrain?ie.projMatrix:null,pe=q?zu(u,Q,l,W,ve,C):Yd(u,Q,l,W,ve,se.lineClipsArray.length,C,[Le,De]);if(V){const qe=se.gradients[l.id];let Ye=qe.texture;if(l.gradientVersion!==qe.version){let We=256;if(l.stepInterpolant){const at=r.getSource().maxzoom,wt=ie.canonical.z===at?Math.ceil(1<<u.transform.maxZoom-ie.canonical.z):1;We=a.clamp(a.nextPowerOfTwo(se.maxLineLength/a.EXTENT*1024*wt),256,j.maxTextureSize)}qe.gradient=a.renderColorRamp({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:We,image:qe.gradient||void 0,clips:se.lineClipsArray}),qe.texture?qe.texture.update(qe.gradient):qe.texture=new a.Texture(j,qe.gradient,H.RGBA),qe.version=l.gradientVersion,Ye=qe.texture}j.activeTexture.set(H.TEXTURE1),Ye.bind(l.stepInterpolant?H.NEAREST:H.LINEAR,H.CLAMP_TO_EDGE)}k&&(j.activeTexture.set(H.TEXTURE0),Q.lineAtlasTexture.bind(H.LINEAR,H.REPEAT),xe.updatePaintBuffers(W)),q&&(j.activeTexture.set(H.TEXTURE0),Q.imageAtlasTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),xe.updatePaintBuffers(W)),u.prepareDrawProgram(j,Ce,ie.toUnwrapped());const Ke=qe=>{Ce.draw(j,H.TRIANGLES,b,qe,S,a.CullFaceMode.disabled,pe,l.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,l.paint,u.transform.zoom,xe,[se.layoutVertexBuffer2])};if(ne){const qe=u.stencilModeForClipping(ie).ref;qe===0&&u.terrain&&j.clear({stencil:0});const Ye={func:H.EQUAL,mask:255};pe.u_alpha_discard_threshold=.8,Ke(new a.StencilMode(Ye,qe,255,H.KEEP,H.KEEP,H.INVERT)),pe.u_alpha_discard_threshold=0,Ke(new a.StencilMode(Ye,qe,255,H.KEEP,H.KEEP,H.KEEP))}else Ke(u.stencilModeForClipping(ie))}ne&&(u.resetStencilClippingMasks(),u.terrain&&j.clear({stencil:0}))},fill:function(u,r,l,p){const _=l.paint.get("fill-color"),y=l.paint.get("fill-opacity");if(y.constantOr(1)===0)return;const b=u.colorModeForRenderPass(),S=l.paint.get("fill-pattern"),C=u.opaquePassEnabledForLayer()&&!S.constantOr(1)&&_.constantOr(a.Color.transparent).a===1&&y.constantOr(0)===1?"opaque":"translucent";if(u.renderPass===C){const z=u.depthModeForSublayer(1,u.renderPass==="opaque"?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly);tp(u,r,l,p,z,b,!1)}if(u.renderPass==="translucent"&&l.paint.get("fill-antialias")){const z=u.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,a.DepthMode.ReadOnly);tp(u,r,l,p,z,b,!0)}},"fill-extrusion":function(u,r,l,p){const _=l.paint.get("fill-extrusion-opacity");if(_!==0&&u.renderPass==="translucent"){const y=new a.DepthMode(u.context.gl.LEQUAL,a.DepthMode.ReadWrite,u.depthRangeFor3D);if(_!==1||l.paint.get("fill-extrusion-pattern").constantOr(1))Bu(u,r,l,p,y,a.StencilMode.disabled,a.ColorMode.disabled),Bu(u,r,l,p,y,u.stencilModeFor3D(),u.colorModeForRenderPass()),u.resetStencilClippingMasks();else{const b=u.colorModeForRenderPass();Bu(u,r,l,p,y,a.StencilMode.disabled,b)}}},hillshade:function(u,r,l,p){if(u.renderPass!=="offscreen"&&u.renderPass!=="translucent")return;const _=u.context,y=u.depthModeForSublayer(0,a.DepthMode.ReadOnly),b=u.colorModeForRenderPass(),S=u.terrain&&u.terrain.renderingToTexture,[C,z]=u.renderPass!=="translucent"||S?[{},p]:u.stencilConfigForOverlap(p);for(const k of z){const R=r.getTile(k);if(R.needsHillshadePrepare&&u.renderPass==="offscreen")Vd(u,R,l,y,a.StencilMode.disabled,b);else if(u.renderPass==="translucent"){const U=S&&u.terrain?u.terrain.stencilModeForRTTOverlap(k):C[k.overscaledZ];Bl(u,k,R,l,y,U,b)}}_.viewport.set([0,0,u.width,u.height]),u.resetStencilClippingMasks()},raster:function(u,r,l,p,_,y){if(u.renderPass!=="translucent"||l.paint.get("raster-opacity")===0||!p.length)return;const b=u.context,S=b.gl,C=r.getSource(),z=u.useProgram("raster"),k=u.colorModeForRenderPass(),R=u.terrain&&u.terrain.renderingToTexture,[U,q]=C instanceof ae||R?[{},p]:u.stencilConfigForOverlap(p),V=q[q.length-1].overscaledZ,W=!u.options.moving;for(const $ of q){const j=R?a.DepthMode.disabled:u.depthModeForSublayer($.overscaledZ-V,l.paint.get("raster-opacity")===1?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly,S.LESS),H=$.toUnwrapped(),Z=r.getTile($);if(R&&(!Z||!Z.hasData()))continue;const ne=R?$.projMatrix:u.transform.calculateProjMatrix(H,W),ie=u.terrain&&R?u.terrain.stencilModeForRTTOverlap($):U[$.overscaledZ],Q=y?0:l.paint.get("raster-fade-duration");Z.registerFadeDuration(Q);const se=r.findLoadedParent($,0),xe=Su(Z,se,r,u.transform,Q);let Ce,Ee;u.terrain&&u.terrain.prepareDrawTile();const Ge=l.paint.get("raster-resampling")==="nearest"?S.NEAREST:S.LINEAR;b.activeTexture.set(S.TEXTURE0),Z.texture.bind(Ge,S.CLAMP_TO_EDGE),b.activeTexture.set(S.TEXTURE1),se?(se.texture.bind(Ge,S.CLAMP_TO_EDGE),Ce=Math.pow(2,se.tileID.overscaledZ-Z.tileID.overscaledZ),Ee=[Z.tileID.canonical.x*Ce%1,Z.tileID.canonical.y*Ce%1]):Z.texture.bind(Ge,S.CLAMP_TO_EDGE);const fe=Pu(ne,Ee||[0,0],Ce||1,xe,l,C instanceof ae?C.perspectiveTransform:[0,0]);if(u.prepareDrawProgram(b,z,H),C instanceof ae)C.boundsBuffer&&C.boundsSegments&&z.draw(b,S.TRIANGLES,j,a.StencilMode.disabled,k,a.CullFaceMode.disabled,fe,l.id,C.boundsBuffer,u.quadTriangleIndexBuffer,C.boundsSegments);else{const{tileBoundsBuffer:Le,tileBoundsIndexBuffer:De,tileBoundsSegments:ve}=u.getTileBoundsBuffers(Z);z.draw(b,S.TRIANGLES,j,ie,k,a.CullFaceMode.disabled,fe,l.id,Le,De,ve)}}u.resetStencilClippingMasks()},background:function(u,r,l,p){const _=l.paint.get("background-color"),y=l.paint.get("background-opacity");if(y===0)return;const b=u.context,S=b.gl,C=u.transform,z=C.tileSize,k=l.paint.get("background-pattern");if(u.isPatternMissing(k))return;const R=!k&&_.a===1&&y===1&&u.opaquePassEnabledForLayer()?"opaque":"translucent";if(u.renderPass!==R)return;const U=a.StencilMode.disabled,q=u.depthModeForSublayer(0,R==="opaque"?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly),V=u.colorModeForRenderPass(),W=u.useProgram(k?"backgroundPattern":"background");let $,j=p;j||($=u.getBackgroundTiles(),j=Object.values($).map(Z=>Z.tileID)),k&&(b.activeTexture.set(S.TEXTURE0),u.imageManager.bind(u.context));const H=l.getCrossfadeParameters();for(const Z of j){const ne=Z.toUnwrapped(),ie=p?Z.projMatrix:u.transform.calculateProjMatrix(ne);u.prepareDrawTile();const Q=r?r.getTile(Z):$?$[Z.key]:new a.Tile(Z,z,C.zoom,u),se=k?Km(ie,y,u,k,{tileID:Z,tileSize:z},H):Du(ie,y,_);u.prepareDrawProgram(b,W,ne);const{tileBoundsBuffer:xe,tileBoundsIndexBuffer:Ce,tileBoundsSegments:Ee}=u.getTileBoundsBuffers(Q);W.draw(b,S.TRIANGLES,q,U,V,a.CullFaceMode.disabled,se,l.id,xe,Ce,Ee)}},sky:function(u,r,l){const p=u.transform,_=p.projection.name==="mercator"||p.projection.name==="globe"?1:a.smoothstep(7,8,p.zoom),y=l.paint.get("sky-opacity")*_;if(y===0)return;const b=u.context,S=l.paint.get("sky-type"),C=new a.DepthMode(b.gl.LEQUAL,a.DepthMode.ReadOnly,[0,1]),z=u.frameCounter/1e3%1;S==="atmosphere"?u.renderPass==="offscreen"?l.needsSkyboxCapture(u)&&(function(k,R,U,q){const V=k.context,W=V.gl;let $=R.skyboxFbo;if(!$){$=R.skyboxFbo=V.createFramebuffer(32,32,!1),R.skyboxGeometry=new Xt(V),R.skyboxTexture=V.gl.createTexture(),W.bindTexture(W.TEXTURE_CUBE_MAP,R.skyboxTexture),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_MIN_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_MAG_FILTER,W.LINEAR);for(let ne=0;ne<6;++ne)W.texImage2D(W.TEXTURE_CUBE_MAP_POSITIVE_X+ne,0,W.RGBA,32,32,0,W.RGBA,W.UNSIGNED_BYTE,null)}V.bindFramebuffer.set($.framebuffer),V.viewport.set([0,0,32,32]);const j=R.getCenter(k,!0),H=k.useProgram("skyboxCapture"),Z=new Float64Array(16);a.identity(Z),a.rotateY(Z,Z,.5*-Math.PI),Gi(V,R,H,Z,j,0),a.identity(Z),a.rotateY(Z,Z,.5*Math.PI),Gi(V,R,H,Z,j,1),a.identity(Z),a.rotateX(Z,Z,.5*-Math.PI),Gi(V,R,H,Z,j,2),a.identity(Z),a.rotateX(Z,Z,.5*Math.PI),Gi(V,R,H,Z,j,3),a.identity(Z),Gi(V,R,H,Z,j,4),a.identity(Z),a.rotateY(Z,Z,Math.PI),Gi(V,R,H,Z,j,5),V.viewport.set([0,0,k.width,k.height])}(u,l),l.markSkyboxValid(u)):u.renderPass==="sky"&&function(k,R,U,q,V){const W=k.context,$=W.gl,j=k.transform,H=k.useProgram("skybox");W.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_CUBE_MAP,R.skyboxTexture);const Z=((ne,ie,Q,se,xe)=>({u_matrix:ne,u_sun_direction:ie,u_cubemap:0,u_opacity:se,u_temporal_offset:xe}))(j.skyboxMatrix,R.getCenter(k,!1),0,q,V);k.prepareDrawProgram(W,H),H.draw(W,$.TRIANGLES,U,a.StencilMode.disabled,k.colorModeForRenderPass(),a.CullFaceMode.backCW,Z,"skybox",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(u,l,C,y,z):S==="gradient"&&u.renderPass==="sky"&&function(k,R,U,q,V){const W=k.context,$=W.gl,j=k.transform,H=k.useProgram("skyboxGradient");R.skyboxGeometry||(R.skyboxGeometry=new Xt(W)),W.activeTexture.set($.TEXTURE0);let Z=R.colorRampTexture;Z||(Z=R.colorRampTexture=new a.Texture(W,R.colorRamp,$.RGBA)),Z.bind($.LINEAR,$.CLAMP_TO_EDGE);const ne=((ie,Q,se,xe,Ce)=>({u_matrix:ie,u_color_ramp:0,u_center_direction:Q,u_radius:a.degToRad(se),u_opacity:xe,u_temporal_offset:Ce}))(j.skyboxMatrix,R.getCenter(k,!1),R.paint.get("sky-gradient-radius"),q,V);k.prepareDrawProgram(W,H),H.draw(W,$.TRIANGLES,U,a.StencilMode.disabled,k.colorModeForRenderPass(),a.CullFaceMode.backCW,ne,"skyboxGradient",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(u,l,C,y,z)},debug:function(u,r,l){for(let p=0;p<l.length;p++)Zo(u,r,l[p])},custom:function(u,r,l){const p=u.context,_=l.implementation;if(u.transform.projection.unsupportedLayers&&u.transform.projection.unsupportedLayers.includes("custom"))a.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(u.renderPass==="offscreen"){const y=_.prerender;y&&(u.setCustomLayerDefaults(),p.setColorMode(u.colorModeForRenderPass()),y.call(_,p.gl,u.transform.customLayerMatrix()),p.setDirty(),u.setBaseState())}else if(u.renderPass==="translucent"){u.setCustomLayerDefaults(),p.setColorMode(u.colorModeForRenderPass()),p.setStencilMode(a.StencilMode.disabled);const y=_.renderingMode==="3d"?new a.DepthMode(u.context.gl.LEQUAL,a.DepthMode.ReadWrite,u.depthRangeFor3D):u.depthModeForSublayer(0,a.DepthMode.ReadOnly);p.setDepthMode(y),_.render(p.gl,u.transform.customLayerMatrix()),p.setDirty(),u.setBaseState(),p.bindFramebuffer.set(null)}}};class t_{constructor(r,l){this.context=new L(r),this.transform=l,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=a.SourceCache.maxUnderzooming+a.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Go,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(r,l){const p=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Zd(this,r));const _=this._terrain;this.transform.elevation=p?_:null,_.update(r,this.transform,l)}_updateFog(r){const l=r.fog;if(!l||this.transform.projection.name==="globe"||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,_]=l.getFovAdjustedRange(this.transform._fov);if(p>_)return void(this.transform.fogCullDistSq=null);const y=p+.78*(_-p);this.transform.fogCullDistSq=y*y}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(r,l){if(this.width=r*a.exported.devicePixelRatio,this.height=l*a.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._layers[p].resize()}setup(){const r=this.context,l=new a.StructArrayLayout2i4;l.emplaceBack(0,0),l.emplaceBack(a.EXTENT,0),l.emplaceBack(0,a.EXTENT),l.emplaceBack(a.EXTENT,a.EXTENT),this.tileExtentBuffer=r.createVertexBuffer(l,a.posAttributes.members),this.tileExtentSegments=a.SegmentVector.simpleSegment(0,0,4,2);const p=new a.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(a.EXTENT,0),p.emplaceBack(0,a.EXTENT),p.emplaceBack(a.EXTENT,a.EXTENT),this.debugBuffer=r.createVertexBuffer(p,a.posAttributes.members),this.debugSegments=a.SegmentVector.simpleSegment(0,0,4,5);const _=new a.StructArrayLayout2i4;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(_,a.posAttributes.members),this.viewportSegments=a.SegmentVector.simpleSegment(0,0,4,2);const y=new a.StructArrayLayout4i8;y.emplaceBack(0,0,0,0),y.emplaceBack(a.EXTENT,0,a.EXTENT,0),y.emplaceBack(0,a.EXTENT,0,a.EXTENT),y.emplaceBack(a.EXTENT,a.EXTENT,a.EXTENT,a.EXTENT),this.mercatorBoundsBuffer=r.createVertexBuffer(y,a.boundsAttributes.members),this.mercatorBoundsSegments=a.SegmentVector.simpleSegment(0,0,4,2);const b=new a.StructArrayLayout3ui6;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(b);const S=new a.StructArrayLayout1ui2;for(const z of[0,1,3,2,0])S.emplaceBack(z);this.debugIndexBuffer=r.createIndexBuffer(S),this.emptyTexture=new a.Texture(r,new a.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA),this.identityMat=a.create();const C=this.context.gl;this.stencilClearMode=new a.StencilMode({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO),this.loadTimeStamps.push(a.window.performance.now()),this.atmosphereBuffer=new sp(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context,l=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(r,l.TRIANGLES,a.DepthMode.disabled,this.stencilClearMode,a.ColorMode.disabled,a.CullFaceMode.disabled,Rs(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,l,p){if(!l||this.currentStencilSource===l.id||!r.isTileClipped()||!p||p.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let S=!1;for(const C of p)if(this._tileClippingMaskIDs[C.key]===void 0){S=!0;break}if(!S)return}this.currentStencilSource=l.id;const _=this.context,y=_.gl;this.nextStencilID+p.length>256&&this.clearStencil(),_.setColorMode(a.ColorMode.disabled),_.setDepthMode(a.DepthMode.disabled);const b=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of p){const C=l.getTile(S),z=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,{tileBoundsBuffer:k,tileBoundsIndexBuffer:R,tileBoundsSegments:U}=this.getTileBoundsBuffers(C);b.draw(_,y.TRIANGLES,a.DepthMode.disabled,new a.StencilMode({func:y.ALWAYS,mask:0},z,255,y.KEEP,y.KEEP,y.REPLACE),a.ColorMode.disabled,a.CullFaceMode.disabled,Rs(S.projMatrix),"$clipping",k,R,U)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,l=this.context.gl;return new a.StencilMode({func:l.NOTEQUAL,mask:255},r,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const l=this.context.gl;return new a.StencilMode({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(r){const l=this.context.gl,p=r.sort((b,S)=>S.overscaledZ-b.overscaledZ),_=p[p.length-1].overscaledZ,y=p[0].overscaledZ-_+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const b={};for(let S=0;S<y;S++)b[S+_]=new a.StencilMode({func:l.GEQUAL,mask:255},S+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=y,[b,p]}return[{[_]:a.StencilMode.disabled},p]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new a.ColorMode([r.CONSTANT_COLOR,r.ONE],new a.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?a.ColorMode.unblended:a.ColorMode.alphaBlended}depthModeForSublayer(r,l,p){if(!this.opaquePassEnabledForLayer())return a.DepthMode.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new a.DepthMode(p||this.context.gl.LEQUAL,l,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,l){this.style=r,this.options=l,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(a.exported.now()),this.imageManager.beginFrame();const p=this.style.order,_=this.style._sourceCaches;for(const C in _){const z=_[C];z.used&&z.prepare(this.context)}const y={},b={},S={};for(const C in _){const z=_[C];y[C]=z.getVisibleCoordinates(),b[C]=y[C].slice().reverse(),S[C]=z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let C=0;C<p.length;C++)if(this.style._layers[p[C]].is3D()){this.opaquePassCutoff=C;break}if(this.terrain&&(this.terrain.updateTileBinding(S),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new a.GlobeSharedBuffers(this.context)),a.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const C of p){const z=this.style._layers[C],k=r._getLayerSourceCache(z);if(!z.hasOffscreenPass()||z.isHidden(this.transform.zoom))continue;const R=k?b[k.id]:void 0;(z.type==="custom"||z.isSky()||R&&R.length)&&this.renderLayer(this,k,z,R)}if(this.depthRangeFor3D=[0,1-(r.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:l.showOverdrawInspector?a.Color.black:a.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const C=this.style._layers[p[this.currentLayer]],z=r._getLayerSourceCache(C);if(C.isSky())continue;const k=z?b[z.id]:void 0;this._renderTileClippingMasks(C,z,k),this.renderLayer(this,z,C,k)}if(this.style.fog&&this.transform.projection.supportsFog&&function(C,z){const k=C.context,R=k.gl,U=C.transform,q=new a.DepthMode(R.LEQUAL,a.DepthMode.ReadOnly,[0,1]),V=C.useProgram("globeAtmosphere",null,U.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),W=a.globeToMercatorTransition(U.zoom),$=z.properties.get("color").toArray01(),j=z.properties.get("high-color").toArray01(),H=z.properties.get("space-color").toArray01PremultipliedAlpha(),Z=a.identity$1([]);a.rotateY$1(Z,Z,-a.degToRad(U._center.lng)),a.rotateX$1(Z,Z,a.degToRad(U._center.lat)),a.rotateZ$1(Z,Z,U.angle),a.rotateX$1(Z,Z,-U._pitch);const ne=a.fromQuat(new Float32Array(16),Z),ie=a.mapValue(z.properties.get("star-intensity"),0,1,0,.25),Q=5e-4,se=a.mapValue(z.properties.get("horizon-blend"),0,1,Q,.25),xe=a.globeUseCustomAntiAliasing(C,k,U)&&se===Q?U.worldSize/(2*Math.PI*1.025)-1:U.globeRadius,Ce=C.frameCounter/1e3%1,Ee=a.length(U.globeCenterInViewSpace),Ge=Math.sqrt(Math.pow(Ee,2)-Math.pow(xe,2)),fe=Math.acos(Ge/Ee),Le=((ve,pe,Ke,qe,Ye,We,at,wt,yt,ut,Xe,Mt,Dt,nn)=>({u_frustum_tl:ve,u_frustum_tr:pe,u_frustum_br:Ke,u_frustum_bl:qe,u_horizon:Ye,u_transition:We,u_fadeout_range:at,u_color:wt,u_high_color:yt,u_space_color:ut,u_star_intensity:Xe,u_star_size:5*a.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Mt,u_horizon_angle:Dt,u_rotation_matrix:nn}))(U.frustumCorners.TL,U.frustumCorners.TR,U.frustumCorners.BR,U.frustumCorners.BL,U.frustumCorners.horizon,W,se,$,j,H,ie,Ce,fe,ne);C.prepareDrawProgram(k,V);const De=C.atmosphereBuffer;De&&V.draw(k,R.TRIANGLES,q,a.StencilMode.disabled,a.ColorMode.alphaBlended,a.CullFaceMode.backCW,Le,"skybox",De.vertexBuffer,De.indexBuffer,De.segments)}(this,this.style.fog),this.renderPass="sky",(a.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const C=this.style._layers[p[this.currentLayer]],z=r._getLayerSourceCache(C);C.isSky()&&this.renderLayer(this,z,C,z?b[z.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;){const C=this.style._layers[p[this.currentLayer]],z=r._getLayerSourceCache(C);if(C.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(C)){if(C.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const k=z?(C.type==="symbol"?S:b)[z.id]:void 0;this._renderTileClippingMasks(C,z,z?y[z.id]:void 0),this.renderLayer(this,z,C,k),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let C=null;a.values(this.style._layers).forEach(z=>{const k=r._getLayerSourceCache(z);k&&!z.isHidden(this.transform.zoom)&&(!C||C.getSource().maxzoom<k.getSource().maxzoom)&&(C=k)}),C&&this.options.showTileBoundaries&&Us.debug(this,C,C.getVisibleCoordinates())}this.options.showPadding&&function(C){const z=C.transform.padding;Os(C,C.transform.height-(z.top||0),3,Fu),Os(C,z.bottom||0,3,np),Nu(C,z.left||0,3,rp),Nu(C,C.transform.width-(z.right||0),3,ip);const k=C.transform.centerPoint;(function(R,U,q,V){Vi(R,U-1,q-10,2,20,V),Vi(R,U-10,q-1,20,2,V)})(C,k.x,C.transform.height-k.y,Uu)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(a.window.performance.now()),this.saveCanvasCopy())}}renderLayer(r,l,p,_){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||_&&_.length)&&(this.id=p.id,this.gpuTimingStart(p),r.transform.projection.unsupportedLayers&&r.transform.projection.unsupportedLayers.includes(p.type)||Us[p.type](r,l,p,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery;let p=this.gpuTimers[r.id];p||(p=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:l.createQueryEXT()}),p.calls++,l.beginQueryEXT(l.TIME_ELAPSED_EXT,p.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const r=this.context.extTimerQuery,l=r.createQueryEXT();this.deferredRenderGpuTimeQueries.push(l),r.beginQueryEXT(r.TIME_ELAPSED_EXT,l)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){const r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){const l={};for(const p in r){const _=r[p],y=this.context.extTimerQuery,b=y.getQueryObjectEXT(_.query,y.QUERY_RESULT_EXT)/1e6;y.deleteQueryEXT(_.query),l[p]=b}return l}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;const l=this.context.extTimerQuery;let p=0;for(const _ of r)p+=l.getQueryObjectEXT(_,l.QUERY_RESULT_EXT)/1e6,l.deleteQueryEXT(_);return p}translatePosMatrix(r,l,p,_,y){if(!p[0]&&!p[1])return r;const b=y?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(b){const z=Math.sin(b),k=Math.cos(b);p=[p[0]*k-p[1]*z,p[0]*z+p[1]*k]}const S=[y?p[0]:qn(l,p[0],this.transform.zoom),y?p[1]:qn(l,p[1],this.transform.zoom),0],C=new Float32Array(16);return a.translate(C,r,S),C}saveTileTexture(r){const l=this._tileTextures[r.size[0]];l?l.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const l=this._tileTextures[r];return l&&l.length>0?l.pop():null}isPatternMissing(r){if(!r)return!1;if(!r.from||!r.to)return!0;const l=this.imageManager.getPattern(r.from.toString()),p=this.imageManager.getPattern(r.to.toString());return!l||!p}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const r=this.terrain&&this.terrain.renderingToTexture,l=this.style&&this.style.fog,p=[];return this.terrainRenderModeElevated()&&p.push("TERRAIN"),this.transform.projection.name==="globe"&&p.push("GLOBE"),l&&!r&&l.getOpacity(this.transform.pitch)!==0&&p.push("FOG"),r&&p.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&p.push("OVERDRAW_INSPECTOR"),p}useProgram(r,l,p){this.cache=this.cache||{};const _=p||[],y=this.currentGlobalDefines().concat(_),b=qd.cacheKey(Tu[r],r,y,l);return this.cache[b]||(this.cache[b]=new qd(this.context,r,Tu[r],l,Wl[r],y)),this.cache[b]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=a.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(r,l,p){if(this.terrain&&this.terrain.renderingToTexture)return;const _=this.style.fog;if(_){const y=_.getOpacity(this.transform.pitch),b=((S,C,z,k,R,U,q,V,W,$,j)=>{const H=S.transform,Z=C.properties.get("color").toArray01();Z[3]=k;const ne=S.frameCounter/1e3%1;return{u_fog_matrix:z?H.calculateFogTileMatrix(z):S.identityMat,u_fog_range:C.getFovAdjustedRange(H._fov),u_fog_color:Z,u_fog_horizon_blend:C.properties.get("horizon-blend"),u_fog_temporal_offset:ne,u_frustum_tl:R,u_frustum_tr:U,u_frustum_br:q,u_frustum_bl:V,u_globe_pos:W,u_globe_radius:$,u_viewport:j,u_globe_transition:a.globeToMercatorTransition(H.zoom),u_is_globe:+(H.projection.name==="globe")}})(this,_,p,y,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*a.exported.devicePixelRatio,this.transform.height*a.exported.devicePixelRatio]);l.setFogUniformValues(r,b)}}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const r=this.context.gl,l=r.createTexture();return r.bindTexture(r.TEXTURE_2D,l),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&r.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const r=this._backgroundTiles,l=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const _ of p)l[_.key]=r[_.key]||new a.Tile(_,512,this.transform.tileZoom,this);return l}clearBackgroundTiles(){this._backgroundTiles={}}}class ju{constructor(r=0,l=0,p=0,_=0){if(isNaN(r)||r<0||isNaN(l)||l<0||isNaN(p)||p<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=l,this.left=p,this.right=_}interpolate(r,l,p){return l.top!=null&&r.top!=null&&(this.top=a.number(r.top,l.top,p)),l.bottom!=null&&r.bottom!=null&&(this.bottom=a.number(r.bottom,l.bottom,p)),l.left!=null&&r.left!=null&&(this.left=a.number(r.left,l.left,p)),l.right!=null&&r.right!=null&&(this.right=a.number(r.right,l.right,p)),this}getCenter(r,l){const p=a.clamp((this.left+r-this.right)/2,0,r),_=a.clamp((this.top+l-this.bottom)/2,0,l);return new a.pointGeometry(p,_)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new ju(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Vu(u,r){const l=a.getColumn(u,3);a.fromQuat(u,r),a.setColumn(u,3,l)}function Gu(u,r){const l=a.identity$1([]);return a.rotateZ$1(l,l,-r),a.rotateX$1(l,l,-u),l}function Fa(u,r){const l=[u[0],u[1],0],p=[r[0],r[1],0];if(a.length(l)>=1e-15){const b=a.normalize([],l);a.scale$2(p,b,a.dot(p,b)),r[0]=p[0],r[1]=p[1]}const _=a.cross([],r,u);if(a.len(_)<1e-15)return null;const y=Math.atan2(-_[1],_[0]);return Gu(Math.atan2(Math.sqrt(u[0]*u[0]+u[1]*u[1]),-u[2]),y)}class Ua{constructor(r,l){this.position=r,this.orientation=l}get position(){return this._position}set position(r){if(r){const l=r instanceof a.MercatorCoordinate?r:new a.MercatorCoordinate(r[0],r[1],r[2]);this._renderWorldCopies&&(l.x=a.wrap(l.x,0,1)),this._position=l}else this._position=null}lookAtPoint(r,l){if(this.orientation=null,!this.position)return;const p=this._elevation?this._elevation.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(r)):0,_=this.position,y=a.MercatorCoordinate.fromLngLat(r,p),b=[y.x-_.x,y.y-_.y,y.z-_.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=Fa(b,l)}setPitchBearing(r,l){this.orientation=Gu(a.degToRad(r),a.degToRad(-l))}}class qo{constructor(r,l){this._transform=a.identity([]),this.orientation=l,this.position=r}get mercatorPosition(){const r=this.position;return new a.MercatorCoordinate(r[0],r[1],r[2])}get position(){const r=a.getColumn(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var l;r&&a.setColumn(this._transform,3,[(l=r)[0],l[1],l[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||a.identity$1([]),r&&Vu(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,l){this._orientation=Gu(r,l),Vu(this._transform,this._orientation)}forward(){const r=a.getColumn(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=a.getColumn(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=a.getColumn(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,l){const p=new Float64Array(16);return a.invert(p,this.getWorldToCamera(r,l)),p}getWorldToCameraPosition(r,l,p){const _=this.position;a.scale$2(_,_,-r);const y=new Float64Array(16);return a.fromScaling(y,[p,p,p]),a.translate(y,y,_),y[10]*=l,y}getWorldToCamera(r,l){const p=new Float64Array(16),_=new Float64Array(4),y=this.position;return a.conjugate(_,this._orientation),a.scale$2(y,y,-r),a.fromQuat(p,_),a.translate(p,p,y),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=l,p[9]*=l,p[10]*=l,p[11]*=l,p}getCameraToClipPerspective(r,l,p,_){const y=new Float64Array(16);return a.perspective(y,r,l,p,_),y}getDistanceToElevation(r){const l=r===0?0:a.mercatorZfromAltitude(r,this.position[1]),p=this.forward();return(l-this.position[2])/p[2]}clone(){return new qo([...this.position],[...this.orientation])}}function Hl(u,r){const l=Na(u.projection,u.zoom,u.width,u.height),p=function(y,b,S,C,z){const k=new a.LngLat(S.lng-180*$i,S.lat),R=new a.LngLat(S.lng+180*$i,S.lat),U=y.project(k.lng,k.lat),q=y.project(R.lng,R.lat),V=-Math.atan2(q.y-U.y,q.x-U.x),W=a.MercatorCoordinate.fromLngLat(S);W.y=a.clamp(W.y,-.999975,.999975);const $=W.toLngLat(),j=y.project($.lng,$.lat),H=a.MercatorCoordinate.fromLngLat($);H.x+=$i;const Z=H.toLngLat(),ne=y.project(Z.lng,Z.lat),ie=nt(ne.x-j.x,ne.y-j.y,V),Q=a.MercatorCoordinate.fromLngLat($);Q.y+=$i;const se=Q.toLngLat(),xe=y.project(se.lng,se.lat),Ce=nt(xe.x-j.x,xe.y-j.y,V),Ee=Math.abs(ie.x)/Math.abs(Ce.y),Ge=a.identity([]);a.rotateZ(Ge,Ge,-V*(1-(z?0:C)));const fe=a.identity([]);return a.scale(fe,fe,[1,1-(1-Ee)*C,1]),fe[4]=-Ce.x/Ce.y*C,a.rotateZ(fe,fe,V),a.multiply(fe,Ge,fe),fe}(u.projection,0,u.center,l,r),_=Yl(u);return a.scale(p,p,[_,_,1]),p}function Yl(u){const r=u.projection,l=Na(u.projection,u.zoom,u.width,u.height),p=ja(r,u.center),_=ja(r,a.LngLat.convert(r.center));return Math.pow(2,p*l+(1-l)*_)}function Na(u,r,l,p,_=1/0){const y=u.range;if(!y)return 0;const b=Math.min(_,Math.max(l,p)),S=Math.log(b/1024)/Math.LN2;return a.smoothstep(y[0]+S,y[1]+S,r)}const $i=1/4e4;function ja(u,r){const l=a.clamp(r.lat,-a.MAX_MERCATOR_LATITUDE,a.MAX_MERCATOR_LATITUDE),p=new a.LngLat(r.lng-180*$i,l),_=new a.LngLat(r.lng+180*$i,l),y=u.project(p.lng,l),b=u.project(_.lng,l),S=a.MercatorCoordinate.fromLngLat(p),C=a.MercatorCoordinate.fromLngLat(_),z=b.x-y.x,k=b.y-y.y,R=C.x-S.x,U=C.y-S.y,q=Math.sqrt((R*R+U*U)/(z*z+k*k));return Math.log(q)/Math.LN2}function nt(u,r,l){const p=Math.cos(l),_=Math.sin(l);return{x:u*p-r*_,y:u*_+r*p}}class Fr{constructor(r,l,p,_,y,b,S){this.tileSize=512,this._renderWorldCopies=y===void 0||y,this._minZoom=r||0,this._maxZoom=l||22,this._minPitch=p==null?0:p,this._maxPitch=_==null?60:_,this.setProjection(b),this.setMaxBounds(S),this.width=0,this.height=0,this._center=new a.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ju,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new qo,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const r=new Fr(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.mercatorFromTransition=this.mercatorFromTransition,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(r){const l=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||l)&&this._updateCameraOnTerrain(),(r||l)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return a.pick(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const l=this.projection?this.getProjection():void 0;this.projection=a.getProjection(this.projectionOptions);const p=!B(l,this.getProjection());return p&&this._calcMatrices(),this.mercatorFromTransition=!1,p}setMercatorFromTransition(){const r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=a.getProjection({name:"mercator"});const l=r!==this.projection.name;return l&&this._calcMatrices(),l}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return a.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.pointGeometry(this.width,this.height)}get bearing(){return a.wrap(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const l=-r*Math.PI/180;var p;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=(p=new a.ARRAY_TYPE(4),a.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p),function(_,y,b){var S=y[0],C=y[1],z=y[2],k=y[3],R=Math.sin(b),U=Math.cos(b);_[0]=S*U+z*R,_[1]=C*U+k*R,_[2]=S*-R+z*U,_[3]=C*-R+k*U}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const l=a.clamp(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get aspect(){return this.width/this.height}get fovX(){return this._fov}get fovY(){const r=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/r)}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=a.degToRad(r),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){const l=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const r=this._elevation;this._centerAltitude=r.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=r.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let _=0,y=0;for(let b=0;b<l.length;b++){const S=new a.pointGeometry(l[b][0]*this.width,p+l[b][1]*(this.height-p)),C=r.pointCoordinate(S);if(!C)continue;const z=1/Math.hypot(C[0]-this._camera.position[0],C[1]-this._camera.position[1]);_+=C[3]*z,y+=z}return y===0?NaN:_/y}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const r=this._seaLevelZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*l,_=this._mercatorZfromZoom(r),y=this._mercatorZfromZoom(this._maxZoom),b=Math.max(_-p,y);this._setZoom(this._zoomFromMercatorZ(b))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let p;p=r.z<this._camera.position[2]?[l.x,l.y,l.z]:[r.x,r.y,r.z];const _=a.length(a.sub([],this._camera.position,p));return a.clamp(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let l=!1;if(r.orientation&&!a.exactEquals(r.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(r.orientation)),r.position){const p=[r.position.x,r.position.y,r.position.z];a.exactEquals$1(p,this._camera.position)||(this._setCameraPosition(p),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,l=new Ua;return l.position=new a.MercatorCoordinate(r[0],r[1],r[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(r){if(!a.length$1(r))return!1;a.normalize$1(r,r);const l=a.transformQuat([],[0,0,-1],r),p=a.transformQuat([],[0,-1,0],r);if(p[2]<0)return!1;const _=Fa(l,p);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(r){const l=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;r[2]=a.clamp(r[2],_/p,_/l),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,l,p){this._unmodified=!1,this._edgeInsets.interpolate(r,l,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const l=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(r){const l=[new a.UnwrappedTileID(0,r)];if(this.renderWorldCopies){const p=this.pointCoordinate(new a.pointGeometry(0,0)),_=this.pointCoordinate(new a.pointGeometry(this.width,0)),y=this.pointCoordinate(new a.pointGeometry(this.width,this.height)),b=this.pointCoordinate(new a.pointGeometry(0,this.height)),S=Math.floor(Math.min(p.x,_.x,y.x,b.x)),C=Math.floor(Math.max(p.x,_.x,y.x,b.x)),z=1;for(let k=S-z;k<=C+z;k++)k!==0&&l.push(new a.UnwrappedTileID(k,r))}return l}coveringTiles(r){let l=this.coveringZoomLevel(r);const p=l,_=this.elevation&&!r.isTerrainDEM,y=this.projection.name==="mercator";if(r.minzoom!==void 0&&l<r.minzoom)return[];r.maxzoom!==void 0&&l>r.maxzoom&&(l=r.maxzoom);const b=this.locationCoordinate(this.center),S=this.center.lat,C=1<<l,z=[C*b.x,C*b.y,0],k=this.projection.name==="globe",R=!k,U=a.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,R),q=k?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),V=C*a.mercatorZfromAltitude(1,this.center.lat),W=this._camera.position[2]/a.mercatorZfromAltitude(1,this.center.lat),$=[C*q.x,C*q.y,W*(R?1:V)],j=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),H=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?l:0,Z=r.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ne=r.isTerrainDEM?-Z:this._elevation?this._elevation.getMinElevationBelowMSL():0,ie=this.projection.isReprojectedInTileSpace?Yl(this):1,Q=pe=>{const qe=new a.MercatorCoordinate(pe.x+25e-6,pe.y,pe.z),Ye=new a.MercatorCoordinate(pe.x,pe.y+25e-6,pe.z),We=pe.toLngLat(),at=qe.toLngLat(),wt=Ye.toLngLat(),yt=this.locationCoordinate(We),ut=this.locationCoordinate(at),Xe=this.locationCoordinate(wt),Mt=Math.hypot(ut.x-yt.x,ut.y-yt.y),Dt=Math.hypot(Xe.x-yt.x,Xe.y-yt.y);return Math.sqrt(Mt*Dt)*ie/25e-6},se=pe=>{const Ke=Z,qe=ne;return{aabb:a.tileAABB(this,C,0,0,0,pe,qe,Ke,this.projection),zoom:0,x:0,y:0,minZ:qe,maxZ:Ke,wrap:pe,fullyVisible:!1}},xe=[];let Ce=[];const Ee=l,Ge=r.reparseOverscaled?p:l,fe=pe=>pe*pe,Le=fe((W-this._centerAltitude)*V),De=pe=>{if(!this._elevation||!pe.tileID||!y)return;const Ke=this._elevation.getMinMaxForTile(pe.tileID),qe=pe.aabb;Ke?(qe.min[2]=Ke.min,qe.max[2]=Ke.max,qe.center[2]=(qe.min[2]+qe.max[2])/2):(pe.shouldSplit=ve(pe),pe.shouldSplit||(qe.min[2]=qe.max[2]=qe.center[2]=this._centerAltitude))},ve=pe=>{if(pe.zoom<H)return!0;if(pe.zoom===Ee)return!1;if(pe.shouldSplit!=null)return pe.shouldSplit;const Ke=pe.aabb.distanceX($),qe=pe.aabb.distanceY($);let Ye=Le,We=1;if(k){Ye=fe(pe.aabb.distanceZ($));const yt=Math.pow(2,pe.zoom),ut=a.latFromMercatorY((pe.y+1)/yt),Xe=a.latFromMercatorY(pe.y/yt),Mt=Math.min(Math.max(S,ut),Xe),Dt=a.circumferenceAtLatitude(Mt)/a.circumferenceAtLatitude(S);if(We=Mt===S?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Dt/this._mercatorScaleRatio),this.zoom<=a.GLOBE_ZOOM_THRESHOLD_MIN&&pe.zoom===Ee-1&&Dt>=.9)return!0}else if(_&&(Ye=fe(pe.aabb.distanceZ($)*V)),this.projection.isReprojectedInTileSpace&&p<=5){const yt=Math.pow(2,pe.zoom),ut=Q(new a.MercatorCoordinate((pe.x+.5)/yt,(pe.y+.5)/yt));We=ut>.85?1:ut}const at=Ke*Ke+qe*qe+Ye,wt=fe((1<<Ee-pe.zoom)*j*We*((yt,ut)=>{if(ut*fe(.707)<yt)return 1;const Xe=Math.sqrt(ut/yt);return Xe/(1.4144271570014144+(Math.pow(1.1,Xe-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Ye,Le),at));return at<wt};if(this.renderWorldCopies)for(let pe=1;pe<=3;pe++)xe.push(se(-pe)),xe.push(se(pe));for(xe.push(se(0));xe.length>0;){const pe=xe.pop(),Ke=pe.x,qe=pe.y;let Ye=pe.fullyVisible;if(!Ye){const We=pe.aabb.intersects(U);if(We===0)continue;Ye=We===2}if(pe.zoom!==Ee&&ve(pe))for(let We=0;We<4;We++){const at=(Ke<<1)+We%2,wt=(qe<<1)+(We>>1),yt={aabb:y?pe.aabb.quadrant(We):a.tileAABB(this,C,pe.zoom+1,at,wt,pe.wrap,pe.minZ,pe.maxZ,this.projection),zoom:pe.zoom+1,x:at,y:wt,wrap:pe.wrap,fullyVisible:Ye,tileID:void 0,shouldSplit:void 0,minZ:pe.minZ,maxZ:pe.maxZ};_&&!k&&(yt.tileID=new a.OverscaledTileID(pe.zoom+1===Ee?Ge:pe.zoom+1,pe.wrap,pe.zoom+1,at,wt),De(yt)),xe.push(yt)}else{const We=pe.zoom===Ee?Ge:pe.zoom;if(r.minzoom&&r.minzoom>We)continue;const at=z[0]-(.5+Ke+(pe.wrap<<pe.zoom))*(1<<l-pe.zoom),wt=z[1]-.5-qe,yt=pe.tileID?pe.tileID:new a.OverscaledTileID(We,pe.wrap,pe.zoom,Ke,qe);Ce.push({tileID:yt,distanceSq:at*at+wt*wt})}}if(this.fogCullDistSq){const pe=this.fogCullDistSq,Ke=this.horizonLineFromTop();Ce=Ce.filter(qe=>{const Ye=[0,0,0,1],We=[a.EXTENT,a.EXTENT,0,1],at=this.calculateFogTileMatrix(qe.tileID.toUnwrapped());a.transformMat4$1(Ye,Ye,at),a.transformMat4$1(We,We,at);const wt=a.getAABBPointSquareDist(Ye,We);if(wt===0)return!0;let yt=!1;const ut=this._elevation;if(ut&&wt>pe&&Ke!==0){const Xe=this.calculateProjMatrix(qe.tileID.toUnwrapped());let Mt;r.isTerrainDEM||(Mt=ut.getMinMaxForTile(qe.tileID)),Mt||(Mt={min:ne,max:Z});const Dt=a.furthestTileCorner(this.rotation),nn=[Dt[0]*a.EXTENT,Dt[1]*a.EXTENT,Mt.max];a.transformMat4(nn,nn,Xe),yt=(1-nn[1])*this.height*.5<Ke}return wt<pe||yt})}return Ce.sort((pe,Ke)=>pe.distanceSq-Ke.distanceSq).map(pe=>pe.tileID)}resize(r,l){this.width=r,this.height=l,this.pixelsToGLUnits=[2/r,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const l=a.clamp(r.lat,-a.MAX_MERCATOR_LATITUDE,a.MAX_MERCATOR_LATITUDE),p=this.projection.project(r.lng,l);return new a.pointGeometry(p.x*this.worldSize,p.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(r,l){let p,_;const y=this.centerPoint;if(this.projection.name==="globe"){const S=this.worldSize;p=(l.x-y.x)/S,_=(l.y-y.y)/S}else{const S=this.pointCoordinate(l),C=this.pointCoordinate(y);p=S.x-C.x,_=S.y-C.y}const b=this.locationCoordinate(r);this.setLocation(new a.MercatorCoordinate(b.x-p,b.y-_))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r){return this.projection.locationPoint(this,r)}locationPoint3D(r){return this.projection.locationPoint(this,r,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r){return this.coordinateLocation(this.pointCoordinate3D(r))}locationCoordinate(r,l){const p=l?a.mercatorZfromAltitude(l,r.lat):void 0,_=this.projection.project(r.lng,r.lat);return new a.MercatorCoordinate(_.x,_.y,p)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,l){const p=l!=null?l:this._centerAltitude,_=[r.x,r.y,0,1],y=[r.x,r.y,1,1];a.transformMat4$1(_,_,this.pixelMatrixInverse),a.transformMat4$1(y,y,this.pixelMatrixInverse);const b=y[3];a.scale$1(_,_,1/_[3]),a.scale$1(y,y,1/b);const S=_[2],C=y[2];return{p0:_,p1:y,t:S===C?0:(p-S)/(C-S)}}screenPointToMercatorRay(r){const l=[r.x,r.y,0,1],p=[r.x,r.y,1,1];return a.transformMat4$1(l,l,this.pixelMatrixInverse),a.transformMat4$1(p,p,this.pixelMatrixInverse),a.scale$1(l,l,1/l[3]),a.scale$1(p,p,1/p[3]),l[2]=a.mercatorZfromAltitude(l[2],this._center.lat)*this.worldSize,p[2]=a.mercatorZfromAltitude(p[2],this._center.lat)*this.worldSize,a.scale$1(l,l,1/this.worldSize),a.scale$1(p,p,1/this.worldSize),new a.Ray([l[0],l[1],l[2]],a.normalize([],a.sub([],p,l)))}rayIntersectionCoordinate(r){const{p0:l,p1:p,t:_}=r,y=a.mercatorZfromAltitude(l[2],this._center.lat),b=a.mercatorZfromAltitude(p[2],this._center.lat);return new a.MercatorCoordinate(a.number(l[0],p[0],_)/this.worldSize,a.number(l[1],p[1],_)/this.worldSize,a.number(y,b,_))}pointCoordinate(r,l=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,l)}pointCoordinate3D(r){if(!this.elevation)return this.pointCoordinate(r);let l=this.projection.pointCoordinate3D(this,r.x,r.y);if(l)return new a.MercatorCoordinate(l[0],l[1],l[2]);let p=0,_=this.horizonLineFromTop();if(r.y>_)return this.pointCoordinate(r);const y=.02*_,b=r.clone();for(let S=0;S<10&&_-p>y;S++){b.y=a.number(p,_,.66);const C=this.projection.pointCoordinate3D(this,b.x,b.y);C?(_=b.y,l=C):p=b.y}return l?new a.MercatorCoordinate(l[0],l[1],l[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}_coordinatePoint(r,l){const p=l&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,_=[r.x*this.worldSize,r.y*this.worldSize,p+r.toAltitude(),1];return a.transformMat4$1(_,_,this.pixelMatrix),_[3]>0?new a.pointGeometry(_[0]/_[3],_[1]/_[3]):new a.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getGlobeBounds(){const{top:r,left:l}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,_=this.width-this._edgeInsets.right,y=this.pointCoordinate3D(new a.pointGeometry(l,r)),b=this.pointCoordinate3D(new a.pointGeometry(_,r)),S=this.pointCoordinate3D(new a.pointGeometry(_,p)),C=this.pointCoordinate3D(new a.pointGeometry(l,p));let z=Math.min(y.x,C.x),k=Math.max(b.x,S.x),R=Math.min(y.y,b.y),U=Math.max(C.y,S.y);const q=Math.pow(2,-this.zoom)/16,V=(j,H,Z,ne)=>{const ie=(j+Z)/2,Q=(H+ne)/2,se=new a.pointGeometry(ie,Q),xe=this.pointCoordinate3D(se),Ce=Math.max(0,z-xe.x,R-xe.y,xe.x-k,xe.y-U);z=Math.min(z,xe.x),k=Math.max(k,xe.x),R=Math.min(R,xe.y),U=Math.max(U,xe.y),Ce>q&&(V(j,H,ie,Q),V(ie,Q,Z,ne))};V(l,r,_,r),V(_,r,_,p),V(_,p,l,p),V(l,p,l,r);const W=new a.LngLat(a.lngFromMercatorX(k),a.latFromMercatorY(R)),$=new a.LngLat(a.lngFromMercatorX(z),a.latFromMercatorY(U));return new a.LngLatBounds($,W)}_getBounds(r,l){if(this.projection.name==="globe")return this._getGlobeBounds();const p=new a.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),_=new a.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),y=new a.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),b=new a.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let S=this.pointCoordinate(p,r),C=this.pointCoordinate(_,r);const z=this.pointCoordinate(y,l),k=this.pointCoordinate(b,l),R=(U,q)=>(q.y-U.y)/(q.x-U.x);return S.y>1&&C.y>=0?S=new a.MercatorCoordinate((1-k.y)/R(k,S)+k.x,1):S.y<0&&C.y<=1&&(S=new a.MercatorCoordinate(-k.y/R(k,S)+k.x,0)),C.y>1&&S.y>=0?C=new a.MercatorCoordinate((1-z.y)/R(z,C)+z.x,1):C.y<0&&S.y<=1&&(C=new a.MercatorCoordinate(-z.y/R(z,C)+z.x,0)),new a.LngLatBounds().extend(this.coordinateLocation(S)).extend(this.coordinateLocation(C)).extend(this.coordinateLocation(k)).extend(this.coordinateLocation(z))}_getBounds3D(){const r=this.elevation;if(!r.visibleDemTiles.length||r.isUsingMockSource())return this._getBounds(0,0);const l=r.visibleDemTiles.reduce((p,_)=>{if(_.dem){const y=_.dem.tree;p.min=Math.min(p.min,y.minimums[0]),p.max=Math.max(p.max,y.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBounds(l.min*r.exaggeration(),l.max*r.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(r=!0){const l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,p=this.height/2-l*(1-this._horizonShift);return r?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-a.MAX_MERCATOR_LATITUDE,this.maxLat=a.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=a.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=a.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=a.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=a.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,l){return this.projection.createTileMatrix(this,l,r)}calculateDistanceTileData(r){const l=r.key,p=this._distanceTileDataCache;if(p[l])return p[l];const _=r.canonical,y=1/this.height,b=this.cameraWorldSize/this.zoomScale(_.z),S=(_.x+Math.pow(2,_.z)*r.wrap)*b,C=_.y*b,z=this.point,k=this.angle,R=Math.sin(-k),U=-Math.cos(-k);return p[l]={bearing:[R,U],center:[(z.x-S)*y,(z.y-C)*y],scale:b/a.EXTENT*y},p[l]}calculateFogTileMatrix(r){const l=r.key,p=this._fogTileMatrixCache;if(p[l])return p[l];const _=this.projection.createTileMatrix(this,this.cameraWorldSize,r);return a.multiply(_,this.worldToFogMatrix,_),p[l]=new Float32Array(_),p[l]}calculateProjMatrix(r,l=!1){const p=r.key,_=l?this._alignedProjMatrixCache:this._projMatrixCache;if(_[p])return _[p];const y=this.calculatePosMatrix(r,this.worldSize);return a.multiply(y,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:l?this.alignedProjMatrix:this.projMatrix,y),_[p]=new Float32Array(y),_[p]}calculatePixelsToTileUnitsMatrix(r){const l=r.tileID.key,p=this._pixelsToTileUnitsCache;if(p[l])return p[l];const _=function(y,b){const{scale:S}=y.tileTransform,C=S*a.EXTENT/(y.tileSize*Math.pow(2,b.zoom-y.tileID.overscaledZ+y.tileID.canonical.z));return z=new Float32Array(4),U=(k=b.inverseAdjustmentMatrix)[1],q=k[2],V=k[3],$=(R=[C,C])[1],z[0]=k[0]*(W=R[0]),z[1]=U*W,z[2]=q*$,z[3]=V*$,z;var z,k,R,U,q,V,W,$}(r,this);return p[l]=_,p[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const r=this._elevation;this._updateCameraState();const l=a.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(l),_=this._camera.forward(),y=a.mercatorZfromAltitude(1,this._center.lat);p[2]/=y,_[2]/=y,a.normalize(_,_);const b=r.raycast(p,_,r.exaggeration());if(b){const S=a.scaleAndAdd([],p,_,b),C=new a.MercatorCoordinate(S[0],S[1],a.mercatorZfromAltitude(S[2],a.latFromMercatorY(S[1]))),z=(C.z+a.length([C.x-p[0],C.y-p[1],C.z-p[2]*y]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(z),this._centerAltitude=C.toAltitude(),this._center=this.coordinateLocation(C),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const r=this._elevation;this._updateCameraState();const l=a.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(l),_=r.getAtPointOrZero(new a.MercatorCoordinate(...p)),y=this._minimumHeightOverTerrain()*Math.cos(a.degToRad(this._maxPitch)),b=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*_;if(b<y){const S=this.locationCoordinate(this._center,this._centerAltitude),C=[S.x-p[0],S.y-p[1],S.z-p[2]],z=a.length(C);C[2]-=(y-b)/this._pixelsPerMercatorPixel;const k=a.length(C);if(k===0)return;a.scale$2(C,C,z/k*this._pixelsPerMercatorPixel),this._camera.position=[S.x-C[0],S.y-C[1],S.z*this._pixelsPerMercatorPixel-C[2]],this._camera.orientation=Fa(C,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){const U=this.center;return U.lat=a.clamp(U.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(U.lng=a.clamp(U.lng,this.minLng,this.maxLng)),this.center=U,void(this._constraining=!1)}const l=this._unmodified,{x:p,y:_}=this.point;let y=0,b=p,S=_;const C=this.width/2,z=this.height/2,k=this.worldMinY*this.scale,R=this.worldMaxY*this.scale;if(_-z<k&&(S=k+z),_+z>R&&(S=R-z),R-k<this.height&&(y=Math.max(y,this.height/(R-k)),S=(R+k)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const U=this.worldMinX*this.scale,q=this.worldMaxX*this.scale,V=this.worldSize/2-(U+q)/2;b=(p+V+this.worldSize)%this.worldSize-V,b-C<U&&(b=U+C),b+C>q&&(b=q-C),q-U<this.width&&(y=Math.max(y,this.width/(q-U)),b=(q+U)/2)}b===p&&S===_||(this.center=this.unproject(new a.pointGeometry(b,S))),y&&(this.zoom+=this.scaleZoom(y)),this._constrainCameraAltitude(),this._unmodified=l,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,l=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=a.mercatorZfromAltitude(1,this.center.lat)/a.mercatorZfromAltitude(1,a.GLOBE_SCALE_MATCH_LATITUDE));const p=Na(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,p),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const _=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?l:1),y=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);y[8]=2*-r.x/this.width,y[9]=2*r.y/this.height;let b=a.mul([],y,_);if(this.projection.isReprojectedInTileSpace){const ie=this.locationCoordinate(this.center),Q=a.identity([]);a.translate(Q,Q,[ie.x*this.worldSize,ie.y*this.worldSize,0]),a.multiply(Q,Q,Hl(this)),a.translate(Q,Q,[-ie.x*this.worldSize,-ie.y*this.worldSize,0]),a.multiply(b,b,Q),this.inverseAdjustmentMatrix=function(se){const xe=Hl(se,!0);return mt([],[xe[0],xe[1],xe[4],xe[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=a.scale([],b,[this.worldSize,this.worldSize,this.worldSize/l,1]),this.projMatrix=b,this.invProjMatrix=a.invert(new Float64Array(16),this.projMatrix);const S=a.invert([],y);this.frustumCorners=a.FrustumCorners.fromInvProjectionMatrix(S,this.horizonLineFromTop(),this.height);const C=new Float32Array(16);a.identity(C),a.scale(C,C,[1,-1,1]),a.rotateX(C,C,this._pitch),a.rotateZ(C,C,this.angle);const z=a.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),k=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;z[8]=2*-r.x/this.width,z[9]=2*(r.y+k)/this.height,this.skyboxMatrix=a.multiply(C,z,C);const R=this.point,U=R.x,q=R.y,V=this.width%2/2,W=this.height%2/2,$=Math.cos(this.angle),j=Math.sin(this.angle),H=U-Math.round(U)+$*V+j*W,Z=q-Math.round(q)+$*W+j*V,ne=new Float64Array(b);if(a.translate(ne,ne,[H>.5?H-1:H,Z>.5?Z-1:Z,0]),this.alignedProjMatrix=ne,b=a.create(),a.scale(b,b,[this.width/2,-this.height/2,1]),a.translate(b,b,[1,-1,0]),this.labelPlaneMatrix=b,b=a.create(),a.scale(b,b,[1,-1,1]),a.translate(b,b,[-1,-1,0]),a.scale(b,b,[2/this.width,2/this.height,1]),this.glCoordMatrix=b,this.pixelMatrix=a.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},b=a.invert(new Float64Array(16),this.pixelMatrix),!b)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=b,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=a.calculateGlobeMatrix(this);const ie=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=a.transformMat4(ie,ie,_),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=b;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSize,l=this.cameraPixelsPerMeter,p=this._camera.position,_=1/this.height/this._pixelsPerMercatorPixel,y=[r,r,l];a.scale$2(y,y,_),a.scale$2(p,p,-1),a.multiply$2(p,p,y);const b=a.create();a.translate(b,b,p),a.scale(b,b,y),this.mercatorFogMatrix=b,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,l,_)}_computeCameraPosition(r){const l=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),_=this.point,y=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*l-r/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-p[0]*y,_.y/this.worldSize-p[1]*y,r/this.worldSize*this._centerAltitude-p[2]*y]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],_=r[2];let y=1;this.projection.wrap&&(this.center=this.center.wrap()),_>0&&(y=Math.min((l-p)/_,1)),this._camera.position=a.scaleAndAdd([],this._camera.position,r,y),this._updateStateFromCamera()}_updateStateFromCamera(){const r=this._camera.position,l=this._camera.forward(),{pitch:p,bearing:_}=this._camera.getPitchBearing(),y=a.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,b=this._mercatorZfromZoom(this._maxZoom)*Math.cos(a.degToRad(this._maxPitch)),S=Math.max((r[2]-y)/Math.cos(p),b),C=this._zoomFromMercatorZ(S);a.scaleAndAdd(r,r,l,S),this._pitch=a.clamp(p,a.degToRad(this.minPitch),a.degToRad(this.maxPitch)),this.angle=a.wrap(_,-Math.PI,Math.PI),this._setZoom(a.clamp(C,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new a.MercatorCoordinate(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}zoomFromMercatorZAdjusted(r){const l=b=>{const S=this.getCameraToCenterDistance(this.projection,b);return this.scaleZoom(S/(r*this.tileSize))};let p,_=l(this.zoom),y=Math.abs(_-l(_));for(;p!==y;)_=l(_),p=y,y=Math.abs(_-l(_));return _}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(a.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,l){const p=Math.min(r.x,l.x),_=Math.max(r.x,l.x),y=Math.min(r.y,l.y),b=Math.max(r.y,l.y);if(y<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const S=[new a.pointGeometry(p,y),new a.pointGeometry(_,b),new a.pointGeometry(p,b),new a.pointGeometry(_,y)],C=this.renderWorldCopies?-3:0,z=this.renderWorldCopies?4:1;for(const k of S){const R=this.pointRayIntersection(k);if(R.t<0)return!0;const U=this.rayIntersectionCoordinate(R);if(U.x<C||U.y<0||U.x>z||U.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+a.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new a.pointGeometry(0,0),new a.pointGeometry(this.width,this.height))}zoomDeltaToMovement(r,l){const p=a.length(a.sub([],this._camera.position,r)),_=this._zoomFromMercatorZ(p)+l;return p-this._mercatorZfromZoom(_)}getCameraPoint(){if(this.projection.name==="globe"){const r=function(l,p){const _=[l[0],l[1],l[2],1];a.transformMat4$1(_,_,p);const y=Math.max(_[3],1e-6);return[_[0]/y,_[1]/y,_[2]/y,y]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new a.pointGeometry(r[0],r[1])}{const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.pointGeometry(0,r))}}getCameraToCenterDistance(r,l=this.zoom){const p=Na(r,l,this.width,this.height,1024),_=r.pixelSpaceConversion(this.center.lat,this.worldSize,p);return .5/Math.tan(.5*this._fov)*this.height*_}getWorldToCameraMatrix(){const r=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&a.multiply(r,r,this.globeMatrix),r}}function $u(u,r){let l=!1,p=null;const _=()=>{p=null,l&&(u(),p=setTimeout(_,r),l=!1)};return()=>(l=!0,p||_(),p)}class ap{constructor(r){this._hashName=r&&encodeURIComponent(r),a.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=$u(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,a.window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),a.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const r=this._map;if(!r)return"";const l=Zu(r);if(this._hashName){const p=this._hashName;let _=!1;const y=a.window.location.hash.slice(1).split("&").map(b=>{const S=b.split("=")[0];return S===p?(_=!0,`${S}=${l}`):b}).filter(b=>b);return _||y.push(`${p}=${l}`),`#${y.join("&")}`}return`#${l}`}_getCurrentHash(){const r=a.window.location.hash.replace("#","");if(this._hashName){let l;return r.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(l=p)}),(l&&l[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._map;if(!r)return!1;const l=this._getCurrentHash();if(l.length>=3&&!l.some(p=>isNaN(p))){const p=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(l[3]||0):r.getBearing();return r.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:p,pitch:+(l[4]||0)}),!0}return!1}_updateHashUnthrottled(){const r=a.window.location.href.replace(/(#.+)?$/,this.getHashString());a.window.history.replaceState(a.window.history.state,null,r)}}function Zu(u,r){const l=u.getCenter(),p=Math.round(100*u.getZoom())/100,_=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,_),b=Math.round(l.lng*y)/y,S=Math.round(l.lat*y)/y,C=u.getBearing(),z=u.getPitch();let k=r?`/${b}/${S}/${p}`:`${p}/${S}/${b}`;return(C||z)&&(k+="/"+Math.round(10*C)/10),z&&(k+=`/${Math.round(z)}`),k}const Zi={linearity:.3,easing:a.bezier(0,0,.3,1)},lp=a.extend({deceleration:2500,maxSpeed:1400},Zi),Kl=a.extend({deceleration:20,maxSpeed:1400},Zi),qu=a.extend({deceleration:1e3,maxSpeed:360},Zi),Jl=a.extend({deceleration:1e3,maxSpeed:90},Zi);class cp{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.exported.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,l=a.exported.now();for(;r.length>0&&l-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const l={zoom:0,bearing:0,pitch:0,pan:new a.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)l.zoom+=y.zoomDelta||0,l.bearing+=y.bearingDelta||0,l.pitch+=y.pitchDelta||0,y.panDelta&&l.pan._add(y.panDelta),y.around&&(l.around=y.around),y.pinchAround&&(l.pinchAround=y.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(l.pan.mag()){const y=qi(l.pan.mag(),p,a.extend({},lp,r||{}));_.offset=l.pan.mult(y.amount/l.pan.mag()),_.center=this._map.transform.center,Va(_,y)}if(l.zoom){const y=qi(l.zoom,p,Kl);_.zoom=this._map.transform.zoom+y.amount,Va(_,y)}if(l.bearing){const y=qi(l.bearing,p,qu);_.bearing=this._map.transform.bearing+a.clamp(y.amount,-179,179),Va(_,y)}if(l.pitch){const y=qi(l.pitch,p,Jl);_.pitch=this._map.transform.pitch+y.amount,Va(_,y)}if(_.zoom||_.bearing){const y=l.pinchAround===void 0?l.around:l.pinchAround;_.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),_.noMoveStart=!0,_}}function Va(u,r){(!u.duration||u.duration<r.duration)&&(u.duration=r.duration,u.easing=r.easing)}function qi(u,r,l){const{maxSpeed:p,linearity:_,deceleration:y}=l,b=a.clamp(u*_/(r/1e3),-p,p),S=Math.abs(b)/(y*_);return{easing:l.easing,duration:1e3*S,amount:b*(S/2)}}class Ur extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,p,_={}){const y=Me(l.getCanvasContainer(),p),b=l.unproject(y);super(r,a.extend({point:y,lngLat:b,originalEvent:p},_)),this._defaultPrevented=!1,this.target=l}}class Ql extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,p){const _=r==="touchend"?p.changedTouches:p.touches,y=ct(l.getCanvasContainer(),_),b=y.map(C=>l.unproject(C)),S=y.reduce((C,z,k,R)=>C.add(z.div(R.length)),new a.pointGeometry(0,0));super(r,{points:y,point:S,lngLats:b,lngLat:l.unproject(S),originalEvent:p}),this._defaultPrevented=!1}}class up extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,p){super(r,{originalEvent:p}),this._defaultPrevented=!1}}class ec{constructor(r,l){this._map=r,this._clickTolerance=l.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new up(r.type,this._map,r))}mousedown(r,l){return this._mousedownPos=l,this._firePreventable(new Ur(r.type,this._map,r))}mouseup(r){this._map.fire(new Ur(r.type,this._map,r))}preclick(r){const l=a.extend({},r);l.type="preclick",this._map.fire(new Ur(l.type,this._map,l))}click(r,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(r),this._map.fire(new Ur(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new Ur(r.type,this._map,r))}mouseover(r){this._map.fire(new Ur(r.type,this._map,r))}mouseout(r){this._map.fire(new Ur(r.type,this._map,r))}touchstart(r){return this._firePreventable(new Ql(r.type,this._map,r))}touchmove(r){this._map.fire(new Ql(r.type,this._map,r))}touchend(r){this._map.fire(new Ql(r.type,this._map,r))}touchcancel(r){this._map.fire(new Ql(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Wu{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new Ur(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ur("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new Ur(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class hp{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,l){this.isEnabled()&&r.shiftKey&&r.button===0&&(me(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(r,l){if(!this._active)return;const p=l,_=this._startPos,y=this._lastPos;if(!_||!y||y.equals(p)||!this._box&&p.dist(_)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=ye("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const b=Math.min(_.x,p.x),S=Math.max(_.x,p.x),C=Math.min(_.y,p.y),z=Math.max(_.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${b}px,${C}px)`,this._box.style.width=S-b+"px",this._box.style.height=z-C+"px")})}mouseupWindow(r,l){if(!this._active)return;const p=this._startPos,_=l;if(p&&r.button===0){if(this.reset(),He(),p.x!==_.x||p.y!==_.y)return this._map.fire(new a.Event("boxzoomend",{originalEvent:r})),{cameraAnimation:y=>y.fitScreenCoordinates(p,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),de(),delete this._startPos,delete this._lastPos}_fireEvent(r,l){return this._map.fire(new a.Event(r,{originalEvent:l}))}}function tc(u,r){const l={};for(let p=0;p<u.length;p++)l[u[p].identifier]=r[p];return l}class nc{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,l,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=r.timeStamp),p.length===this.numTouches&&(this.centroid=function(_){const y=new a.pointGeometry(0,0);for(const b of _)y._add(b);return y.div(_.length)}(l),this.touches=tc(p,l)))}touchmove(r,l,p){if(this.aborted||!this.centroid)return;const _=tc(p,l);for(const y in this.touches){const b=this.touches[y],S=_[y];(!S||S.dist(b)>30)&&(this.aborted=!0)}}touchend(r,l,p){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Ga{constructor(r){this.singleTap=new nc(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,l,p){this.singleTap.touchstart(r,l,p)}touchmove(r,l,p){this.singleTap.touchmove(r,l,p)}touchend(r,l,p){const _=this.singleTap.touchend(r,l,p);if(_){const y=r.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(_)<30;if(y&&b||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class dp{constructor(){this._zoomIn=new Ga({numTouches:1,numTaps:2}),this._zoomOut=new Ga({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,l,p){this._zoomIn.touchstart(r,l,p),this._zoomOut.touchstart(r,l,p)}touchmove(r,l,p){this._zoomIn.touchmove(r,l,p),this._zoomOut.touchmove(r,l,p)}touchend(r,l,p){const _=this._zoomIn.touchend(r,l,p),y=this._zoomOut.touchend(r,l,p);return _?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()+1,around:b.unproject(_)},{originalEvent:r})}):y?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()-1,around:b.unproject(y)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const pp={0:1,2:2};class rc{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,l){return!1}_move(r,l){return{}}mousedown(r,l){if(this._lastPoint)return;const p=dt(r);this._correctButton(r,p)&&(this._lastPoint=l,this._eventButton=p)}mousemoveWindow(r,l){const p=this._lastPoint;if(p){if(r.preventDefault(),this._eventButton!=null&&function(_,y){const b=pp[y];return _.buttons===void 0||(_.buttons&b)!==b}(r,this._eventButton))this.reset();else if(this._moved||!(l.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(p,l)}}mouseupWindow(r){this._lastPoint&&dt(r)===this._eventButton&&(this._moved&&He(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class fp extends rc{mousedown(r,l){super.mousedown(r,l),this._lastPoint&&(this._active=!0)}_correctButton(r,l){return l===0&&!r.ctrlKey}_move(r,l){return{around:l,panDelta:l.sub(r)}}}class Xu extends rc{_correctButton(r,l){return l===0&&r.ctrlKey||l===2}_move(r,l){const p=.8*(l.x-r.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(r){r.preventDefault()}}class Wo extends rc{_correctButton(r,l){return l===0&&r.ctrlKey||l===2}_move(r,l){const p=-.5*(l.y-r.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(r){r.preventDefault()}}class mp{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),a.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new a.pointGeometry(0,0)}touchstart(r,l,p){return this._calculateTransform(r,l,p)}touchmove(r,l,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1&&!a.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,l,p)}}touchend(r,l,p){this._calculateTransform(r,l,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,l,p){p.length>0&&(this._active=!0);const _=tc(p,l),y=new a.pointGeometry(0,0),b=new a.pointGeometry(0,0);let S=0;for(const z in _){const k=_[z],R=this._touches[z];R&&(y._add(k),b._add(k.sub(R)),S++,_[z]=k)}if(this._touches=_,S<this._minTouches||!b.mag())return;const C=b.div(S);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(S),panDelta:C}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ye("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class ic{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,l,p){return{}}touchstart(r,l,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([l[0],l[1]]))}touchmove(r,l,p){const _=this._firstTwoTouches;if(!_)return;r.preventDefault();const[y,b]=_,S=$a(p,l,y),C=$a(p,l,b);if(!S||!C)return;const z=this._aroundCenter?null:S.add(C).div(2);return this._move([S,C],z,r)}touchend(r,l,p){if(!this._firstTwoTouches)return;const[_,y]=this._firstTwoTouches,b=$a(p,l,_),S=$a(p,l,y);b&&S||(this._active&&He(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function $a(u,r,l){for(let p=0;p<u.length;p++)if(u[p].identifier===l)return r[p]}function Hu(u,r){return Math.log(u/r)/Math.LN2}class _p extends ic{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,l){const p=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(Hu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Hu(this._distance,p),pinchAround:l}}}function Yu(u,r){return 180*u.angleWith(r)/Math.PI}class or extends ic{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,l){const p=this._vector;if(this._vector=r[0].sub(r[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Yu(this._vector,p),pinchAround:l}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const l=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;const _=Yu(r,p);return Math.abs(_)<l}}function Ku(u){return Math.abs(u.y)>Math.abs(u.x)}class gp extends ic{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,Ku(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,l,p){const _=this._lastPoints;if(!_)return;const y=r[0].sub(_[0]),b=r[1].sub(_[1]);return this._map._cooperativeGestures&&!a.isFullscreen()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(y,b,p.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(y.y+b.y)/2*-.5})}gestureBeginsVertically(r,l,p){if(this._valid!==void 0)return this._valid;const _=r.mag()>=2,y=l.mag()>=2;if(!_&&!y)return;if(!_||!y)return this._firstMove==null&&(this._firstMove=p),p-this._firstMove<100&&void 0;const b=r.y>0==l.y>0;return Ku(r)&&Ku(l)&&b}}const n_={panStep:100,bearingStep:15,pitchStep:10};class r_{constructor(){const r=n_;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let l=0,p=0,_=0,y=0,b=0;switch(r.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:r.shiftKey?p=-1:(r.preventDefault(),y=-1);break;case 39:r.shiftKey?p=1:(r.preventDefault(),y=1);break;case 38:r.shiftKey?_=1:(r.preventDefault(),b=-1);break;case 40:r.shiftKey?_=-1:(r.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(p=0,_=0),{cameraAnimation:S=>{const C=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:Wi,zoom:l?Math.round(C)+l*(r.shiftKey?2:1):C,bearing:S.getBearing()+p*this._bearingStep,pitch:S.getPitch()+_*this._pitchStep,offset:[-y*this._panStep,-b*this._panStep],center:S.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Wi(u){return u*(2-u)}const Ju=4.000244140625;class Ns{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._handler=l,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,a.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||a.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=r.deltaMode===a.window.WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const p=a.exported.now(),_=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,l!==0&&l%Ju==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(_*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),r.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=r,this._delta-=l,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=Me(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform;this._type==="wheel"&&r.projection.wrap&&(r._center.lng>=180||r._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const l=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(this._delta!==0){const C=this._type==="wheel"&&Math.abs(this._delta)>Ju?this._wheelZoomRate:this._defaultZoomRate;let z=2/(1+Math.exp(-Math.abs(this._delta*C)));this._delta<0&&z!==0&&(z=1/z);const k=l(),R=Math.pow(2,k),U=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):R;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(U*z))),this._type==="wheel"&&(this._startZoom=k,this._easing=this._smoothOutEasing(200)),this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:l(),_=this._startZoom,y=this._easing;let b,S=!1;if(this._type==="wheel"&&_&&y){const C=Math.min((a.exported.now()-this._lastWheelEventTime)/200,1),z=y(C);b=a.number(_,p,z),C<1?this._frameId||(this._frameId=!0):S=!0}else b=p,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!S,zoomDelta:b-l(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let l=a.ease;if(this._prevEase){const p=this._prevEase,_=(a.exported.now()-p.start)/p.duration,y=p.easing(_+.01)-p.easing(_),b=.27/Math.sqrt(y*y+1e-4)*.01,S=Math.sqrt(.0729-b*b);l=a.bezier(b,S,.25,1)}return this._prevEase={start:a.exported.now(),duration:r,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ye("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(a.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Ci{constructor(r,l){this._clickZoom=r,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class oc{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,l){return r.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(r.shiftKey?-1:1),around:p.unproject(l)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class rt{constructor(){this._tap=new Ga({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,l,p){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=l[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(r,l,p))}touchmove(r,l,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const _=l[0],y=_.y-this._swipePoint.y;return this._swipePoint=_,r.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(r,l,p)}touchend(r,l,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(r,l,p)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yp{constructor(r,l,p){this._el=r,this._mousePan=l,this._touchPan=p}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class xp{constructor(r,l,p){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=l,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Za{constructor(r,l,p,_){this._el=r,this._touchZoom=l,this._touchRotate=p,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const wo=u=>u.zoom||u.drag||u.pitch||u.rotate;class vp extends a.Event{}class wp{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,l){const p=a.sub([],l,r);this.radius=a.length(p[2]<0?a.div([],p,this.constants):[p[0],p[1],0])}projectRay(r){a.div(r,r,this.constants),a.normalize(r,r),a.mul$1(r,r,this.constants);const l=a.scale$2([],r,this.radius);if(l[2]>0){const p=a.scale$2([],[0,0,1],a.dot(l,[0,0,1])),_=a.scale$2([],a.normalize([],[l[0],l[1],0]),this.radius),y=a.add([],l,a.scale$2([],a.sub([],a.add([],_,p),l),2));l[0]=y[0],l[1]=y[1]}return l}}function qa(u){return u.panDelta&&u.panDelta.mag()||u.zoomDelta||u.bearingDelta||u.pitchDelta}class bp{constructor(r,l){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new cp(r),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new wp,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),a.bindAll(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[a.window.document,"mousemove",{capture:!0}],[a.window.document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[a.window,"blur",void 0]];for(const[_,y,b]of this._listeners)_.addEventListener(y,_===a.window.document?this.handleWindowEvent:this.handleEvent,b)}destroy(){for(const[r,l,p]of this._listeners)r.removeEventListener(l,r===a.window.document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(r){const l=this._map,p=l.getCanvasContainer();this._add("mapEvent",new ec(l,r));const _=l.boxZoom=new hp(l,r);this._add("boxZoom",_);const y=new dp,b=new oc;l.doubleClickZoom=new Ci(b,y),this._add("tapZoom",y),this._add("clickZoom",b);const S=new rt;this._add("tapDragZoom",S);const C=l.touchPitch=new gp(l);this._add("touchPitch",C);const z=new Xu(r),k=new Wo(r);l.dragRotate=new xp(r,z,k),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",k,["mouseRotate"]);const R=new fp(r),U=new mp(l,r);l.dragPan=new yp(p,R,U),this._add("mousePan",R),this._add("touchPan",U,["touchZoom","touchRotate"]);const q=new or,V=new _p;l.touchZoomRotate=new Za(p,V,q,S),this._add("touchRotate",q,["touchPan","touchZoom"]),this._add("touchZoom",V,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Wu(l));const W=l.scrollZoom=new Ns(l,this);this._add("scrollZoom",W,["mousePan"]);const $=l.keyboard=new r_;this._add("keyboard",$);for(const j of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[j]&&l[j].enable(r[j])}_add(r,l,p){this._handlers.push({handlerName:r,handler:l,allowed:p}),this._handlersById[r]=l}stop(r){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!wo(this._eventsInProgress)||this.isZooming()}_blockedByActive(r,l,p){for(const _ in r)if(_!==p&&(!l||l.indexOf(_)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const l=[];for(const p of r)this._el.contains(p.target)&&l.push(p);return l}handleEvent(r,l){this._updatingCamera=!0;const p=r.type==="renderFrame",_=p?void 0:r,y={needsRenderFrame:!1},b={},S={},C=r.touches?this._getMapTouches(r.touches):void 0,z=C?ct(this._el,C):p?void 0:Me(this._el,r);for(const{handlerName:U,handler:q,allowed:V}of this._handlers){if(!q.isEnabled())continue;let W;this._blockedByActive(S,V,U)?q.reset():q[l||r.type]&&(W=q[l||r.type](r,z,C),this.mergeHandlerResult(y,b,W,U,_),W&&W.needsRenderFrame&&this._triggerRenderFrame()),(W||q.isActive())&&(S[U]=q)}const k={};for(const U in this._previousActiveHandlers)S[U]||(k[U]=_);this._previousActiveHandlers=S,(Object.keys(k).length||qa(y))&&(this._changes.push([y,b,k]),this._triggerRenderFrame()),(Object.keys(S).length||qa(y))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:R}=y;R&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],R(this._map))}mergeHandlerResult(r,l,p,_,y){if(!p)return;a.extend(r,p);const b={handlerName:_,originalEvent:p.originalEvent||y};p.zoomDelta!==void 0&&(l.zoom=b),p.panDelta!==void 0&&(l.drag=b),p.pitchDelta!==void 0&&(l.pitch=b),p.bearingDelta!==void 0&&(l.rotate=b)}_applyChanges(){const r={},l={},p={};for(const[_,y,b]of this._changes)_.panDelta&&(r.panDelta=(r.panDelta||new a.pointGeometry(0,0))._add(_.panDelta)),_.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(r.around=_.around),_.aroundCoord!==void 0&&(r.aroundCoord=_.aroundCoord),_.pinchAround!==void 0&&(r.pinchAround=_.pinchAround),_.noInertia&&(r.noInertia=_.noInertia),a.extend(l,y),a.extend(p,b);this._updateMapTransform(r,l,p),this._changes=[]}_updateMapTransform(r,l,p){const _=this._map,y=_.transform,b=H=>[H.x,H.y,H.z];if((H=>{const Z=this._eventsInProgress.drag;return Z&&!this._handlersById[Z.handlerName].isActive()})()&&!qa(r)){const H=y.zoom;y.cameraElevationReference="sea",y.recenterOnTerrain(),y.cameraElevationReference="ground",H!==y.zoom&&this._map._update(!0)}if(!qa(r))return void this._fireEvents(l,p,!0);let{panDelta:S,zoomDelta:C,bearingDelta:z,pitchDelta:k,around:R,aroundCoord:U,pinchAround:q}=r;q!==void 0&&(R=q),(H=>l.drag&&!this._eventsInProgress.drag)()&&R&&(this._dragOrigin=b(y.pointCoordinate3D(R)),this._trackingEllipsoid.setup(y._camera.position,this._dragOrigin)),y.cameraElevationReference="sea",_._stop(!0),R=R||_.transform.centerPoint,z&&(y.bearing+=z),k&&(y.pitch+=k),y._updateCameraState();const V=[0,0,0];if(S)if(y.projection.name==="mercator"){const H=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(R).dir),Z=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(R.sub(S)).dir);V[0]=Z[0]-H[0],V[1]=Z[1]-H[1]}else{const H=y.pointCoordinate(R);if(y.projection.name==="globe"){S=S.rotate(-y.angle);const Z=y._pixelsPerMercatorPixel/y.worldSize;V[0]=-S.x*a.mercatorScale(a.latFromMercatorY(H.y))*Z,V[1]=-S.y*a.mercatorScale(y.center.lat)*Z}else{const Z=y.pointCoordinate(R.sub(S));H&&Z&&(V[0]=Z.x-H.x,V[1]=Z.y-H.y)}}const W=y.zoom,$=[0,0,0];if(C){const H=b(U||y.pointCoordinate3D(R)),Z={dir:a.normalize([],a.sub([],H,y._camera.position))};if(Z.dir[2]<0){const ne=y.zoomDeltaToMovement(H,C);a.scale$2($,Z.dir,ne)}}const j=a.add(V,V,$);y._translateCameraConstrained(j),C&&Math.abs(y.zoom-W)>1e-4&&y.recenterOnTerrain(),y.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(l,p,!0)}_fireEvents(r,l,p){const _=wo(this._eventsInProgress),y=wo(r),b={};for(const k in r){const{originalEvent:R}=r[k];this._eventsInProgress[k]||(b[`${k}start`]=R),this._eventsInProgress[k]=r[k]}!_&&y&&this._fireEvent("movestart",y.originalEvent);for(const k in b)this._fireEvent(k,b[k]);y&&this._fireEvent("move",y.originalEvent);for(const k in r){const{originalEvent:R}=r[k];this._fireEvent(k,R)}const S={};let C;for(const k in this._eventsInProgress){const{handlerName:R,originalEvent:U}=this._eventsInProgress[k];this._handlersById[R].isActive()||(delete this._eventsInProgress[k],C=l[R]||U,S[`${k}end`]=C)}for(const k in S)this._fireEvent(k,S[k]);const z=wo(this._eventsInProgress);if(p&&(_||y)&&!z){this._updatingCamera=!0;const k=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),R=U=>U!==0&&-this._bearingSnap<U&&U<this._bearingSnap;k?(R(k.bearing||this._map.getBearing())&&(k.bearing=0),this._map.easeTo(k,{originalEvent:C})):(this._map.fire(new a.Event("moveend",{originalEvent:C})),R(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,l){this._map.fire(new a.Event(r,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new vp("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Qu="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Tp extends a.Evented{constructor(r,l){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=l.bearingSnap,a.bindAll(["_renderFrameCallback"],this)}getCenter(){return new a.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(r,l){return this.jumpTo({center:r},l)}panBy(r,l,p){return r=a.pointGeometry.convert(r).mult(-1),this.panTo(this.transform.center,a.extend({offset:r},l),p)}panTo(r,l,p){return this.easeTo(a.extend({center:r},l),p)}getZoom(){return this.transform.zoom}setZoom(r,l){return this.jumpTo({zoom:r},l),this}zoomTo(r,l,p){return this.easeTo(a.extend({zoom:r},l),p)}zoomIn(r,l){return this.zoomTo(this.getZoom()+1,r,l),this}zoomOut(r,l){return this.zoomTo(this.getZoom()-1,r,l),this}getBearing(){return this.transform.bearing}setBearing(r,l){return this.jumpTo({bearing:r},l),this}getPadding(){return this.transform.padding}setPadding(r,l){return this.jumpTo({padding:r},l),this}rotateTo(r,l,p){return this.easeTo(a.extend({bearing:r},l),p)}resetNorth(r,l){return this.rotateTo(0,a.extend({duration:1e3},r),l),this}resetNorthPitch(r,l){return this.easeTo(a.extend({bearing:0,pitch:0,duration:1e3},r),l),this}snapToNorth(r,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,l):this}getPitch(){return this.transform.pitch}setPitch(r,l){return this.jumpTo({pitch:r},l),this}cameraForBounds(r,l){r=a.LngLatBounds.convert(r);const p=l&&l.bearing||0,_=r.getNorthWest(),y=r.getSouthEast();return this._cameraForBounds(this.transform,_,y,p,l)}_extendCameraOptions(r){const l={top:0,bottom:0,right:0,left:0};if(typeof(r=a.extend({padding:l,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding=="number"){const p=r.padding;r.padding={top:p,bottom:p,right:p,left:p}}return r.padding=a.extend(l,r.padding),r}_minimumAABBFrustumDistance(r,l){const p=l.max[0]-l.min[0],_=l.max[1]-l.min[1];return p/_>r.aspect?p/(2*Math.tan(.5*r.fovX)*r.aspect):_/(2*Math.tan(.5*r.fovY)*r.aspect)}_cameraForBoundsOnGlobe(r,l,p,_,y){const b=r.clone(),S=this._extendCameraOptions(y);b.bearing=_;const C=a.LngLat.convert(l),z=a.LngLat.convert(p),k=.5*(C.lat+z.lat),R=.5*(C.lng+z.lng),U=a.latLngToECEF(k,R),q=a.normalize([],U),V=a.normalize([],a.cross([],q,[0,1,0])),W=a.cross([],V,q),$=[V[0],V[1],V[2],0,W[0],W[1],W[2],0,q[0],q[1],q[2],0,0,0,0,1],j=[U,a.latLngToECEF(C.lat,C.lng),a.latLngToECEF(z.lat,C.lng),a.latLngToECEF(z.lat,z.lng),a.latLngToECEF(C.lat,z.lng),a.latLngToECEF(k,C.lng),a.latLngToECEF(k,z.lng),a.latLngToECEF(C.lat,R),a.latLngToECEF(z.lat,R)];let H=a.Aabb.fromPoints(j.map(qe=>[a.dot(V,qe),a.dot(W,qe),a.dot(q,qe)]));const Z=a.transformMat4([],H.center,$);a.squaredLength(Z)===0&&a.set(Z,0,0,1),a.normalize(Z,Z),a.scale$2(Z,Z,a.GLOBE_RADIUS),b.center=a.ecefToLatLng(Z);const ne=b.getWorldToCameraMatrix(),ie=a.invert(new Float64Array(16),ne);H=a.Aabb.applyTransform(H,a.multiply([],ne,$)),a.transformMat4(Z,Z,ne);const Q=.5*(H.max[2]-H.min[2]),se=this._minimumAABBFrustumDistance(b,H),xe=a.scale$2([],[0,0,1],Q),Ce=a.add(xe,Z,xe),Ee=se+(b.pitch===0?0:a.distance(Z,Ce)),Ge=b.globeCenterInViewSpace,fe=a.sub([],Z,[Ge[0],Ge[1],Ge[2]]);a.normalize(fe,fe),a.scale$2(fe,fe,Ee);const Le=a.add([],Z,fe);a.transformMat4(Le,Le,ie);const De=a.earthRadius/a.GLOBE_RADIUS,ve=a.length(Le),pe=a.mercatorZfromAltitude(ve*De-a.earthRadius,0),Ke=Math.min(b.zoomFromMercatorZAdjusted(pe),S.maxZoom);return Ke>.5*(a.GLOBE_ZOOM_THRESHOLD_MIN+a.GLOBE_ZOOM_THRESHOLD_MAX)?(b.setProjection({name:"mercator"}),b.zoom=Ke,this._cameraForBounds(b,l,p,_,y)):{center:b.center,zoom:Ke,bearing:_}}queryTerrainElevation(r,l){const p=this.transform.elevation;return p?(l=a.extend({},{exaggerated:!0},l),p.getAtPoint(a.MercatorCoordinate.fromLngLat(r),null,l.exaggerated)):null}_cameraForBounds(r,l,p,_,y){if(r.projection.name==="globe")return this._cameraForBoundsOnGlobe(r,l,p,_,y);const b=r.clone(),S=this._extendCameraOptions(y),C=b.padding;b.bearing=_;const z=a.LngLat.convert(l),k=a.LngLat.convert(p),R=new a.LngLat(z.lng,k.lat),U=new a.LngLat(k.lng,z.lat),q=b.project(z),V=b.project(k),W=this.queryTerrainElevation(z),$=this.queryTerrainElevation(k),j=this.queryTerrainElevation(R),H=this.queryTerrainElevation(U),Z=[[q.x,q.y,Math.min(W||0,$||0,j||0,H||0)],[V.x,V.y,Math.max(W||0,$||0,j||0,H||0)]];let ne=a.Aabb.fromPoints(Z);const ie=b.getWorldToCameraMatrix(),Q=a.invert(new Float64Array(16),ie);ne=a.Aabb.applyTransform(ne,ie);const se=a.sub([],ne.max,ne.min),xe=C.left||0,Ce=C.right||0,Ee=C.bottom||0,Ge=C.top||0,{left:fe,right:Le,top:De,bottom:ve}=S.padding,pe=.5*(xe+Ce),Ke=.5*(Ge+Ee),qe=Math.min(b.scaleZoom(b.scale*Math.min((b.width-(xe+Ce+fe+Le))/se[0],(b.height-(Ee+Ge+ve+De))/se[1])),S.maxZoom),Ye=b.scale/b.zoomScale(qe);ne=new a.Aabb([ne.min[0]-(fe+pe)*Ye,ne.min[1]-(ve+Ke)*Ye,ne.min[2]],[ne.max[0]+(Le+pe)*Ye,ne.max[1]+(De+Ke)*Ye,ne.max[2]]);const We=.5*se[2],at=this._minimumAABBFrustumDistance(b,ne),wt=[0,0,1,0];a.transformMat4$1(wt,wt,ie),a.normalize$2(wt,wt);const yt=a.scale$2([],wt,at+We),ut=a.add([],ne.center,yt),Xe=(typeof S.offset.x=="number"&&typeof S.offset.y=="number"?new a.pointGeometry(S.offset.x,S.offset.y):a.pointGeometry.convert(S.offset)).rotate(-a.degToRad(_));ne.center[0]-=Xe.x*Ye,ne.center[1]+=Xe.y*Ye,a.transformMat4(ne.center,ne.center,Q),a.transformMat4(ut,ut,Q);const Mt=[ne.center[0],ne.center[1],ut[2]*b.pixelsPerMeter];a.scale$2(Mt,Mt,1/b.worldSize);const Dt=a.lngFromMercatorX(Mt[0]),nn=a.latFromMercatorY(Mt[1]),rn=Math.min(b._zoomFromMercatorZ(Mt[2]),S.maxZoom),Jt=new a.LngLat(Dt,nn);return b.mercatorFromTransition&&rn<.5*(a.GLOBE_ZOOM_THRESHOLD_MIN+a.GLOBE_ZOOM_THRESHOLD_MAX)?(b.setProjection({name:"globe"}),b.zoom=rn,this._cameraForBounds(b,l,p,_,y)):{center:Jt,zoom:rn,bearing:_}}fitBounds(r,l,p){const _=this.cameraForBounds(r,l);return this._fitInternal(_,l,p)}fitScreenCoordinates(r,l,p,_,y){const b=a.pointGeometry.convert(r),S=a.pointGeometry.convert(l),C=new a.pointGeometry(Math.min(b.x,S.x),Math.min(b.y,S.y)),z=new a.pointGeometry(Math.max(b.x,S.x),Math.max(b.y,S.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(b,S))return this;const k=this.transform.pointLocation3D(C),R=this.transform.pointLocation3D(z),U=this.transform.pointLocation3D(new a.pointGeometry(C.x,z.y)),q=this.transform.pointLocation3D(new a.pointGeometry(z.x,C.y)),V=[Math.min(k.lng,R.lng,U.lng,q.lng),Math.min(k.lat,R.lat,U.lat,q.lat)],W=[Math.max(k.lng,R.lng,U.lng,q.lng),Math.max(k.lat,R.lat,U.lat,q.lat)],$=this._cameraForBounds(this.transform,V,W,p,_);return this._fitInternal($,_,y)}_fitInternal(r,l,p){return r?(delete(l=a.extend(r,l)).padding,l.linear?this.easeTo(l,p):this.flyTo(l,p)):this}jumpTo(r,l){this.stop();const p=r.preloadOnly?this.transform.clone():this.transform;let _=!1,y=!1,b=!1;return"zoom"in r&&p.zoom!==+r.zoom&&(_=!0,p.zoom=+r.zoom),r.center!==void 0&&(p.center=a.LngLat.convert(r.center)),"bearing"in r&&p.bearing!==+r.bearing&&(y=!0,p.bearing=+r.bearing),"pitch"in r&&p.pitch!==+r.pitch&&(b=!0,p.pitch=+r.pitch),r.padding==null||p.isPaddingEqual(r.padding)||(p.padding=r.padding),r.preloadOnly?(this._preloadTiles(p),this):(this.fire(new a.Event("movestart",l)).fire(new a.Event("move",l)),_&&this.fire(new a.Event("zoomstart",l)).fire(new a.Event("zoom",l)).fire(new a.Event("zoomend",l)),y&&this.fire(new a.Event("rotatestart",l)).fire(new a.Event("rotate",l)).fire(new a.Event("rotateend",l)),b&&this.fire(new a.Event("pitchstart",l)).fire(new a.Event("pitch",l)).fire(new a.Event("pitchend",l)),this.fire(new a.Event("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||a.warnOnce(Qu),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,l){const p=this.transform;if(!p.projection.supportsFreeCamera)return a.warnOnce(Qu),this;this.stop();const _=p.zoom,y=p.pitch,b=p.bearing;p.setFreeCameraOptions(r);const S=_!==p.zoom,C=y!==p.pitch,z=b!==p.bearing;return this.fire(new a.Event("movestart",l)).fire(new a.Event("move",l)),S&&this.fire(new a.Event("zoomstart",l)).fire(new a.Event("zoom",l)).fire(new a.Event("zoomend",l)),z&&this.fire(new a.Event("rotatestart",l)).fire(new a.Event("rotate",l)).fire(new a.Event("rotateend",l)),C&&this.fire(new a.Event("pitchstart",l)).fire(new a.Event("pitch",l)).fire(new a.Event("pitchend",l)),this.fire(new a.Event("moveend",l)),this}easeTo(r,l){this._stop(!1,r.easeId),((r=a.extend({offset:[0,0],duration:500,easing:a.ease},r)).animate===!1||!r.essential&&a.exported.prefersReducedMotion)&&(r.duration=0);const p=this.transform,_=this.getZoom(),y=this.getBearing(),b=this.getPitch(),S=this.getPadding(),C="zoom"in r?+r.zoom:_,z="bearing"in r?this._normalizeBearing(r.bearing,y):y,k="pitch"in r?+r.pitch:b,R="padding"in r?r.padding:p.padding,U=a.pointGeometry.convert(r.offset);let q,V,W;if(p.projection.name==="globe"){const Ce=a.MercatorCoordinate.fromLngLat(p.center),Ee=U.rotate(-p.angle);Ce.x+=Ee.x/p.worldSize,Ce.y+=Ee.y/p.worldSize;const Ge=Ce.toLngLat(),fe=a.LngLat.convert(r.center||Ge);this._normalizeCenter(fe),q=p.centerPoint.add(Ee),V=new a.pointGeometry(Ce.x,Ce.y).mult(p.worldSize),W=new a.pointGeometry(a.mercatorXfromLng(fe.lng),a.mercatorYfromLat(fe.lat)).mult(p.worldSize).sub(V)}else{q=p.centerPoint.add(U);const Ce=p.pointLocation(q),Ee=a.LngLat.convert(r.center||Ce);this._normalizeCenter(Ee),V=p.project(Ce),W=p.project(Ee).sub(V)}const $=p.zoomScale(C-_);let j,H;r.around&&(j=a.LngLat.convert(r.around),H=p.locationPoint(j));const Z=this._zooming||C!==_,ne=this._rotating||y!==z,ie=this._pitching||k!==b,Q=!p.isPaddingEqual(R),se=Ce=>Ee=>{if(Z&&(Ce.zoom=a.number(_,C,Ee)),ne&&(Ce.bearing=a.number(y,z,Ee)),ie&&(Ce.pitch=a.number(b,k,Ee)),Q&&(Ce.interpolatePadding(S,R,Ee),q=Ce.centerPoint.add(U)),j)Ce.setLocationAtPoint(j,H);else{const Ge=Ce.zoomScale(Ce.zoom-_),fe=C>_?Math.min(2,$):Math.max(.5,$),Le=Math.pow(fe,1-Ee),De=Ce.unproject(V.add(W.mult(Ee*Le)).mult(Ge));Ce.setLocationAtPoint(Ce.renderWorldCopies?De.wrap():De,q)}return r.preloadOnly||this._fireMoveEvents(l),Ce};if(r.preloadOnly){const Ce=this._emulate(se,r.duration,p);return this._preloadTiles(Ce),this}const xe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Z,this._rotating=ne,this._pitching=ie,this._padding=Q,this._easeId=r.easeId,this._prepareEase(l,r.noMoveStart,xe),this._ease(se(p),Ce=>{p.recenterOnTerrain(),this._afterEase(l,Ce)},r),this}_prepareEase(r,l,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",l||p.moving||this.fire(new a.Event("movestart",r)),this._zooming&&!p.zooming&&this.fire(new a.Event("zoomstart",r)),this._rotating&&!p.rotating&&this.fire(new a.Event("rotatestart",r)),this._pitching&&!p.pitching&&this.fire(new a.Event("pitchstart",r))}_fireMoveEvents(r){this.fire(new a.Event("move",r)),this._zooming&&this.fire(new a.Event("zoom",r)),this._rotating&&this.fire(new a.Event("rotate",r)),this._pitching&&this.fire(new a.Event("pitch",r))}_afterEase(r,l){if(this._easeId&&l&&this._easeId===l)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const p=this._zooming,_=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new a.Event("zoomend",r)),_&&this.fire(new a.Event("rotateend",r)),y&&this.fire(new a.Event("pitchend",r)),this.fire(new a.Event("moveend",r))}flyTo(r,l){if(!r.essential&&a.exported.prefersReducedMotion){const Ye=a.pick(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ye,l)}this.stop(),r=a.extend({offset:[0,0],speed:1.2,curve:1.42,easing:a.ease},r);const p=this.transform,_=this.getZoom(),y=this.getBearing(),b=this.getPitch(),S=this.getPadding(),C="zoom"in r?a.clamp(+r.zoom,p.minZoom,p.maxZoom):_,z="bearing"in r?this._normalizeBearing(r.bearing,y):y,k="pitch"in r?+r.pitch:b,R="padding"in r?r.padding:p.padding,U=p.zoomScale(C-_),q=a.pointGeometry.convert(r.offset);let V=p.centerPoint.add(q);const W=p.pointLocation(V),$=a.LngLat.convert(r.center||W);this._normalizeCenter($);const j=p.project(W),H=p.project($).sub(j);let Z=r.curve;const ne=Math.max(p.width,p.height),ie=ne/U,Q=H.mag();if("minZoom"in r){const Ye=a.clamp(Math.min(r.minZoom,_,C),p.minZoom,p.maxZoom),We=ne/p.zoomScale(Ye-_);Z=Math.sqrt(We/Q*2)}const se=Z*Z;function xe(Ye){const We=(ie*ie-ne*ne+(Ye?-1:1)*se*se*Q*Q)/(2*(Ye?ie:ne)*se*Q);return Math.log(Math.sqrt(We*We+1)-We)}function Ce(Ye){return(Math.exp(Ye)-Math.exp(-Ye))/2}function Ee(Ye){return(Math.exp(Ye)+Math.exp(-Ye))/2}const Ge=xe(0);let fe=function(Ye){return Ee(Ge)/Ee(Ge+Z*Ye)},Le=function(Ye){return ne*((Ee(Ge)*(Ce(We=Ge+Z*Ye)/Ee(We))-Ce(Ge))/se)/Q;var We},De=(xe(1)-Ge)/Z;if(Math.abs(Q)<1e-6||!isFinite(De)){if(Math.abs(ne-ie)<1e-6)return this.easeTo(r,l);const Ye=ie<ne?-1:1;De=Math.abs(Math.log(ie/ne))/Z,Le=function(){return 0},fe=function(We){return Math.exp(Ye*Z*We)}}r.duration="duration"in r?+r.duration:1e3*De/("screenSpeed"in r?+r.screenSpeed/Z:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const ve=y!==z,pe=k!==b,Ke=!p.isPaddingEqual(R),qe=Ye=>We=>{const at=We*De,wt=1/fe(at);Ye.zoom=We===1?C:_+Ye.scaleZoom(wt),ve&&(Ye.bearing=a.number(y,z,We)),pe&&(Ye.pitch=a.number(b,k,We)),Ke&&(Ye.interpolatePadding(S,R,We),V=Ye.centerPoint.add(q));const yt=We===1?$:Ye.unproject(j.add(H.mult(Le(at))).mult(wt));return Ye.setLocationAtPoint(Ye.renderWorldCopies?yt.wrap():yt,V),Ye._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(l),Ye};if(r.preloadOnly){const Ye=this._emulate(qe,r.duration,p);return this._preloadTiles(Ye),this}return this._zooming=!0,this._rotating=ve,this._pitching=pe,this._padding=Ke,this._prepareEase(l,!1),this._ease(qe(p),()=>this._afterEase(l),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,l)}if(!r){const p=this.handlers;p&&p.stop(!1)}return this}_ease(r,l,p){p.animate===!1||p.duration===0?(r(1),l()):(this._easeStart=a.exported.now(),this._easeOptions=p,this._onEaseFrame=r,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((a.exported.now()-this._easeStart)/this._easeOptions.duration,1),l=this._onEaseFrame;l&&l(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,l){r=a.wrap(r,-180,180);const p=Math.abs(r-l);return Math.abs(r-360-l)<p&&(r-=360),Math.abs(r+360-l)<p&&(r+=360),r}_normalizeCenter(r){const l=this.transform;if(!l.renderWorldCopies||l.maxBounds)return;const p=r.lng-l.center.lng;r.lng+=p>180?-360:p<-180?360:0}_emulate(r,l,p){const _=Math.ceil(15*l/1e3),y=[],b=r(p.clone());for(let S=0;S<=_;S++){const C=b(S/_);y.push(C.clone())}return y}}class eh{constructor(r={}){this.options=r,a.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const l=this.options&&this.options.compact;return this._map=r,this._container=ye("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ye("button","mapboxgl-ctrl-attrib-button",this._container),ye("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ye("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),l===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(r,l){const p=this._map._getUIString(`AttributionControl.${l}`);r.setAttribute("aria-label",p),r.removeAttribute("title"),r.firstElementChild&&r.firstElementChild.setAttribute("title",p)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||a.config.ACCESS_TOKEN}];if(r){const p=l.reduce((_,y,b)=>(y.value&&(_+=`${y.key}=${y.value}${b<l.length-1?"&":""}`),_),"?");r.href=`${a.config.FEEDBACK_URL}/${p}#${Zu(this._map,!0)}`,r.rel="noopener nofollow",this._setElementTitle(r,"MapFeedback")}}_updateData(r){!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const l=this._map.style._sourceCaches;for(const _ in l){const y=l[_];if(y.used){const b=y.getSource();b.attribution&&r.indexOf(b.attribution)<0&&r.push(b.attribution)}}r.sort((_,y)=>_.length-y.length),r=r.filter((_,y)=>{for(let b=y+1;b<r.length;b++)if(r[b].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const p=r.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,r.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Wa{constructor(){a.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=ye("div","mapboxgl-ctrl");const l=ye("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&r.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(Object.entries(r).length===0)return!0;for(const l in r){const p=r[l].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const l=r[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class sc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const l=++this._id;return this._queue.push({callback:r,id:l,cancelled:!1}),l}remove(r){const l=this._currentlyRunning,p=l?this._queue.concat(l):this._queue;for(const _ of p)if(_.id===r)return void(_.cancelled=!0)}run(r=0){const l=this._currentlyRunning=this._queue;this._queue=[];for(const p of l)if(!p.cancelled&&(p.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Xa(u,r,l){if(u=new a.LngLat(u.lng,u.lat),r){const p=new a.LngLat(u.lng-360,u.lat),_=new a.LngLat(u.lng+360,u.lat),y=360*Math.ceil(Math.abs(u.lng-l.center.lng)/360),b=l.locationPoint(u).distSqr(r),S=r.x<0||r.y<0||r.x>l.width||r.y>l.height;l.locationPoint(p).distSqr(r)<b&&(S||Math.abs(p.lng-l.center.lng)<y)?u=p:l.locationPoint(_).distSqr(r)<b&&(S||Math.abs(_.lng-l.center.lng)<y)&&(u=_)}for(;Math.abs(u.lng-l.center.lng)>180;){const p=l.locationPoint(u);if(p.x>=0&&p.y>=0&&p.x<=l.width&&p.y<=l.height)break;u.lng>l.center.lng?u.lng-=360:u.lng+=360}return u}const ac={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class lc extends a.Evented{constructor(r,l){if(super(),(r instanceof a.window.HTMLElement||l)&&(r=a.extend({element:r},l)),a.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=r&&r.occludedOpacity||.2,r&&r.element)this._element=r.element,this._offset=a.pointGeometry.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=ye("div");const _=41,y=27,b=Fe("svg",{display:"block",height:_*this._scale+"px",width:y*this._scale+"px",viewBox:`0 0 ${y} ${_}`},this._element),S=Fe("radialGradient",{id:"shadowGradient"},Fe("defs",{},b));Fe("stop",{offset:"10%","stop-opacity":.4},S),Fe("stop",{offset:"100%","stop-opacity":.05},S),Fe("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},b),Fe("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},b),Fe("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},b),Fe("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},b),this._offset=a.pointGeometry.convert(r&&r.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",_=>{_.preventDefault()}),this._element.addEventListener("mousedown",_=>{_.preventDefault()});const p=this._element.classList;for(const _ in ac)p.remove(`mapboxgl-marker-anchor-${_}`);p.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){const r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=a.LngLat.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,r._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const l=r.code,p=r.charCode||r.keyCode;l!=="Space"&&l!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(r){const l=r.originalEvent.target,p=this._element;this._popup&&(l===p||p.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const r=this._map,l=this._pos;if(!r||!l)return!1;const p=r.unproject(l),_=r.getFreeCameraOptions();if(!_.position)return!1;const y=_.position.toLngLat();return y.distanceTo(p)<.9*y.distanceTo(this._lngLat)}_evaluateOpacity(){const r=this._map;if(!r)return;const l=this._pos;if(!l||l.x<0||l.x>r.transform.width||l.y<0||l.y>r.transform.height)return void this._clearFadeTimer();const p=r.unproject(l);let _;r._showingGlobe()&&a.isLngLatBehindGlobe(r.transform,this._lngLat)?_=0:(_=1-r._queryFogOpacity(p),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(_*=this._occludedOpacity)),this._element.style.opacity=`${_}`,this._element.style.pointerEvents=_>0?"auto":"none",this._popup&&this._popup._setOpacity(_),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const r=this._pos;if(!r||!this._map)return;const l=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${r.x}px,${r.y}px)
            ${ac[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${l.x}px,${l.y}px)
        `}_calculateXYTransform(){const r=this._pos,l=this._map,p=this.getPitchAlignment();if(!l||!r||p!=="map")return"";if(!l._showingGlobe()){const C=l.getPitch();return C?`rotateX(${C}deg)`:""}const _=a.radToDeg(a.globeTiltAtLngLat(l.transform,this._lngLat)),y=r.sub(a.globeCenterToScreenPoint(l.transform)),b=Math.abs(y.x)+Math.abs(y.y);if(b===0)return"";const S=_/b;return`rotateX(${-y.y*S}deg) rotateY(${y.x*S}deg)`}_calculateZTransform(){const r=this._pos,l=this._map;if(!l||!r)return"";let p=0;const _=this.getRotationAlignment();if(_==="map")if(l._showingGlobe()){const y=l.project(new a.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),b=l.project(new a.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(y);p=a.radToDeg(Math.atan2(b.y,b.x))-90}else p=-l.getBearing();else if(_==="horizon"){const y=a.smoothstep(4,6,l.getZoom()),b=a.globeCenterToScreenPoint(l.transform);b.y+=y*l.transform.height;const S=r.sub(b),C=a.radToDeg(Math.atan2(S.y,S.x));p=(C>90?C-270:C+90)*(1-y)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(r){a.window.cancelAnimationFrame(this._updateFrameId);const l=this._map;l&&(l.transform.renderWorldCopies&&(this._lngLat=Xa(this._lngLat,this._pos,l.transform)),this._pos=l.project(this._lngLat),r===!0?this._updateFrameId=a.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),l._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(l._showingGlobe()||l.getTerrain()||l.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=a.pointGeometry.convert(r),this._update(),this}_onMove(r){const l=this._map;if(!l)return;const p=this._pointerdownPos,_=this._positionDelta;if(p&&_){if(!this._isDragging){const y=this._clickTolerance||l._clickTolerance;if(r.point.dist(p)<y)return;this._isDragging=!0}this._pos=r.point.sub(_),this._lngLat=l.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.Event("dragstart"))),this.fire(new a.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new a.Event("dragend")),this._state="inactive"}_addDragHandler(r){const l=this._map,p=this._pos;l&&p&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(p),this._pointerdownPos=r.point,this._state="pending",l.on("mousemove",this._onMove),l.on("touchmove",this._onMove),l.once("mouseup",this._onUp),l.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;const l=this._map;return l&&(r?(l.on("mousedown",this._addDragHandler),l.on("touchstart",this._addDragHandler)):(l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(r){return this._occludedOpacity=r||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Ep={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Sp=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function th(u=new a.pointGeometry(0,0),r="bottom"){if(typeof u=="number"){const l=Math.round(Math.sqrt(.5*Math.pow(u,2)));switch(r){case"top":return new a.pointGeometry(0,u);case"top-left":return new a.pointGeometry(l,l);case"top-right":return new a.pointGeometry(-l,l);case"bottom":return new a.pointGeometry(0,-u);case"bottom-left":return new a.pointGeometry(l,-l);case"bottom-right":return new a.pointGeometry(-l,-l);case"left":return new a.pointGeometry(u,0);case"right":return new a.pointGeometry(-u,0)}return new a.pointGeometry(0,0)}return u instanceof a.pointGeometry||Array.isArray(u)?a.pointGeometry.convert(u):a.pointGeometry.convert(u[r]||[0,0])}class Cp{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const l=a.easeCubicInOut((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,l,p){this._start=this.getValue(l),this._end=r,this._startTime=l,this._endTime=l+p}}const Mp={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},nh={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function cc(u){u.parentNode&&u.parentNode.removeChild(u)}const Ap={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ip{constructor(r,l,p=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new Xu({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,p&&(this.mousePitch=new Wo({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),a.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(r,l){this.mouseRotate.mousedown(r,l),this.mousePitch&&this.mousePitch.mousedown(r,l),me()}move(r,l){const p=this.map,_=this.mouseRotate.mousemoveWindow(r,l),y=_&&_.bearingDelta;if(y&&p.setBearing(p.getBearing()+y),this.mousePitch){const b=this.mousePitch.mousemoveWindow(r,l),S=b&&b.pitchDelta;S&&p.setPitch(p.getPitch()+S)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart,{passive:!1}),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){de(),a.window.removeEventListener("mousemove",this.mousemove),a.window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(a.extend({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),Me(this.element,r)),a.window.addEventListener("mousemove",this.mousemove),a.window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,Me(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){r.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ct(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){r.targetTouches.length!==1?this.reset():(this._lastPos=ct(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){r.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const zp={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},rh={maxWidth:100,unit:"metric"};function kp(u,r,l){const p=uc(r),_=p/r,y={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[l];this._map._requestDomTask(()=>{this._container.style.width=u*_+"px",this._container.innerHTML=`${p}&nbsp;${y}`})}function uc(u){const r=Math.pow(10,`${Math.floor(u)}`.length-1);let l=u/r;return l=l>=10?10:l>=5?5:l>=3?3:l>=2?2:l>=1?1:function(p){const _=Math.pow(10,Math.ceil(-Math.log(p)/Math.LN10));return Math.round(p*_)/_}(l),r*l}const Ha={version:a.version,supported:G,setRTLTextPlugin:a.setRTLTextPlugin,getRTLTextPluginStatus:a.getRTLTextPluginStatus,Map:class extends Tp{constructor(u){if(a.LivePerformanceUtils.mark(a.PerformanceMarkers.create),(u=a.extend({},nh,u)).minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(u.antialias&&a.isSafariWithAntialiasingBug(a.window)&&(u.antialias=!1,a.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Fr(u.minZoom,u.maxZoom,u.minPitch,u.maxPitch,u.renderWorldCopies),u),this._interactive=u.interactive,this._minTileCacheSize=u.minTileCacheSize,this._maxTileCacheSize=u.maxTileCacheSize,this._failIfMajorPerformanceCaveat=u.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=u.preserveDrawingBuffer,this._antialias=u.antialias,this._trackResize=u.trackResize,this._bearingSnap=u.bearingSnap,this._refreshExpiredTiles=u.refreshExpiredTiles,this._fadeDuration=u.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=u.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=u.collectResourceTiming,this._optimizeForTerrain=u.optimizeForTerrain,this._language=this._parseLanguage(u.language),this._worldview=u.worldview,this._renderTaskQueue=new sc,this._domRenderTaskQueue=new sc,this._controls=[],this._markers=[],this._popups=[],this._mapId=a.uniqueId(),this._locale=a.extend({},Mp,u.locale),this._clickTolerance=u.clickTolerance,this._cooperativeGestures=u.cooperativeGestures,this._performanceMetricsCollection=u.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Cp(0),this._interactionRange=[1/0,-1/0],this._useExplicitProjection=!1,this._requestManager=new a.RequestManager(u.transformRequest,u.accessToken,u.testMode),this._silenceAuthErrors=!!u.testMode,typeof u.container=="string"){if(this._container=a.window.document.getElementById(u.container),!this._container)throw new Error(`Container '${u.container}' not found.`)}else{if(!(u.container instanceof a.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(this._container.childNodes.length>0&&a.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),u.maxBounds&&this.setMaxBounds(u.maxBounds),a.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),a.window!==void 0&&(a.window.addEventListener("online",this._onWindowOnline,!1),a.window.addEventListener("resize",this._onWindowResize,!1),a.window.addEventListener("orientationchange",this._onWindowResize,!1),a.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new bp(this,u),this._localFontFamily=u.localFontFamily,this._localIdeographFontFamily=u.localIdeographFontFamily,u.style&&this.setStyle(u.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),u.projection&&this.setProjection(u.projection),this._hash=u.hash&&new ap(typeof u.hash=="string"&&u.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch}),u.bounds&&(this.resize(),this.fitBounds(u.bounds,a.extend({},u.fitBoundsOptions,{duration:0})))),this.resize(),u.attributionControl&&this.addControl(new eh({customAttribution:u.customAttribution})),this._logoControl=new Wa,this.addControl(this._logoControl,u.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update(r.dataType==="style"),this.fire(new a.Event(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new a.Event(`${r.dataType}dataloading`,r))})}_getMapId(){return this._mapId}addControl(u,r){if(r===void 0&&(r=u.getDefaultPosition?u.getDefaultPosition():"top-right"),!u||!u.onAdd)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=u.onAdd(this);this._controls.push(u);const p=this._controlPositions[r];return r.indexOf("bottom")!==-1?p.insertBefore(l,p.firstChild):p.appendChild(l),this}removeControl(u){if(!u||!u.onRemove)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(u);return r>-1&&this._controls.splice(r,1),u.onRemove(this),this}hasControl(u){return this._controls.indexOf(u)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(u){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new a.Event("movestart",u)).fire(new a.Event("move",u)),this.fire(new a.Event("resize",u)),r&&this.fire(new a.Event("moveend",u)),this}getBounds(){return this.transform.projection.name==="globe"&&a.warnOnce('Globe projection does not support getBounds API, this API may behave unexpectedly when viewing the poles."'),this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(u){return this.transform.setMaxBounds(a.LngLatBounds.convert(u)),this._update()}setMinZoom(u){if((u=u==null?-2:u)>=-2&&u<=this.transform.maxZoom)return this.transform.minZoom=u,this._update(),this.getZoom()<u?this.setZoom(u):this.fire(new a.Event("zoomstart")).fire(new a.Event("zoom")).fire(new a.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(u){if((u=u==null?22:u)>=this.transform.minZoom)return this.transform.maxZoom=u,this._update(),this.getZoom()>u?this.setZoom(u):this.fire(new a.Event("zoomstart")).fire(new a.Event("zoom")).fire(new a.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(u){if((u=u==null?0:u)<0)throw new Error("minPitch must be greater than or equal to 0");if(u>=0&&u<=this.transform.maxPitch)return this.transform.minPitch=u,this._update(),this.getPitch()<u?this.setPitch(u):this.fire(new a.Event("pitchstart")).fire(new a.Event("pitch")).fire(new a.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(u){if((u=u==null?85:u)>85)throw new Error("maxPitch must be less than or equal to 85");if(u>=this.transform.minPitch)return this.transform.maxPitch=u,this._update(),this.getPitch()>u?this.setPitch(u):this.fire(new a.Event("pitchstart")).fire(new a.Event("pitch")).fire(new a.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(u){return this.transform.renderWorldCopies=u,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(u){return u==="auto"?a.window.navigator.language:Array.isArray(u)?u.length===0?void 0:u.map(r=>r==="auto"?a.window.navigator.language:r):u}setLanguage(u){const r=this._parseLanguage(u);if(!this.style||r===this._language)return this;this._language=r,this.style._reloadSources();for(const l of this._controls)l._setLanguage&&l._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(u){return this.style&&u!==this._worldview?(this._worldview=u,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(u){return this._lazyInitEmptyStyle(),u?typeof u=="string"&&(u={name:u}):u=null,this._useExplicitProjection=!!u,this._prioritizeAndUpdateProjection(u,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const u=this.transform,r=u.projection.name;let l;r==="globe"&&u.zoom>=a.GLOBE_ZOOM_THRESHOLD_MAX?(u.setMercatorFromTransition(),l=!0):r==="mercator"&&u.zoom<a.GLOBE_ZOOM_THRESHOLD_MAX&&(u.setProjection({name:"globe"}),l=!0),l&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(u,r){return this._updateProjection(u||r||{name:"mercator"})}_updateProjection(u){let r;if(r=u.name==="globe"&&this.transform.zoom>=a.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(u),this.style.applyProjectionUpdate(),r){this.painter.clearBackgroundTiles();for(const l in this.style._sourceCaches)this.style._sourceCaches[l].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(u){return this.transform.locationPoint3D(a.LngLat.convert(u))}unproject(u){return this.transform.pointLocation3D(a.pointGeometry.convert(u))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(u,r,l){if(u==="mouseenter"||u==="mouseover"){let p=!1;const _=b=>{const S=r.filter(z=>this.getLayer(z)),C=S.length?this.queryRenderedFeatures(b.point,{layers:S}):[];C.length?p||(p=!0,l.call(this,new Ur(u,this,b.originalEvent,{features:C}))):p=!1},y=()=>{p=!1};return{layers:new Set(r),listener:l,delegates:{mousemove:_,mouseout:y}}}if(u==="mouseleave"||u==="mouseout"){let p=!1;const _=b=>{const S=r.filter(C=>this.getLayer(C));(S.length?this.queryRenderedFeatures(b.point,{layers:S}):[]).length?p=!0:p&&(p=!1,l.call(this,new Ur(u,this,b.originalEvent)))},y=b=>{p&&(p=!1,l.call(this,new Ur(u,this,b.originalEvent)))};return{layers:new Set(r),listener:l,delegates:{mousemove:_,mouseout:y}}}{const p=_=>{const y=r.filter(S=>this.getLayer(S)),b=y.length?this.queryRenderedFeatures(_.point,{layers:y}):[];b.length&&(_.features=b,l.call(this,_),delete _.features)};return{layers:new Set(r),listener:l,delegates:{[u]:p}}}}on(u,r,l){if(l===void 0)return super.on(u,r);Array.isArray(r)||(r=[r]);const p=this._createDelegatedListener(u,r,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[u]=this._delegatedListeners[u]||[],this._delegatedListeners[u].push(p);for(const _ in p.delegates)this.on(_,p.delegates[_]);return this}once(u,r,l){if(l===void 0)return super.once(u,r);Array.isArray(r)||(r=[r]);const p=this._createDelegatedListener(u,r,l);for(const _ in p.delegates)this.once(_,p.delegates[_]);return this}off(u,r,l){if(l===void 0)return super.off(u,r);r=new Set(Array.isArray(r)?r:[r]);const p=(y,b)=>{if(y.size!==b.size)return!1;for(const S of y)if(!b.has(S))return!1;return!0},_=this._delegatedListeners?this._delegatedListeners[u]:void 0;return _&&(y=>{for(let b=0;b<y.length;b++){const S=y[b];if(S.listener===l&&p(S.layers,r)){for(const C in S.delegates)this.off(C,S.delegates[C]);return y.splice(b,1),this}}})(_),this}queryRenderedFeatures(u,r){return this.style?(r!==void 0||u===void 0||u instanceof a.pointGeometry||Array.isArray(u)||(r=u,u=void 0),this.style.queryRenderedFeatures(u=u||[[0,0],[this.transform.width,this.transform.height]],r=r||{},this.transform)):[]}querySourceFeatures(u,r){return this.style.querySourceFeatures(u,r)}setStyle(u,r){return(r=a.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r)).diff!==!1&&r.localIdeographFontFamily===this._localIdeographFontFamily&&r.localFontFamily===this._localFontFamily&&this.style&&u?(this._diffStyle(u,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(u,r))}_getUIString(u){const r=this._locale[u];if(r==null)throw new Error(`Missing UI string '${u}'`);return r}_updateStyle(u,r){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),u&&(this.style=new bi(this,r||{}),this.style.setEventedParent(this,{style:this.style}),typeof u=="string"?this.style.loadURL(u):this.style.loadJSON(u)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new bi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(u,r){if(typeof u=="string"){const l=this._requestManager.normalizeStyleURL(u),p=this._requestManager.transformRequest(l,a.ResourceType.Style);a.getJSON(p,(_,y)=>{_?this.fire(new a.ErrorEvent(_)):y&&this._updateDiff(y,r)})}else typeof u=="object"&&this._updateDiff(u,r)}_updateDiff(u,r){try{this.style.setState(u)&&this._update(!0)}catch(l){a.warnOnce(`Unable to perform style diff: ${l.message||l.error||l}.  Rebuilding the style from scratch.`),this._updateStyle(u,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(a.warnOnce("There is no style added to the map."),!1)}addSource(u,r){return this._lazyInitEmptyStyle(),this.style.addSource(u,r),this._update(!0)}isSourceLoaded(u){return!!this.style&&this.style._isSourceCacheLoaded(u)}areTilesLoaded(){const u=this.style&&this.style._sourceCaches;for(const r in u){const l=u[r]._tiles;for(const p in l){const _=l[p];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}addSourceType(u,r,l){this._lazyInitEmptyStyle(),this.style.addSourceType(u,r,l)}removeSource(u){return this.style.removeSource(u),this._updateTerrain(),this._update(!0)}getSource(u){return this.style.getSource(u)}addImage(u,r,{pixelRatio:l=1,sdf:p=!1,stretchX:_,stretchY:y,content:b}={}){if(this._lazyInitEmptyStyle(),r instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&r instanceof a.window.ImageBitmap){const{width:S,height:C,data:z}=a.exported.getImageData(r);this.style.addImage(u,{data:new a.RGBAImage({width:S,height:C},z),pixelRatio:l,stretchX:_,stretchY:y,content:b,sdf:p,version:0})}else if(r.width===void 0||r.height===void 0)this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:S,height:C}=r,z=r;this.style.addImage(u,{data:new a.RGBAImage({width:S,height:C},new Uint8Array(z.data)),pixelRatio:l,stretchX:_,stretchY:y,content:b,sdf:p,version:0,userImage:z}),z.onAdd&&z.onAdd(this,u)}}updateImage(u,r){const l=this.style.getImage(u);if(!l)return void this.fire(new a.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=r instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&r instanceof a.window.ImageBitmap?a.exported.getImageData(r):r,{width:_,height:y}=p;_!==void 0&&y!==void 0?_===l.data.width&&y===l.data.height?(l.data.replace(p.data,!(r instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&r instanceof a.window.ImageBitmap)),this.style.updateImage(u,l)):this.fire(new a.ErrorEvent(new Error(`The width and height of the updated image (${_}, ${y})
                must be that same as the previous version of the image
                (${l.data.width}, ${l.data.height})`))):this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(u){return u?!!this.style.getImage(u):(this.fire(new a.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(u){this.style.removeImage(u)}loadImage(u,r){a.getImage(this._requestManager.transformRequest(u,a.ResourceType.Image),(l,p)=>{r(l,p instanceof a.window.HTMLImageElement?a.exported.getImageData(p):p)})}listImages(){return this.style.listImages()}addLayer(u,r){return this._lazyInitEmptyStyle(),this.style.addLayer(u,r),this._update(!0)}moveLayer(u,r){return this.style.moveLayer(u,r),this._update(!0)}removeLayer(u){return this.style.removeLayer(u),this._update(!0)}getLayer(u){return this.style.getLayer(u)}setLayerZoomRange(u,r,l){return this.style.setLayerZoomRange(u,r,l),this._update(!0)}setFilter(u,r,l={}){return this.style.setFilter(u,r,l),this._update(!0)}getFilter(u){return this.style.getFilter(u)}setPaintProperty(u,r,l,p={}){return this.style.setPaintProperty(u,r,l,p),this._update(!0)}getPaintProperty(u,r){return this.style.getPaintProperty(u,r)}setLayoutProperty(u,r,l,p={}){return this.style.setLayoutProperty(u,r,l,p),this._update(!0)}getLayoutProperty(u,r){return this.style.getLayoutProperty(u,r)}setLight(u,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(u,r),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(u){return this._lazyInitEmptyStyle(),!u&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(u),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(u){return this._lazyInitEmptyStyle(),this.style.setFog(u),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(u){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(a.LngLat.convert(u),this.transform):0}setFeatureState(u,r){return this.style.setFeatureState(u,r),this._update()}removeFeatureState(u,r){return this.style.removeFeatureState(u,r),this._update()}getFeatureState(u){return this.style.getFeatureState(u)}_updateContainerDimensions(){if(!this._container)return;const u=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let l,p,_,y=this._container;for(;y&&(!p||!_);){const b=a.window.getComputedStyle(y).transform;b&&b!=="none"&&(l=b.match(/matrix.*\((.+)\)/)[1].split(", "),l[0]&&l[0]!=="0"&&l[0]!=="1"&&(p=l[0]),l[3]&&l[3]!=="0"&&l[3]!=="1"&&(_=l[3])),y=y.parentElement}this._containerWidth=p?Math.abs(u/p):u,this._containerHeight=_?Math.abs(r/_):r}_detectMissingCSS(){a.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&a.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const u=this._container;u.classList.add("mapboxgl-map"),(this._missingCSSCanary=ye("div","mapboxgl-canary",u)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=ye("div","mapboxgl-canvas-container",u);this._interactive&&r.classList.add("mapboxgl-interactive"),this._canvas=ye("canvas","mapboxgl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const l=this._controlContainer=ye("div","mapboxgl-control-container",u),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(_=>{p[_]=ye("div",`mapboxgl-ctrl-${_}`,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(u,r){const l=a.exported.devicePixelRatio||1;this._canvas.width=l*Math.ceil(u),this._canvas.height=l*Math.ceil(r),this._canvas.style.width=`${u}px`,this._canvas.style.height=`${r}px`}_addMarker(u){this._markers.push(u)}_removeMarker(u){const r=this._markers.indexOf(u);r!==-1&&this._markers.splice(r,1)}_addPopup(u){this._popups.push(u)}_removePopup(u){const r=this._popups.indexOf(u);r!==-1&&this._popups.splice(r,1)}_setupPainter(){const u=a.extend({},G.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl",u)||this._canvas.getContext("experimental-webgl",u);r?(a.storeAuthState(r,!0),this.painter=new t_(r,this.transform),this.on("data",l=>{l.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),a.exported$1.testSupport(r)):this.fire(new a.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(u){u.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.Event("webglcontextlost",{originalEvent:u}))}_contextRestored(u){this._setupPainter(),this.resize(),this._update(),this.fire(new a.Event("webglcontextrestored",{originalEvent:u}))}_onMapScroll(u){if(u.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(u){return this.style?(this._styleDirty=this._styleDirty||u,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(u){return this._update(),this._renderTaskQueue.add(u)}_cancelRenderFrame(u){this._renderTaskQueue.remove(u)}_requestDomTask(u){!this.loaded()||this.loaded()&&!this.isMoving()?u():this._domRenderTaskQueue.add(u)}_render(u){let r;const l=this.painter.context.extTimerQuery,p=a.exported.now();if(this.listens("gpu-timing-frame")&&(r=l.createQueryEXT(),l.beginQueryEXT(l.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],a.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],a.window.performance.now())),this._renderTaskQueue.run(u),this._domRenderTaskQueue.run(u),this._removed)return;this._updateProjectionTransition();let _=!1;const y=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const C=this.transform.zoom,z=this.transform.pitch,k=a.exported.now();this.style.zoomHistory.update(C,k);const R=new a.EvaluationParameters(C,{now:k,fadeDuration:y,pitch:z,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),U=R.crossFadingFactor();U===1&&U===this._crossFadingFactor||(_=!0,this._crossFadingFactor=U),this.style.update(R)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let b=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),b=this._updateAverageElevation(p),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):b=this._updateAverageElevation(p),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,y,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new a.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new a.Event("load"))),this.style&&(this.style.hasTransitions()||_)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const C=a.exported.now()-p;l.endQueryEXT(l.TIME_ELAPSED_EXT,r),setTimeout(()=>{const z=l.getQueryObjectEXT(r,l.QUERY_RESULT_EXT)/1e6;l.deleteQueryEXT(r),this.fire(new a.Event("gpu-timing-frame",{cpuTime:C,gpuTime:z})),a.window.performance.mark("frame-gpu",{startTime:p,detail:{gpuTime:z}})},50)}if(this.listens("gpu-timing-layer")){const C=this.painter.collectGpuTimers();setTimeout(()=>{const z=this.painter.queryGpuTimers(C);this.fire(new a.Event("gpu-timing-layer",{layerTimes:z}))},50)}if(this.listens("gpu-timing-deferred-render")){const C=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const z=this.painter.queryGpuTimeDeferredRender(C);this.fire(new a.Event("gpu-timing-deferred-render",{gpuTime:z}))},50)}const S=this._sourcesDirty||this._styleDirty||this._placementDirty||b;if(S||this._repaint)this.triggerRepaint();else{const C=!this.isMoving()&&this.loaded();if(C&&(b=this._updateAverageElevation(p,!0)),b)this.triggerRepaint();else if(this._triggerFrame(!1),C&&(this.fire(new a.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const z=this._calculateSpeedIndex();this.fire(new a.Event("speedindexcompleted",{speedIndex:z})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||S||(this._fullyLoaded=!0,a.LivePerformanceUtils.mark(a.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&a.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.painter.transform.projection,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(u){for(const r of this._markers)u&&!this.getRenderWorldCopies()&&(r._lngLat=r._lngLat.wrap()),r._update();for(const r of this._popups)!u||this.getRenderWorldCopies()||r._trackPointer||(r._lngLat=r._lngLat.wrap()),r._update()}_updateAverageElevation(u,r=!1){const l=p=>(this.transform.averageElevation=p,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&l(0);if((r||u-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(u)){const p=this.transform.averageElevation;let _=this.transform.sampleAverageElevation(),y=!1;this.transform.elevation&&(y=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(_)?_=0:this._averageElevationLastSampledAt=u;const b=Math.abs(p-_);if(b>1){if(this._isInitialLoad||y)return this._averageElevation.jumpTo(_),l(_);this._averageElevation.easeTo(_,u,300)}else if(b>1e-4)return this._averageElevation.jumpTo(_),l(_)}return!!this._averageElevation.isEasing(u)&&l(this._averageElevation.getValue(u))}_authenticate(){a.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,u=>{if(u&&(u.message===a.AUTH_ERR_MSG||u.status===401)){const r=this.painter.context.gl;a.storeAuthState(r,!1),this._logoControl instanceof Wa&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new a.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),a.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const u=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const l=this.painter.context.gl,p=l.createFramebuffer();function _(y){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,y,0);const b=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,b),b}return l.bindFramebuffer(l.FRAMEBUFFER,p),this._canvasPixelComparison(_(u),r.canvasCopies.map(_),r.timeStamps)}_canvasPixelComparison(u,r,l){let p=l[1]-l[0];const _=u.length/4;for(let y=0;y<r.length;y++){const b=r[y];let S=0;for(let C=0;C<b.length;C+=4)b[C]===u[C]&&b[C+1]===u[C+1]&&b[C+2]===u[C+2]&&b[C+3]===u[C+3]&&(S+=1);p+=(l[y+2]-l[y+1])*(1-S/_)}return p}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),a.window!==void 0&&(a.window.removeEventListener("resize",this._onWindowResize,!1),a.window.removeEventListener("orientationchange",this._onWindowResize,!1),a.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),a.window.removeEventListener("online",this._onWindowOnline,!1));const u=this.painter.context.gl.getExtension("WEBGL_lose_context");u&&u.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),cc(this._canvasContainer),cc(this._controlContainer),cc(this._missingCSSCanary),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),a.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new a.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(u){this._renderNextFrame=this._renderNextFrame||u,this.style&&!this._frame&&(this._frame=a.exported.frame(r=>{const l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(r)}))}_preloadTiles(u){const r=this.style?Object.values(this.style._sourceCaches):[];return a.asyncAll(r,(l,p)=>l._preloadTiles(u,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(u){this._trackResize&&this.resize({originalEvent:u})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(u){this._showTileBoundaries!==u&&(this._showTileBoundaries=u,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(u){this._showTerrainWireframe!==u&&(this._showTerrainWireframe=u,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(u){this._speedIndexTiming!==u&&(this._speedIndexTiming=u,this._update())}get showPadding(){return!!this._showPadding}set showPadding(u){this._showPadding!==u&&(this._showPadding=u,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(u){this._showCollisionBoxes!==u&&(this._showCollisionBoxes=u,u?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(u){this._showOverdrawInspector!==u&&(this._showOverdrawInspector=u,this._update())}get repaint(){return!!this._repaint}set repaint(u){this._repaint!==u&&(this._repaint=u,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(u){this._vertices=u,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(u){this._showTileAABBs!==u&&(this._showTileAABBs=u,u&&this._update())}_setCacheLimits(u,r){a.setCacheLimits(u,r)}get version(){return a.version}},NavigationControl:class{constructor(u){this.options=a.extend({},Ap,u),this._container=ye("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(a.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),ye("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),ye("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{const l=this._map;l&&(this.options.visualizePitch?l.resetNorthPitch({},{originalEvent:r}):l.resetNorth({},{originalEvent:r}))}),this._compassIcon=ye("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const u=this._map;if(!u)return;const r=u.getZoom(),l=r===u.getMaxZoom(),p=r===u.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const u=this._map;if(!u)return;const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(u.transform.pitch*(Math.PI/180)),.5)}) rotateX(${u.transform.pitch}deg) rotateZ(${u.transform.angle*(180/Math.PI)}deg)`:`rotate(${u.transform.angle*(180/Math.PI)}deg)`;u._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(u){return this._map=u,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),u.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&u.on("pitch",this._rotateCompassArrow),u.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ip(u,this._compass,this.options.visualizePitch)),this._container}onRemove(){const u=this._map;u&&(this._container.remove(),this.options.showZoom&&u.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&u.off("pitch",this._rotateCompassArrow),u.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(u,r){const l=ye("button",u,this._container);return l.type="button",l.addEventListener("click",r),l}_setButtonTitle(u,r){if(!this._map)return;const l=this._map._getUIString(`NavigationControl.${r}`);u.setAttribute("aria-label",l),u.firstElementChild&&u.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends a.Evented{constructor(u){super(),this.options=a.extend({geolocation:a.window.navigator.geolocation},zp,u),a.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=$u(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(u){return this._map=u,this._container=ye("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(u){const r=(l=!!this.options.geolocation)=>{this._supportsGeolocation=l,u(l)};this._supportsGeolocation!==void 0?u(this._supportsGeolocation):a.window.navigator.permissions!==void 0?a.window.navigator.permissions.query({name:"geolocation"}).then(l=>r(l.state!=="denied")).catch(()=>r()):r()}_isOutOfMapMaxBounds(u){const r=this._map.getMaxBounds(),l=u.coords;return!!r&&(l.longitude<r.getWest()||l.longitude>r.getEast()||l.latitude<r.getSouth()||l.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(u){if(this._map){if(this._isOutOfMapMaxBounds(u))return this._setErrorState(),this.fire(new a.Event("outofmaxbounds",u)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=u,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(u),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(u),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("geolocate",u)),this._finish()}}_updateCamera(u){const r=new a.LngLat(u.coords.longitude,u.coords.latitude),l=u.coords.accuracy,p=this._map.getBearing(),_=a.extend({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(l),_,{geolocateSource:!0})}_updateMarker(u){if(u){const r=new a.LngLat(u.coords.longitude,u.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=u.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const u=this._map.transform,r=a.mercatorZfromAltitude(1,u._center.lat)*u.worldSize,l=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(u){if(this._map){if(this.options.trackUserLocation)if(u.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(u.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("error",u)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(u){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=ye("button","mapboxgl-ctrl-geolocate",this._container),ye("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",u===!1){a.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ye("div","mapboxgl-user-location"),this._dotElement.appendChild(ye("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ye("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new lc({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ye("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new lc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new a.Event("trackuserlocationend")))})}_onDeviceOrientation(u){this._userLocationDotMarker&&(u.webkitCompassHeading?this._heading=u.webkitCompassHeading:u.absolute===!0&&(this._heading=-1*u.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return a.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let u;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(u={maximumAge:6e5,timeout:0},this._noTimeout=!0):(u=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,u),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const u=()=>{a.window.addEventListener("ondeviceorientationabsolute"in a.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};a.window.DeviceMotionEvent!==void 0&&typeof a.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(r=>{r==="granted"&&u()}).catch(console.error):u()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),a.window.removeEventListener("deviceorientation",this._onDeviceOrientation),a.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:eh,ScaleControl:class{constructor(u){this.options=a.extend({},rh,u),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=kp.bind(this)),a.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const u=this.options.maxWidth||100,r=this._map,l=r._containerHeight/2,p=r._containerWidth/2-u/2,_=r.unproject([p,l]),y=r.unproject([p+u,l]),b=_.distanceTo(y);if(this.options.unit==="imperial"){const S=3.2808*b;S>5280?this._setScale(u,S/5280,"mile"):this._setScale(u,S,"foot")}else this.options.unit==="nautical"?this._setScale(u,b/1852,"nautical-mile"):b>=1e3?this._setScale(u,b/1e3,"kilometer"):this._setScale(u,b,"meter")}_setScale(u,r,l){const p=uc(r),_=p/r;this._map._requestDomTask(()=>{this._container.style.width=u*_+"px",this._container.innerHTML=l!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:l}).format(p):`${p}&nbsp;nm`})}onAdd(u){return this._map=u,this._language=u.getLanguage(),this._container=ye("div","mapboxgl-ctrl mapboxgl-ctrl-scale",u.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(u){this._language=u,this._update()}setUnit(u){this.options.unit=u,this._update()}},FullscreenControl:class{constructor(u){this._fullscreen=!1,u&&u.container&&(u.container instanceof a.window.HTMLElement?this._container=u.container:a.warnOnce("Full screen control 'container' must be a DOM element.")),a.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in a.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in a.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(u){return this._map=u,this._container||(this._container=this._map.getContainer()),this._controlContainer=ye("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,a.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!a.window.document.fullscreenEnabled&&!a.window.document.webkitFullscreenEnabled)}_setupUI(){const u=this._fullscreenButton=ye("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ye("span","mapboxgl-ctrl-icon",u).setAttribute("aria-hidden","true"),u.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),a.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const u=this._getTitle();this._fullscreenButton.setAttribute("aria-label",u),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",u)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(a.window.document.fullscreenElement||a.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?a.window.document.exitFullscreen?a.window.document.exitFullscreen():a.window.document.webkitCancelFullScreen&&a.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends a.Evented{constructor(u){super(),this.options=a.extend(Object.create(Ep),u),a.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(u&&u.className?u.className.trim().split(/\s+/):[])}addTo(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&u.on("preclick",this._onClose),this.options.closeOnMove&&u.on("move",this._onClose),u.on("remove",this.remove),this._update(),u._addPopup(this),this._focusFirstElement(),this._trackPointer?(u.on("mousemove",this._onMouseEvent),u.on("mouseup",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")):u.on("move",this._update),this.fire(new a.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const u=this._map;return u&&(u.off("move",this._update),u.off("move",this._onClose),u.off("preclick",this._onClose),u.off("click",this._onClose),u.off("remove",this.remove),u.off("mousemove",this._onMouseEvent),u.off("mouseup",this._onMouseEvent),u.off("drag",this._onMouseEvent),u._canvasContainer&&u._canvasContainer.classList.remove("mapboxgl-track-pointer"),u._removePopup(this),this._map=void 0),this.fire(new a.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(u){this._lngLat=a.LngLat.convert(u),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const u=this._map;return u&&(u.off("move",this._update),u.on("mousemove",this._onMouseEvent),u.on("drag",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(u){return this.setDOMContent(a.window.document.createTextNode(u))}setHTML(u){const r=a.window.document.createDocumentFragment(),l=a.window.document.createElement("body");let p;for(l.innerHTML=u;p=l.firstChild,p;)r.appendChild(p);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(u){return this.options.maxWidth=u,this._update(),this}setDOMContent(u){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=ye("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(u),this.options.closeButton){const l=this._closeButton=ye("button","mapboxgl-popup-close-button",r);l.type="button",l.setAttribute("aria-label","Close popup"),l.setAttribute("aria-hidden","true"),l.innerHTML="&#215;",l.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(u){return this._classList.add(u),this._updateClassList(),this}removeClassName(u){return this._classList.delete(u),this._updateClassList(),this}setOffset(u){return this.options.offset=u,this._update(),this}toggleClassName(u){let r;return this._classList.delete(u)?r=!1:(this._classList.add(u),r=!0),this._updateClassList(),r}_onMouseEvent(u){this._update(u.point)}_getAnchor(u){if(this.options.anchor)return this.options.anchor;const r=this._map,l=this._container,p=this._pos;if(!r||!l||!p)return"bottom";const _=l.offsetWidth,y=l.offsetHeight,b=p.x<_/2,S=p.x>r.transform.width-_/2;if(p.y+u<y)return b?"top-left":S?"top-right":"top";if(p.y>r.transform.height-y){if(b)return"bottom-left";if(S)return"bottom-right"}return b?"left":S?"right":"bottom"}_updateClassList(){const u=this._container;if(!u)return;const r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),u.className=r.join(" ")}_update(u){const r=this._map,l=this._content;if(!r||!this._lngLat&&!this._trackPointer||!l)return;let p=this._container;if(p||(p=this._container=ye("div","mapboxgl-popup",r.getContainer()),this._tip=ye("div","mapboxgl-popup-tip",p),p.appendChild(l)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Xa(this._lngLat,this._pos,r.transform)),!this._trackPointer||u){const _=this._pos=this._trackPointer&&u?u:r.project(this._lngLat),y=th(this.options.offset),b=this._anchor=this._getAnchor(y.y),S=th(this.options.offset,b),C=_.add(S).round();r._requestDomTask(()=>{this._container&&b&&(this._container.style.transform=`${ac[b]} translate(${C.x}px,${C.y}px)`)})}if(!this._marker&&r._showingGlobe()){const _=a.isLngLatBehindGlobe(r.transform,this._lngLat)?0:1;this._setOpacity(_)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const u=this._container.querySelector(Sp);u&&u.focus()}_onClose(){this.remove()}_setOpacity(u){this._container&&(this._container.style.opacity=`${u}`),this._content&&(this._content.style.pointerEvents=u?"auto":"none")}},Marker:lc,Style:bi,LngLat:a.LngLat,LngLatBounds:a.LngLatBounds,Point:a.pointGeometry,MercatorCoordinate:a.MercatorCoordinate,FreeCameraOptions:Ua,Evented:a.Evented,config:a.config,prewarm:function(){Tt().acquire(gt)},clearPrewarmedResources:function(){const u=ht;u&&(u.isPreloaded()&&u.numActive()===1?(u.release(gt),ht=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return a.config.ACCESS_TOKEN},set accessToken(u){a.config.ACCESS_TOKEN=u},get baseApiUrl(){return a.config.API_URL},set baseApiUrl(u){a.config.API_URL=u},get workerCount(){return pt.workerCount},set workerCount(u){pt.workerCount=u},get maxParallelImageRequests(){return a.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(u){a.config.MAX_PARALLEL_IMAGE_REQUESTS=u},clearStorage(u){a.clearTileCache(u)},workerUrl:"",workerClass:null,setNow:a.exported.setNow,restoreNow:a.exported.restoreNow};return Ha});var I=v;return I})})(B0);const ET=B0.exports,Tz=JS({__proto__:null,default:ET},[B0.exports]);ET.accessToken="pk.eyJ1IjoiYWRlbGluYXJhZHVsZXNjdSIsImEiOiJjbGF0cWFmNTQwM2U4M3Btb2djZWxyM20zIn0.qMv2ldG5SYADLla1erJiLg";function Ez(){return At.exports.useState(0),Jh("div",{className:"App",children:[tr("h1",{children:"Find the location of the libraries situated around Copenhagen Municipality"}),tr(bz,{})]})}Og.createRoot(document.getElementById("root")).render(tr(_C.StrictMode,{children:tr(Ez,{})}));
